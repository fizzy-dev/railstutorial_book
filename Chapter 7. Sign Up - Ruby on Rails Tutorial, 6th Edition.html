<!DOCTYPE html>
<!-- saved from url=(0080)https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml -->
<html class=" js flexbox flexboxlegacy no-touch websqldatabase indexeddb history csscolumns csstransforms localstorage sessionstorage no-applicationcache svg inlinesvg zoom" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#" itemscope="" itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/" data-offline-url="/" data-url="/library/view/ruby-on-rails/9780136702726/ch10.xhtml" data-csrf-cookie="csrfsafari" data-highlight-privacy="" data-user-id="10224494" data-user-uuid="66943332-5511-462c-876e-5d5b720c7edf" data-username="czjtgu3dkobug4zdmolfga2wembsmu" data-account-type="Trial" data-activated-trial-date="12/02/2020" data-archive="9780136702726" data-publishers="Addison-Wesley Professional" data-htmlfile-name="ch10.xhtml" data-epub-title="Ruby on Rails Tutorial, 6th Edition" data-debug="0" data-testing="0" style=""><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="author" content="O&#39;Reilly Media"><meta name="format-detection" content="telephone=no"><meta http-equiv="cleartype" content="on"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="apple-itunes-app" content="app-id=881697395, app-argument=safaridetail://9780136702726"><link rel="shortcut icon" href="https://www.oreilly.com/favicon.ico"><meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, maximum-scale=1.0"><meta property="twitter:account_id" content="4503599627559754"><link rel="shortcut icon" href="https://learning.oreilly.com/favicon.ico" type="image/x-icon"><link href="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/css" rel="stylesheet" type="text/css"><title>Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition</title><link rel="stylesheet" href="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/output.731fc84c4f9a.css" type="text/css"><link rel="stylesheet" type="text/css" href="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/annotator.e3b0c44298fc.css"><link rel="stylesheet" href="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/font-awesome.min.css"><style type="text/css" title="ibis-book">@page{margin:1em 2em}#sbo-rt-content div{margin-top:1em;margin-bottom:1em;margin-left:1em;margin-right:1em;text-align:justify}#sbo-rt-content div.cover img{max-width:99%;max-height:99%}#sbo-rt-content .att{text-align:right}#sbo-rt-content .cover{margin-top:.5em;margin-bottom:.5em;text-align:center}#sbo-rt-content .h1{margin-top:1.5em;margin-bottom:.5em;font-weight:bold;font-size:210%;page-break-after:avoid;border-bottom:solid .1em;text-align:center}#sbo-rt-content .halftitle{margin-top:1em;margin-bottom:2em;font-weight:bold;font-size:210%;page-break-after:avoid;text-align:center}#sbo-rt-content .h2{margin-top:1em;margin-bottom:.1em;font-weight:bold;font-size:180%;border-bottom:solid .1em;page-break-after:avoid;text-align:left}#sbo-rt-content .h2f{margin-top:1em;margin-bottom:2.5em;font-weight:bold;font-size:190%;border-bottom:solid .1em;page-break-after:avoid;text-align:left}#sbo-rt-content .h2t{margin-top:1em;margin-bottom:2em;font-weight:bold;font-size:190%;border-bottom:solid .1em;page-break-after:avoid;text-align:left}#sbo-rt-content .center{text-align:center}#sbo-rt-content .h3{margin-top:.5em;margin-bottom:.001em;font-weight:bold;font-size:160%;page-break-after:avoid;text-align:left}#sbo-rt-content .h4{margin-top:.5em;margin-bottom:.001em;font-weight:bold;font-size:130%;page-break-after:avoid;text-align:left}#sbo-rt-content .h5{margin-top:.5em;margin-bottom:.001em;font-weight:bold;font-size:120%;page-break-after:avoid;text-align:left}#sbo-rt-content ul{margin-top:1em;margin-bottom:1em;margin-left:.2em}#sbo-rt-content ul.sq{list-style-type:square}#sbo-rt-content ul.sq li p,#sbo-rt-content ul.sq li p.noindent{margin-top:.5em;margin-left:1em;margin-bottom:.5em;text-indent:.002em}#sbo-rt-content .left{text-align:left}#sbo-rt-content .ex-title{margin-top:.8em;margin-bottom:.5em;text-indent:.1em;font-size:100%}#sbo-rt-content code{font-family:Courier,Courier New,monospace;font-size:small}#sbo-rt-content pre{font-family:Courier,Courier New,monospace;margin-top:.6em;margin-bottom:1em;margin-left:.1em;line-height:1.3em;font-size:small}#sbo-rt-content .pre3{font-family:Courier,Courier New,monospace;margin-top:1em;margin-bottom:1em;margin-left:2.9em;background-color:#E6E6E6}#sbo-rt-content .equ{margin-top:.8em;margin-bottom:.5em;text-align:center}#sbo-rt-content .footnum{margin-top:.7em;margin-bottom:.5em;text-indent:-1em;margin-left:3.3em}#sbo-rt-content .footnotep{margin-top:.8em;margin-left:.8em;margin-bottom:.5em;text-indent:.8em}#sbo-rt-content .mark1{background-color:#F4F7F9}#sbo-rt-content .codelink{margin-top:.2em;margin-bottom:.5em}#sbo-rt-content .middle img{vertical-align:middle}#sbo-rt-content .box{margin-top:.6em;margin-bottom:1em;margin-left:.1em;margin-right:.8em;padding:.8em;background-color:#E6E6E6}#sbo-rt-content .box-bq{font-size:.8em;margin-top:.8em;margin-bottom:.5em;margin-left:1.6em;text-indent:.1em;background-color:#E6E6E6}#sbo-rt-content .boxip{margin-top:.5em;margin-left:.1em;margin-bottom:.5em;text-indent:.8em;background-color:#E6E6E6}#sbo-rt-content ol.num{list-style-type:number;font-weight:normal}#sbo-rt-content ol.num li p{list-style-type:number;font-weight:normal}#sbo-rt-content ol.num li p,#sbo-rt-content ol.num li p.number{margin-top:.5em;margin-left:.2em;margin-bottom:.5em;text-indent:.002em}#sbo-rt-content .num-p{margin-top:.5em;margin-bottom:.5em;margin-left:0}#sbo-rt-content .bullet{margin-top:.7em;margin-bottom:.5em;text-indent:-.8em;margin-left:2em}#sbo-rt-content .credit{margin-top:.1em;margin-bottom:.1em;text-indent:-1.5em;margin-left:2em}#sbo-rt-content .box-caption{margin-top:.1em;margin-bottom:1em;font-size:125%;font-weight:bold;text-indent:.02em;text-align:left}#sbo-rt-content .example{font-family:Courier,Courier New,monospace;margin-top:.6em;margin-bottom:1em;margin-left:.1em;line-height:1.3em;font-size:small;border-top:.02em solid black;border-bottom:.02em solid black}#sbo-rt-content .image-l{margin-top:.8em;margin-left:1em;text-align:center}#sbo-rt-content .topbot{margin-top:.8em;margin-bottom:.5em;border-bottom:solid black .1em;border-top:solid black .1em;text-indent:.1em}#sbo-rt-content .uln{margin-top:.7em;margin-bottom:.7em;margin-left:2em}#sbo-rt-content .fdash{margin-top:.7em;margin-bottom:.7em;margin-left:2em}#sbo-rt-content .fdash1{margin-top:.7em;margin-bottom:.7em;margin-left:3em}#sbo-rt-content .tr{border-bottom:.1em solid black}#sbo-rt-content th{text-align:left}#sbo-rt-content td{padding-left:.1em;padding-top:0;padding-bottom:0;vertical-align:top;text-align:left}#sbo-rt-content .mark{background-color:#E6E6E6}#sbo-rt-content .pre1{font-family:Courier,Courier New,monospace;margin-top:.2em;margin-bottom:1em;margin-left:0;padding:.8em;background-color:#E6E6E6}#sbo-rt-content .pre2{font-family:Courier,Courier New,monospace;margin-top:.2em;margin-bottom:1em;margin-left:.2em}#sbo-rt-content .tab-thc{margin-top:.1em;margin-bottom:.1em;border-bottom:solid black .1em;text-align:center}#sbo-rt-content .tab-th{margin-top:.1em;border-bottom:solid black .1em;border-top:solid black .1em;text-align:left}#sbo-rt-content .author{margin-top:2.5em;margin-bottom:5.5em;text-align:center;font-size:120%}#sbo-rt-content .pub{margin-top:1.5em;margin-bottom:.5em;text-align:center}#sbo-rt-content .pub1{font-weight:bold;font-size:.9em;margin-top:.1em;margin-bottom:.5em;text-align:center}#sbo-rt-content .copy{margin-top:.9em;margin-bottom:.5em;text-indent:.02em}#sbo-rt-content .copy1{margin-top:.9em;margin-bottom:.2em;text-indent:.02em}#sbo-rt-content .copy2{margin-top:.2em;margin-bottom:.5em;text-indent:.02em}#sbo-rt-content .title{margin-top:1em;margin-bottom:.2em;font-size:125%;font-weight:bold;text-indent:.02em;text-align:center}#sbo-rt-content .noindent{margin-top:.5em;margin-bottom:.5em;text-indent:.1em}#sbo-rt-content .tab-para{margin-top:.1em;margin-bottom:.1em;margin-left:.1em;text-indent:0}#sbo-rt-content .tab-parai{margin-top:.1em;margin-bottom:.1em;margin-left:1.1em;text-indent:-1.1em}#sbo-rt-content .boxnp{margin-top:.5em;margin-bottom:.5em;text-indent:.1em}#sbo-rt-content .toc-intro{margin-top:.1em;margin-bottom:.5em;margin-left:1.5em;text-align:left}#sbo-rt-content .tocchap{margin-top:1.5em;margin-bottom:.4em;margin-left:3.4em;text-indent:-4em}#sbo-rt-content .toclev1{margin-top:.4em;margin-bottom:.4em;margin-left:1em}#sbo-rt-content .toclev2{margin-top:.4em;margin-bottom:.4em;margin-left:2.6em}#sbo-rt-content .toclev1a{margin-top:.4em;margin-bottom:.4em;margin-left:.5em}#sbo-rt-content .toc-index{margin-top:2em;margin-bottom:.4em;margin-left:.7em}#sbo-rt-content .indexmain{margin-top:.4em;margin-bottom:.2em;margin-left:.8em;text-indent:-.8em}#sbo-rt-content .indexsub{margin-top:.4em;margin-bottom:.2em;margin-left:1.7em;text-indent:-.7em}#sbo-rt-content .indexsubsub{margin-top:.4em;margin-bottom:.2em;font-style:italic;margin-left:3em;text-indent:-.9em}#sbo-rt-content figcaption{margin-top:.8em;margin-bottom:.5em;color:black;text-align:left;text-indent:.1em}#sbo-rt-content .subtitle{margin-top:.1em;margin-bottom:1em;font-weight:bold;font-size:150%;page-break-after:avoid;text-align:center}#sbo-rt-content .edition{margin-top:2em;margin-bottom:3em;font-weight:bold;font-size:150%;page-break-after:avoid;text-align:center}#sbo-rt-content .indent{margin-top:.5em;margin-left:.1em;margin-bottom:.5em;text-indent:1.5em}#sbo-rt-content .h2a{margin-top:.1em;margin-bottom:2em;font-weight:bold;font-size:190%;page-break-after:avoid;text-align:left}#sbo-rt-content figure>img{max-width:99%;max-height:99%}#sbo-rt-content figure{margin-top:1em;margin-bottom:1em;margin-left:.5em;margin-right:1.5em}#sbo-rt-content none{list-style-type:none}#sbo-rt-content a{text-decoration:none}#sbo-rt-content .footnote{font-size:.8em;margin-top:.1em;margin-bottom:.5em;margin-left:.8em}#sbo-rt-content .none{margin-top:.5em;margin-left:1em;margin-bottom:.5em;list-style-type:none}#sbo-rt-content div.image-p img{width:80%}#sbo-rt-content .image-p{page-break-before:always;text-align:center}#sbo-rt-content table{border-collapse:collapse;border-spacing:0;background:transparent;vertical-align:top;margin-top:.1em;margin-right:.1em;margin-bottom:.9em;margin-left:0;width:100%}#sbo-rt-content .tab-parar{margin-top:.1em;margin-bottom:.1em;text-indent:.1em;text-align:right}#sbo-rt-content .h2i{margin-top:1em;margin-bottom:2.1em;font-weight:bold;font-size:190%;border-bottom:solid .1em;page-break-after:avoid;text-align:left}#sbo-rt-content pre{overflow:auto;-ms-overflow:auto;-moz-overflow:auto;-webkit-overflow:auto;-ms-padding-bottom:5pt;-moz-padding-bottom:5pt;-webkit-padding-bottom:5pt}#sbo-rt-content .maroon{color:#BB2121}#sbo-rt-content .green{color:#005A00}#sbo-rt-content .green1{color:#48785D}#sbo-rt-content .navy{color:#504B72}#sbo-rt-content .ash{color:#666}#sbo-rt-content .blue{color:#408080}#sbo-rt-content .green3{color:#00A100}#sbo-rt-content .blue1{color:#0000B8}#sbo-rt-content .violet{color:#1A177D}#sbo-rt-content .pink{color:#A131A1}#sbo-rt-content .pink1{color:#A131A1}#sbo-rt-content .red{color:#800}#sbo-rt-content .blue3{color:#2E3192}#sbo-rt-content .red2{color:#B80000}#sbo-rt-content .green4{color:#269200}#sbo-rt-content .ash1{color:#666}#sbo-rt-content .ash2{color:#33484A}#sbo-rt-content .red2{color:#640000}#sbo-rt-content .ash3{color:#7D8F29}#sbo-rt-content .red5{color:#BD7B00}#sbo-rt-content .maroon1{color:#B66600}#sbo-rt-content .blue5{color:#1F3BFF}#sbo-rt-content .red6{color:#B68}#sbo-rt-content .green7{color:#14B600}#sbo-rt-content .maroon2{color:#B66600}#sbo-rt-content .pink2{color:#AC21FF}#sbo-rt-content .pink3{color:#AC21FF}#sbo-rt-content .lighgreen{color:#5FA100}#sbo-rt-content .lighblue{color:#269271}#sbo-rt-content .darkmaroon{color:#269271}#sbo-rt-content .maroon5{color:#A10000}#sbo-rt-content .blue6{color:#0000B9}#sbo-rt-content .marko{background-color:#FAF9CE}#sbo-rt-content .green5{color:#1C8B43}#sbo-rt-content .colork1{color:#136433;font-weight:bold}#sbo-rt-content .colork2{color:#504C72}#sbo-rt-content .colork3{color:#51785D}#sbo-rt-content .colork4{color:#303192}#sbo-rt-content .colork5{color:#955744}#sbo-rt-content .colork6{color:#5C70BA}#sbo-rt-content .colork7{color:#487864}#sbo-rt-content .colork8{color:#5C5778}#sbo-rt-content .colork9{color:#666}#sbo-rt-content .colork10{color:#48785D}#sbo-rt-content .colork11{color:#BC654D}#sbo-rt-content .colork12{color:#3E8185}#sbo-rt-content .colork13{color:#C62425}#sbo-rt-content .colork14{color:#1D8C43}#sbo-rt-content .colork15{color:#0D8140}#sbo-rt-content .colork16{color:#BB2425}#sbo-rt-content .colork17{color:#985744}#sbo-rt-content .colork18{color:#6C8896}#sbo-rt-content .colork19{color:#2A2C80}#sbo-rt-content .colork20{color:#BD2425}#sbo-rt-content .redk1{color:#EE1C25}#sbo-rt-content .colork21{color:#2A2C77}#sbo-rt-content .colork22{color:#955744}#sbo-rt-content .colork23{color:#BC6561}#sbo-rt-content .colork24{color:#BE7D2B}#sbo-rt-content .colork25{color:#8E7C5D}#sbo-rt-content .colork26{color:#7C5778}#sbo-rt-content .colork27{color:#9D1C1F}#sbo-rt-content .colork28{color:#AA5744}#sbo-rt-content .colork29{color:#C59861}#sbo-rt-content .grayk1{color:#C0908E}#sbo-rt-content .pd_green{color:#48785d}#sbo-rt-content .dark-green{color:#146333}#sbo-rt-content .mark1{background-color:#faf9ce}#sbo-rt-content .mark{background-color:#faf9ce}#sbo-rt-content .pd_ash{color:#666}#sbo-rt-content .pd_blue7{color:#6c8896}#sbo-rt-content .pd_blue1{color:#504b72}#sbo-rt-content .pd_red{color:#965744}#sbo-rt-content .pd_red2{color:#bb654e}#sbo-rt-content .pd_red5{color:#ed1c24}#sbo-rt-content .pd_blue5{color:#2e3192}#sbo-rt-content .pd_green4{color:#269200}#sbo-rt-content .pd_green5{color:#1c8b43}#sbo-rt-content .pd_blue3{color:#2c2c78}#sbo-rt-content .pd_orange{color:#c49847}</style><script type="text/javascript" async="" src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/cool-2.1.15.min.js.download"></script><script type="text/javascript" async="" src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/ec.js.download"></script><script type="text/javascript" async="" src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/analytics.js.download"></script><script type="text/javascript" async="" src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/f.txt"></script><script type="text/javascript" async="" src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/js"></script><script crossorigin="anonymous" integrity="sha256-NiDMmov61Y536X/eLXLiDGzFVFmNLtPyu4b5aFB54ks=" type="text/javascript" src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/appcues.main.11e38ef4746fd64ab30c11794299d10b30bcb704.js.download" async=""></script><script async="" src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/gtm.js.download"></script><script> // <![CDATA[
    var g = {
      position_cache: {
        
          "chapter": "/api/v1/book/9780136702726/chapter/ch10.xhtml",
          "book_id": "9780136702726",
          "chapter_uri": "ch10.xhtml",
          "position": 27.4567491080775,
          "user_uuid": "66943332-5511-462c-876e-5d5b720c7edf",
          "next_chapter_uri": "/library/view/ruby-on-rails/9780136702726/ch11.xhtml"
        
      },
      title: "Ruby on Rails Tutorial, 6th Edition",
      author_list: "Michael Hartl",
      format: "book",
      source: "application/epub+zip",
      is_system_book: true,
      is_public: false,
      loaded_from_server: true,
      allow_scripts: false,
      has_mathml: true
    };
    // ]]></script><script src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/modernizr.8e35451ddb64.js.download"></script><script>
    
      

      
        
          window.PUBLIC_ANNOTATIONS = true;
        
      

      window.MOBILE_PUBLIC_ANNOTATIONS = false;

    

    
      window.PRIVACY_CONTROL_OVERRIDE = false;
    

      window.PRIVACY_CONTROL_SWITCH = true;

      window.PUBLISHER_PAGES = true;

      window.SBO = {
        "constants": {
          "SITB_ENDPOINT": "/api/v2/sitb/",
          "SEARCH_SELECT_ENDPOINT": "https://learning.oreilly.com/api/v2/search/select/",
          "ENABLE_ONLINE_TRAINING": true
        }
      };
  </script><link rel="canonical" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch10.xhtml"><meta name="description" content=" Chapter 10 Updating, Showing, and Deleting Users In this chapter, we complete the REST actions for the Users resource (Table 7.1) by adding edit, update, index ... "><meta property="og:title" content="Chapter 10. Updating, Showing, and Deleting Users"><meta itemprop="isPartOf" content="/library/view/ruby-on-rails/9780136702726/"><meta itemprop="name" content="Chapter 10. Updating, Showing, and Deleting Users"><meta property="og:url" itemprop="url" content="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch10.xhtml"><meta property="og:site_name" content="Safari"><meta property="og:image" itemprop="thumbnailUrl" content="https://learning.oreilly.com/library/cover/9780136702726/"><meta property="og:description" itemprop="description" content=" Chapter 10 Updating, Showing, and Deleting Users In this chapter, we complete the REST actions for the Users resource (Table 7.1) by adding edit, update, index ... "><meta itemprop="inLanguage" content="en"><meta itemprop="publisher" content="Addison-Wesley Professional"><meta property="og:type" content="book"><meta property="og:book:isbn" itemprop="isbn" content="9780136702726"><meta property="og:book:author" itemprop="author" content="Michael Hartl"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@OReillyMedia"><style type="text/css" id="font-styles" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-size: &lt;%= font_size %&gt; !important; }"></style><style type="text/css" id="font-family" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-family: &lt;%= font_family %&gt; !important; }"></style><style type="text/css" id="column-width" data-template="#sbo-rt-content { max-width: &lt;%= column_width %&gt;% !important; margin: 0 auto !important; }"></style><noscript><meta http-equiv="refresh" content="0; url=/library/no-js/" /></noscript><script>
    var dataLayer = window.dataLayer || [];

    
      window.medalliaVsgUserIdentifier = '66943332-5511-462c-876e-5d5b720c7edf';
      dataLayer.push({userIdentifier: '66943332-5511-462c-876e-5d5b720c7edf'});
      dataLayer.push({loggedIn: 'yes'});

      
        window.medalliaVsgAccountIdentifier = 'ba5f3401-307d-4b66-90a6-a97047c63525';
        

        window.medalliaVsgIsIndividual = true;
        
          
          dataLayer.push({learningAccountType: 'free trial'});
          
        

        
      
    

    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-5P4V6Z');
    (function () {
      var VERSION = 'V1.1';
      var AUTHOR = 'Awwad';
      if (!window.GtmHelper)
        window.GtmHelper = function () {
          var instance = this;
          var loc = document.location;
          this.version = VERSION;
          this.author = AUTHOR;
          this.readCookie = function (name) {
            var nameEQ = name + "=";
            var ca = document.cookie.split(';');
            for (var i = 0; i < ca.length; i++) {
              var c = ca[i];
              while (c.charAt(0) == ' ') c = c.substring(1, c.length);
              if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
          };
          this.createCookie = function (name, value, days, cookieDomain) {
            var domain = "";
            var expires = "";

            if (days) {
              var date = new Date();
              date.setTime(date.getTime() + Math.ceil(days * 24 * 60 * 60 * 1000));
              var expires = " expires=" + date.toGMTString() + ";";
            }

            if (typeof (cookieDomain) != 'undefined')
              domain = " domain=" + cookieDomain + "; ";

            document.cookie = name + "=" + value + ";" + expires + domain + "path=/";
          };

          this.isDuplicated = function (currentTransactionId) {
            // the previous transaction id:
            var previousTransIdValue = this.readCookie("previousTransId");

            if (currentTransactionId === previousTransIdValue) {
              return true; // Duplication
            } else {
              return false;
            }
          };
        }
    })()
  </script><script defer="" src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/vendor.3eecedff6f59.js.download"></script><script defer="" src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/reader.772cf1e31d6c.js.download"></script><iframe src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/saved_resource.html"></iframe><iframe src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/saved_resource(3).html"></iframe><iframe src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/saved_resource(4).html"></iframe><link rel="stylesheet" type="text/css" integrity="sha256-q9sKb2HpA5fJjN1cK9LjLaEXff5ix81Rv1Y3xJFptPE=" crossorigin="anonymous" href="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/container.11e38ef4746fd64ab30c11794299d10b30bcb704.css"><iframe src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/saved_resource(5).html"></iframe><script src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/f(1).txt"></script><script async="" src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/MathJax.js.download"></script><style id="annotator-dynamic-style">.annotator-adder, .annotator-outer, .annotator-notice {
  z-index: 100019;
}
.annotator-filter {
  z-index: 100009;
}</style><style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 2px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 2px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: 1em}
.MathJax_MenuRadioCheck.RTL {right: 1em; left: auto}
.MathJax_MenuLabel {padding: 2px 2em 4px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #CCCCCC; margin: 4px 1px 0px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: Highlight; color: HighlightText}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
</style><style type="text/css" id="kampyleStyle">.noOutline{outline: none !important;}.wcagOutline:focus{outline: 1px dashed #595959 !important;outline-offset: 2px !important;transition: none !important;}</style></head>


<body class="reading sidenav  scalefonts subscribe-panel library nav-collapsed"><div id="MathJax_Message" style="display: none;"></div>

    
  <noscript> 
    <iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P4V6Z"
            height="0" width="0"
            style="display:none;visibility:hidden">
    </iframe>
  </noscript>



    
      <div class="working hide" role="status">
        <div class="working-image"></div>
      </div>
      <div class="sbo-site-nav">
        

  


<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#container" class="skip">Skip to content</a><header class="topbar t-topbar"><nav role="navigation" class="js-site-nav"><ul class="topnav"><li><a href="https://learning.oreilly.com/home/" class="l0 nav-icn"><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M11.738 14H9.254v-3.676a.617.617 0 0 0-.621-.613H7.39a.617.617 0 0 0-.62.613V14H4.284a.617.617 0 0 1-.622-.613V10.22c0-.327.132-.64.367-.87l3.547-3.493a.627.627 0 0 1 .875 0l3.54 3.499c.234.229.366.54.367.864v3.167a.617.617 0 0 1-.62.613zM7.57 2.181a.625.625 0 0 1 .882 0l5.77 5.692-.93.92-5.28-5.209-5.28 5.208-.932-.919 5.77-5.692z"></path></svg><span>Home</span></a></li><li class="search"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#" class="t-search-nav trigger nav-icn l0" data-dropdown-selector=".searchbox"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>search icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M31.3 0C20.9 0 12.5 8.4 12.5 18.8 12.5 22.5 13.6 25.9 15.4 28.8L1.2 42.9C-0.4 44.5-0.4 47.2 1.2 48.8 2 49.6 3.1 50 4.2 50 5.2 50 6.3 49.6 7.1 48.8L21.2 34.6C24.1 36.5 27.5 37.5 31.3 37.5 41.6 37.5 50 29.1 50 18.8 50 8.4 41.6 0 31.3 0ZM31.3 31.3C24.4 31.3 18.8 25.6 18.8 18.8 18.8 11.9 24.4 6.3 31.3 6.3 38.1 6.3 43.8 11.9 43.8 18.8 43.8 25.6 38.1 31.3 31.3 31.3Z"></path></g></svg><span>Search</span></a></li><li class="usermenu dropdown"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#" class="trigger l0 nav-icn nav-dropdown"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>navigation arrow</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M0.1 12.5L9.7 3.1C9.8 3 9.9 3 10 3 10.1 3 10.2 3 10.3 3.1L19.9 12.5C20 12.5 20 12.6 20 12.8 20 12.9 20 13 19.9 13L17 15.9C16.9 16 16.8 16 16.7 16 16.5 16 16.4 16 16.4 15.9L10 9.7 3.6 15.9C3.6 16 3.5 16 3.3 16 3.2 16 3.1 16 3 15.9L0.1 13C0 12.9 0 12.8 0 12.7 0 12.7 0 12.6 0.1 12.5Z"></path></g></svg><span>Expand Nav</span></a><div class="drop-content"><ul><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#" class="l1 nav-icn "><!--?xml version="1.0" encoding="UTF-8"?--><svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M8,8 C6.34321755,8 5.00013,6.65691245 5.00013,5.00013 C5.00013,3.34334755 6.34321755,2.00026001 8,2.00026001 C9.65678245,2.00026001 10.99987,3.34334755 10.99987,5.00013 C10.99987,6.65691245 9.65678245,8 8,8 Z M2.33024571,11.3523547 L2.33774538,11.3523547 C3.7622187,9.70968996 5.82947484,8.76608166 8.00374984,8.76608166 C10.1780248,8.76608166 12.245281,9.70968996 13.6697543,11.3523547 C13.8892083,11.6177474 14.0062813,11.9530021 13.99974,12.2973138 L13.99974,13.99974 L2.00026001,13.99974 L2.00026001,12.2973138 C1.99371867,11.9530021 2.11079172,11.6177474 2.33024571,11.3523547 Z" id="path-1"></path></svg><span>Your O'Reilly</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/profile/" class="l2 nav-icn"><span>Profile</span></a></li><li><a href="https://learning.oreilly.com/history/" class="l2 nav-icn"><span>History</span></a></li><li><a href="https://learning.oreilly.com/playlists/" class="l2 nav-icn"><span>Playlists</span></a></li><li><a href="https://learning.oreilly.com/u/66943332-5511-462c-876e-5d5b720c7edf/" class="l2 nav-icn"><span>Highlights</span></a></li></ul></li><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#" class="l1 nav-icn "><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M11.564 2.263l2.172 2.174c.17.168.264.397.264.636V11a.6.6 0 0 1-.6.6h-.6V6.2h-6V2.6a.6.6 0 0 1 .6-.6h3.527c.239 0 .468.095.637.263zM2.6 14a.6.6 0 0 1-.6-.6V6.8a.6.6 0 0 1 .6-.6h1.903a1.2 1.2 0 0 1 .849.352L6.2 7.4H11a.6.6 0 0 1 .6.6v5.4a.6.6 0 0 1-.6.6H2.6zM11 5h1.8L11 3.2V5z"></path></svg><span>Featured</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/featured/navigating-21st-century/" class="l2 nav-icn"><span>Navigating Change</span></a></li><li><a href="https://learning.oreilly.com/recommendations/" class="l2 nav-icn"><span>Recommended</span></a></li></ul></li><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#" class="l1 nav-icn "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>queue icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 29.2C25.4 29.2 25.8 29.1 26.1 28.9L48.7 16.8C49.5 16.4 50 15.5 50 14.6 50 13.7 49.5 12.8 48.7 12.4L26.1 0.3C25.4-0.1 24.6-0.1 23.9 0.3L1.3 12.4C0.5 12.8 0 13.7 0 14.6 0 15.5 0.5 16.4 1.3 16.8L23.9 28.9C24.2 29.1 24.6 29.2 25 29.2ZM7.3 14.6L25 5.2 42.7 14.6 25 24 7.3 14.6ZM48.7 22.4L47.7 21.9 25 34.2 2.3 21.9 1.3 22.4C0.5 22.9 0 23.7 0 24.7 0 25.6 0.5 26.5 1.3 26.9L23.9 39.3C24.2 39.5 24.6 39.6 25 39.6 25.4 39.6 25.8 39.5 26.1 39.3L48.7 26.9C49.5 26.5 50 25.6 50 24.7 50 23.7 49.5 22.9 48.7 22.4ZM48.7 32.8L47.7 32.3 25 44.6 2.3 32.3 1.3 32.8C0.5 33.3 0 34.1 0 35.1 0 36 0.5 36.9 1.3 37.3L23.9 49.7C24.2 49.9 24.6 50 25 50 25.4 50 25.8 49.9 26.1 49.7L48.7 37.3C49.5 36.9 50 36 50 35.1 50 34.1 49.5 33.3 48.7 32.8Z"></path></g></svg><span>Explore</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/topics/" class="l2 nav-icn"><span>All Topics</span></a></li><li><a href="https://learning.oreilly.com/search/?query=&amp;extended_publisher_data=true&amp;highlight=true&amp;include_assessments=false&amp;include_case_studies=true&amp;include_courses=true&amp;include_orioles=true&amp;include_playlists=true&amp;include_collections=true&amp;include_notebooks=true&amp;is_academic_institution_account=false&amp;source=user&amp;formats=book&amp;sort=publication_date&amp;facet_json=true&amp;page=0" class="l2 nav-icn"><span>Early Releases</span></a></li><li><a href="https://learning.oreilly.com/playlists/discover/" class="l2 nav-icn"><span>Shared Playlists</span></a></li><li><a href="https://learning.oreilly.com/search/?query=&amp;extended_publisher_data=true&amp;highlight=true&amp;include_assessments=false&amp;include_case_studies=true&amp;include_courses=true&amp;include_orioles=true&amp;include_playlists=true&amp;include_collections=true&amp;include_notebooks=true&amp;is_academic_institution_account=false&amp;source=user&amp;formats=book&amp;formats=case%20study&amp;formats=learning%20path&amp;formats=live%20online%20training&amp;formats=notebook&amp;formats=oriole&amp;formats=video&amp;sort=popularity&amp;facet_json=true&amp;page=0&amp;collection_type=expert" class="l2 nav-icn"><span>Most Popular Titles</span></a></li><li><a href="https://learning.oreilly.com/resource-centers/" class="l2 nav-icn"><span>Resource Centers</span></a></li></ul></li><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#" class="l1 nav-icn "><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M12.8 3.2A1.2 1.2 0 0 1 14 4.4v8.4a1.2 1.2 0 0 1-1.2 1.2H3.2A1.2 1.2 0 0 1 2 12.8V4.4a1.2 1.2 0 0 1 1.2-1.2h1.2V2h1.2v1.2h4.8V2h1.2v1.2h1.2zm-9.6 9.6h9.6V6.2H3.2v6.6zM8 9.5a1.35 1.35 0 1 1 0-2.7 1.35 1.35 0 0 1 0 2.7zm2.7 2.148v.552H5.3v-.552c0-.321.124-.634.355-.858a3.358 3.358 0 0 1 4.69 0c.23.224.355.537.355.858z"></path></svg><span>Attend</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/live-training/" class="l2 nav-icn"><span>Live Trainings</span></a></li><li><a href="https://learning.oreilly.com/featured/architectural-katas" class="l2 nav-icn"><span>Architectural Katas</span></a></li><li><a href="https://learning.oreilly.com/featured/strata/" class="l2 nav-icn"><span>Strata</span></a></li><li><a href="https://learning.oreilly.com/featured/oscon/" class="l2 nav-icn"><span>Open Source</span></a></li><li><a href="https://learning.oreilly.com/featured/infrastructure-ops/" class="l2 nav-icn"><span>Infra &amp; Ops</span></a></li><li><a href="https://learning.oreilly.com/featured/software-architecture/" class="l2 nav-icn"><span>Software Arch</span></a></li></ul></li><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#" class="l1 nav-icn "><svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M11.6467109,4.35328907 L14.7964612,7.51003884 C15.0678463,7.78304342 15.0678463,8.22395603 14.7964612,8.49696061 L11.6467109,11.6467109 L10.6597892,10.6597892 L13.3055794,8 L10.6597892,5.34021084 L11.6467109,4.35328907 Z M4.35328907,11.6467109 L1.20353875,8.48996116 C0.932153749,8.21695658 0.932153749,7.77604397 1.20353875,7.50303939 L4.35328907,4.35328907 L5.34021084,5.34021084 L2.69442057,8 L5.34021084,10.6597892 L4.35328907,11.6467109 Z M5.84417089,11.4997226 L8.67194674,4.50027742 L10.1838269,4.50027742 L7.35605105,11.4997226 L5.84417089,11.4997226 Z" id="Mask"></path></svg><span>Interact</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/scenarios/?classification=content-scenario" class="l2 nav-icn"><span>Scenarios</span></a></li><li><a href="https://learning.oreilly.com/scenarios/?classification=sandbox-scenario" class="l2 nav-icn"><span>Sandboxes</span></a></li><li><a href="https://learning.oreilly.com/interactive/?classification=jupyter-notebook" class="l2 nav-icn"><span>Jupyter Notebooks</span></a></li></ul></li><li><a href="https://learning.oreilly.com/answers/" class="l1 nav-icn "><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path d="M2.31032699,3.75609006 C4.65421571,1.41371359 8.45302454,1.41472092 10.7955702,3.75860838 C13.1381158,6.10249583 13.1369405,9.90130261 10.7930518,12.243847 C8.44916311,14.5863913 4.65018639,14.5852161 2.30780867,12.2413286 C-0.0346204845,9.89749489 -0.0334929936,6.09853298 2.31032699,3.75609006 Z M8.8198605,4.98016308 C7.34193969,3.86924672 5.23410194,3.98609692 3.88914868,5.33104946 C3.12814393,6.09032122 2.72818176,7.13880077 2.79015179,8.21201133 C2.79115912,8.23064692 2.79233434,8.24928252 2.79350956,8.26791811 L2.79350956,8.26791811 C2.83179539,8.8307976 2.9944077,9.37404287 3.26947292,9.86201677 L3.26947292,9.86201677 L2.77621706,11.7027432 C2.7699968,11.7259241 2.77662063,11.7506624 2.79359185,11.7676337 C2.8105631,11.7846049 2.83530144,11.7912287 2.85848233,11.7850085 L2.85848233,11.7850085 L4.69400524,11.2922565 C5.26306363,11.6167344 5.90703177,11.786885 6.56209849,11.7858479 C8.64827865,11.7858479 10.3395879,10.094542 10.3395879,8.00836292 C10.3405204,6.84135608 9.80105674,5.73967784 8.87862141,5.02482134 L8.87862141,5.02482134 L8.82825492,4.98654283 Z M13.7933062,2 C14.7073496,2.00009863 15.4482759,2.74110484 15.4482759,3.65514822 C15.4482759,4.32460943 15.0449926,4.92814782 14.4264842,5.18432286 C13.8079757,5.44049789 13.096053,5.29885769 12.6226979,4.82545158 C12.1493429,4.35204547 12.0077795,3.64010743 12.2640213,3.02162665 C12.5202631,2.40314587 13.123845,1.99992776 13.7933062,2 Z"></path></svg><span>Answers</span></a></li><li><a href="https://learning.oreilly.com/certifications/" class="l1 nav-icn "><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path d="M12.912 9.18L14 8.014l-1.088-1.18a.304.304 0 01-.075-.268L13.195 5l-1.535-.463a.313.313 0 01-.194-.194l-.462-1.537-1.565.358c-.09.03-.194 0-.269-.074L8.007 2 6.845 3.09a.303.303 0 01-.269.074l-1.565-.358-.462 1.537a.313.313 0 01-.194.194L2.82 5l.358 1.567a.26.26 0 01-.075.269L2 8.015l1.088 1.164c.075.075.09.18.075.269l-.358 1.567 1.535.463c.09.03.164.104.194.194l.462 1.537 1.565-.358c.015 0 .045-.015.075-.015.075 0 .15.03.209.074L8.007 14l1.163-1.09a.303.303 0 01.269-.074l1.565.358.462-1.537a.313.313 0 01.194-.194L13.195 11l-.358-1.567a.338.338 0 01.075-.254zm-6.046 1.37L4.41 8.26l1.16-1.244 1.767 1.649L10.4 5.6l1.202 1.202-4.242 4.243-.495-.495z"></path></svg><span>Certifications</span></a></li><li><a href="https://learning.oreilly.com/preferences/" class="l1 nav-icn "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" width="20" height="20" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z"></path></g></svg><span>Settings</span></a></li><li><a href="https://learning.oreilly.com/public/support/" class="l1 nav-icn "><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M7.363 6.656a2.692 2.692 0 0 1-2.681-2.703c0-1.493 1.2-2.703 2.681-2.703a2.692 2.692 0 0 1 2.682 2.703c0 1.493-1.2 2.703-2.682 2.703zm4.023 2.027c-1.852 0-3.352 1.513-3.352 3.379H2v-1.534c-.006-.31.099-.612.295-.852a6.666 6.666 0 0 1 9.09-.993zm-.543.676h1.12v.304c.003.284.16.543.408.676a.766.766 0 0 0 .77 0l.303-.176.556.966-.302.176a.772.772 0 0 0-.362.676v.08a.772.772 0 0 0 .362.677l.302.21-.556.965-.302-.175a.766.766 0 0 0-.771 0 .778.778 0 0 0-.409.675v.352h-1.106v-.372a.778.778 0 0 0-.409-.676.766.766 0 0 0-.77 0l-.303.176-.556-.912.302-.176a.772.772 0 0 0 .362-.676v-.04-.04a.772.772 0 0 0-.362-.676l-.302-.176.556-.966.289.155a.766.766 0 0 0 .77 0 .778.778 0 0 0 .41-.676V9.36zm1.562 2.703c0-.271-.108-.531-.3-.722a1.001 1.001 0 0 0-.72-.292 1.01 1.01 0 0 0-.992 1.023 1.01 1.01 0 0 0 1.01 1.004 1.01 1.01 0 0 0 1.002-1.013z"></path></svg><span>Support</span></a></li><li><a href="https://get.oreilly.com/email-signup.html" class="l1 nav-icn " target="&quot;_blank&quot;"><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M11.564 2.263l2.172 2.174c.17.168.264.397.264.636V11a.6.6 0 0 1-.6.6h-.6V6.2h-6V2.6a.6.6 0 0 1 .6-.6h3.527c.239 0 .468.095.637.263zM2.6 14a.6.6 0 0 1-.6-.6V6.8a.6.6 0 0 1 .6-.6h1.903a1.2 1.2 0 0 1 .849.352L6.2 7.4H11a.6.6 0 0 1 .6.6v5.4a.6.6 0 0 1-.6.6H2.6zM11 5h1.8L11 3.2V5z"></path></svg><span>Newsletters</span></a></li><li><a href="https://learning.oreilly.com/accounts/logout/" class="l1 nav-icn "><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M2.613 12.63A.607.607 0 0 1 2 12.03V3.602C2 3.269 2.274 3 2.613 3h5.515v1.204H3.226v7.223h4.902v1.203H2.613zM5.677 9.02V6.611h4.903V4.926a.301.301 0 0 1 .19-.274.31.31 0 0 1 .33.063l2.722 2.673a.594.594 0 0 1 0 .849L11.1 10.909a.31.31 0 0 1-.331.063.301.301 0 0 1-.19-.274V9.02H5.677z"></path></svg><span>Sign Out</span></a></li></ul></div></li></ul></nav></header>



      </div>
      <div id="container" class="application" style="height: auto;">
        
          <div class="nav-container clearfix">
            


            
            
          </div>

          

  <div class="js-toc">
    
      <div class="sbo-reading-menu sbo-menu-top"><section class="sbo-toc-container toc-menu"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#" class="sbo-toc-thumb"><span class="sbo-title ss-list"><h1><div class="visuallyhidden">Table of Contents for </div>
      
      Ruby on Rails Tutorial, 6th Edition
      
    </h1></span></a><div class="toc-contents" style="max-height: 0px;">
  <div class="sbo-toc">
    <button type="button" class="sbo-toc-thumb close"><div class="visuallyhidden">Close</div></button>
      <section class="ios-app-teaser">
        <ul>
            <li><a class="js-toc-link toc-link" href="https://itunes.apple.com/gb/app/safari-queue-library-over/id881697395?mt=8" role="button">Install App</a></li>
            <li><a class="js-toc-link toc-link" href="safaridetail://9780136702726" role="button">Open in App</a></li>
        </ul>
      </section>
      <div class="sbo-book-meta">
        
        <span class="cover">
         <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/">
          <img src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/saved_resource" alt="Cover image for Ruby on Rails Tutorial, 6th Edition" height="184" width="141">
        </a>
        </span>
        <span class="title">
          
            
                <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/publisher/addison-wesley-professional/">
                  <img src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/addison-wesley.png" class="publisher-logo video" alt="publisher logo">
                </a>
            
          

          <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/">Ruby on Rails Tutorial, 6th Edition</a>
        </span>
        
        <span class="authors">by Michael Hartl</span>
        

        
        <span class="publishers t-publishers">Published by
          <!-- Show publisher page link if publisher pages switch is on -->
          
            <a class="t-publisher-link toc-link js-toc-link" href="https://learning.oreilly.com/library/publisher/addison-wesley-professional/">
              Addison-Wesley Professional</a>, 2020
          
        </span>
        

    

    </div>
  <ol class="tocList">
    
    
    
     

     <li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/cover.xhtml">
        Cover Page <span class="minutes">(01:09 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/pref00.xhtml">
        About This eBook <span class="minutes">(01:09 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/halftitle.xhtml">
        Halftitle Page <span class="minutes">(01:09 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/title.xhtml">
        Title Page <span class="minutes">(01:09 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/copy.xhtml">
        Copyright Page <span class="minutes">(02:18 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/toc.xhtml#toc">
        Contents <span class="minutes">(05:45 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/pref02.xhtml#pref02">
        Foreword <span class="minutes">(01:09 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/pref03.xhtml#pref03">
        Acknowledgments <span class="minutes">(01:09 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/pref04.xhtml#pref04">
        About the Author <span class="minutes">(01:09 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch01.xhtml#ch01">
        Chapter 1. From Zero to Deploy <span class="minutes">(77:03 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch02.xhtml#ch02">
        Chapter 2. A Toy App <span class="minutes">(50:36 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch03.xhtml#ch03">
        Chapter 3. Mostly Static Pages <span class="minutes">(63:15 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch04.xhtml#ch04">
        Chapter 4. Rails-Flavored Ruby <span class="minutes">(57:30 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch05.xhtml#ch05">
        Chapter 5. Filling in the Layout <span class="minutes">(60:57 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch06.xhtml#ch06">
        Chapter 6. Modeling Users <span class="minutes">(67:51 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07">
        Chapter 7. Sign Up <span class="minutes">(79:21 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08">
        Chapter 8. Basic Login <span class="minutes">(66:42 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch09.xhtml#ch09">
        Chapter 9. Advanced Login <span class="minutes">(52:54 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1 currently-reading">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch10.xhtml#ch10">
        Chapter 10. Updating, Showing, and Deleting Users <span class="minutes">(73:36 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch11.xhtml#ch11">
        Chapter 11. Account Activation <span class="minutes">(55:12 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12">
        Chapter 12. Password Reset <span class="minutes">(48:18 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch13.xhtml#ch13">
        Chapter 13. User Microposts <span class="minutes">(106:57 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch14.xhtml#ch14">
        Chapter 14. Following Users <span class="minutes">(78:12 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/index.xhtml#index">
        Index <span class="minutes">(55:12 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/credits.xhtml#credits">
        Credits <span class="minutes">(19:33 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch01_images.xhtml#ch01_images">
        Code Snippets <span class="minutes">(09:12 mins)</span>
       </a>
      
        
      
   </li></ol>
 </div>



</div></section></div>

    

    <div class="interface-controls interface-controls-top">
      <ul class="interface-control-btns js-bitlist js-reader">
        <li class="js-search-in-archive search-in-archive t-search-in-archive"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#" title="Search in archive" class="js-search-controls search-controls" onclick="window.Appcues.track(&#39;SearchBook_HeronBook&#39;)"><span class="icon">Search in book...</span></a><form class="search-archive-bar js-search-form"><input type="search" name="query" placeholder="Search inside this book..." autocomplete="off"></form><div class="search-archive-results"><div class="js-sitb-results-region"></div></div></li><li class="queue-control"><div class="js-content-uri" data-content-uri="/api/v1/book/9780136702726/chapter/ch10.xhtml"><div class="js-collections-dropdown collections-dropdown menu-bit-cards" onclick="window.Appcues.track(&#39;AddPlaylist_HeronBook&#39;)"><div data-reactroot="" class="menu-dropdown-wrapper js-menu-dropdown-wrapper align-right"><img class="hidden" src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/ajax-transp.gif" alt="loading spinner"><div class="menu-control"><div class="control "><div class="js-playlists-menu"><button class="js-playlist-icon"><svg class="icon-add-to-playlist-sml" viewBox="0 0 16 14" version="1.1" xmlns="http://www.w3.org/2000/svg"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g fill-rule="nonzero" fill="#000000"><g transform="translate(-1.000000, 0.000000)"><rect x="5" y="0" width="12" height="2"></rect><title>Playlists</title><path d="M4.5,14 C6.43299662,14 8,12.4329966 8,10.5 C8,8.56700338 6.43299662,7 4.5,7 C2.56700338,7 1,8.56700338 1,10.5 C1,12.4329966 2.56700338,14 4.5,14 Z M2.5,10 L4,10 L4,8.5 L5,8.5 L5,10 L6.5,10 L6.5,11 L5,11 L5,12.5 L4,12.5 L4,11 L2.5,11 L2.5,10 Z"></path><circle cx="2" cy="5" r="1"></circle><circle cx="1.94117647" cy="1" r="1"></circle><rect x="5" y="4" width="12" height="2"></rect><rect x="9" y="8" width="8" height="2"></rect><rect x="9" y="12" width="8" height="2"></rect></g></g></g></svg><div class="js-playlist-addto-label">Add&nbsp;To</div></button></div></div></div></div></div></div></li><li class="js-font-control-panel font-control-activator"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#" data-push-state="false" id="font-controls" title="Change font size" aria-label="Change font size" onclick="window.Appcues.track(&#39;ChangeFont_HeronBook&#39;)"><span class="icon">Toggle Font Controls</span></a></li><li class="dropdown sharing-controls"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#" class="trigger" data-push-state="false" title="Share" aria-label="Share" onclick="window.Appcues.track(&#39;Share_HeronBook&#39;)"><i class="fa fa-share"></i></a><ul class="social-sharing dropdown-menu"><li class="currently-reading"><a class="twitter share-button t-twitter" target="_blank" aria-label="Share this section on Twitter" title="Share this section on Twitter" href="https://twitter.com/share?url=https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch10.xhtml&amp;text=Ruby%20on%20Rails%20Tutorial%2C%206th%20Edition&amp;via=OReillyMedia"><span>Twitter</span></a></li><li class="currently-reading"><a class="facebook share-button t-facebook" target="_blank" aria-label="Share this section on Facebook" title="Share this section on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch10.xhtml"><span>Facebook</span></a></li><li class="currently-reading"><a class="googleplus share-button t-googleplus" target="_blank" aria-label="Share this secton on Google Plus" title="Share this secton on Google Plus" href="https://plus.google.com/share?url=https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch10.xhtml"><span>Google Plus</span></a></li><li class="currently-reading"><a class="email share-button t-email" aria-label="Share this section via email" title="Share this section via email" href="mailto:?subject=Safari:%20Chapter%2010.%20Updating%2C%20Showing%2C%20and%20Deleting%20Users&amp;body=https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch10.xhtml%0D%0Afrom%20Ruby%20on%20Rails%20Tutorial%2C%206th%20Edition%0D%0A"><span>Email</span></a></li></ul></li><!-- endif request.user.is_authenticated -->
      </ul>
    </div>

      
          
      

    <section role="document"><script src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/48743.js.download"></script>
<script>
  var userId = "66943332-5511-462c-876e-5d5b720c7edf";

  var userObject = {
    firstName: "Trần",
    segment: "Trial",
    admin: "False",
    profileCreatedOn: "2020-12-01",
    academic: ""
  };
  window.Appcues.identify(userId, userObject);
  window.Appcues.page();

  setTimeout(function () {
    window.Appcues.track('ViewingBook_HeronBook')
  }, 20000);
</script>


	  <div class="t-sbo-prev sbo-prev sbo-nav-top">
  
    
      
        <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch06.xhtml" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">Chapter 6. Modeling Users</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-top">
  
    
      
        <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">Chapter 8. Basic Login</div>
        </a>
    
  
  </div>



<div id="sbo-rt-content"><div class="annotator-wrapper"><section epub:type="chapter">
<h2 class="h2" id="ch07"><span epub:type="pagebreak" id="page_309"></span>Chapter 7</h2>
<h2 class="h2a">Sign Up</h2>
<p class="noindent">Now that we have a working User model, it’s time to add a capability that few websites can live without: letting users sign up. We’ll use an HTML <em>form</em> to submit user signup information to our application (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#sec7_2">Section 7.2</a>), which will then be used to create a new user and save its attributes to the database (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#sec7_4">Section 7.4</a>). At the end of the signup process, it’s important to render a profile page with the newly created user’s information, so we’ll begin by making a page for <em>showing</em> users, which will serve as the first step toward implementing the REST architecture for users (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch02.xhtml#sec2_2_2">Section 2.2.2</a>). Along the way, we’ll build on our work in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch05.xhtml#sec5_3_4">Section 5.3.4</a> to write succinct and expressive integration tests.</p>
<p class="indent">In this chapter, we’ll rely on the User model validations from <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch06.xhtml#ch06">Chapter 6</a> to increase the odds of new users having valid email addresses. In <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch11.xhtml#ch11">Chapter 11</a>, we’ll make <em>sure</em> of email validity by adding a separate <em>account activation</em> step to user signup.</p>
<p class="indent">Although this tutorial is designed to be as simple as possible while still being professional-grade, web development is a complicated subject, and <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07">Chapter 7</a> necessarily marks a significant increase in the difficulty of the exposition. I recommend taking your time with the material and reviewing it as necessary. (Some readers have reported simply doing the chapter twice is a helpful exercise.) You might also consider subscribing to the courses at Learn Enough to gain additional assistance, both with this tutorial and with its relevant prerequisites (especially <em>Learn Enough Ruby to Be Dangerous</em> (<a href="http://www.learnenough.com/ruby">www.learnenough.com/ruby</a>)).<span epub:type="pagebreak" id="page_310"></span></p>
<section>
<h3 class="h3" id="sec7_1">7.1 Showing Users</h3>
<p class="noindent">In this section, we’ll take the first steps toward the final profile by making a page to display a user’s name and profile photo, as indicated by the mockup in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fig01">Figure 7.1</a>.<sup><a id="ch07fn1a" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fn1" class="totri-footnote">1</a></sup> Our eventual goal for the user profile pages is to show the user’s profile image, basic user data, and a list of microposts, as mocked up in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fig02">Figure 7.2</a>.<sup><a id="ch07fn2a" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fn2" class="totri-footnote">2</a></sup> (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fig02">Figure 7.2</a> includes <span epub:type="pagebreak" id="page_311"></span>an example of <em>lorem ipsum</em> text, which has a fascinating story that you should definitely read about some time.) We’ll complete this task, and with it the sample application, in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch14.xhtml#ch14">Chapter 14</a>.</p>
<p class="footnote"><a id="ch07fn1" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fn1a" class="totri-footnote">1</a>. Mockingbird doesn’t support custom images like the profile photo in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fig01">Figure 7.1</a>; I put that in by hand using GIMP.</p>
<p class="footnote"><a id="ch07fn2" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fn2a" class="totri-footnote">2</a>. Image retrieved from <a href="https://www.flickr.com/photos/43803060@N00/24308857/">https://www.flickr.com/photos/43803060@N00/24308857/</a> on 2014-06-16. Copyright © 2002 by Shaun Wallin and used unaltered under the terms of the Creative Commons Attribution 2.0 Generic license.</p>
<figure id="ch07fig01" class="image-l">
<img src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/fig07_01.jpg" alt="Image" width="677" height="583" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig07_01.jpg">
<figcaption><p><strong>Figure 7.1:</strong> A mockup of the user profile made in this section.</p></figcaption>
</figure>
<figure id="ch07fig02" class="image-l">
<img src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/fig07_02.jpg" alt="Image" width="625" height="537" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig07_02.jpg">
<figcaption><p><strong>Figure 7.2:</strong> A mockup of our best guess at the final profile page.</p></figcaption>
</figure>
<p class="indent">If you’re following along with version control, make a topic branch as usual:</p>
<pre class="pre1"><strong><span class="navy">$</span></strong> git checkout -b sign-up</pre>
<section>
<h4 class="h4" id="sec7_1_1">7.1.1 Debug and Rails Environments</h4>
<p class="noindent">The profiles in this section will be the first truly dynamic pages in our application. Although the view will exist as a single page of code, each profile will be customized using information retrieved from the application’s database. As preparation for adding dynamic pages to our sample application, now is a good time to add some debug <span epub:type="pagebreak" id="page_312"></span>information to our site layout (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex01">Listing 7.1</a>). This displays some useful information about each page using the built-in <span class="dark-green"><strong><code>debug</code></strong></span> method and <span class="dark-green"><strong><code>params</code></strong></span> variable (which we’ll learn more about in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#sec7_1_2">Section 7.1.2</a>).</p>
<p class="ex-title" id="ch07ex01"><strong>Listing 7.1:</strong> Adding some debug information to the site layout.</p>
<pre class="pre2"><code>app/views/layouts/application.html.erb</code></pre>
<p class="codelink"><a id="pf0312-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0312-01a">Click here to view code image</a></p>
<div class="example">
<pre><span class="red5">&lt;!DOCTYPE html&gt;</span>
&lt;<span class="green"><strong>html</strong></span>&gt;
  .
  .
  .
  &lt;<span class="green"><strong>body</strong></span>&gt;
    <span class="red5">&lt;%=</span> render <span class="maroon">'layouts/header'</span> <span class="red5">%&gt;</span>
    &lt;<span class="green"><strong>div</strong></span> <span class="ash3">class</span><span class="ash">=</span><span class="maroon">"container"</span>&gt;
      <span class="red5">&lt;%=</span> <span class="green"><strong>yield</strong></span> <span class="red5">%&gt;</span>
      <span class="red5">&lt;%=</span> render <span class="maroon">'layouts/footer'</span> <span class="red5">%&gt;</span>
<span class="mark">      <span class="maroon1">&lt;%=</span> debug(params) <span class="green3"><strong>if</strong></span> <span class="red2">Rails</span><span class="ash1">.</span>env<span class="ash1">.</span>development? <span class="maroon1">%&gt;</span></span>
    &lt;/<span class="green"><strong>div</strong></span>&gt;
  &lt;/<span class="green"><strong>body</strong></span>&gt;
&lt;/<span class="green"><strong>html</strong></span>&gt;</pre>
</div>
<p class="indent">Since we don’t want to display debug information to users of a deployed application, <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex01">Listing 7.1</a> uses</p>
<pre class="pre1"><span class="green"><strong>if</strong></span> <span class="red">Rails</span><span class="ash">.</span>env<span class="ash">.</span>development?</pre>
<p class="noindent">to restrict the debug information to the <em>development environment</em>, which is one of three environments defined by default in Rails (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#box7_1">Box 7.1</a>).<sup><a id="ch07fn3a" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fn3" class="totri-footnote">3</a></sup> In particular, <span class="dark-green"><strong><code>Rails.env.development?</code></strong></span> is <span class="dark-green"><strong><code>true</code></strong></span> only in a development environment, so the embedded Ruby</p>
<p class="footnote"><a id="ch07fn3" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fn3a" class="totri-footnote">3</a>. You can define your own custom environments as well; see the RailsCast on adding an environment for details.</p>
<p class="codelink"><a id="pf0312-03" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0312-03a">Click here to view code image</a></p>
<pre class="pre1"><span class="red5">&lt;%=</span> debug(params) <span class="green"><strong>if</strong></span> <span class="red">Rails</span><span class="ash">.</span>env<span class="ash">.</span>development? <span class="red5">%&gt;</span></pre>
<p class="noindent">won’t be inserted into production applications or tests. (Inserting the debug information into tests probably wouldn’t do any harm, but it probably wouldn’t do any good, either—so it’s best to restrict the debug display to development only.)<span epub:type="pagebreak" id="page_313"></span></p>
<div class="box">
<p class="box-caption" id="box7_1">Box 7.1: Rails Environments</p>
<p class="boxnp">Rails comes equipped with three environments: <code>test</code>, <code>development</code>, and <code>production</code>. The default environment for the Rails console is <code>development</code>:</p>
<p class="codelink"><a id="pf0313-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0313-01a">Click here to view code image</a></p>
<pre>$ rails console
Loading development environment
&gt;&gt; Rails.env
=&gt; "development"
&gt;&gt; Rails.env.development?
=&gt; true
&gt;&gt; Rails.env.test?
=&gt; false</pre>
<p class="boxnp">As you can see, Rails provides a <code>Rails</code> object with an <code>env</code> attribute and associated environment boolean methods, so that, for example, <code>Rails.env.test?</code> returns <code>true</code> in a test environment and <code>false</code> otherwise.</p>
<p class="boxip">If you ever need to run a console in a different environment (to debug a test, for example), you can pass the environment as a parameter to the <code>console</code> script:</p>
<p class="codelink"><a id="pf0313-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0313-02a">Click here to view code image</a></p>
<pre>$ rails console test
Loading test environment
&gt;&gt; Rails.env
=&gt; "test"
&gt;&gt; Rails.env.test?
=&gt; true</pre>
<p class="boxip">As with the console, <code>development</code> is the default environment for the Rails server, but you can also run it in a different environment:</p>
<p class="codelink"><a id="pf0313-03" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0313-03a">Click here to view code image</a></p>
<pre>$ rails server --environment production</pre>
<p class="boxnp">If you view your app running in production, it won’t work without a production database, which we can create by running <code>rails db:migrate</code> in production:</p>
<p class="codelink"><a id="pf0313-04" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0313-04a">Click here to view code image</a></p>
<pre>$ rails db:migrate RAILS_ENV=production</pre>
<p class="boxnp">(I find it confusing that the idiomatic commands to run the console, server, and migrate commands in nondefault environments use different syntax, which is why I bothered to show all three. It’s worth noting, though, that preceding any of them with <code>RAILS_ENV=&lt;env&gt;</code> will also work, as in <code>RAILS_ENV=production rails server</code>.)<span epub:type="pagebreak" id="page_314"></span></p>
<p class="boxip">By the way, if you have deployed your sample app to Heroku, you can see its environment using <code>heroku run rails console</code>:</p>
<p class="codelink"><a id="pf0314-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0314-01a">Click here to view code image</a></p>
<pre>$ heroku run rails console
&gt;&gt; Rails.env
=&gt; "production"
&gt;&gt; Rails.env.production?
=&gt; true</pre>
<p class="boxnp">Naturally, since Heroku is a platform for production sites, it runs each application in a production environment.</p>
</div>
<p class="indent">To make the debug output look nice, we’ll add some rules to the custom stylesheet created in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch05.xhtml#ch05">Chapter 5</a>, as shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex02">Listing 7.2</a>.</p>
<p class="ex-title" id="ch07ex02"><strong>Listing 7.2:</strong> Adding code for a pretty debug box, including a Sass mixin.</p>
<pre class="pre2"><code>app/assets/stylesheets/custom.scss</code></pre>
<p class="codelink"><a id="pf0314-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0314-02a">Click here to view code image</a></p>
<div class="example">
<pre><span class="green"><strong>@import</strong></span> <span class="maroon">"bootstrap-sprockets"</span>;
<span class="green"><strong>@import</strong></span> <span class="maroon">"bootstrap"</span>;

<span class="blue">/* mixins, variables, etc. */</span>

<span class="violet">$gray-medium-light</span><span class="ash">: #eaeaea</span>;

<span class="mark"><span class="green"><strong>@mixin</strong></span> <span class="blue3">box_sizing</span> {</span>
<span class="mark">  <span class="green"><strong>-moz-box-sizing</strong></span><span class="pink3">:</span>    <strong><span class="green">border-box</span></strong><span class="ash">;</span></span>
<span class="mark">  <span class="green"><strong>-webkit-box-sizing</strong></span><span class="pink3">:</span> <strong><span class="green">border-box</span></strong><span class="ash">;</span></span>
<span class="mark">  <span class="green"><strong>box-sizing</strong></span><span class="pink3">:</span>         <strong><span class="green">border-box</span></strong><span class="ash">;</span></span>
<span class="mark">}</span>
<span class="blue3"><strong>.</strong></span>
<span class="blue3"><strong>.</strong></span>
<span class="blue3"><strong>.</strong></span>
<span class="mark"><span class="ash">/*</span> <span class="green"><strong>miscellaneous</strong></span> <span class="ash">*/</span></span>

<span class="mark"><span class="blue3"><strong>. debug_dump</strong></span> {</span>
<span class="mark">  <span class="green"><strong>clear</strong></span><span class="pink3">:</span> <strong><span class="green">both</span></strong><span class="ash">;</span></span>
<span class="mark">  <span class="green"><strong>float</strong></span><span class="pink3">:</span> <strong><span class="green">left</span></strong><span class="ash">;</span></span>
<span class="mark">  <span class="green"><strong>width</strong></span><span class="pink3">:</span> <strong><span class="green">100</span></strong><span class="red-box">%</span>;</span>
<span class="mark">  <span class="green"><strong>margin-top</strong></span><span class="pink3">:</span> <strong><span class="green">45px</span></strong><span class="ash">;</span></span>
<span class="mark">  <span class="ash">@</span><span class="green"><strong>include box_sizing</strong></span><span class="ash">;</span></span>
<span class="mark">}</span></pre>
</div>
<p class="noindent">This introduces the Sass <em>mixin</em> facility, in this case called <span class="dark-green"><strong><code>box_sizing</code></strong></span>. A mixin allows a group of CSS rules to be packaged up and used for multiple elements, converting<span epub:type="pagebreak" id="page_315"></span></p>
<pre class="pre1"><span class="blue3"><strong>.debug_dump</strong></span> {
  <span class="blue3"><strong>.</strong></span>
  <span class="blue3"><strong>.</strong></span>
  <span class="blue3"><strong>.</strong></span>
  <span class="ash">@</span><span class="green"><strong>include box_sizing</strong></span><span class="ash">;</span>
}</pre>
<p class="noindent">to</p>
<p class="codelink"><a id="pf0315-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0315-02a">Click here to view code image</a></p>
<pre class="pre1"><span class="blue3"><strong>.debug_dump</strong></span> {
  <span class="blue3"><strong>.</strong></span>
  <span class="blue3"><strong>.</strong></span>
  <span class="blue3"><strong>.</strong></span>
  <span class="green"><strong>-moz-box-sizing</strong></span><span class="pink2">:</span>    <strong><span class="green">border-box</span></strong><span class="ash">;</span>
  <span class="green"><strong>-webkit-box-sizing</strong></span><span class="pink2">:</span> <strong><span class="green">border-box</span></strong><span class="ash">;</span>
  <span class="green"><strong>box-sizing</strong></span><span class="pink2">:</span>         <strong><span class="green">border-box</span></strong><span class="ash">;</span>
}</pre>
<p class="noindent">We’ll put this mixin to use again in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#sec7_2_1">Section 7.2.1</a>. The result in the case of the debug box is shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fig03">Figure 7.3</a>.<sup><a id="ch07fn4a" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fn4" class="totri-footnote">4</a></sup></p>
<p class="footnote"><a id="ch07fn4" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fn4a" class="totri-footnote">4</a>. The exact appearance of the Rails debug information is slightly version-dependent. For example, as of Rails 5 the debug information shows the <span class="dark-green"><strong><code>permitted</code></strong></span> status of the information, a subject we’ll cover in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#sec7_3_2">Section 7.3.2</a>. Use your technical sophistication (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch01.xhtml#box1_2">Box 1.2</a>) to resolve such minor discrepancies.</p>
<figure id="ch07fig03" class="image-l">
<img src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/fig07_03.jpg" alt="Image" width="677" height="521" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig07_03.jpg">
<figcaption><p><strong>Figure 7.3:</strong> The sample application Home page with debug information.</p></figcaption>
</figure>
<p class="indent">The debug output in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fig03">Figure 7.3</a> gives potentially useful information about the page being rendered:</p>
<pre class="pre1"><span class="blue5">---</span>
controller: static_pages
action: home</pre>
<p class="noindent">This is a YAML<sup><a id="ch07fn5a" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fn5" class="totri-footnote">5</a></sup> representation of <span class="dark-green"><strong><code>params</code></strong></span>, which is basically a hash, and in this case identifies the controller and action for the page. We’ll see another example in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#sec7_1_2">Section 7.1.2</a>.</p>
<p class="footnote"><a id="ch07fn5" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fn5a" class="totri-footnote">5</a>. The Rails <span class="dark-green"><strong><code>debug</code></strong></span> information is shown as YAML (a recursive acronym standing for “YAML Ain’t Markup Language”), which is a friendly data format designed to be both machine- <em>and</em> human-readable.</p>
<section>
<h5 class="h5" id="lev69">Exercises</h5>
<p class="noindent">Solutions to the exercises are available to all Rails Tutorial purchasers at <a href="https://www.railstutorial.org/aw-solutions">https://www.railstutorial.org/aw-solutions</a>.</p>
<p class="indent">To see other people’s answers and to record your own, subscribe to the Rails Tutorial course or to the Learn Enough All Access Bundle.<span epub:type="pagebreak" id="page_316"></span></p>
<ol class="num">
<li><p class="num">Visit /about in your browser and use the debug information to determine the controller and action of the <span class="dark-green"><strong><code>params</code></strong></span> hash.</p></li>
<li><p class="num">In the Rails console, pull the first user out of the database and assign it to the variable <span class="dark-green"><strong><code>user</code></strong></span>. What is the output of <span class="dark-green"><strong><code>puts user.attributes.to_yaml</code></strong></span>? Compare this to using the <span class="dark-green"><strong><code>y</code></strong></span> method via <span class="dark-green"><strong><code>y user.attributes</code></strong></span>.</p></li>
</ol></section>
</section>
<section>
<h4 class="h4" id="sec7_1_2">7.1.2 A Users Resource</h4>
<p class="noindent">To make a user profile page, we need to have a user in the database, which introduces a chicken-and-egg problem: How can the site have a user before there is a working signup page? Happily, this problem has already been solved: In <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch06.xhtml#sec6_3_4">Section 6.3.4</a>, we created a User record by hand using the Rails console, so there should be one user in the database:<span epub:type="pagebreak" id="page_317"></span></p>
<p class="codelink"><a id="pf0317-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0317-01a">Click here to view code image</a></p>
<pre class="pre1"><span class="green">$ rails console</span>
<span class="navy"><strong>&gt;&gt;</strong></span> <span class="red">User</span><span class="ash">.</span>count
<span class="green">=&gt; 1</span>
<span class="navy"><strong>&gt;&gt;</strong></span> <span class="red">User</span><span class="ash">.</span>first
<span class="green">=&gt; #&lt;User id: 1, name: "Michael Hartl", email: "mhartl@example.com",</span>
<span class="green">created_at: "2019-08-22 03:15:38", updated_at: "2019-08-22 03:15:38",</span>
<span class="green">password_digest: [FILTERED]&gt;</span></pre>
<p class="noindent">(If you don’t currently have a user in your database, you should visit <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch06.xhtml#sec6_3_4">Section 6.3.4</a> now and complete it before proceeding.) We see from this console output that the user has id <span class="dark-green"><strong><code>1</code></strong></span>, and our goal now is to make a page to display this user’s information. We’ll follow the conventions of the REST architecture favored in Rails applications (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch02.xhtml#box2_2">Box 2.2</a>), which means representing data as <em>resources</em> that can be created, shown, updated, or destroyed—four actions corresponding to the four fundamental operations <code>POST</code>, <code>GET</code>, <code>PATCH</code>, and <code>DELETE</code> defined by the HTTP standard (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch03.xhtml#box3_2">Box 3.2</a>).</p>
<p class="indent">When following REST principles, resources are typically referenced using the resource name and a unique identifier. What this means in the context of users— which we’re now thinking of as a Users <em>resource</em>—is that we should view the user with id <span class="dark-green"><strong><code>1</code></strong></span> by issuing a <code>GET</code> request to the URL /users/1. Here the <span class="dark-green"><strong><code>show</code></strong></span> action is <em>implicit</em> in the type of request: When Rails’ REST features are activated, <code>GET</code> requests are automatically handled by the <span class="dark-green"><strong><code>show</code></strong></span> action.</p>
<p class="indent">We saw in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch02.xhtml#sec2_2_1">Section 2.2.1</a> that the page for a user with id <span class="dark-green"><strong><code>1</code></strong></span> has URL /users/1. Unfortunately, visiting that URL right now just gives an error (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fig04">Figure 7.4</a>).</p>
<figure id="ch07fig04" class="image-l">
<img src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/fig07_04.jpg" alt="Image" width="677" height="521" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig07_04.jpg">
<figcaption><p><strong>Figure 7.4:</strong> The current state of /users/1.</p></figcaption>
</figure>
<p class="indent">We can get the routing for /users/1 to work by adding a single line to our routes file (<span class="dark-green"><strong><code>config/routes.rb</code></strong></span>):</p>
<pre class="pre1">resources <span class="violet">:users</span></pre>
<p class="noindent">The result appears in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex03">Listing 7.3</a>.</p>
<p class="ex-title" id="ch07ex03"><strong>Listing 7.3:</strong> Adding a Users resource to the routes file.</p>
<pre class="pre2"><code>config/routes.rb</code></pre>
<p class="codelink"><a id="pf0317-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0317-02a">Click here to view code image</a></p>
<div class="example">
<pre><span class="red">Rails</span><span class="ash">.</span>application<span class="ash">.</span>routes<span class="ash">.</span>draw <strong><span class="green">do</span></strong>
  root <span class="maroon">'static_pages#home'</span>
  get  <span class="maroon">'/help'</span>,     <span class="violet">to</span>: <span class="maroon">'static_pages#help'</span>
  get  <span class="maroon">'/about'</span>,    <span class="violet">to</span>: <span class="maroon">'static_pages#about'</span>
<span epub:type="pagebreak" id="page_318"></span>  get  <span class="maroon">'/contact'</span>,  <span class="violet">to</span>: <span class="maroon">'static_pages#contact'</span>
  get  <span class="maroon">'/signup'</span>,   <span class="violet">to</span>: <span class="maroon">'users#new'</span>
<span class="mark">  resources <span class="blue1">:users</span></span>
<span class="green"><strong>end</strong></span></pre>
</div>
<p class="indent">Although our immediate motivation is making a page to show users, the single line <span class="dark-green"><strong><code>resources :users</code></strong></span> doesn’t just add a working /users/1 URL: It endows our sample application with <em>all</em> the actions needed for a RESTful Users resource,<sup><a id="ch07fn6a" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fn6" class="totri-footnote">6</a></sup> along with a large number of named routes (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch05.xhtml#sec5_3_3">Section 5.3.3</a>) for generating user URLs. The resulting correspondence of URLs, actions, and named routes is shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07tab01">Table 7.1</a>. (Compare this table to <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch02.xhtml#ch02tab02">Table 2.2</a>.) Over the course of the next three chapters, we’ll <span epub:type="pagebreak" id="page_319"></span>cover all of the other entries in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07tab01">Table 7.1</a> as we fill in all the actions necessary to make Users a fully RESTful resource.</p>
<p class="footnote"><a id="ch07fn6" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fn6a" class="totri-footnote">6</a>. The <em>routing</em> works, but the corresponding pages don’t necessarily work at this point. For example, /users/1/edit gets routed properly to the <span class="dark-green"><strong><code>edit</code></strong></span> action of the Users controller, but since the <span class="dark-green"><strong><code>edit</code></strong></span> action doesn’t exist yet actually hitting that URL will return an error.</p>
<figure id="ch07tab01">
<figcaption><p><strong>Table 7.1:</strong> RESTful routes provided by the Users resource in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex03">Listing 7.3</a>.</p></figcaption>
<table class="topbot">
<thead>
<tr>
<th class="tab-th"><p class="tab-para">HTTP request</p></th>
<th class="tab-th"><p class="tab-para">URL</p></th>
<th class="tab-th"><p class="tab-para">Action</p></th>
<th class="tab-th"><p class="tab-para">Named route</p></th>
<th class="tab-th"><p class="tab-para">Purpose</p></th>
</tr>
</thead>
<tbody>
<tr>
<td><p class="tab-para"><code>GET</code></p></td>
<td><p class="tab-para">/users</p></td>
<td><p class="tab-para"><span class="dark-green"><strong><code>index</code></strong></span></p></td>
<td><p class="tab-para"><span class="dark-green"><strong><code>users_path</code></strong></span></p></td>
<td><p class="tab-para">page to list all users</p></td>
</tr>
<tr>
<td><p class="tab-para"><code>GET</code></p></td>
<td><p class="tab-para">/users/1</p></td>
<td><p class="tab-para"><span class="dark-green"><strong><code>show</code></strong></span></p></td>
<td><p class="tab-para"><span class="dark-green"><strong><code>user_path(user)</code></strong></span></p></td>
<td><p class="tab-para">page to show user</p></td>
</tr>
<tr>
<td><p class="tab-para"><code>GET</code></p></td>
<td><p class="tab-para">/users/new</p></td>
<td><p class="tab-para"><span class="dark-green"><strong><code>new</code></strong></span></p></td>
<td><p class="tab-para"><span class="dark-green"><strong><code>new_user_path</code></strong></span></p></td>
<td><p class="tab-para">page to make a new user (signup)</p></td>
</tr>
<tr>
<td><p class="tab-para"><code>POST</code></p></td>
<td><p class="tab-para">/users</p></td>
<td><p class="tab-para"><span class="dark-green"><strong><code>create</code></strong></span></p></td>
<td><p class="tab-para"><span class="dark-green"><strong><code>users_path</code></strong></span></p></td>
<td><p class="tab-para">create a new user</p></td>
</tr>
<tr>
<td><p class="tab-para"><code>GET</code></p></td>
<td><p class="tab-para">/users/1/edit</p></td>
<td><p class="tab-para"><span class="dark-green"><strong><code>edit</code></strong></span></p></td>
<td><p class="tab-para"><span class="dark-green"><strong><code>edit_user_path(user)</code></strong></span></p></td>
<td><p class="tab-para">page to edit user with id <span class="dark-green"><strong><code>1</code></strong></span></p></td>
</tr>
<tr>
<td><p class="tab-para"><code>PATCH</code></p></td>
<td><p class="tab-para">/users/1</p></td>
<td><p class="tab-para"><span class="dark-green"><strong><code>update</code></strong></span></p></td>
<td><p class="tab-para"><span class="dark-green"><strong><code>user_path(user)</code></strong></span></p></td>
<td><p class="tab-para">update user</p></td>
</tr>
<tr>
<td><p class="tab-para"><code>DELETE</code></p></td>
<td><p class="tab-para">/users/1</p></td>
<td><p class="tab-para"><span class="dark-green"><strong><code>destroy</code></strong></span></p></td>
<td><p class="tab-para"><span class="dark-green"><strong><code>user_path(user)</code></strong></span></p></td>
<td><p class="tab-para">delete user</p></td>
</tr>
</tbody>
</table>
</figure>
<p class="indent">With the code in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex03">Listing 7.3</a>, the routing works, but there’s still no page there (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fig05">Figure 7.5</a>). To fix this, we’ll begin with a minimalist version of the profile page, which we’ll flesh out in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#sec7_1_4">Section 7.1.4</a>.</p>
<figure id="ch07fig05" class="image-l">
<img src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/fig07_05.jpg" alt="Image" width="677" height="521" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig07_05.jpg">
<figcaption><p><strong>Figure 7.5:</strong> The URL /users/1 with routing but no page.</p></figcaption>
</figure>
<p class="indent">We’ll use the standard Rails location for showing a user, which is <span class="dark-green"><strong><code>app/views/-users/show.html.erb</code></strong></span>. Unlike the <span class="dark-green"><strong><code>new.html.erb</code></strong></span> view, which we created with the generator in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch05.xhtml#ch05ex038">Listing 5.38</a>, the <span class="dark-green"><strong><code>show.html.erb</code></strong></span> file doesn’t currently exist, so you’ll have to create it by hand,<sup><a id="ch07fn7a" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fn7" class="totri-footnote">7</a></sup> and then fill it with the content shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex04">Listing 7.4</a>.</p>
<p class="footnote"><a id="ch07fn7" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fn7a" class="totri-footnote">7</a>. Using, for example, <span class="dark-green"><strong><code>touch app/views/users/show.html.erb</code></strong></span>.</p>
<p class="ex-title" id="ch07ex04"><strong>Listing 7.4:</strong> A stub view for showing user information.</p>
<pre class="pre2"><code>app/views/users/show.html.erb</code></pre>
<p class="codelink"><a id="pf0319-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0319-01a">Click here to view code image</a></p>
<div class="example">
<pre><span class="red5">&lt;%=</span> <span class="violet">@user</span><span class="ash">.</span>name <span class="red5">%&gt;</span>, <span class="red5">&lt;%=</span> <span class="violet">@user</span><span class="ash">.</span>email <span class="red5">%&gt;</span></pre>
</div>
<p class="noindent">This view uses embedded Ruby to display the user’s name and email address, assuming the existence of an instance variable called <span class="dark-green"><strong><code>@user</code></strong></span>. Of course, eventually the real user show page will look very different (and won’t display the email address publicly).<span epub:type="pagebreak" id="page_320"></span></p>
<p class="indent">To get the user show view to work, we need to define an <span class="dark-green"><strong><code>@user</code></strong></span> variable in the corresponding <span class="dark-green"><strong><code>show</code></strong></span> action in the Users controller. As you might expect, we use the <span class="dark-green"><strong><code>find</code></strong></span> method on the User model (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch06.xhtml#sec6_1_4">Section 6.1.4</a>) to retrieve the user from the database, as shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex05">Listing 7.5</a>.</p>
<p class="ex-title" id="ch07ex05"><strong>Listing 7.5:</strong> The Users controller with a <span class="dark-green"><strong><code>show</code></strong></span> action.</p>
<pre class="pre2"><code>app/controllers/users_controller.rb</code></pre>
<p class="codelink"><a id="pf0320-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0320-01a">Click here to view code image</a></p>
<div class="example">
<pre><span class="green"><strong>class</strong></span> <span class="blue3">UsersController</span> <span class="ash">&lt;</span> <span class="red">ApplicationController</span>

  <strong><span class="green">def</span></strong> <span class="blue3">show</span>
<span class="mark">    <span class="blue1">@user</span> <span class="ash1">=</span> <span class="red2">User</span><span class="ash1">.</span>find(params<span class="ash1">[</span><span class="blue1">:id</span><span class="ash1">]</span>)</span>
  <strong><span class="green">end</span></strong>

  <span class="green"><strong>def new</strong></span>
  <strong><span class="green">end</span></strong>

<span class="green"><strong>end</strong></span></pre>
</div>
<p class="noindent"><span epub:type="pagebreak" id="page_321"></span>Here we’ve used <span class="dark-green"><strong><code>params</code></strong></span> to retrieve the user id. When we make the appropriate request to the Users controller, <span class="dark-green"><strong><code>params[:id]</code></strong></span> will be the user id <code>1</code>, so the effect is the same as that from using the <span class="dark-green"><strong><code>find</code></strong></span> method <span class="dark-green"><strong><code>User.find(1)</code></strong></span> we saw in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch06.xhtml#sec6_1_4">Section 6.1.4</a>. (Technically, <span class="dark-green"><strong><code>params[:id]</code></strong></span> is the string <span class="dark-green"><strong><code>"1"</code></strong></span>, but <span class="dark-green"><strong><code>find</code></strong></span> is smart enough to convert this to an integer.)</p>
<p class="indent">With the user view and action defined, the URL /users/1 works perfectly, as seen in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fig06">Figure 7.6</a>. (If you haven’t restarted the Rails server since adding bcrypt, you may have to do so at this time. This sort of thing is a good application of technical sophistication (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch01.xhtml#box1_2">Box 1.2</a>).) Note that the debug information in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fig06">Figure 7.6</a> confirms the value of <span class="dark-green"><strong><code>params[:id]</code></strong></span>:</p>
<figure id="ch07fig06" class="image-l">
<img src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/fig07_06.jpg" alt="Image" width="677" height="521" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig07_06.jpg">
<figcaption><p><strong>Figure 7.6:</strong> The user show page after adding a Users resource.</p></figcaption>
</figure>
<pre class="pre1"><span class="blue5">---</span>
action: show
controller: users
id: <span class="pink1">'1'</span></pre>
<p class="noindent"><span epub:type="pagebreak" id="page_322"></span>This is why the code</p>
<pre class="pre1"><span class="red">User</span><span class="ash">.</span>find(params<span class="ash">[</span><span class="violet">:id</span><span class="ash">]</span>)</pre>
<p class="noindent">in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex05">Listing 7.5</a> finds the user with id <code>1</code>.</p>
<section>
<h5 class="h5" id="lev70">Exercises</h5>
<p class="noindent">Solutions to the exercises are available to all Rails Tutorial purchasers at <a href="https://www.railstutorial.org/aw-solutions">https://www.railstutorial.org/aw-solutions</a>.</p>
<p class="indent">To see other people’s answers and to record your own, subscribe to the Rails Tutorial course or to the Learn Enough All Access Bundle.</p>
<ol class="num">
<li><p class="num">Using embedded Ruby, add the <span class="dark-green"><strong><code>created_at</code></strong></span> and <span class="dark-green"><strong><code>updated_at</code></strong></span> “magic column” attributes to the user show page from <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex04">Listing 7.4</a>.</p></li>
<li><p class="num">Using embedded Ruby, add <span class="dark-green"><strong><code>Time.now</code></strong></span> to the user show page. What happens when you refresh the browser?</p></li>
</ol></section>
</section>
<section>
<h4 class="h4" id="sec7_1_3">7.1.3 Debugger</h4>
<p class="noindent">We saw in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#sec7_1_2">Section 7.1.2</a> how the <span class="dark-green"><strong><code>debug</code></strong></span> method could help us understand what’s going on in our application, but there’s also a more direct way to get debugging information using the <code>byebug</code> gem (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch03.xhtml#ch03ex02">Listing 3.2</a>). To see how it works, we just need to add a line consisting of <span class="dark-green"><strong><code>debugger</code></strong></span> to our application, as shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex06">Listing 7.6</a>.</p>
<p class="ex-title" id="ch07ex06"><strong>Listing 7.6:</strong> The Users controller with a debugger.</p>
<pre class="pre2"><code>app/controllers/users_controller.rb</code></pre>
<p class="codelink"><a id="pf0322-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0322-01a">Click here to view code image</a></p>
<div class="example">
<pre><span class="green"><strong>class</strong></span> <strong><span class="blue3">UsersController</span></strong> <span class="ash">&lt;</span> <span class="red">ApplicationController</span>

  <strong><span class="green">def</span></strong> <span class="blue3">show</span>
    <span class="violet">@user</span> <span class="ash">=</span> <span class="red">User</span><span class="ash">.</span>find(params<span class="ash">[</span><span class="violet">:id</span><span class="ash">]</span>)
<span class="mark">    debugger</span>
  <strong><span class="green">end</span></strong>

  <strong><span class="green">def</span></strong> <span class="blue3">new</span>
  <strong><span class="green">end</span></strong>
<span class="green"><strong>end</strong></span></pre>
</div>
<p class="indent"><span epub:type="pagebreak" id="page_323"></span>Now, when we visit /users/1, the Rails server shows a <span class="dark-green"><strong><code>byebug</code></strong></span> prompt (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fig07">Figure 7.7</a>):</p>
<figure id="ch07fig07" class="image-l">
<img src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/fig07_07.jpg" alt="Image" width="671" height="228" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig07_07.jpg">
<figcaption><p><strong>Figure 7.7:</strong> The <span class="dark-green"><strong><code>byebug</code></strong></span> prompt in the Rails server.</p></figcaption>
</figure>
<pre class="pre1"><span class="green3">(byebug)</span></pre>
<p class="indent">We can treat <span class="dark-green"><strong><code>byebug</code></strong></span> like a Rails console, issuing commands to figure out the state of the application:</p>
<pre class="pre1"><span class="green3">(byebug) @user.name</span>
<span class="green3">"Michael Hartl"</span>
<span class="green3">(byebug) @user.email</span>
<span class="green3">"michael@example.com"</span>
<span class="green3">(byebug) params[:id]</span>
<span class="green3">"1"</span></pre>
<p class="noindent">To release the prompt and continue execution of the application, press Ctrl-D, then remove the <span class="dark-green"><strong><code>debugger</code></strong></span> line from the <span class="dark-green"><strong><code>show</code></strong></span> action (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex07">Listing 7.7</a>).</p>
<p class="ex-title" id="ch07ex07"><strong>Listing 7.7:</strong> The Users controller with the debugger line removed.</p>
<pre class="pre2"><code>app/controllers/users_controller.rb</code></pre>
<p class="codelink"><a id="pf0323-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0323-02a">Click here to view code image</a></p>
<div class="example">
<pre><span class="green"><strong>class</strong></span> <strong><span class="blue3">UsersController</span></strong> <span class="ash">&lt;</span> <span class="red">ApplicationController</span>

  <strong><span class="green">def</span></strong> <span class="blue3">show</span>
    <span class="violet">@user</span> <span class="ash">=</span> <span class="red">User</span><span class="ash">.</span>find(params<span class="ash">[</span><span class="violet">:id</span><span class="ash">]</span>)
  <strong><span class="green">end</span></strong>

  <strong><span class="green">def</span></strong> <span class="blue3">new</span>
  <strong><span class="green">end</span></strong>
<span class="green"><strong>end</strong></span></pre>
</div>
<p class="indent"><span epub:type="pagebreak" id="page_324"></span>Whenever you’re confused about something in a Rails application, it’s a good practice to put <span class="dark-green"><strong><code>debugger</code></strong></span> close to the code you think might be causing the trouble. Inspecting the state of the system using <code>byebug</code> is a powerful method for tracking down application errors and interactively debugging your application.</p>
<section>
<h5 class="h5" id="lev71">Exercises</h5>
<p class="noindent">Solutions to the exercises are available to all Rails Tutorial purchasers at <a href="https://www.railstutorial.org/aw-solutions">https://www.railstutorial.org/aw-solutions</a>.</p>
<p class="indent">To see other people’s answers and to record your own, subscribe to the Rails Tutorial course or to the Learn Enough All Access Bundle.</p>
<ol class="num">
<li><p class="num">With the <span class="dark-green"><strong><code>debugger</code></strong></span> in the <span class="dark-green"><strong><code>show</code></strong></span> action as in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex06">Listing 7.6</a>, hit /users/1. Use <span class="dark-green"><strong><code>puts</code></strong></span> to display the value of the YAML form of the <span class="dark-green"><strong><code>params</code></strong></span> hash. <em>Hint</em>: Refer to the relevant exercise in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#sec7_1_1">Section 7.1.1</a>. How does it compare to the debug information shown by the <span class="dark-green"><strong><code>debug</code></strong></span> method in the site template?</p></li>
<li><p class="num">Put the <span class="dark-green"><strong><code>debugger</code></strong></span> in the User <span class="dark-green"><strong><code>new</code></strong></span> action and hit /users/new. What is the value of <span class="dark-green"><strong><code>@user</code></strong></span>?</p></li>
</ol></section>
</section>
<section>
<h4 class="h4" id="sec7_1_4">7.1.4 A Gravatar Image and a Sidebar</h4>
<p class="noindent">Having defined a basic user page in the previous section, we’ll now flesh it out a little with a profile image for each user and the first cut of the user sidebar. We’ll start by adding a “globally recognized avatar,” or Gravatar, to the user profile.<sup><a id="ch07fn8a" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fn8" class="totri-footnote">8</a></sup> Gravatar is a free service that allows users to upload images and associate them with email addresses they control. As a result, Gravatars are a convenient way to include user profile images without going through the trouble of managing image upload, cropping, and storage; all we need to do is construct the proper Gravatar image URL using the user’s email address and the corresponding Gravatar image will automatically appear. (We’ll learn how to handle custom image upload in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch13.xhtml#sec13_4">Section 13.4</a>.)</p>
<p class="footnote"><a id="ch07fn8" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fn8a" class="totri-footnote">8</a>. In Hinduism, an avatar is the manifestation of a deity in human or animal form. By extension, the term <em>avatar</em> is commonly used to mean some kind of personal representation, especially in a virtual environment. (In the context of Twitter and other social media, the term <em>avi</em> has gained currency, which is likely a mutated form of <em>avatar</em>.)</p>
<p class="indent">Our plan is to define a <span class="dark-green"><strong><code>gravatar_for</code></strong></span> helper function to return a Gravatar image for a given user, as shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex08">Listing 7.8</a>.<span epub:type="pagebreak" id="page_325"></span></p>
<p class="ex-title" id="ch07ex08"><strong>Listing 7.8:</strong> The user show view with name and Gravatar.</p>
<pre class="pre2"><code>app/views/users/show.html.erb</code></pre>
<p class="codelink"><a id="pf0325-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0325-01a">Click here to view code image</a></p>
<div class="example">
<pre><span class="red5">&lt;%</span> provide(<span class="violet">:title</span>, <span class="violet">@user</span><span class="ash">.</span>name) <span class="red5">%&gt;</span>
&lt;<span class="green"><strong>h1</strong></span>&gt;
  <span class="red5">&lt;%=</span> gravatar_for <span class="violet">@user</span> <span class="red5">%&gt;</span>
  <span class="red5">&lt;%=</span> <span class="violet">@user</span><span class="ash">.</span>name <span class="red5">%&gt;</span>
&lt;/<span class="green"><strong>h1</strong></span>&gt;</pre>
</div>
<p class="indent">By default, methods defined in any helper file are automatically available in any view, but for convenience we’ll put the <span class="dark-green"><strong><code>gravatar_for</code></strong></span> method in the file for helpers associated with the Users controller. As noted in the Gravatar documentation, Gravatar URLs are based on an MD5 hash of the user’s email address. In Ruby, the MD5 hashing algorithm is implemented using the <span class="dark-green"><strong><code>hexdigest</code></strong></span> method, which is part of the <span class="dark-green"><strong><code>Digest</code></strong></span> library:</p>
<p class="codelink"><a id="pf0325-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0325-02a">Click here to view code image</a></p>
<pre class="pre1"><span class="navy"><strong>&gt;&gt;</strong></span> email <span class="ash">=</span> <span class="maroon">"MHARTL@example.COM"</span>
<span class="mark"><span class="blue1"><strong>&gt;&gt;</strong></span> <span class="red2">Digest</span><span class="ash1">::</span><span class="red2">MD5</span><span class="ash1">::</span>hexdigest(email<span class="ash1">.</span>downcase)</span>
<span class="green">=&gt; "1fda4469bcbec3badf5418269ffc5968"</span></pre>
<p class="noindent">Since email addresses are case-insensitive (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch06.xhtml#sec6_2_4">Section 6.2.4</a>) but MD5 hashes are not, we’ve used the <span class="dark-green"><strong><code>downcase</code></strong></span> method to ensure that the argument to <span class="dark-green"><strong><code>hexdigest</code></strong></span> is all lowercase. (Because of the email downcasing callback in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch06.xhtml#ch06ex032">Listing 6.32</a>, this will never make a difference in this tutorial, but it’s a good practice in case the <span class="dark-green"><strong><code>gravatar_for</code></strong></span> ever gets used on email addresses from other sources.) The resulting <span class="dark-green"><strong><code>gravatar_for</code></strong></span> helper appears in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex09">Listing 7.9</a>.</p>
<p class="ex-title" id="ch07ex09"><strong>Listing 7.9:</strong> Defining a <span class="dark-green"><strong><code>gravatar_for</code></strong></span> helper method.</p>
<pre class="pre2"><code>app/helpers/users_helper.rb</code></pre>
<p class="codelink"><a id="pf0325-03" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0325-03a">Click here to view code image</a></p>
<div class="example">
<pre><span class="green"><strong>module</strong></span> <strong><span class="blue3">UsersHelper</span></strong>

  <span class="blue"># Returns the Gravatar for the given user.</span>
  <strong><span class="green">def</span></strong> <span class="blue3">gravatar_for</span>(user)
    gravatar_id  <span class="ash">=</span> <span class="red">Digest</span><span class="ash">::</span><span class="red">MD5</span><span class="ash">::</span>hexdigest(user<span class="ash">.</span>email<span class="ash">.</span>downcase)
    gravatar_url <span class="ash">=</span> <span class="maroon">"https://secure.gravatar.com/avatar/</span><strong><span class="pink">#{</span></strong>gravatar_id<strong><span class="pink">}</span></strong><span class="maroon">"</span>
    image_tag(gravatar_url, <span class="violet">alt</span>: user<span class="ash">.</span>name, <span class="violet">class</span>: <span class="maroon">"gravatar"</span>)
   <strong><span class="green">end</span></strong>
<span class="green"><strong>end</strong></span></pre>
</div>
<p class="noindent"><span epub:type="pagebreak" id="page_326"></span>The code in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex09">Listing 7.9</a> returns an image tag for the Gravatar with a <span class="dark-green"><strong><code>gravatar</code></strong></span> CSS class and alt text equal to the user’s name (which is especially convenient for visually impaired users using a screen reader).</p>
<p class="indent">The profile page appears as in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fig08">Figure 7.8</a>, which shows the default Gravatar image, which appears because <span class="dark-green"><strong><code>michael@example.com</code></strong></span> isn’t a real email address. (In fact, as you can see by visiting it, the example.com domain is reserved for examples like this one.)</p>
<figure id="ch07fig08" class="image-l">
<img src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/fig07_08.jpg" alt="Image" width="677" height="521" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig07_08.jpg">
<figcaption><p><strong>Figure 7.8:</strong> The user profile page with the default Gravatar.</p></figcaption>
</figure>
<p class="indent">To get our application to display a custom Gravatar, we’ll use <span class="dark-green"><strong><code>update_attributes</code></strong></span> (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch06.xhtml#sec6_1_5">Section 6.1.5</a>) to change the user’s email to something I control:<sup><a id="ch07fn9a" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fn9" class="totri-footnote">9</a></sup></p>
<p class="footnote"><a id="ch07fn9" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fn9a" class="totri-footnote">9</a>. The password confirmation isn’t technically necessary here because <span class="dark-green"><strong><code>has_secure_password</code></strong></span> (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch06.xhtml#sec6_3_1">Section 6.3.1</a>) actually allows the confirmation to be <span class="dark-green"><strong><code>nil</code></strong></span>. The reason is so that apps that don’t need password confirmation can simply omit the confirmation field. We do want a confirmation, though, so we’ll include such a field in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex015">Listing 7.15</a>.<span epub:type="pagebreak" id="page_327"></span></p>
<p class="codelink"><a id="pf0327-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0327-01a">Click here to view code image</a></p>
<pre class="pre1"><span class="green">$ rails console</span>
<strong><span class="navy"><strong>&gt;&gt;</strong></span></strong> user <span class="ash">=</span> <span class="red">User</span><span class="ash">.</span>first
<strong><span class="navy"><strong>&gt;&gt;</strong></span></strong> user<span class="ash">.</span>update(<span class="green1">name</span>: <span class="maroon">"Example User"</span>,
<span class="navy"><strong>?&gt;</strong></span>             <span class="violet">email</span>: <span class="maroon">"example@railstutorial.org"</span>,
<span class="navy"><strong>?&gt;</strong></span>             <span class="violet">password</span>: <span class="maroon">"foobar"</span>,
<span class="navy"><strong>?&gt;</strong></span>             <span class="violet">password_confirmation</span>: <span class="maroon">"foobar"</span>)
<span class="green">=&gt; true</span></pre>
<p class="noindent">Here we’ve assigned the user the email address <span class="dark-green"><strong><code>example@railstutorial.org</code></strong></span>, which I’ve associated with the Rails Tutorial logo, as seen in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fig09">Figure 7.9</a>.</p>
<figure id="ch07fig09" class="image-l">
<img src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/fig07_09.jpg" alt="Image" width="677" height="521" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig07_09.jpg">
<figcaption><p><strong>Figure 7.9:</strong> The user show page with a custom Gravatar.</p></figcaption>
</figure>
<p class="indent">The last element needed to complete the mockup from <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fig01">Figure 7.1</a> is the initial version of the user sidebar. We’ll implement it using the <span class="dark-green"><strong><code>aside</code></strong></span> tag, which is used for content (such as sidebars) that complements the rest of the page but can also stand alone. We include <span class="dark-green"><strong><code>row</code></strong></span> and <span class="dark-green"><strong><code>col-md-4</code></strong></span> classes, which are both part of Bootstrap. The code for the modified user show page appears in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex010">Listing 7.10</a>.<span epub:type="pagebreak" id="page_328"></span></p>
<p class="ex-title" id="ch07ex010"><strong>Listing 7.10:</strong> Adding a sidebar to the user <span class="dark-green"><strong><code>show</code></strong></span> view.</p>
<pre class="pre2"><code>app/views/users/show.html.erb</code></pre>
<p class="codelink"><a id="pf0328-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0328-01a">Click here to view code image</a></p>
<div class="example">
<pre><span class="red5">&lt;%</span> provide(<span class="violet">:title</span>, <span class="violet">@user</span><span class="ash">.</span>name) <span class="red5">%&gt;</span>
&lt;<span class="green"><strong>div</strong></span> <span class="ash3">class</span><span class="ash">=</span><span class="maroon">"row"</span>&gt;
  &lt;<span class="green"><strong>aside</strong></span> <span class="ash3">class</span><span class="ash">=</span><span class="maroon">"col-md-4"</span>&gt;
    &lt;<span class="green"><strong>section</strong></span> <span class="ash3">class</span><span class="ash">=</span><span class="maroon">"user_info"</span>&gt;
       &lt;<span class="green"><strong>h1</strong></span>&gt;
         <span class="red5">&lt;%=</span> gravatar_for <span class="violet">@user</span> <span class="red5">%&gt;</span>
         <span class="red5">&lt;%=</span> <span class="violet">@user</span><span class="ash">.</span>name <span class="red5">%&gt;</span>
      &lt;/<span class="green"><strong>h1</strong></span>&gt;
    &lt;/<span class="green"><strong>section</strong></span>&gt;
  &lt;/<span class="green"><strong>aside</strong></span>&gt;
&lt;/<span class="green"><strong>div</strong></span>&gt;</pre>
</div>
<p class="indent">With the HTML elements and CSS classes in place, we can style the profile page (including the sidebar and the Gravatar) with the SCSS shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex011">Listing 7.11</a>.<sup><a id="ch07fn10a" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fn10">10</a></sup> (Note the nesting of the table CSS rules, which works only because of the Sass engine used by the asset pipeline.) The resulting page is shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fig010">Figure 7.10</a>.</p>
<p class="footnote"><a id="ch07fn10" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fn10a">10</a>. <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex011">Listing 7.11</a> includes the <span class="dark-green"><strong><code>.gravatar_edit</code></strong></span> class, which we’ll put to work in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch10.xhtml#ch10">Chapter 10</a>.</p>
<figure id="ch07fig010" class="image-l">
<img src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/fig07_10.jpg" alt="Image" width="677" height="521" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig07_10.jpg">
<figcaption><p><strong>Figure 7.10:</strong> The user show page with a sidebar and CSS.</p></figcaption>
</figure>
<p class="ex-title" id="ch07ex011"><strong>Listing 7.11:</strong> SCSS for styling the user show page, including the sidebar.</p>
<pre class="pre2"><code>app/assets/stylesheets/custom.scss</code></pre>
<p class="codelink"><a id="pf0328-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0328-02a">Click here to view code image</a></p>
<div class="example">
<pre><span class="blue3"><strong>.</strong></span>
<span class="blue3"><strong>.</strong></span>
<span class="blue3"><strong>.</strong></span>
<span class="ash">/*</span> <span class="green"><strong>sidebar</strong></span> <span class="ash">*/</span>

<span class="green"><strong>aside</strong></span> {
  <span class="green"><strong>section</strong></span><span class="blue3"><strong>.user_info</strong></span> {
    <span class="green"><strong>margin-top</strong></span><span class="pink2">:</span> <strong><span class="green">20px</span></strong><span class="ash">;</span>
  }
  <span class="green"><strong>section</strong></span> {
    <span class="green"><strong>padding</strong></span><span class="pink2">:</span> <strong><span class="green">10px 0</span></strong><span class="ash">;</span>
    <span class="green"><strong>margin-top</strong></span><span class="pink2">:</span> <strong><span class="green">20px</span></strong><span class="ash">;</span>
    <span class="green"><strong>&amp;</strong></span><span class="pink2">:first-child</span> {
      <span class="green"><strong>border</strong></span><span class="pink2">:</span> <strong><span class="green">0</span></strong><span class="ash">;</span>
      <span class="green"><strong>padding-top</strong></span><span class="pink2">:</span> <strong><span class="green">0</span></strong><span class="ash">;</span>
   }
   <span class="green"><strong>span</strong></span> {
     <span class="green"><strong>display</strong></span><span class="pink2">:</span> <strong><span class="green">block</span></strong><span class="ash">;</span>
<span epub:type="pagebreak" id="page_329"></span>     <span class="green"><strong>margin-bottom</strong></span><span class="pink2">:</span> <strong><span class="green">3px</span></strong><span class="ash">;</span>
     <span class="green"><strong>line-height</strong></span><span class="pink2">:</span> <strong><span class="green">1</span></strong><span class="ash">;</span>
  }
  <span class="green"><strong>h1</strong></span> {
    <span class="green"><strong>font-size</strong></span><span class="pink2">:</span> <strong><span class="green">1</span></strong><strong><span class="blue3">.4em</span></strong><span class="ash">;</span>
    <span class="green"><strong>text-align</strong></span><span class="pink2">:</span> <strong><span class="green">left</span></strong><span class="ash">;</span>
    <span class="green"><strong>letter-spacing</strong></span><span class="pink2">:</span> <strong><span class="green">-1px</span></strong><span class="ash">;</span>
    <span class="green"><strong>margin-bottom</strong></span><span class="pink2">:</span> <strong><span class="green">3px</span></strong><span class="ash">;</span>
    <span class="green"><strong>margin-top</strong></span><span class="pink2">:</span> <strong><span class="green">0px</span></strong><span class="ash">;</span>
  }
 }
}

 <span class="blue3"><strong>.gravatar</strong></span> {
   <span class="green"><strong>float</strong></span><span class="pink2">:</span> <strong><span class="green">left</span></strong><span class="ash">;</span>
   <span class="green"><strong>margin-right</strong></span><span class="pink2">:</span> <strong><span class="green">10px</span></strong><span class="ash">;</span>
 }

 <span class="blue3"><strong>.gravatar_edit</strong></span> {
   <span class="green"><strong>margin-top</strong></span><span class="pink2">:</span> <strong><span class="green">15px</span></strong><span class="ash">;</span>
}</pre>
</div>
<section>
<h5 class="h5" id="lev72"><span epub:type="pagebreak" id="page_330"></span>Exercises</h5>
<p class="noindent">Solutions to the exercises are available to all Rails Tutorial purchasers at <a href="https://www.railstutorial.org/aw-solutions">https://www.railstutorial.org/aw-solutions</a>.</p>
<p class="indent">To see other people’s answers and to record your own, subscribe to the Rails Tutorial course or to the Learn Enough All Access Bundle.</p>
<ol class="num">
<li><p class="num">Associate a Gravatar with your primary email address if you haven’t already done so. What is the MD5 hash associated with the image?</p></li>
<li><p class="num">Verify that the code in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex012">Listing 7.12</a> allows the <span class="dark-green"><strong><code>gravatar_for</code></strong></span> helper defined in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#sec7_1_4">Section 7.1.4</a> to take an optional <span class="dark-green"><strong><code>size</code></strong></span> parameter, allowing code like <span class="dark-green"><strong><code>gravatar_for user, size: 50</code></strong></span> in the view. (We’ll put this improved helper to use in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch10.xhtml#sec10_3_1">Section 10.3.1</a>.)</p></li>
<li><p class="num">The options hash used in the previous exercise is still commonly used, but as of Ruby 2.0 we can use <em>keyword arguments</em> instead. Confirm that the code in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex013">Listing 7.13</a> can be used in place of <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex012">Listing 7.12</a>. What are the differences between the two?</p></li>
</ol>
<p class="ex-title" id="ch07ex012"><strong>Listing 7.12:</strong> Adding an options hash in the <span class="dark-green"><strong><code>gravatar_for</code></strong></span> helper.</p>
<pre class="pre2"><code>app/helpers/users_helper.rb</code></pre>
<p class="codelink"><a id="pf0330-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0330-01a">Click here to view code image</a></p>
<div class="example">
<pre><strong><span class="green">module</span> <span class="blue3">UsersHelper</span></strong>

  <span class="blue"># Returns the Gravatar for the given user.</span>
<span class="mark">  <strong><span class="green3">def</span></strong> <span class="blue5">gravatar_for</span>(user, options <span class="ash1">=</span> { <span class="blue1">size</span>: <span class="ash1">80</span> })</span>
<span class="mark">    size         <span class="ash1">=</span> options<span class="ash1">[</span><span class="blue1">:size</span><span class="ash1">]</span></span>
    gravatar_id  <span class="ash">=</span> <span class="red">Digest</span><span class="ash">::</span><span class="red">MD5</span><span class="ash">::</span>hexdigest(user<span class="ash">.</span>email<span class="ash">.</span>downcase)
<span class="mark">    gravatar_url <span class="ash1">=</span> <span class="red2">"https://secure.gravatar.com/avatar/</span><span class="pink1">#{</span>gravatar_id<span class="pink1">}</span><span class="red2">?s=</span><span class="pink1">#{</span>size<span class="pink1">}</span><span class="red2">"</span></span>
    image_tag(gravatar_url, <span class="violet">alt</span>: user<span class="ash">.</span>name, <span class="violet">class</span>: <span class="maroon">"gravatar"</span>)
 <strong><span class="green">end</span></strong>
<span class="green"><strong>end</strong></span></pre>
</div>
<p class="ex-title" id="ch07ex013"><strong>Listing 7.13:</strong> Using keyword arguments in the <span class="dark-green"><strong><code>gravatar_for</code></strong></span> helper.</p>
<pre class="pre2"><code>app/helpers/users_helper.rb</code></pre>
<p class="codelink"><a id="pf0330-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0330-02a">Click here to view code image</a></p>
<div class="example">
<pre><span class="green"><strong>module</strong></span> <strong><span class="blue3">UsersHelper</span></strong>

  <span class="blue"># Returns the Gravatar for the given user.</span>
<span class="mark">  <strong><span class="green3">def</span></strong> <span class="blue5">gravatar_for</span>(user, <span class="blue1">size</span>: <span class="ash1">80</span>)</span>
<span epub:type="pagebreak" id="page_331"></span>  gravatar_id <span class="ash">=</span> <span class="red">Digest</span><span class="ash">::</span><span class="red">MD5</span><span class="ash">::</span>hexdigest(user<span class="ash">.</span>email<span class="ash">.</span>downcase)
  gravatar_url <span class="ash">=</span> <span class="maroon">"https://secure.gravatar.com/avatar/</span><strong><span class="pink">#{</span></strong>gravatar_id<strong><span class="pink">}</span></strong><span class="maroon">?s=</span><strong><span class="pink">#{</span></strong>size<strong><span class="pink">}</span></strong><span class="maroon">"</span>
  image_tag(gravatar_url, <span class="violet">alt</span>: user<span class="ash">.</span>name, <span class="violet">class</span>: <span class="maroon">"gravatar"</span>)
 <strong><span class="green">end</span></strong>
<span class="green"><strong>end</strong></span></pre>
</div>
</section>
</section>
</section>
<section>
<h3 class="h3" id="sec7_2">7.2 Signup Form</h3>
<p class="noindent">Now that we have a working (though not yet complete) user profile page, we’re ready to make a signup form for our site. We saw in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch05.xhtml#ch05fig011">Figure 5.11</a> (shown again in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fig011">Figure 7.11</a>) that the signup page is currently blank: Right now it’s useless for signing up new users. The goal of this section is to start changing this sad state of affairs by producing the signup form mocked up in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fig012">Figure 7.12</a>.</p>
<figure id="ch07fig011" class="image-l">
<img src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/fig07_11.jpg" alt="Image" width="677" height="520" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig07_11.jpg">
<figcaption><p><strong>Figure 7.11:</strong> The current state of the signup page /signup.<span epub:type="pagebreak" id="page_332"></span></p></figcaption>
</figure>
<figure id="ch07fig012" class="image-l">
<img src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/fig07_12.jpg" alt="Image" width="677" height="582" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig07_12.jpg">
<figcaption><p><strong>Figure 7.12:</strong> A mockup of the user signup page.</p></figcaption>
</figure>
<section>
<h4 class="h4" id="sec7_2_1">7.2.1 Using <span class="dark-green"><strong><code>form_with</code></strong></span></h4>
<p class="noindent">The heart of the signup page is a <em>form</em> for submitting the relevant signup information (name, email, password, confirmation). We can accomplish this in Rails with the <span class="dark-green"><strong><code>form_with</code></strong></span> helper method, which uses an Active Record object to build a form using the object’s attributes.</p>
<p class="indent">Recall that the signup page /signup is routed to the <span class="dark-green"><strong><code>new</code></strong></span> action in the Users controller (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch05.xhtml#ch05ex043">Listing 5.43</a>). Our first step is to create the User object required as an argument to <span class="dark-green"><strong><code>form_with</code></strong></span>. The resulting <span class="dark-green"><strong><code>@user</code></strong></span> variable definition appears in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex014">Listing 7.14</a>.<span epub:type="pagebreak" id="page_333"></span></p>
<p class="ex-title" id="ch07ex014"><strong>Listing 7.14:</strong> Adding an <span class="dark-green"><strong><code>@user</code></strong></span> variable to the <span class="dark-green"><strong><code>new</code></strong></span> action.</p>
<pre class="pre2"><code>app/controllers/users_controller.rb</code></pre>
<p class="codelink"><a id="pf0333-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0333-01a">Click here to view code image</a></p>
<div class="example">
<pre><span class="green"><strong>class</strong></span> <strong><span class="blue3">UsersController</span></strong> <span class="ash">&lt;</span> <span class="red">ApplicationController</span>

  <strong><span class="green">def</span></strong> <span class="blue3">show</span>
    <span class="violet">@user</span> <span class="ash">=</span> <span class="red">User</span><span class="ash">.</span>find(params<span class="ash">[</span><span class="violet">:id</span><span class="ash">]</span>)
  <strong><span class="green">end</span></strong>

  <strong><span class="green">def</span></strong> <span class="blue3">new</span>
<span class="mark">    <span class="blue1">@user</span> <span class="ash1">=</span> <span class="red2">User</span><span class="ash1">.</span>new</span>
 <strong><span class="green">end</span></strong>
<span class="green"><strong>end</strong></span></pre>
</div>
<p class="indent">The form itself appears as in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex015">Listing 7.15</a>. We’ll discuss it in detail in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#sec7_2_2">Section 7.2.2</a>, but first let’s style it a little with the SCSS in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex016">Listing 7.16</a>. (Note the reuse of the <span class="dark-green"><strong><code>box_sizing</code></strong></span> mixin from <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex02">Listing 7.2</a>.) Once these CSS rules have been applied, the signup page appears as in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fig013">Figure 7.13</a>.</p>
<figure id="ch07fig013" class="image-l">
<img src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/fig07_13.jpg" alt="Image" width="677" height="521" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig07_13.jpg">
<figcaption><p><strong>Figure 7.13:</strong> The user signup form.</p></figcaption>
</figure>
<p class="ex-title" id="ch07ex015"><strong>Listing 7.15:</strong> A form to sign up new users.</p>
<pre class="pre2"><code>app/views/users/new.html.erb</code></pre>
<p class="codelink"><a id="pf0333-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0333-02a">Click here to view code image</a></p>
<div class="example">
<pre><span class="red5">&lt;%</span> provide(<span class="violet">:title</span>, <span class="maroon">'Sign up'</span>) <span class="red5">%&gt;</span>
&lt;<span class="green"><strong>h1</strong></span>&gt;Sign up&lt;/<span class="green"><strong>h1</strong></span>&gt;

&lt;<span class="green"><strong>div</strong></span> <span class="ash3">class</span><span class="ash">=</span><span class="maroon">"row"</span>&gt;
  &lt;<span class="green"><strong>div</strong></span> <span class="ash3">class</span><span class="ash">=</span><span class="maroon">"col-md-6 col-md-offset-3"</span>&gt;
    <span class="red5">&lt;%=</span> form_with(<span class="violet">model</span>: <span class="violet">@user</span>, <span class="violet">local</span>: <span class="green"><strong>true</strong></span>) <strong><span class="green">do</span></strong> <span class="ash">|</span>f<span class="ash">|</span> <span class="red5">%&gt;</span>
      <span class="red5">&lt;%=</span> f<span class="ash">.</span>label <span class="violet">:name</span> <span class="red5">%&gt;</span>
      <span class="red5">&lt;%=</span> f<span class="ash">.</span>text_field <span class="violet">:name</span> <span class="red5">%&gt;</span>

      <span class="red5">&lt;%=</span> f<span class="ash">.</span>label <span class="violet">:email</span> <span class="red5">%&gt;</span>
      <span class="red5">&lt;%=</span> f<span class="ash">.</span>email_field <span class="violet">:email</span> <span class="red5">%&gt;</span>

      <span class="red5">&lt;%=</span> f<span class="ash">.</span>label <span class="violet">:password</span> <span class="red5">%&gt;</span>
      <span class="red5">&lt;%=</span> f<span class="ash">.</span>password_field <span class="violet">:password</span> <span class="red5">%&gt;</span>

      <span class="red5">&lt;%=</span> f<span class="ash">.</span>label <span class="violet">:password_confirmation</span>, <span class="maroon">"Confirmation"</span> <span class="red5">%&gt;</span>
      <span class="red5">&lt;%=</span> f<span class="ash">.</span>password_field <span class="violet">:password_confirmation</span> <span class="red5">%&gt;</span>

      <span class="red5">&lt;%=</span> f<span class="ash">.</span>submit <span class="maroon">"Create my account"</span>, <span class="violet">class</span>: <span class="maroon">"btn btn-primary"</span> <span class="red5">%&gt;</span>
    <span class="red5">&lt;%</span> <strong><span class="green">end</span></strong> <span class="red5">%&gt;</span>
  &lt;/<span class="green"><strong>div</strong></span>&gt;
&lt;/<span class="green"><strong>div</strong></span>&gt;</pre>
</div>
<p class="ex-title" id="ch07ex016"><span epub:type="pagebreak" id="page_334"></span><strong>Listing 7.16:</strong> CSS for the signup form.</p>
<pre class="pre2"><code>app/assets/stylesheets/custom.scss</code></pre>
<p class="codelink"><a id="pf0334-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0334-01a">Click here to view code image</a></p>
<div class="example">
<pre><span class="blue3"><strong>.</strong></span>
<span class="blue3"><strong>.</strong></span>
<span class="blue3"><strong>.</strong></span>
<span class="ash">/*</span> <span class="green"><strong>forms</strong></span> <span class="ash">*/</span>

<span class="green"><strong>input</strong></span><span class="ash">,</span> <strong><span class="green">textarea</span></strong><span class="ash">,</span> <strong><span class="green">select</span></strong><span class="ash">,</span> <strong><span class="blue3">.uneditable-input</span></strong> {
  <span class="green"><strong>border</strong></span><span class="pink2">:</span> <strong><span class="green">1px solid</span></strong> <strong><span class="blue3">#bbb</span></strong><span class="ash">;</span>
  <span class="green"><strong>width</strong></span><span class="pink2">:</span> <strong><span class="green">100</span></strong>%<span class="ash">;</span>
  <span class="green"><strong>margin-bottom</strong></span><span class="pink2">:</span> <strong><span class="green">15px</span></strong><span class="ash">;</span>
  <span class="ash">@</span><strong><span class="green">include box_sizing</span></strong>;
}

<span class="green"><strong>input</strong></span> {
  <span class="green"><strong>height</strong></span><span class="pink2">:</span> <strong><span class="green">auto</span></strong> <span class="ash">!</span><strong><span class="green">important</span></strong><span class="ash">;</span>
}</pre>
</div>
<section>
<h5 class="h5" id="lev73"><span epub:type="pagebreak" id="page_335"></span>Exercise</h5>
<p class="noindent">Solutions to the exercises are available to all Rails Tutorial purchasers at <a href="https://www.railstutorial.org/aw-solutions">https://www.railstutorial.org/aw-solutions</a>.</p>
<p class="indent">To see other people’s answers and to record your own, subscribe to the Rails Tutorial course or to the Learn Enough All Access Bundle.</p>
<ol class="num">
<li><p class="num">Confirm by replacing all occurrences of <span class="dark-green"><strong><code>f</code></strong></span> with <span class="dark-green"><strong><code>foobar</code></strong></span> that the name of the block variable is irrelevant as far as the result is concerned. Why might <span class="dark-green"><strong><code>foobar</code></strong></span> nevertheless be a bad choice?</p></li>
</ol></section>
</section>
<section>
<h4 class="h4" id="sec7_2_2">7.2.2 Signup Form HTML</h4>
<p class="noindent">To understand the form defined in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex015">Listing 7.15</a>, it’s helpful to break it into smaller pieces. We’ll first look at the outer structure, which consists of embedded Ruby opening with a call to <span class="dark-green"><strong><code>form_with</code></strong></span> and closing with <span class="dark-green"><strong><code>end</code></strong></span>:</p>
<p class="codelink"><a id="pf0335-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0335-01a">Click here to view code image</a></p>
<pre class="pre1"><span class="red5">&lt;%=</span> form_with(<span class="violet">model</span>: <span class="violet">@user</span>, <span class="violet">local</span>: <span class="green"><strong>true</strong></span>) <strong><span class="green">do</span></strong> <span class="ash">|</span>f<span class="ash">|</span> <span class="red5">%&gt;</span>
  .
  .
  .
<span class="red5">&lt;%</span> <strong><span class="green">end</span></strong> <span class="red5">%&gt;</span></pre>
<p class="noindent">The presence of the <span class="dark-green"><strong><code>do</code></strong></span> keyword indicates that <span class="dark-green"><strong><code>form_with</code></strong></span> takes a block with one variable, which we’ve called <span class="dark-green"><strong><code>f</code></strong></span> (for “form”). Note the presence of the hash argument <span class="dark-green"><strong><code>local: true</code></strong></span>; by default, <span class="dark-green"><strong><code>form_with</code></strong></span> sends a “remote” XHR request, whereas we want a regular “local” form request, mostly so that our error messages will render properly (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#sec7_3_3">Section 7.3.3</a>).</p>
<p class="indent">As is usually the case with Rails helpers, we don’t need to know any details about the implementation, but what we <em>do</em> need to know is what the <span class="dark-green"><strong><code>f</code></strong></span> object does: When called with a method corresponding to an HTML form element—such as a text field, radio button, or password field—<span class="dark-green"><strong><code>f</code></strong></span> returns code for that element specifically designed to set an attribute of the <span class="dark-green"><strong><code>@user</code></strong></span> object. In other words,</p>
<pre class="pre1"><span class="red5">&lt;%=</span> f<span class="ash">.</span>label <span class="violet">:name</span> <span class="red5">%&gt;</span>
<span class="red5">&lt;%=</span> f<span class="ash">.</span>text_field <span class="violet">:name</span> <span class="red5">%&gt;</span></pre>
<p class="noindent"><span epub:type="pagebreak" id="page_336"></span>creates the HTML needed to make a labeled text field element appropriate for setting the <span class="dark-green"><strong><code>name</code></strong></span> attribute of a User model.</p>
<p class="indent">If you look at the HTML for the generated form by Ctrl-clicking and using the “inspect element” function of your browser, the page’s source should look something like <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex017">Listing 7.17</a>. Let’s take a moment to discuss its structure.</p>
<p class="ex-title" id="ch07ex017"><strong>Listing 7.17:</strong> The HTML for the form in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fig013">Figure 7.13</a>.</p>
<p class="codelink"><a id="pf0336-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0336-01a">Click here to view code image</a></p>
<div class="example">
<pre>&lt;<span class="green"><strong>form</strong></span> <span class="ash3">accept-charset</span><span class="ash">=</span><span class="maroon">"UTF-8"</span> <span class="ash3">action</span><span class="ash">=</span><span class="maroon">"/users"</span> <span class="ash3">class</span><span class="ash">=</span><span class="maroon">"new_user"</span>
      <span class="ash3">id</span><span class="ash">=</span><span class="maroon">"new_user"</span> <span class="ash3">method</span><span class="ash">=</span><span class="maroon">"post"</span>&gt;
  &lt;<span class="green"><strong>input</strong></span> <span class="ash3">name</span><span class="ash">=</span><span class="maroon">"authenticity_token"</span> <span class="ash3">type</span><span class="ash">=</span><span class="maroon">"hidden"</span>
         <span class="ash3">value</span><span class="ash">=</span><span class="maroon">"NNb6+J/j46LcrgYUC60wQ2titMuJQ5lLqyAbnbAUkdo="</span> /&gt;
  &lt;<span class="green"><strong>label</strong></span> <span class="ash3">for</span><span class="ash">=</span><span class="maroon">"user_name"</span>&gt;Name&lt;/<span class="green"><strong>label</strong></span>&gt;
  &lt;<span class="green"><strong>input</strong></span> <span class="ash3">id</span><span class="ash">=</span><span class="maroon">"user_name"</span> <span class="ash3">name</span><span class="ash">=</span><span class="maroon">"user[name]"</span> <span class="ash3">type</span><span class="ash">=</span><span class="maroon">"text"</span> /&gt;

  &lt;<span class="green"><strong>label</strong></span> <span class="ash3">for</span><span class="ash">=</span><span class="maroon">"user_email"</span>&gt;Email&lt;/<span class="green"><strong>label</strong></span>&gt;
  &lt;<span class="green"><strong>input</strong></span> <span class="ash3">id</span><span class="ash">=</span><span class="maroon">"user_email"</span> <span class="ash3">name</span><span class="ash">=</span><span class="maroon">"user[email]"</span> <span class="ash3">type</span><span class="ash">=</span><span class="maroon">"email"</span> /&gt;

  &lt;<span class="green"><strong>label</strong></span> <span class="ash3">for</span><span class="ash">=</span><span class="maroon">"user_password"</span>&gt;Password&lt;/<span class="green"><strong>label</strong></span>&gt;
  &lt;<span class="green"><strong>input</strong></span> <span class="ash3">id</span><span class="ash">=</span><span class="maroon">"user_password"</span> <span class="ash3">name</span><span class="ash">=</span><span class="maroon">"user[password]"</span>
         <span class="ash3">type</span><span class="ash">=</span><span class="maroon">"password"</span> /&gt;

  &lt;<span class="green"><strong>label</strong></span> <span class="ash3">for</span><span class="ash">=</span><span class="maroon">"user_password_confirmation"</span>&gt;Confirmation&lt;/<span class="green"><strong>label</strong></span>&gt;
  &lt;<span class="green"><strong>input</strong></span> <span class="ash3">id</span><span class="ash">=</span><span class="maroon">"user_password_confirmation"</span>
         <span class="ash3">name</span><span class="ash">=</span><span class="maroon">"user[password_confirmation]"</span> <span class="ash3">type</span><span class="ash">=</span><span class="maroon">"password"</span> /&gt;

  &lt;<span class="green"><strong>input</strong></span> <span class="ash3">class</span><span class="ash">=</span><span class="maroon">"btn btn-primary"</span> <span class="ash3">name</span><span class="ash">=</span><span class="maroon">"commit"</span> <span class="ash3">type</span><span class="ash">=</span><span class="maroon">"submit"</span>
         <span class="ash3">value</span><span class="ash">=</span><span class="maroon">"Create my account"</span> /&gt;
&lt;/<span class="green"><strong>form</strong></span>&gt;</pre>
</div>
<p class="indent">We’ll start with the internal structure of the document. Comparing <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex015">Listing 7.15</a> with <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex017">Listing 7.17</a>, we see that the embedded Ruby</p>
<pre class="pre1"><span class="red5">&lt;%=</span> f<span class="ash">.</span>label <span class="violet">:name</span> <span class="red5">%&gt;</span>
<span class="red5">&lt;%=</span> f<span class="ash">.</span>text_field <span class="violet">:name</span> <span class="red5">%&gt;</span></pre>
<p class="noindent">produces the HTML</p>
<p class="codelink"><a id="pf0336-03" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0336-03a">Click here to view code image</a></p>
<pre class="pre1">&lt;<span class="green"><strong>label</strong></span> <span class="ash3">for</span><span class="ash">=</span><span class="maroon">"user_name"</span>&gt;Name&lt;/<span class="green"><strong>label</strong></span>&gt;
&lt;<span class="green"><strong>input</strong></span> <span class="ash3">id</span><span class="ash">=</span><span class="maroon">"user_name"</span> <span class="ash3">name</span><span class="ash">=</span><span class="maroon">"user[name]"</span> <span class="ash3">type</span><span class="ash">=</span><span class="maroon">"text"</span> /&gt;</pre>
<p class="noindent"><span epub:type="pagebreak" id="page_337"></span>while</p>
<pre class="pre1"><span class="red5">&lt;%=</span> f<span class="ash">.</span>label <span class="violet">:email</span> <span class="red5">%&gt;</span>
<span class="red5">&lt;%=</span> f<span class="ash">.</span>email_field <span class="violet">:email</span> <span class="red5">%&gt;</span></pre>
<p class="noindent">produces the HTML</p>
<p class="codelink"><a id="pf0337-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0337-02a">Click here to view code image</a></p>
<pre class="pre1">&lt;<span class="green"><strong>label</strong></span> <span class="ash3">for</span><span class="ash">=</span><span class="maroon">"user_email"</span>&gt;Email&lt;/<span class="green"><strong>label</strong></span>&gt;
&lt;<span class="green"><strong>input</strong></span> <span class="ash3">id</span><span class="ash">=</span><span class="maroon">"user_email"</span> <span class="ash3">name</span><span class="ash">=</span><span class="maroon">"user[email]"</span> <span class="ash3">type</span><span class="ash">=</span><span class="maroon">"email"</span> /&gt;</pre>
<p class="noindent">and</p>
<p class="codelink"><a id="pf0337-03" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0337-03a">Click here to view code image</a></p>
<pre class="pre1"><span class="red5">&lt;%=</span> f<span class="ash">.</span>label <span class="violet">:password</span> <span class="red5">%&gt;</span>
<span class="red5">&lt;%=</span> f<span class="ash">.</span>password_field <span class="violet">:password</span> <span class="red5">%&gt;</span></pre>
<p class="noindent">produces the HTML</p>
<p class="codelink"><a id="pf0337-04" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0337-04a">Click here to view code image</a></p>
<pre class="pre1">&lt;<span class="green"><strong>label</strong></span> <span class="ash3">for</span><span class="ash">=</span><span class="maroon">"user_password"</span>&gt;Password&lt;/<span class="green"><strong>label</strong></span>&gt;
&lt;<span class="green"><strong>input</strong></span> <span class="ash3">id</span><span class="ash">=</span><span class="maroon">"user_password"</span> <span class="ash3">name</span><span class="ash">=</span><span class="maroon">"user[password]"</span> <span class="ash3">type</span><span class="ash">=</span><span class="maroon">"password"</span> /&gt;</pre>
<p class="noindent">As seen in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fig014">Figure 7.14</a>, text and email fields (<span class="dark-green"><strong><code>type="text"</code></strong></span> and <span class="dark-green"><strong><code>type="email"</code></strong></span>) simply display their contents, whereas password fields (<span class="dark-green"><strong><code>type="password"</code></strong></span>) obscure the input for security purposes, as seen in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fig014">Figure 7.14</a>. (The benefit of using an email field is that some systems treat it differently from a text field; for example, the code <span class="dark-green"><strong><code>type="email"</code></strong></span> will cause some mobile devices to display a special keyboard optimized for entering email addresses.)</p>
<figure id="ch07fig014" class="image-l">
<img src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/fig07_14.jpg" alt="Image" width="677" height="521" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig07_14.jpg">
<figcaption><p><strong>Figure 7.14:</strong> A filled-in form with <span class="dark-green"><strong><code>text</code></strong></span> and <span class="dark-green"><strong><code>password</code></strong></span> fields.</p></figcaption>
</figure>
<p class="indent">As we’ll see in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#sec7_4">Section 7.4</a>, the key to creating a user is the special <span class="dark-green"><strong><code>name</code></strong></span> attribute in each <span class="dark-green"><strong><code>input</code></strong></span>:</p>
<p class="codelink"><a id="pf0337-05" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0337-05a">Click here to view code image</a></p>
<pre class="pre1">&lt;<span class="green"><strong>input</strong></span> <span class="ash3">id</span><span class="ash">=</span><span class="maroon">"user_name"</span> <span class="ash3">name</span><span class="ash">=</span><span class="maroon">"user[name]"</span> <span class="ash3">- - -</span> /&gt;
.
.
.
&lt;<span class="green"><strong>input</strong></span> <span class="ash3">id</span><span class="ash">=</span><span class="maroon">"user_password"</span> <span class="ash3">name</span><span class="ash">=</span><span class="maroon">"user[password]"</span> <span class="ash3">- - -</span> /&gt;</pre>
<p class="noindent">These <span class="dark-green"><strong><code>name</code></strong></span> values allow Rails to construct an initialization hash (via the <span class="dark-green"><strong><code>params</code></strong></span> variable) for creating users using the values entered by the user, as we’ll see in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#sec7_3">Section 7.3</a>.<span epub:type="pagebreak" id="page_338"></span></p>
<p class="indent">The second important element is the <span class="dark-green"><strong><code>form</code></strong></span> tag itself. Rails creates the <span class="dark-green"><strong><code>form</code></strong></span> tag using the <span class="dark-green"><strong><code>@user</code></strong></span> object: Because every Ruby object knows its own class (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch04.xhtml#sec4_4_1">Section 4.4.1</a>), Rails figures out that <span class="dark-green"><strong><code>@user</code></strong></span> is of class <span class="dark-green"><strong><code>User</code></strong></span>. Moreover, since <span class="dark-green"><strong><code>@user</code></strong></span> is a <em>new</em> user, Rails knows to construct a form with the <span class="dark-green"><strong><code>post</code></strong></span> method, which is the proper verb for creating a new object (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch03.xhtml#box3_2">Box 3.2</a>):</p>
<p class="codelink"><a id="pf0338-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0338-01a">Click here to view code image</a></p>
<pre class="pre1">&lt;<span class="green"><strong>form</strong></span> <span class="ash3">action</span><span class="ash">=</span><span class="maroon">"/users"</span> <span class="ash3">class</span><span class="ash">=</span><span class="maroon">"new_user"</span> <span class="ash3">id</span><span class="ash">=</span><span class="maroon">"new_user"</span> <span class="ash3">method</span><span class="ash">=</span><span class="maroon">"post"</span>&gt;</pre>
<p class="noindent">Here the <span class="dark-green"><strong><code>class</code></strong></span> and <span class="dark-green"><strong><code>id</code></strong></span> attributes are largely irrelevant; what’s important is <span class="dark-green"><strong><code>action=-"/users"</code></strong></span> and <span class="dark-green"><strong><code>method="post"</code></strong></span>. Together, these constitute instructions to issue an HTTP <code>POST</code> request to the /users URL. In the next two sections we’ll see what effects this has.</p>
<p class="indent">You may also have noticed the code that appears just inside the <span class="dark-green"><strong><code>form</code></strong></span> tag:</p>
<p class="codelink"><a id="pf0338-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0338-02a">Click here to view code image</a></p>
<pre class="pre1">&lt;<span class="green"><strong>input</strong></span> <span class="ash3">name</span><span class="ash">=</span><span class="maroon">"authenticity_token"</span> <span class="ash3">type</span><span class="ash">=</span><span class="maroon">"hidden"</span>
       <span class="ash3">value</span><span class="ash">=</span><span class="maroon">"NNb6+J/j46LcrgYUC60wQ2titMuJQ5lLqyAbnbAUkdo="</span> /&gt;</pre>
<p class="noindent"><span epub:type="pagebreak" id="page_339"></span>This code, which isn’t displayed in the browser, is used internally by Rails, so it’s not important for us to understand what it does. Briefly, it includes an <em>authenticity token</em>, which Rails uses to thwart an attack called a <em>cross-site request forgery</em> (CSRF). Knowing when it’s OK to ignore details like this is a good mark of technical sophistication (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch01.xhtml#box1_2">Box 1.2</a>).<sup><a id="ch07fn11a" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fn11">11</a></sup></p>
<p class="footnote"><a id="ch07fn11" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fn11a">11</a>. See the Stack Overflow entry on the Rails authenticity token if you’re interested in the details of how this works.</p>
<section>
<h5 class="h5" id="lev74">Exercise</h5>
<p class="noindent">Solutions to the exercises are available to all Rails Tutorial purchasers at <a href="https://www.railstutorial.org/aw-solutions">https://www.railstutorial.org/aw-solutions</a>.</p>
<p class="indent">To see other people’s answers and to record your own, subscribe to the Rails Tutorial course or to the Learn Enough All Access Bundle.</p>
<p class="indent">1. <em>Learn Enough HTML to Be Dangerous</em>, in which all HTML is written by hand, doesn’t cover the <span class="dark-green"><strong><code>form</code></strong></span> tag. Why not?</p>
</section>
</section>
</section>
<section>
<h3 class="h3" id="sec7_3">7.3 Unsuccessful Signups</h3>
<p class="noindent">Although we’ve briefly examined the HTML for the form in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fig013">Figure 7.13</a> (shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex017">Listing 7.17</a>), we haven’t yet covered any details, and the form is best understood in the context of <em>signup failure</em>. In this section, we’ll create a signup form that accepts an invalid submission and re-renders the signup page with a list of errors, as mocked up in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fig015">Figure 7.15</a>.</p>
<figure id="ch07fig015" class="image-l">
<img src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/fig07_15.jpg" alt="Image" width="677" height="582" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig07_15.jpg">
<figcaption><p><strong>Figure 7.15:</strong> A mockup of the signup failure page.</p></figcaption>
</figure>
<section>
<h4 class="h4" id="sec7_3_1">7.3.1 A Working Form</h4>
<p class="noindent">Recall from <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#sec7_1_2">Section 7.1.2</a> that adding <span class="dark-green"><strong><code>resources :users</code></strong></span> to the <span class="dark-green"><strong><code>routes.rb</code></strong></span> file (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex03">Listing 7.3</a>) automatically ensures that our Rails application responds to the RESTful URLs from <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07tab01">Table 7.1</a>. In particular, it ensures that a <code>POST</code> request to /users is handled by the <span class="dark-green"><strong><code>create</code></strong></span> action. Our strategy for the <span class="dark-green"><strong><code>create</code></strong></span> action is to use the form submission to make a new user object with <span class="dark-green"><strong><code>User.new</code></strong></span>, try (and fail) to save that user, and then render the signup page for possible resubmission. Let’s get started by reviewing the code for the signup form:<span epub:type="pagebreak" id="page_340"></span></p>
<p class="codelink"><a id="pf0340-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0340-01a">Click here to view code image</a></p>
<pre class="pre1">&lt;<span class="green"><strong>form</strong></span> <span class="ash3">action</span><span class="ash">=</span><span class="maroon">"/users"</span> <span class="ash3">class</span><span class="ash">=</span><span class="maroon">"new_user"</span> <span class="ash3">id</span><span class="ash">=</span><span class="maroon">"new_user"</span> <span class="ash3">method</span><span class="ash">=</span><span class="maroon">"post"</span>&gt;</pre>
<p class="noindent">As noted in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#sec7_2_2">Section 7.2.2</a>, this HTML issues a <code>POST</code> request to the /users URL.</p>
<p class="indent">Our first step toward a working signup form is adding the code in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex018">Listing 7.18</a>. This listing includes a second use of the <span class="dark-green"><strong><code>render</code></strong></span> method, which we first saw in the context of partials (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch05.xhtml#sec5_1_3">Section 5.1.3</a>); as you can see, <span class="dark-green"><strong><code>render</code></strong></span> works in controller actions as well. Note that we’ve taken this opportunity to introduce an <span class="dark-green"><strong><code>if</code></strong></span>-<span class="dark-green"><strong><code>else</code></strong></span> branching structure, which allows us to handle the cases of failure and success separately based on the value of <span class="dark-green"><strong><code>@user.save</code></strong></span>, which (as we saw in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch06.xhtml#sec6_1_3">Section 6.1.3</a>) is either <span class="dark-green"><strong><code>true</code></strong></span> or <span class="dark-green"><strong><code>false</code></strong></span> depending on whether the save succeeds.<span epub:type="pagebreak" id="page_341"></span></p>
<p class="ex-title" id="ch07ex018"><strong>Listing 7.18:</strong> A <span class="dark-green"><strong><code>create</code></strong></span> action that can handle signup failure.</p>
<pre class="pre2"><code>app/controllers/users_controller.rb</code></pre>
<p class="codelink"><a id="pf0341-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0341-01a">Click here to view code image</a></p>
<div class="example">
<pre><span class="green"><strong>class</strong></span> <strong><span class="blue3">UsersController</span></strong> <span class="ash">&lt;</span> <span class="red">ApplicationController</span>

  <strong><span class="green">def</span></strong> <span class="blue3">show</span>
    <span class="violet">@user</span> <span class="ash">=</span> <span class="red">User</span><span class="ash">.</span>find(params<span class="ash">[</span><span class="violet">:id</span><span class="ash">]</span>)
  <strong><span class="green">end</span></strong>

  <strong><span class="green">def</span></strong> <span class="blue3">new</span>
    <span class="violet">@user</span> <span class="ash">=</span> <span class="red">User</span><span class="ash">.</span>new
  <strong><span class="green">end</span></strong>

  <strong><span class="green">def</span></strong> <span class="blue3">create</span>
<span class="mark">    <span class="blue1">@user</span> <span class="ash1">=</span> <span class="red2">User</span><span class="ash1">.</span>new(params<span class="ash1">[</span><span class="blue1">:user</span><span class="ash1">]</span>) <span class="green4"># Not the final implementation!</span></span>
    <span class="green"><strong>if</strong></span> <span class="violet">@user</span><span class="ash">.</span>save
      <span class="blue"># Handle a successful save.</span>
    <span class="green"><strong>else</strong></span>
      render <span class="maroon">'new'</span>
    <strong><span class="green">end</span></strong>
  <strong><span class="green">end</span></strong>
<span class="green"><strong>end</strong></span></pre>
</div>
<p class="noindent">Note the comment: This is not the final implementation. But it’s enough to get us started, and we’ll finish the implementation in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#sec7_3_2">Section 7.3.2</a>.</p>
<p class="indent">The best way to understand how the code in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex018">Listing 7.18</a> works is to <em>submit</em> the form with some invalid signup data. The result appears in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fig016">Figure 7.16</a>, and the full debug information appears in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fig017">Figure 7.17</a>.</p>
<figure id="ch07fig016" class="image-l">
<img src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/fig07_16.jpg" alt="Image" width="677" height="521" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig07_16.jpg">
<figcaption><p><strong>Figure 7.16:</strong> Signup failure upon submitting invalid data.</p></figcaption>
</figure>
<figure id="ch07fig017" class="image-l">
<img src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/fig07_17.jpg" alt="Image" width="677" height="147" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig07_17.jpg">
<figcaption><p><strong>Figure 7.17:</strong> Signup failure debug information.</p></figcaption>
</figure>
<p class="indent">To get a better picture of how Rails handles the submission, let’s take a closer look at the <span class="dark-green"><strong><code>user</code></strong></span> part of the parameters hash from the debug information (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fig017">Figure 7.17</a>):</p>
<p class="codelink"><a id="pf0341-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0341-02a">Click here to view code image</a></p>
<pre class="pre1"><span class="maroon">"user"</span> <span class="ash">=&gt;</span> { <span class="maroon">"name"</span> <span class="ash">=&gt;</span> <span class="maroon">"Foo Bar"</span>,
            <span class="maroon">"email"</span> <span class="ash">=&gt;</span> <span class="maroon">"foo@invalid"</span>,
            <span class="maroon">"password"</span> <span class="ash">=&gt;</span> <span class="maroon">"[FILTERED]"</span>,
            <span class="maroon">"password_confirmation"</span> <span class="ash">=&gt;</span> <span class="maroon">"[FILTERED]"</span>
          }</pre>
<p class="noindent">This hash gets passed to the Users controller as part of <span class="dark-green"><strong><code>params</code></strong></span>, and we saw starting in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#sec7_1_2">Section 7.1.2</a> that the <span class="dark-green"><strong><code>params</code></strong></span> hash contains information about each request. In the case of a URL like /users/1, the value of <span class="dark-green"><strong><code>params[:id]</code></strong></span> is the <span class="dark-green"><strong><code>id</code></strong></span> of the corresponding <span epub:type="pagebreak" id="page_342"></span>user (<span class="dark-green"><strong><code>1</code></strong></span> in this example). In the case of posting to the signup form, <span class="dark-green"><strong><code>params</code></strong></span> instead contains a hash of hashes, a construction we first saw in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch04.xhtml#sec4_3_3">Section 4.3.3</a>, which introduced the strategically named <span class="dark-green"><strong><code>params</code></strong></span> variable in a console session. This debug information shows that submitting the form results in a <span class="dark-green"><strong><code>user</code></strong></span> hash with attributes corresponding <span epub:type="pagebreak" id="page_343"></span>to the submitted values, where the keys come from the <span class="dark-green"><strong><code>name</code></strong></span> attributes of the <span class="dark-green"><strong><code>input</code></strong></span> tags seen in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex017">Listing 7.17</a>. For example, the value of</p>
<p class="codelink"><a id="pf0343-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0343-01a">Click here to view code image</a></p>
<pre class="pre1">&lt;<span class="green"><strong>input</strong></span> <span class="ash3">id</span><span class="ash">=</span><span class="maroon">"user_email"</span> <span class="ash3">name</span><span class="ash">=</span><span class="maroon">"user[email]"</span> <span class="ash3">type</span><span class="ash">=</span><span class="maroon">"email"</span> /&gt;</pre>
<p class="noindent">with name <span class="dark-green"><strong><code>"user[email]"</code></strong></span> is precisely the <span class="dark-green"><strong><code>email</code></strong></span> attribute of the <span class="dark-green"><strong><code>user</code></strong></span> hash.</p>
<p class="indent">Although the hash keys appear as strings in the debug output, we can access them in the Users controller as symbols, so that <span class="dark-green"><strong><code>params[:user]</code></strong></span> is the hash of user attributes—in fact, exactly the attributes needed as an argument to <span class="dark-green"><strong><code>User.new</code></strong></span>, as seen first in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch04.xhtml#sec4_4_5">Section 4.4.5</a> and then in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex018">Listing 7.18</a>. This means that the line</p>
<pre class="pre1"><span class="violet">@user</span> <span class="ash">=</span> <span class="red">User</span><span class="ash">.</span>new(params<span class="ash">[</span><span class="violet">:user</span><span class="ash">]</span>)</pre>
<p class="noindent">is mostly equivalent to</p>
<p class="codelink"><a id="pf0343-03" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0343-03a">Click here to view code image</a></p>
<pre class="pre1"><span class="violet">@user</span> <span class="ash">=</span> <span class="red">User</span><span class="ash">.</span>new(<span class="green1">name</span>: <span class="maroon">"Foo Bar"</span>, <span class="violet">email</span>: <span class="maroon">"foo@invalid"</span>,
                 <span class="violet">password</span>: <span class="maroon">"foo"</span>, <span class="violet">password_confirmation</span>: <span class="maroon">"bar"</span>)</pre>
<p class="indent">In previous versions of Rails, using</p>
<pre class="pre1"><span class="violet">@user</span> <span class="ash">=</span> <span class="red">User</span><span class="ash">.</span>new(params<span class="ash">[</span><span class="violet">:user</span><span class="ash">]</span>)</pre>
<p class="noindent">actually worked, but it was insecure by default and required a careful and error-prone procedure to prevent malicious users from potentially modifying the application database. In Rails versions later than 4.0, this code raises an error (as seen in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fig016">Figure 7.16</a> and <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fig017">Figure 7.17</a>), which means it is secure by default.</p>
</section>
<section>
<h4 class="h4" id="sec7_3_2">7.3.2 Strong Parameters</h4>
<p class="noindent">We mentioned briefly in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch04.xhtml#sec4_4_5">Section 4.4.5</a> the idea of <em>mass assignment</em>, which involves initializing a Ruby variable using a hash of values, as in</p>
<p class="codelink"><a id="pf0343-05" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0343-05a">Click here to view code image</a></p>
<pre class="pre1"><span class="violet">@user</span> <span class="ash">=</span> <span class="red">User</span><span class="ash">.</span>new(params<span class="ash">[</span><span class="violet">:user</span><span class="ash">]</span>)   <span class="blue"># Not the final implementation!</span></pre>
<p class="noindent">The comment included in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex018">Listing 7.18</a> and reproduced here indicates that this is not the final implementation. The reason is that initializing the entire <span class="dark-green"><strong><code>params</code></strong></span> hash is <span epub:type="pagebreak" id="page_344"></span><em>extremely</em> dangerous: It arranges to pass to <span class="dark-green"><strong><code>User.new</code></strong></span> <em>all</em> data submitted by a user. In particular, suppose that, in addition to the current attributes, the User model included an <span class="dark-green"><strong><code>admin</code></strong></span> attribute used to identify administrative users of the site. (We will implement just such an attribute in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch10.xhtml#sec10_4_1">Section 10.4.1</a>.) The way to set such an attribute to <span class="dark-green"><strong><code>true</code></strong></span> is to pass the value <span class="dark-green"><strong><code>admin='1'</code></strong></span> as part of <span class="dark-green"><strong><code>params[:user]</code></strong></span>, a task that is easy to accomplish using a command-line HTTP client such as <span class="dark-green"><strong><code>curl</code></strong></span>. The result would be that, by passing in the entire <span class="dark-green"><strong><code>params</code></strong></span> hash to <span class="dark-green"><strong><code>User.new</code></strong></span>, we would allow any user of the site to gain administrative access by including <span class="dark-green"><strong><code>admin='1'</code></strong></span> in the web request.</p>
<p class="indent">Previous versions of Rails used a method called <span class="dark-green"><strong><code>attr_accessible</code></strong></span> in the <em>model</em> layer to solve this problem, and you may still see that method in legacy Rails applications. As of Rails 4.0, though, the preferred technique is to use <em>strong parameters</em> in the controller layer. This allows us to specify which parameters are <em>required</em> and which ones are <em>permitted</em>. In addition, passing in a raw <span class="dark-green"><strong><code>params</code></strong></span> hash just shown will cause an error to be raised, so that Rails applications are now immune to mass assignment vulnerabilities by default.</p>
<p class="indent">In the present instance, we want to require the <span class="dark-green"><strong><code>params</code></strong></span> hash to have a <span class="dark-green"><strong><code>:user</code></strong></span> attribute, and we want to permit the name, email, password, and password confirmation attributes (but no others). We can accomplish this as follows:</p>
<p class="codelink"><a id="pf0344-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0344-01a">Click here to view code image</a></p>
<pre class="pre1">params<span class="ash">.</span>require(<span class="violet">:user</span>)<span class="ash">.</span>permit(<span class="violet">:name</span>, <span class="violet">:email</span>, <span class="violet">:password</span>, <span class="violet">:password_confirmation</span>)</pre>
<p class="noindent">This code returns a version of the <span class="dark-green"><strong><code>params</code></strong></span> hash with only the permitted attributes (while raising an error if the <span class="dark-green"><strong><code>:user</code></strong></span> attribute is missing).</p>
<p class="indent">To facilitate the use of these parameters, it’s conventional to introduce an auxiliary method called <span class="dark-green"><strong><code>user_params</code></strong></span> (which returns an appropriate initialization hash) and use it in place of <span class="dark-green"><strong><code>params[:user]</code></strong></span>:</p>
<pre class="pre1"><span class="violet">@user</span> <span class="ash">=</span> <span class="red">User</span><span class="ash">.</span>new(user_params)</pre>
<p class="noindent">Since <span class="dark-green"><strong><code>user_params</code></strong></span> will be used only internally by the Users controller and need not be exposed to external users via the web, we’ll make it <em>private</em> using Ruby’s <span class="dark-green"><strong><code>private</code></strong></span> keyword, as shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex019">Listing 7.19</a>. (We’ll discuss <span class="dark-green"><strong><code>private</code></strong></span> in more detail in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch09.xhtml#sec9_1">Section 9.1</a>.)<span epub:type="pagebreak" id="page_345"></span></p>
<p class="ex-title" id="ch07ex019"><strong>Listing 7.19:</strong> Using strong parameters in the <span class="dark-green"><strong><code>create</code></strong></span> action.</p>
<pre class="pre2"><code>app/controllers/users_controller.rb</code></pre>
<p class="codelink"><a id="pf0345-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0345-01a">Click here to view code image</a></p>
<div class="example">
<pre><span class="green"><strong>class</strong></span> <strong><span class="blue3">UsersController</span></strong> <span class="ash">&lt;</span> <span class="red">ApplicationController</span>
  <span class="ash">.</span>
  <span class="ash">.</span>
  <span class="ash">.</span>
  <strong><span class="green">def</span></strong> <span class="blue3">create</span>
<span class="mark">    <span class="blue1">@user</span> <span class="ash1">=</span> <span class="red2">User</span><span class="ash1">.</span>new(user_params)</span>
    <span class="green"><strong>if</strong></span> <span class="violet">@user</span><span class="ash">.</span>save
      <span class="blue"># Handle a successful save.</span>
    <span class="green"><strong>else</strong></span>
      render <span class="maroon">'new'</span>
    <strong><span class="green">end</span></strong>
  <strong><span class="green">end</span></strong>

  <span class="green"><strong>private</strong></span>

    <strong><span class="green">def</span></strong> <span class="blue3">user_params</span>
<span class="mark">      params<span class="ash1">.</span>require(<span class="blue1">:user</span>)<span class="ash1">.</span>permit(<span class="blue1">:name</span>, <span class="blue1">:email</span>, <span class="blue1">:password</span>,</span>
<span class="mark">                                   <span class="blue1">:password_confirmation</span>)</span>
    <strong><span class="green">end</span></strong>
<span class="green"><strong>end</strong></span></pre>
</div>
<p class="noindent">By the way, the extra level of indentation on the <span class="dark-green"><strong><code>user_params</code></strong></span> method is designed to make it visually apparent which methods are defined after <span class="dark-green"><strong><code>private</code></strong></span>. (Experience shows that this is a wise practice; in classes with a large number of methods, it is easy to define a private method accidentally, which leads to considerable confusion when it isn’t available to call on the corresponding object.)</p>
<p class="indent">At this point, the signup form is working, at least in the sense that it no longer produces an error upon submission. Of course, as seen in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fig018">Figure 7.18</a>, it doesn’t display any feedback on invalid submissions (apart from the development-only debug area), which is potentially confusing. It also doesn’t actually create a new user. We’ll fix the first issue in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#sec7_3_3">Section 7.3.3</a> and the second in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#sec7_4">Section 7.4</a>.</p>
<figure id="ch07fig018" class="image-l">
<img src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/fig07_18.jpg" alt="Image" width="677" height="520" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig07_18.jpg">
<figcaption><p><strong>Figure 7.18:</strong> The signup form submitted with invalid information.</p></figcaption>
</figure>
<section>
<h5 class="h5" id="lev75">Exercise</h5>
<p class="noindent">Solutions to the exercises are available to all Rails Tutorial purchasers at <a href="https://www.railstutorial.org/aw-solutions">https://www.railstutorial.org/aw-solutions</a>.</p>
<p class="indent">To see other people’s answers and to record your own, subscribe to the Rails Tutorial course or to the Learn Enough All Access Bundle.<span epub:type="pagebreak" id="page_346"></span></p>
<ol class="num">
<li><p class="num">By hitting the URL /signup?admin=1, confirm that the <span class="dark-green"><strong><code>admin</code></strong></span> attribute appears in the <span class="dark-green"><strong><code>params</code></strong></span> debug information.</p></li>
</ol></section>
</section>
<section>
<h4 class="h4" id="sec7_3_3">7.3.3 Signup Error Messages</h4>
<p class="noindent">As a final step in handling failed user creation, we’ll add helpful error messages to indicate the problems that prevented successful signup. Conveniently, Rails automatically provides such messages based on the User model validations. For example, consider trying to save a user with an invalid email address and with a password that’s too short:</p>
<p class="codelink"><a id="pf0346-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0346-01a">Click here to view code image</a></p>
<pre class="pre1"><span class="green">$ rails console</span>
<span class="navy"><strong>&gt;&gt;</strong></span> user <span class="ash">=</span> <span class="red">User</span><span class="ash">.</span>new(<span class="green1">name</span>: <span class="maroon">"Foo Bar"</span>, <span class="violet">email</span>: <span class="maroon">"foo@invalid"</span>,
<span class="navy"><strong>?&gt;</strong></span>                 <span class="violet">password</span>: <span class="maroon">"dude"</span>, <span class="violet">password_confirmation</span>: <span class="maroon">"dude"</span>)
<span class="navy"><strong>&gt;&gt;</strong></span> user<span class="ash">.</span>save
<span class="green">=&gt; false</span>
<span epub:type="pagebreak" id="page_347"></span><span class="navy"><strong>&gt;&gt;</strong></span> user<span class="ash">.</span>errors<span class="ash">.</span>full_messages
<span class="green">=&gt; ["Email is invalid", "Password is too short (minimum is 6 characters)"]</span></pre>
<p class="noindent">Here the <span class="dark-green"><strong><code>errors.full_messages</code></strong></span> object (which we saw briefly before in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch06.xhtml#sec6_2_2">Section 6.2.2</a>) contains an array of error messages.</p>
<p class="indent">As in the console session just shown, the failed save in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex018">Listing 7.18</a> generates a list of error messages associated with the <span class="dark-green"><strong><code>@user</code></strong></span> object. To display the messages in the browser, we’ll render an error-messages partial on the user <span class="dark-green"><strong><code>new</code></strong></span> page while adding the CSS class <span class="dark-green"><strong><code>form-control</code></strong></span> (which has special meaning to Bootstrap) to each entry field, as shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex020">Listing 7.20</a>. It’s worth noting that this error-messages partial is only a first attempt; the final version appears in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch13.xhtml#sec13_3_2">Section 13.3.2</a>.</p>
<p class="ex-title" id="ch07ex020"><strong>Listing 7.20:</strong> Code to display error messages on the signup form.</p>
<pre class="pre2"><code>app/views/users/new.html.erb</code></pre>
<p class="codelink"><a id="pf0347-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0347-02a">Click here to view code image</a></p>
<div class="example">
<pre><span class="red5">&lt;%</span> provide(<span class="violet">:title</span>, <span class="maroon">'Sign up'</span>) <span class="red5">%&gt;</span>
&lt;<span class="green"><strong>h1</strong></span>&gt;Sign up&lt;/<span class="green"><strong>h1</strong></span>&gt;

&lt;<span class="green"><strong>div</strong></span> <span class="ash3">class</span><span class="ash">=</span><span class="maroon">"row"</span>&gt;
  &lt;<span class="green"><strong>div</strong></span> <span class="ash3">class</span><span class="ash">=</span><span class="maroon">"col-md-6 col-md-offset-3"</span>&gt;
    <span class="red5">&lt;%=</span> form_with(<span class="violet">model</span>: <span class="violet">@user</span>, <span class="violet">local</span>: <span class="green"><strong>true</strong></span>) <strong><span class="green">do</span></strong> <span class="ash">|</span>f<span class="ash">|</span> <span class="red5">%&gt;</span>
<span class="mark">      <span class="maroon1">&lt;%=</span> render <span class="red2">'shared/error_messages'</span> <span class="maroon1">%&gt;</span></span>

      <span class="red5">&lt;%=</span> f<span class="ash">.</span>label <span class="violet">:name</span> <span class="red5">%&gt;</span>
<span class="mark">      <span class="maroon1">&lt;%=</span> f.text_field <span class="blue1">:name</span>, <span class="blue1">class</span>: <span class="red2">'form-control'</span> <span class="maroon1">%&gt;</span></span>

      <span class="red5">&lt;%=</span> f<span class="ash">.</span>label <span class="violet">:email</span> <span class="red5">%&gt;</span>
<span class="mark">      <span class="maroon1">&lt;%=</span> f.email_field <span class="blue1">:email</span>, <span class="blue1">class</span>: <span class="red2">'form-control'</span> <span class="maroon1">%&gt;</span></span>

      <span class="red5">&lt;%=</span> f<span class="ash">.</span>label <span class="violet">:password</span> <span class="red5">%&gt;</span>
<span class="mark">      <span class="maroon1">&lt;%=</span> f.password_field <span class="blue1">:password</span>, <span class="blue1">class</span>: <span class="red2">'form-control'</span> <span class="maroon1">%&gt;</span></span>

      <span class="red5">&lt;%=</span> f<span class="ash">.</span>label <span class="violet">:password_confirmation</span>, <span class="maroon">"Confirmation"</span> <span class="red5">%&gt;</span>
<span class="mark">      <span class="maroon1">&lt;%=</span> f.password_field <span class="blue1">:password_confirmation</span>, class: <span class="red2">'form-control'</span> <span class="maroon1">%&gt;</span></span>

      <span class="red5">&lt;%=</span> f<span class="ash">.</span>submit <span class="maroon">"Create my account"</span>, <span class="violet">class</span>: <span class="maroon">"btn btn-primary"</span> <span class="red5">%&gt;</span>
    <span class="red5">&lt;%</span> <strong><span class="green">end</span></strong> <span class="red5">%&gt;</span>
  &lt;/<span class="green"><strong>div</strong></span>&gt;
&lt;/<span class="green"><strong>div</strong></span>&gt;</pre>
</div>
<p class="noindent">Notice here that we <span class="dark-green"><strong><code>render</code></strong></span> a partial called <span class="dark-green"><strong><code>'shared/error_messages'</code></strong></span>; this reflects the common Rails convention of using a dedicated <span class="dark-green"><strong><code>shared/</code></strong></span> directory for partials <span epub:type="pagebreak" id="page_348"></span>expected to be used in views across multiple controllers. (We’ll see this expectation fulfilled in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch10.xhtml#sec10_1_1">Section 10.1.1</a>.)</p>
<p class="indent">Now we have to create a new <span class="dark-green"><strong><code>app/views/shared</code></strong></span> directory using <span class="dark-green"><strong><code>mkdir</code></strong></span> and an error messages partial using (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch01.xhtml#ch01tab01">Table 1.1</a>):</p>
<pre class="pre1"><strong><span class="navy">$</span></strong> mkdir app/views/shared</pre>
<p class="noindent">We then need to create the <span class="dark-green"><strong><code>_error_messages.html.erb</code></strong></span> partial file using <span class="dark-green"><strong><code>touch</code></strong></span> or the text editor as usual. The contents of the partial appear in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex021">Listing 7.21</a>.</p>
<p class="ex-title" id="ch07ex021"><strong>Listing 7.21:</strong> A partial for displaying form submission error messages.</p>
<pre class="pre2"><code>app/views/shared/_error_messages.html.erb</code></pre>
<p class="codelink"><a id="pf0348-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0348-02a">Click here to view code image</a></p>
<div class="example">
<pre><span class="red5">&lt;%</span> <span class="green"><strong>if</strong></span> <span class="violet">@user</span><span class="ash">.</span>errors<span class="ash">.</span>any? <span class="red5">%&gt;</span>
  &lt;<span class="green"><strong>div</strong></span> <span class="ash3">id</span><span class="ash">=</span><span class="maroon">"error_explanation"</span>&gt;
    &lt;<span class="green"><strong>div</strong></span> <span class="ash3">class</span><span class="ash">=</span><span class="maroon">"alert alert-danger"</span>&gt;
      The form contains <span class="red5">&lt;%=</span> pluralize(<span class="violet">@user</span><span class="ash">.</span>errors<span class="ash">.</span>count, <span class="maroon">"error"</span>) <span class="red5">%&gt;</span>.
    &lt;/<span class="green"><strong>div</strong></span>&gt;
    &lt;<span class="green"><strong>ul</strong></span>&gt;
    <span class="red5">&lt;%</span> <span class="violet">@user</span><span class="ash">.</span>errors<span class="ash">.</span>full_messages<span class="ash">.</span>each <strong><span class="green">do</span></strong> <span class="ash">|</span>msg<span class="ash">|</span> <span class="red5">%&gt;</span>
      &lt;<strong><span class="green">li</span></strong>&gt;<span class="red5">&lt;%=</span> msg <span class="red5">%&gt;</span>&lt;/<strong><span class="green">li</span></strong>&gt;
    <span class="red5">&lt;%</span> <strong><span class="green">end</span></strong> <span class="red5">%&gt;</span>
    &lt;/<strong><span class="green">ul</span></strong>&gt;
  &lt;/<strong><span class="green">div</span></strong>&gt;
<span class="red5">&lt;%</span> <strong><span class="green">end</span></strong> <span class="red5">%&gt;</span></pre>
</div>
<p class="noindent">This partial introduces several new Rails and Ruby constructs, including two methods for Rails error objects. The first method is <span class="dark-green"><strong><code>count</code></strong></span>, which simply returns the number of errors:</p>
<pre class="pre1"><span class="navy"><strong>&gt;&gt;</strong></span> user<span class="ash">.</span>errors<span class="ash">.</span>count
<span class="green">=&gt; 2</span></pre>
<p class="noindent">The other new method is <span class="dark-green"><strong><code>any?</code></strong></span>, which (together with <span class="dark-green"><strong><code>empty?</code></strong></span>) is one of a pair of complementary methods:</p>
<pre class="pre1"><span class="navy"><strong>&gt;&gt;</strong></span> user<span class="ash">.</span>errors<span class="ash">.</span>empty?
<span class="green">=&gt; false</span>
<span class="navy"><strong>&gt;&gt;</strong></span> user<span class="ash">.</span>errors<span class="ash">.</span>any?
<span class="green">=&gt; true</span></pre>
<p class="noindent"><span epub:type="pagebreak" id="page_349"></span>We see here that the <span class="dark-green"><strong><code>empty?</code></strong></span> method, which we first encountered in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch04.xhtml#sec4_2_2">Section 4.2.2</a> in the context of strings, also works on Rails error objects, returning <span class="dark-green"><strong><code>true</code></strong></span> for an empty object and <span class="dark-green"><strong><code>false</code></strong></span> otherwise. The <span class="dark-green"><strong><code>any?</code></strong></span> method is just the opposite of <span class="dark-green"><strong><code>empty?</code></strong></span>, returning <span class="dark-green"><strong><code>true</code></strong></span> if there are any elements present and <span class="dark-green"><strong><code>false</code></strong></span> otherwise. (By the way, all of these methods—<span class="dark-green"><strong><code>count</code></strong></span>, <span class="dark-green"><strong><code>empty?</code></strong></span>, and <span class="dark-green"><strong><code>any?</code></strong></span>—work on Ruby arrays as well. We’ll put this fact to good use starting in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch13.xhtml#sec13_2">Section 13.2</a>.)</p>
<p class="indent">The other new idea is the <span class="dark-green"><strong><code>pluralize</code></strong></span> text helper, which is available in the console via the <span class="dark-green"><strong><code>helper</code></strong></span> object:</p>
<p class="codelink"><a id="pf0349-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0349-01a">Click here to view code image</a></p>
<pre class="pre1"><span class="navy"><strong>&gt;&gt;</strong></span> helper<span class="ash">.</span>pluralize(<span class="ash">1</span>, <span class="maroon">"error"</span>)
<span class="green">=&gt; "1 error"</span>
<span class="navy"><strong>&gt;&gt;</strong></span> helper<span class="ash">.</span>pluralize(<span class="ash">5</span>, <span class="maroon">"error"</span>)
<span class="green">=&gt; "5 errors"</span></pre>
<p class="noindent">We see here that <span class="dark-green"><strong><code>pluralize</code></strong></span> takes an integer argument and then returns the number with a properly pluralized version of its second argument. Underlying this method is a powerful <em>inflector</em> that knows how to pluralize a large number of words, including many with irregular plurals:</p>
<p class="codelink"><a id="pf0349-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0349-02a">Click here to view code image</a></p>
<pre class="pre1"><span class="navy"><strong>&gt;&gt;</strong></span> helper<span class="ash">.</span>pluralize(<span class="ash">2</span>, <span class="maroon">"woman"</span>)
<span class="green">=&gt; "2 women"</span>
<span class="navy"><strong>&gt;&gt;</strong></span> helper<span class="ash">.</span>pluralize(<span class="ash">3</span>, <span class="maroon">"erratum"</span>)
<span class="green">=&gt; "3 errata"</span></pre>
<p class="noindent">As a result of its use of <span class="dark-green"><strong><code>pluralize</code></strong></span>, the code</p>
<p class="codelink"><a id="pf0349-03" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0349-03a">Click here to view code image</a></p>
<pre class="pre1"><span class="red5">&lt;%=</span> pluralize(<span class="violet">@user</span><span class="ash">.</span>errors<span class="ash">.</span>count, <span class="maroon">"error"</span>) <span class="red5">%&gt;</span></pre>
<p class="noindent">returns <span class="dark-green"><strong><code>"0 errors"</code></strong></span>, <span class="dark-green"><strong><code>"1 error"</code></strong></span>, <span class="dark-green"><strong><code>"2 errors"</code></strong></span>, and so on, depending on how many errors there are, thereby avoiding ungrammatical phrases such as <span class="dark-green"><strong><code>"1 errors"</code></strong></span> (a distressingly common mistake in both web and desktop applications).</p>
<p class="indent">Note that <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex021">Listing 7.21</a> includes the CSS id <span class="dark-green"><strong><code>error_explanation</code></strong></span> for use in styling the error messages. (Recall from <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch05.xhtml#sec5_1_2">Section 5.1.2</a> that CSS uses the pound sign <span class="dark-green"><strong><code>#</code></strong></span> to style ids.) In addition, after an invalid submission Rails automatically wraps the fields with errors in <span class="dark-green"><strong><code>div</code></strong></span>s with the CSS class <span class="dark-green"><strong><code>field_with_errors</code></strong></span>. These labels then allow us to style the error messages with the SCSS shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex022">Listing 7.22</a>, which makes use of Sass’s <span class="dark-green"><strong><code>@extend</code></strong></span> function to include the functionality of the Bootstrap class <span class="dark-green"><strong><code>has-error</code></strong></span>.<span epub:type="pagebreak" id="page_350"></span></p>
<p class="ex-title" id="ch07ex022"><strong>Listing 7.22:</strong> CSS for styling error messages.</p>
<pre class="pre2"><code>app/assets/stylesheets/custom.scss</code></pre>
<p class="codelink"><a id="pf0350-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0350-01a">Click here to view code image</a></p>
<div class="example">
<pre><span class="blue3"><strong>.</strong></span>
<span class="blue3"><strong>.</strong></span>
<span class="blue3"><strong>.</strong></span>
<span class="ash">/*</span> <span class="green"><strong>forms</strong></span> <span class="ash">*/</span>
<span class="blue3"><strong>.</strong></span>
<span class="blue3"><strong>.</strong></span>
<span class="blue3"><strong>.</strong></span>
<span class="blue3"><strong>#error_explanation</strong></span> {
  <span class="green"><strong>color</strong></span><span class="pink2">:</span> <span class="green"><strong>red</strong></span><span class="ash">;</span>
  <span class="green"><strong>ul</strong></span> {
    <span class="green"><strong>color</strong></span><span class="pink2">:</span> <span class="green"><strong>red</strong></span><span class="ash">;</span>
    <span class="green"><strong>margin</strong></span><span class="pink2">:</span> <span class="green"><strong>0 0 30px 0</strong></span><span class="ash">;</span>
  }
}

<span class="blue3"><strong>.field_with_errors</strong></span> {
  <span class="green"><strong>@extend</strong></span> <strong><span class="blue3">.has-error</span></strong><span class="ash">;</span>
  <span class="blue3"><strong>.form-control</strong></span> {
    <span class="green"><strong>color</strong></span><span class="pink2">:</span> <span class="red-box">$</span><span class="green"><strong>state-danger-text</strong></span><span class="ash">;</span>
  }
}</pre>
</div>
<p class="indent">With the code in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex020">Listing 7.20</a> and <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex021">Listing 7.21</a> and the SCSS from <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex022">Listing 7.22</a>, helpful error messages now appear when users submit invalid signup information, as seen in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fig019">Figure 7.19</a>. Because the messages are generated by the model validations, they will automatically change if you ever change your mind about, say, the format of email addresses, or the minimum length of passwords. (<em>Note</em>: Because both the presence validation and the <span class="dark-green"><strong><code>has_secure_password</code></strong></span> validation catch the case of <em>empty</em> (<span class="dark-green"><strong><code>nil</code></strong></span>) passwords, the signup form currently produces duplicate error messages when the user submits an empty password. We could manipulate the error messages directly to eliminate duplicates, but luckily this issue will be fixed automatically by the addition of <span class="dark-green"><strong><code>allow_nil: true</code></strong></span> in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch10.xhtml#sec10_1_4">Section 10.1.4</a>.)</p>
<figure id="ch07fig019" class="image-l">
<img src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/fig07_19.jpg" alt="Image" width="677" height="521" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig07_19.jpg">
<figcaption><p><strong>Figure 7.19:</strong> Failed signup with error messages.</p></figcaption>
</figure>
<section>
<h5 class="h5" id="lev76">Exercises</h5>
<p class="noindent">Solutions to the exercises are available to all Rails Tutorial purchasers at <a href="https://www.railstutorial.org/aw-solutions">https://www.railstutorial.org/aw-solutions</a>.</p>
<p class="indent">To see other people’s answers and to record your own, subscribe to the Rails Tutorial course or to the Learn Enough All Access Bundle.<span epub:type="pagebreak" id="page_351"></span></p>
<ol class="num">
<li><p class="num">Confirm by changing the minimum length of passwords to 5 that the error message updates automatically as well.</p></li>
<li><p class="num">How does the URL on the unsubmitted signup form (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fig013">Figure 7.13</a>) compare to the URL for a submitted signup form (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fig019">Figure 7.19</a>)? Why don’t they match?</p></li>
</ol></section>
</section>
<section>
<h4 class="h4" id="sec7_3_4">7.3.4 A Test for Invalid Submission</h4>
<p class="noindent">In the days before powerful web frameworks with automated testing capabilities, developers had to test forms by hand. For example, to test a signup page manually, we would have to visit the page in a browser and then alternate between submitting invalid and valid data, verifying in each case that the application’s behavior was correct. Moreover, we would have to remember to repeat the process anytime the application changed. This process was painful and error-prone.<span epub:type="pagebreak" id="page_352"></span></p>
<p class="indent">Happily, with Rails we can write tests to automate the testing of forms. In this section, we’ll write one such test to verify the correct behavior upon invalid form submission; in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#sec7_4_4">Section 7.4.4</a>, we’ll write a corresponding test for valid submission.</p>
<p class="indent">To get started, we first generate an integration test file for signing up users, which we’ll call <span class="dark-green"><strong><code>users_signup</code></strong></span> (adopting the controller convention of a plural resource name):</p>
<p class="codelink"><a id="pf0352-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0352-01a">Click here to view code image</a></p>
<pre class="pre1"><strong><span class="navy">$</span></strong> rails generate integration_test users_signup
      <span class="green">invoke   test_unit</span>
      <span class="green">create     test/integration/users_signup_test.rb</span></pre>
<p class="noindent">(We’ll use this same file in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#sec7_4_4">Section 7.4.4</a> to test a valid signup.)</p>
<p class="indent">The main purpose of our test is to verify that clicking the signup button results in <em>not</em> creating a new user when the submitted information is invalid. (Writing a test for the error messages is left as an exercise (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#sec7_3_4">Section 7.3.4</a>).) The way to do this is to check the <em>count</em> of users, and under the hood our tests will use the <span class="dark-green"><strong><code>count</code></strong></span> method available on every Active Record class, including <span class="dark-green"><strong><code>User</code></strong></span>:</p>
<pre class="pre1"><span class="green">$ rails console</span>
<span class="navy"><strong>&gt;&gt;</strong></span> <span class="red">User</span><span class="ash">.</span>count
<span class="green">=&gt; 1</span></pre>
<p class="noindent">(Here <span class="dark-green"><strong><code>User.count</code></strong></span> is <span class="dark-green"><strong><code>1</code></strong></span> because of the user created in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch06.xhtml#sec6_3_4">Section 6.3.4</a>, though it may differ if you’ve added or deleted any users in the interim.) As in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch05.xhtml#sec5_3_4">Section 5.3.4</a>, we’ll use <span class="dark-green"><strong><code>assert_select</code></strong></span> to test HTML elements of the relevant pages, taking care to check only elements unlikely to change in the future.</p>
<p class="indent">We’ll start by visiting the signup path using <span class="dark-green"><strong><code>get</code></strong></span>:</p>
<pre class="pre1">get signup_path</pre>
<p class="noindent">To test the form submission, we need to issue a <code>POST</code> request to the <span class="dark-green"><strong><code>users_path</code></strong></span> (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07tab01">Table 7.1</a>), which we can do with the <span class="dark-green"><strong><code>post</code></strong></span> function:</p>
<p class="codelink"><a id="pf0352-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0352-02a">Click here to view code image</a></p>
<pre class="pre1">assert_no_difference <span class="maroon">'User.count'</span> <strong><span class="green">do</span></strong>
  post users_path, <span class="violet">params</span>: { <span class="violet">user</span>: { <span class="green1">name</span>: <span class="maroon">""</span>,
                                     <span class="violet">email</span>: <span class="maroon">"user@invalid"</span>,
                                     <span class="violet">password</span>:              <span class="maroon">"foo"</span>,
                                     <span class="violet">password_confirmation</span>: <span class="maroon">"bar"</span> } }
<span class="green"><strong>end</strong></span></pre>
<p class="noindent"><span epub:type="pagebreak" id="page_353"></span>Here we’ve included the <span class="dark-green"><strong><code>params[:user]</code></strong></span> hash expected by <span class="dark-green"><strong><code>User.new</code></strong></span> in the <span class="dark-green"><strong><code>create</code></strong></span> action (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex027">Listing 7.27</a>). (In versions of Rails before 5, <span class="dark-green"><strong><code>params</code></strong></span> was implicit, and only the <span class="dark-green"><strong><code>user</code></strong></span> hash would be passed. This practice was deprecated in Rails 5.0, and now the recommended method is to include the full <span class="dark-green"><strong><code>params</code></strong></span> hash explicitly.)</p>
<p class="indent">By wrapping the <span class="dark-green"><strong><code>post</code></strong></span> in the <span class="dark-green"><strong><code>assert_no_difference</code></strong></span> method with the string argument <span class="dark-green"><strong><code>'User.count'</code></strong></span>, we arrange for a comparison between <span class="dark-green"><strong><code>User.count</code></strong></span> before and after the contents inside the <span class="dark-green"><strong><code>assert_no_difference</code></strong></span> block. This is equivalent to recording the user count, posting the data, and verifying that the count is the same:</p>
<p class="codelink"><a id="pf0353-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0353-01a">Click here to view code image</a></p>
<pre class="pre1">before_count <span class="ash">=</span> <span class="red">User</span><span class="ash">.</span>count
post users_path, <span class="ash">...</span>
after_count <span class="ash">=</span> <span class="red">User</span><span class="ash">.</span>count
assert_equal before_count, after_count</pre>
<p class="noindent">Although the two are equivalent, using <span class="dark-green"><strong><code>assert_no_difference</code></strong></span> is cleaner and is more idiomatically correct Ruby.</p>
<p class="indent">It’s worth noting that our <span class="dark-green"><strong><code>get</code></strong></span> and <span class="dark-green"><strong><code>post</code></strong></span> steps are technically unrelated, and it’s actually not necessary to get the signup path before posting to the users path. I prefer to include both steps, though, both for conceptual clarity and to double-check that the signup form renders without error.</p>
<p class="indent">Putting theses ideas together leads to the test in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex023">Listing 7.23</a>. We’ve also included a call to <span class="dark-green"><strong><code>assert_template</code></strong></span> to check that a failed submission re-renders the <span class="dark-green"><strong><code>new</code></strong></span> action. Adding lines to check for the appearance of error messages is left as an exercise (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#sec7_3_4">Section 7.3.4</a>).</p>
<p class="ex-title" id="ch07ex023"><strong>Listing 7.23:</strong> A test for an invalid signup. <span class="green5"><small>GREEN</small></span></p>
<pre class="pre2"><code>test/integration/users_signup_test.rb</code></pre>
<p class="codelink"><a id="pf0353-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0353-02a">Click here to view code image</a></p>
<div class="example">
<pre class="pre2"><span class="green1">require</span> <span class="maroon">'test_helper'</span>

<span class="green"><strong>class</strong></span> <strong><span class="blue3">UsersSignupTest</span></strong> <span class="ash">&lt;</span> <span class="red">ActionDispatch</span><span class="ash">::</span><span class="red">IntegrationTest</span>

  <span class="green1">test</span> <span class="maroon">"invalid signup information"</span> <strong><span class="green">do</span></strong>
    get signup_path
    assert_no_difference <span class="maroon">'User.count'</span> <strong><span class="green">do</span></strong>
      post users_path, <span class="violet">params</span>: { <span class="violet">user</span>: { <span class="green1">name</span>: <span class="maroon">""</span>,
                                         <span class="violet">email</span>: <span class="maroon">"user@invalid"</span>,
<span epub:type="pagebreak" id="page_354"></span>                                         <span class="violet">password</span>:              <span class="maroon">"foo"</span>,
                                         <span class="violet">password_confirmation</span>: <span class="maroon">"bar"</span> } }
  <strong><span class="green">end</span></strong>
    assert_template <span class="maroon">'users/new'</span>
  <strong><span class="green">end</span></strong>
<span class="green"><strong>end</strong></span></pre>
</div>
<p class="noindent">Because we wrote the application code before the integration test, the test suite should be <span class="green5"><small>GREEN</small></span>:</p>
<p class="ex-title" id="ch07ex024"><strong>Listing 7.24:</strong> <span class="green5"><small>GREEN</small></span></p>
<div class="example">
<pre>$ rails test</pre>
</div>
<section>
<h5 class="h5" id="lev77">Exercise</h5>
<p class="noindent">Solutions to the exercises are available to all Rails Tutorial purchasers at <a href="https://www.railstutorial.org/aw-solutions">https://www.railstutorial.org/aw-solutions</a>.</p>
<p class="indent">To see other people’s answers and to record your own, subscribe to the Rails Tutorial course or to the Learn Enough All Access Bundle.</p>
<ol class="num">
<li><p class="num">Write a test for the error messages implemented in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex020">Listing 7.20</a>. How detailed you want to make your tests is up to you; a suggested template appears in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex025">Listing 7.25</a>.</p></li>
</ol>
<p class="ex-title" id="ch07ex025"><strong>Listing 7.25:</strong> A template for tests of the error messages.</p>
<pre class="pre2"><code>test/integration/users_signup_test.rb</code></pre>
<p class="codelink"><a id="pf0354-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0354-02a">Click here to view code image</a></p>
<div class="example">
<pre><span class="green1">require</span> <span class="maroon">'test_helper'</span>

<span class="green"><strong>class</strong></span> <strong><span class="blue3">UsersSignupTest</span></strong> <span class="ash">&lt;</span> <span class="red">ActionDispatch</span><span class="ash">::</span><span class="red">IntegrationTest</span>

  <span class="green1">test</span> <span class="maroon">"invalid signup information"</span> <strong><span class="green">do</span></strong>
    get signup_path
    assert_no_difference <span class="maroon">'User.count'</span> <strong><span class="green">do</span></strong>
      post users_path, <span class="violet">params</span>: { <span class="violet">user</span>: { <span class="green1">name</span>: <span class="maroon">""</span>,
                                         <span class="violet">email</span>: <span class="maroon">"user@invalid"</span>,
                                         <span class="violet">password</span>:              <span class="maroon">"foo"</span>,
                                         <span class="violet">password_confirmation</span>: <span class="maroon">"bar"</span> } }
   <strong><span class="green">end</span></strong>
    assert_template <span class="maroon">'users/new'</span>
<span epub:type="pagebreak" id="page_355"></span><span class="mark">    assert_select <span class="red2">'div#&lt;CSS id for error explanation&gt;'</span></span>
<span class="mark">    assert_select <span class="red2">'div.&lt;CSS class for field with error&gt;'</span></span>
  <strong><span class="green">end</span></strong>
  <span class="ash">.</span>
  <span class="ash">.</span>
  <span class="ash">.</span>
<span class="green"><strong>end</strong></span></pre>
</div>
</section>
</section>
</section>
<section>
<h3 class="h3" id="sec7_4">7.4 Successful Signups</h3>
<p class="noindent">Having handled invalid form submissions, now it’s time to complete the signup form by actually saving a new user (if valid) to the database. First, we try to save the user; if the save succeeds, the user’s information gets written to the database automatically, and we then <em>redirect</em> the browser to show the user’s profile (together with a friendly greeting), as mocked up in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fig020">Figure 7.20</a>. If it fails, we simply fall back on the behavior developed in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#sec7_3">Section 7.3</a>.</p>
<figure id="ch07fig020" class="image-l">
<img src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/fig07_20.jpg" alt="Image" width="677" height="582" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig07_20.jpg">
<figcaption><p><strong>Figure 7.20:</strong> A mockup of successful signup.</p></figcaption>
</figure>
<section>
<h4 class="h4" id="sec7_4_1">7.4.1 The Finished Signup Form</h4>
<p class="noindent">To complete a working signup form, we need to fill in the commented-out section in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex019">Listing 7.19</a> with the appropriate behavior. Currently, the form simply freezes on valid submission, as indicated by the subtle color change in the submission button (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fig021">Figure 7.21</a>), although this behavior may be system-dependent. This occurs because the default behavior for a Rails action is to render the corresponding view, and there isn’t a view template corresponding to the <span class="dark-green"><strong><code>create</code></strong></span> action (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fig022">Figure 7.22</a>).</p>
<figure id="ch07fig021" class="image-l">
<img src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/fig07_21.jpg" alt="Image" width="677" height="521" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig07_21.jpg">
<figcaption><p><strong>Figure 7.21:</strong> The frozen page on valid signup submission.</p></figcaption>
</figure>
<figure id="ch07fig022" class="image-l">
<img src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/fig07_22.jpg" alt="Image" width="989" height="160" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig07_22.jpg">
<figcaption><p><strong>Figure 7.22:</strong> The <span class="dark-green"><strong><code>create</code></strong></span> template error in the server log.</p></figcaption>
</figure>
<p class="indent">Although it’s possible to render a template for the <span class="dark-green"><strong><code>create</code></strong></span> action, the usual practice is to <em>redirect</em> to a different page instead when the creation is successful. In particular, we’ll follow the common convention of redirecting to the newly created user’s profile, although the root path would also work. The application code, which introduces the <span class="dark-green"><strong><code>redirect_to</code></strong></span> method, appears in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex026">Listing 7.26</a>.</p>
<p class="ex-title" id="ch07ex026"><strong>Listing 7.26:</strong> The user <span class="dark-green"><strong><code>create</code></strong></span> action with a save and a redirect.</p>
<pre class="pre2"><code>app/controllers/users_controller.rb</code></pre>
<p class="codelink"><a id="pf0355-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0355-02a">Click here to view code image</a></p>
<div class="example">
<pre><strong><span class="green">class</span></strong> <strong><span class="blue3">UsersController</span></strong> <span class="ash">&lt;</span> <span class="red">ApplicationController</span>
<span class="ash">.</span>
<span class="ash">.</span>
<span class="ash">.</span>
<span epub:type="pagebreak" id="page_356"></span><strong><span class="green">def</span></strong> <span class="blue3">create</span>
  <span class="violet">@user</span> <span class="ash">=</span> <span class="red">User</span><span class="ash">.</span>new(user_params)
  <span class="green"><strong>if</strong></span> <span class="violet">@user</span><span class="ash">.</span>save
<span class="mark">    redirect_to <span class="blue1">@user</span></span>
  <span class="green"><strong>else</strong></span>
    render <span class="maroon">'new'</span>
  <strong><span class="green">end</span></strong>
<span class="green"><strong>end</strong></span>

<span class="green"><strong>private</strong></span>

  <strong><span class="green">def</span></strong> <span class="blue3">user_params</span>
    params<span class="ash">.</span>require(<span class="violet">:user</span>)<span class="ash">.</span>permit(<span class="violet">:name</span>, <span class="violet">:email</span>, <span class="violet">:password</span>,
                                 <span class="violet">:password_confirmation</span>)
  <strong><span class="green">end</span></strong>
<span class="green"><strong>end</strong></span></pre>
</div>
<p class="noindent"><span epub:type="pagebreak" id="page_357"></span>Note that we’ve written</p>
<pre class="pre1">redirect_to <span class="violet">@user</span></pre>
<p class="noindent">where we could have used the equivalent</p>
<pre class="pre1">redirect_to user_url(<span class="violet">@user</span>)</pre>
<p class="noindent"><span epub:type="pagebreak" id="page_358"></span>This is because Rails automatically infers from <span class="dark-green"><strong><code>redirect_to @user</code></strong></span> that we want to redirect to <span class="dark-green"><strong><code>user_url(@user)</code></strong></span>.</p>
<section>
<h5 class="h5" id="lev78">Exercises</h5>
<p class="noindent">Solutions to the exercises are available to all Rails Tutorial purchasers at <a href="https://www.railstutorial.org/aw-solutions">https://www.railstutorial.org/aw-solutions</a>.</p>
<p class="indent">To see other people’s answers and to record your own, subscribe to the Rails Tutorial course or to the Learn Enough All Access Bundle.</p>
<ol class="num">
<li><p class="num">Using the Rails console, verify that a user is, in fact, created when the user submits valid information.</p></li>
<li><p class="num">Confirm by updating <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex026">Listing 7.26</a> and submitting a valid user that <span class="dark-green"><strong><code>redirect_to user_url(@user)</code></strong></span> has the same effect as <span class="dark-green"><strong><code>redirect_to @user</code></strong></span>.</p></li>
</ol></section>
</section>
<section>
<h4 class="h4" id="sec7_4_2">7.4.2 The Flash</h4>
<p class="noindent">With the code in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex026">Listing 7.26</a>, our signup form is actually working. But before submitting a valid registration in a browser, though, we’ll add a bit of polish common in web applications: a message that appears on the subsequent page (in, this case, welcoming our new user to the application) and then disappears upon visiting a second page or on page reload.</p>
<p class="indent">The Rails way to display a temporary message is to use a special method called the <em>flash</em>, which we can treat like a hash. Rails adopts the convention of a <span class="dark-green"><strong><code>:success</code></strong></span> key for a message indicating a successful result (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex027">Listing 7.27</a>).</p>
<p class="ex-title" id="ch07ex027"><strong>Listing 7.27:</strong> Adding a flash message to user signup.</p>
<pre class="pre2"><code>app/controllers/users_controller.rb</code></pre>
<p class="codelink"><a id="pf0358-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0358-01a">Click here to view code image</a></p>
<div class="example">
<pre><span class="green"><strong>class</strong></span> <strong><span class="blue3">UsersController</span></strong> <span class="ash">&lt;</span> <span class="red">ApplicationController</span>
  <span class="ash">.</span>
  <span class="ash">.</span>
  <span class="ash">.</span>
  <strong><span class="green">def</span></strong> <span class="blue3">create</span>
    <span class="violet">@user</span> <span class="ash">=</span> <span class="red">User</span><span class="ash">.</span>new(user_params)
    <span class="green"><strong>if</strong></span> <span class="violet">@user</span><span class="ash">.</span>save
<span class="mark">      flash<span class="ash1">[</span><span class="blue1">:success</span><span class="ash1">] =</span> <span class="red2">"Welcome to the Sample App!"</span></span>
      redirect_to <span class="violet">@user</span>
    <span class="green"><strong>else</strong></span>
    render <span class="maroon">'new'</span>
  <strong><span class="green">end</span></strong>
<span epub:type="pagebreak" id="page_359"></span><strong><span class="green">end</span></strong>

<span class="green"><strong>private</strong></span>

  <strong><span class="green">def</span></strong> <span class="blue3">user_params</span>
    params<span class="ash">.</span>require(<span class="violet">:user</span>)<span class="ash">.</span>permit(<span class="violet">:name</span>, <span class="violet">:email</span>, <span class="violet">:password</span>,
                                 <span class="violet">:password_confirmation</span>)
  <strong><span class="green">end</span></strong>
<span class="green"><strong>end</strong></span></pre>
</div>
<p class="indent">By assigning a message to the <span class="dark-green"><strong><code>flash</code></strong></span>, we are now in a position to display the message on the first page after the redirect. Our method is to iterate through the <span class="dark-green"><strong><code>flash</code></strong></span> and insert all relevant messages into the site layout. You may recall the console example in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch04.xhtml#sec4_3_3">Section 4.3.3</a>, where we saw how to iterate through a hash using the strategically named <span class="dark-green"><strong><code>flash</code></strong></span> variable (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex028">Listing 7.28</a>).</p>
<p class="ex-title" id="ch07ex028"><strong>Listing 7.28:</strong> Iterating through a <span class="dark-green"><strong><code>flash</code></strong></span> hash in the console.</p>
<p class="codelink"><a id="pf0359-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0359-02a">Click here to view code image</a></p>
<div class="example">
<pre><span class="green">$ rails console</span>
<span class="navy"><strong>&gt;&gt;</strong></span> flash <span class="ash">=</span> { <span class="violet">success</span>: <span class="maroon">"It worked!"</span>, <span class="violet">danger</span>: <span class="maroon">"It failed."</span> }
<span class="green">=&gt; {:success=&gt;"It worked!", danger: "It failed."}</span>
<span class="navy"><strong>&gt;&gt;</strong></span> flash<span class="ash">.</span>each <strong><span class="green">do</span></strong> <span class="ash">|</span>key, value<span class="ash">|</span>
<span class="navy"><strong>?&gt;</strong></span>   <span class="green1">puts</span> <span class="maroon">"</span><strong><span class="pink">#{</span></strong>key<strong><span class="pink">}</span></strong><span class="maroon">"</span>
<span class="navy"><strong>?&gt;</strong></span>   <span class="green1">puts</span> <span class="maroon">"</span><strong><span class="pink">#{</span></strong>value<strong><span class="pink">}</span></strong><span class="maroon">"</span>
<span class="navy"><strong>&gt;&gt;</strong></span> <strong><span class="green">end</span></strong>
<span class="green">success</span>
<span class="green">It worked!</span>
<span class="green">danger</span>
<span class="green">It failed.</span></pre>
</div>
<p class="noindent">By following this pattern, we can arrange to display the contents of the flash site-wide using code like this:</p>
<p class="codelink"><a id="pf0359-03" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0359-03a">Click here to view code image</a></p>
<pre class="pre1"><span class="red5">&lt;%</span> flash<span class="ash">.</span>each <strong><span class="green">do</span></strong> <span class="ash">|</span>message_type, message<span class="ash">|</span> <span class="red5">%&gt;</span>
  &lt;<span class="green"><strong>div</strong></span> <span class="ash3">class</span><span class="ash">=</span><span class="maroon">"alert alert-</span><span class="red5">&lt;%=</span> message_type <span class="red5">%&gt;</span><span class="maroon">"</span>&gt;<span class="red5">&lt;%=</span> message <span class="red5">%&gt;</span>&lt;/<strong><span class="green">div</span></strong>&gt;
<span class="red5">&lt;%</span> <strong><span class="green">end</span></strong> <span class="red5">%&gt;</span></pre>
<p class="noindent">(This code is a particularly ugly and difficult-to-read combination of HTML and ERb; making it prettier is left as an exercise (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#sec7_4_4">Section 7.4.4</a>).) Here the embedded Ruby</p>
<pre class="pre1">alert-<span class="red5">&lt;%=</span> message_type <span class="red5">%&gt;</span></pre>
<p class="noindent"><span epub:type="pagebreak" id="page_360"></span>makes a CSS class corresponding to the type of message, so that for a <span class="dark-green"><strong><code>:success</code></strong></span> message the class is</p>
<pre class="pre1">alert-success</pre>
<p class="noindent">(The key <span class="dark-green"><strong><code>:success</code></strong></span> is a symbol, but embedded Ruby automatically converts it to the string <span class="dark-green"><strong><code>"success"</code></strong></span> before inserting it into the template.) Using a different class for each key allows us to apply different styles to different kinds of messages. For example, in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#sec8_1_4">Section 8.1.4</a> we’ll use <span class="dark-green"><strong><code>flash[:danger]</code></strong></span> to indicate a failed login attempt.<sup><a id="ch07fn12a" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fn12">12</a></sup> (In fact, we’ve already used <span class="dark-green"><strong><code>alert-danger</code></strong></span> once, to style the error message <span class="dark-green"><strong><code>div</code></strong></span> in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex021">Listing 7.21</a>.) Bootstrap CSS supports styling for four such flash classes for increasingly urgent message types (<span class="dark-green"><strong><code>success</code></strong></span>, <span class="dark-green"><strong><code>info</code></strong></span>, <span class="dark-green"><strong><code>warning</code></strong></span>, and <span class="dark-green"><strong><code>danger</code></strong></span>), and we’ll find occasion to use all of them in the course of developing the sample application (<span class="dark-green"><strong><code>info</code></strong></span> in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch11.xhtml#sec11_2">Section 11.2</a>, <span class="dark-green"><strong><code>warning</code></strong></span> in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch11.xhtml#sec11_3">Section 11.3</a>, and <span class="dark-green"><strong><code>danger</code></strong></span> for the first time in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#sec8_1_4">Section 8.1.4</a>).</p>
<p class="footnote"><a id="ch07fn12" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fn12a">12</a>. Actually, we’ll use the closely related <span class="dark-green"><strong><code>flash.now</code></strong></span>, but we’ll defer that subtlety until we need it.</p>
<p class="indent">Because the message is also inserted into the template, the full HTML result for</p>
<p class="codelink"><a id="pf0360-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0360-01a">Click here to view code image</a></p>
<pre class="pre1">flash<span class="ash">[</span><span class="violet">:success</span><span class="ash">] =</span> <span class="maroon">"Welcome to the Sample App!"</span></pre>
<p class="noindent">appears as follows:</p>
<p class="codelink"><a id="pf0360-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0360-02a">Click here to view code image</a></p>
<pre class="pre1">&lt;<span class="green"><strong>div</strong></span> <span class="ash3">class</span><span class="ash">=</span><span class="maroon">"alert alert-success"</span>&gt;Welcome to the Sample App!&lt;/<span class="green"><strong>div</strong></span>&gt;</pre>
<p class="indent">Putting the embedded Ruby just discussed into the site layout leads to the code in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex029">Listing 7.29</a>.</p>
<p class="ex-title" id="ch07ex029"><strong>Listing 7.29:</strong> Adding the contents of the <span class="dark-green"><strong><code>flash</code></strong></span> variable to the site layout.</p>
<pre class="pre2"><code>app/views/layouts/application.html.erb</code></pre>
<p class="codelink"><a id="pf0360-03" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0360-03a">Click here to view code image</a></p>
<div class="example">
<pre><span class="red5">&lt;!DOCTYPE html&gt;</span>
&lt;<span class="green"><strong>html</strong></span>&gt;
  .
  .
  .
  &lt;<span class="green"><strong>body</strong></span>&gt;
    <span class="red5">&lt;%=</span> render <span class="maroon">'layouts/header'</span> <span class="red5">%&gt;</span>
    &lt;<span class="green"><strong>div</strong></span> <span class="ash3">class</span><span class="ash">=</span><span class="maroon">"container"</span>&gt;
<span epub:type="pagebreak" id="page_361"></span><span class="mark">      <span class="maroon1">&lt;%</span> flash<span class="ash1">.</span>each <strong><span class="green3">do</span></strong> <span class="ash1">|</span>message_type, message<span class="ash1">|</span> <span class="maroon1">%&gt;</span></span>
<span class="mark">        <span class="green3">&lt;</span><span class="green3"><strong>div</strong></span> <span class="green3">class=</span></span><span class="red2">"alert alert-</span><span class="maroon1">&lt;%=</span> message_type <span class="maroon1">%&gt;</span><span class="red2">"</span><span class="green3">&gt;</span><span class="maroon1">&lt;%=</span> message <span class="maroon1">%&gt;</span><span class="green3">&lt;/</span><span class="green3"><strong>div</strong></span><span class="green3">&gt;</span>
<span class="mark">      <span class="maroon1">&lt;%</span> <strong><span class="green3">end</span></strong> <span class="maroon1">%&gt;</span></span>
      <span class="red5">&lt;%=</span> <span class="green"><strong>yield</strong></span> <span class="red5">%&gt;</span>
      <span class="red5">&lt;%=</span> render <span class="maroon">'layouts/footer'</span> <span class="red5">%&gt;</span>
      <span class="red5">&lt;%=</span> debug(params) <span class="green"><strong>if</strong></span> <span class="red">Rails</span><span class="ash">.</span>env<span class="ash">.</span>development? <span class="red5">%&gt;</span>
    &lt;/<span class="green"><strong>div</strong></span>&gt;
    .
    .
    .
  &lt;/<span class="green"><strong>body</strong></span>&gt;
&lt;/<span class="green"><strong>html</strong></span>&gt;
</pre>
</div>
<section>
<h5 class="h5" id="lev79">Exercises</h5>
<p class="noindent">Solutions to the exercises are available to all Rails Tutorial purchasers at <a href="https://www.railstutorial.org/aw-solutions">https://www.railstutorial.org/aw-solutions</a>.</p>
<p class="indent">To see other people’s answers and to record your own, subscribe to the Rails Tutorial course or to the Learn Enough All Access Bundle.</p>
<ol class="num">
<li><p class="num">In the console, confirm that you can use interpolation (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch04.xhtml#sec4_2_1">Section 4.2.1</a>) to interpolate a raw symbol. For example, what is the return value of <span class="dark-green"><strong><code>"#{:success}"</code></strong></span>?</p></li>
<li><p class="num">How does the previous exercise relate to the flash iteration shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex028">Listing 7.28</a>?</p></li>
</ol></section>
</section>
<section>
<h4 class="h4" id="sec7_4_3">7.4.3 The First Signup</h4>
<p class="noindent">We can see the result of all this work by signing up the first user for the sample app. Even though previous submissions didn’t work properly (as shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fig021">Figure 7.21</a>), the <span class="dark-green"><strong><code>user.save</code></strong></span> line in the Users controller still works, so users might still have been created. To clear them out, we’ll reset the database as follows:</p>
<pre class="pre1">$ rails db:migrate:reset</pre>
<p class="noindent">On some systems you might have to restart the webserver (using Ctrl-C) for the changes to take effect (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch01.xhtml#box1_2">Box 1.2</a>).</p>
<p class="indent">We’ll create the first user with the name “Rails Tutorial” and email address “<a href="mailto:example@railstutorial.org">example@railstutorial.org</a>”, as shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fig023">Figure 7.23</a>. The resulting page (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fig024">Figure 7.24</a>) <span epub:type="pagebreak" id="page_362"></span>shows a friendly flash message upon successful signup, including nice green styling for the <span class="dark-green"><strong><code>success</code></strong></span> class, which comes included with the Bootstrap CSS framework from <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch05.xhtml#sec5_1_2">Section 5.1.2</a>. Then, upon reloading the user show page, the flash message disappears as promised (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fig025">Figure 7.25</a>).</p>
<figure id="ch07fig023" class="image-l">
<img src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/fig07_23.jpg" alt="Image" width="675" height="519" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig07_23.jpg">
<figcaption><p><strong>Figure 7.23:</strong> Filling in the information for the first signup.</p></figcaption>
</figure>
<figure id="ch07fig024" class="image-l">
<img src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/fig07_24.jpg" alt="Image" width="675" height="519" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig07_24.jpg">
<figcaption><p><strong>Figure 7.24:</strong> The results of a successful user signup, with flash message.</p></figcaption>
</figure>
<figure id="ch07fig025" class="image-l">
<img src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/fig07_25.jpg" alt="Image" width="677" height="521" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig07_25.jpg">
<figcaption><p><strong>Figure 7.25:</strong> The <span class="dark-green"><strong><code>flash</code></strong></span>-less profile page after a browser reload.</p></figcaption>
</figure>
<section>
<h5 class="h5" id="lev80">Exercises</h5>
<p class="noindent">Solutions to the exercises are available to all Rails Tutorial purchasers at <a href="https://www.railstutorial.org/aw-solutions">https://www.railstutorial.org/aw-solutions</a>.</p>
<p class="indent">To see other people’s answers and to record your own, subscribe to the Rails Tutorial course or to the Learn Enough All Access Bundle.</p>
<ol class="num">
<li><p class="num">Using the Rails console, find by the email address to double-check that the new user was actually created. The result should look something like <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex030">Listing 7.30</a>.<span epub:type="pagebreak" id="page_363"></span></p></li>
<li><p class="num">Create a new user with your primary email address. Verify that the Gravatar appears correctly.</p></li>
</ol>
<p class="ex-title" id="ch07ex030"><strong>Listing 7.30:</strong> Finding the newly created user in the database.</p>
<p class="codelink"><a id="pf0363-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0363-01a">Click here to view code image</a></p>
<div class="example">
<pre><span class="green">$ rails console</span>
<span class="navy"><strong>&gt;&gt;</strong></span> <span class="red">User</span><span class="ash">.</span>find_by(<span class="violet">email</span>: <span class="maroon">"example@railstutorial.org"</span>)
<span class="green">=&gt; #&lt;User id: 1, name: "Rails Tutorial", email: "example@railstutorial.</span>
<span class="green">org", created_at: "2016-05-31 17:17:33", updated_at: "2016-05-31 17:17:33",</span>
<span class="green">password_digest: "$2a$10$8MaeHdnOhZvMk3GmFdmpPOeG6a7u7/k2Z9TMjOanC9G..."&gt;</span></pre>
</div>
</section>
</section>
<section>
<h4 class="h4" id="sec7_4_4"><span epub:type="pagebreak" id="page_364"></span>7.4.4 A Test for Valid Submission</h4>
<p class="noindent">Before moving on, we’ll write a test for valid submission to verify our application’s behavior and catch regressions. As with the test for invalid submission in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#sec7_3_4">Section 7.3.4</a>, our main purpose is to verify the contents of the database. In this case, we want to submit valid information and then confirm that a user <em>was</em> created. In analogy with <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex023">Listing 7.23</a>, which used</p>
<p class="codelink"><a id="pf0364-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0364-01a">Click here to view code image</a></p>
<pre class="pre1">assert_no_difference <span class="maroon">'User.count'</span> <strong><span class="green">do</span></strong>
  post users_path, <span class="ash">...</span>
<span class="green"><strong>end</strong></span></pre>
<p class="noindent">here we’ll use the corresponding <span class="dark-green"><strong><code>assert_difference</code></strong></span> method:<span epub:type="pagebreak" id="page_365"></span></p>
<p class="codelink"><a id="pf0365-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0365-01a">Click here to view code image</a></p>
<pre class="pre1">assert_difference <span class="maroon">'User.count'</span>, <span class="ash">1</span> <strong><span class="green">do</span></strong>
  post users_path, <span class="ash">...</span>
<span class="green"><strong>end</strong></span></pre>
<p class="noindent">As with <span class="dark-green"><strong><code>assert_no_difference</code></strong></span>, the first argument is the string <span class="dark-green"><strong><code>'User.count'</code></strong></span>, which arranges for a comparison between <span class="dark-green"><strong><code>User.count</code></strong></span> before and after the contents of the <span class="dark-green"><strong><code>assert_difference</code></strong></span> block. The second (optional) argument specifies the size of the difference (in this case, 1).</p>
<p class="indent">Incorporating <span class="dark-green"><strong><code>assert_difference</code></strong></span> into the file from <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex023">Listing 7.23</a> yields the test shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex031">Listing 7.31</a>. Note that we’ve used the <span class="dark-green"><strong><code>follow_redirect!</code></strong></span> method after posting to the users path. This simply arranges to follow the redirect after submission, resulting in a rendering of the <span class="dark-green"><strong><code>'users/show'</code></strong></span> template. (It’s probably a good idea to write a test for the flash as well, which is left as an exercise (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#sec7_4_4">Section 7.4.4</a>).)</p>
<p class="ex-title" id="ch07ex031"><strong>Listing 7.31:</strong> A test for a valid signup. <span class="green5"><small>GREEN</small></span></p>
<pre class="pre2"><code>test/integration/users_signup_test.rb</code></pre>
<p class="codelink"><a id="pf0365-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0365-02a">Click here to view code image</a></p>
<div class="example">
<pre><span class="green1">require</span> <span class="maroon">'test_helper'</span>

<span class="green"><strong>class</strong></span> <strong><span class="blue3">UsersSignupTest</span></strong> <span class="ash">&lt;</span> <span class="red">ActionDispatch</span><span class="ash">::</span><span class="red">IntegrationTest</span>
  <span class="ash">.</span>
  <span class="ash">.</span>
  <span class="ash">.</span>
  <span class="green1">test</span> <span class="maroon">"valid signup information"</span> <strong><span class="green">do</span></strong>
    get signup_path
    assert_difference <span class="maroon">'User.count'</span>, <span class="ash">1</span> <strong><span class="green">do</span></strong>
      post users_path, <span class="violet">params</span>: { <span class="violet">user</span>: { <span class="green1">name</span>: <span class="maroon">"Example User"</span>,
                                         <span class="violet">email</span>: <span class="maroon">"user@example.com"</span>,
                                         <span class="violet">password</span>:              <span class="maroon">"password"</span>,
                                         <span class="violet">password_confirmation</span>: <span class="maroon">"password"</span> } }
    <strong><span class="green">end</span></strong>
    follow_redirect!
    assert_template <span class="maroon">'users/show'</span>
  <strong><span class="green">end</span></strong>
<span class="green"><strong>end</strong></span></pre>
</div>
<p class="indent">Note that <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex031">Listing 7.31</a> also verifies that the user show template renders following successful signup. For this test to work, it’s necessary for the Users routes (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex03">Listing 7.3</a>), the Users <span class="dark-green"><strong><code>show</code></strong></span> action (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex05">Listing 7.5</a>), and the <span class="dark-green"><strong><code>show.html.erb</code></strong></span> view (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex08">Listing 7.8</a>) to work correctly. As a result, the one line<span epub:type="pagebreak" id="page_366"></span></p>
<pre class="pre1">assert_template <span class="maroon">'users/show'</span></pre>
<p class="noindent">is a sensitive test for almost everything related to a user’s profile page. This sort of end-to-end coverage of important application features illustrates one reason why integration tests are so useful.</p>
<section>
<h5 class="h5" id="lev81">Exercises</h5>
<p class="noindent">Solutions to the exercises are available to all Rails Tutorial purchasers at <a href="https://www.railstutorial.org/aw-solutions">https://www.railstutorial.org/aw-solutions</a>.</p>
<p class="indent">To see other people’s answers and to record your own, subscribe to the Rails Tutorial course or to the Learn Enough All Access Bundle.</p>
<ol class="num">
<li><p class="num">Write a test for the flash implemented in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#sec7_4_2">Section 7.4.2</a>. How detailed you want to make your tests is up to you; a suggested ultra-minimalist template appears in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex032">Listing 7.32</a>, which you should complete by replacing <span class="dark-green"><strong><code>FILL_IN</code></strong></span> with the appropriate code. (Even testing for the right key, much less the text, is likely to be brittle, so I prefer to test only that the flash isn’t empty.)</p></li>
<li><p class="num">As noted earlier, the flash HTML in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex029">Listing 7.29</a> is ugly. Verify by running the test suite that the cleaner code in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex033">Listing 7.33</a>, which uses the Rails <span class="dark-green"><strong><code>content_tag</code></strong></span> helper, also works.</p></li>
<li><p class="num">Verify that the test fails if you comment out the redirect line in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex026">Listing 7.26</a>.</p></li>
<li><p class="num">Suppose we changed <span class="dark-green"><strong><code>@user.save</code></strong></span> to <span class="dark-green"><strong><code>false</code></strong></span> in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex026">Listing 7.26</a>. How does this change verify that the <span class="dark-green"><strong><code>assert_difference</code></strong></span> block is testing the right thing?</p></li>
</ol>
<p class="ex-title" id="ch07ex032"><strong>Listing 7.32:</strong> A template for a test of the flash.</p>
<pre class="pre2"><code>test/integration/users_signup_test.rb</code></pre>
<p class="codelink"><a id="pf0366-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0366-01a">Click here to view code image</a></p>
<div class="example">
<pre><span class="green1">require</span> <span class="maroon">'test_helper'</span>
  <span class="ash">.</span>
  <span class="ash">.</span>
  <span class="ash">.</span>
  <span class="green1">test</span> <span class="maroon">"valid signup information"</span> <strong><span class="green">do</span></strong>
    get signup_path
    assert_difference <span class="maroon">'User.count'</span>, <span class="ash">1</span> <strong><span class="green">do</span></strong>
      post users_path, <span class="violet">params</span>: { <span class="violet">user</span>: { <span class="green1">name</span>: <span class="maroon">"Example User"</span>,
                                         <span class="violet">email</span>: <span class="maroon">"user@example.com"</span>,
                                         <span class="violet">password</span>:              <span class="maroon">"password"</span>,
                                         <span class="violet">password_confirmation</span>: <span class="maroon">"password"</span> } }
<span epub:type="pagebreak" id="page_367"></span>    <strong><span class="green">end</span></strong>
    follow_redirect!
    assert_template <span class="maroon">'users/show'</span>
<span class="mark">    assert_not flash<span class="ash1">.</span>FILL_IN</span>
  <strong><span class="green">end</span></strong>
<span class="green"><strong>end</strong></span></pre>
</div>
<p class="ex-title" id="ch07ex033"><strong>Listing 7.33:</strong> The <span class="dark-green"><strong><code>flash</code></strong></span> ERb in the site layout using <span class="dark-green"><strong><code>content_tag</code></strong></span>.</p>
<pre class="pre2"><code>app/views/layouts/application.html.erb</code></pre>
<p class="codelink"><a id="pf0367-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0367-02a">Click here to view code image</a></p>
<div class="example">
<pre><span class="red5">&lt;!DOCTYPE html&gt;</span>
&lt;<span class="green"><strong>html</strong></span>&gt;
      .
      .
      .
      <span class="red5">&lt;%</span> flash<span class="ash">.</span>each <strong><span class="green">do</span></strong> <span class="ash">|</span>message_type, message<span class="ash">|</span> <span class="red5">%&gt;</span>
<span class="mark">        <span class="maroon1">&lt;%=</span> content_tag(<span class="blue1">:div</span>, message, <span class="blue1">class</span>: <span class="red2">"alert alert-</span><span class="pink1">#{</span>message_type<span class="pink1">}</span><span class="red2">"</span>) <span class="maroon1">%&gt;</span></span>
      <span class="red5">&lt;%</span> <strong><span class="green">end</span></strong> <span class="red5">%&gt;</span>
      .
      .
      .
&lt;/<span class="green"><strong>html</strong></span>&gt;</pre>
</div>
</section>
</section>
</section>
<section>
<h3 class="h3" id="sec7_5">7.5 Professional-Grade Deployment</h3>
<p class="noindent">Now that we have a working signup page, it’s time to deploy our application and get it working in production. Although we started deploying our application in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch03.xhtml#ch03">Chapter 3</a>, this is the first time it will actually <em>do</em> something, so we’ll take this opportunity to make the deployment professional-grade. In particular, we’ll add an important feature to the production application to make signup secure, we’ll replace the default webserver with one suitable for real-world use, and we’ll add some configuration for our production database.</p>
<p class="indent">As preparation for the deployment, you should merge your changes into the <span class="dark-green"><strong><code>master</code></strong></span> branch at this point:</p>
<p class="codelink"><a id="pf0367-03" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0367-03a">Click here to view code image</a></p>
<pre class="pre1"><strong><span class="navy">$</span></strong> git add -A
<strong><span class="navy">$</span></strong> git commit -m <span class="maroon">"Finish user signup"</span>
<span epub:type="pagebreak" id="page_368"></span><strong><span class="navy">$</span></strong> git checkout master
<strong><span class="navy">$</span></strong> git merge sign-up</pre>
<section>
<h4 class="h4" id="sec7_5_1">7.5.1 SSL in Production</h4>
<p class="noindent">When submitting the signup form developed in this chapter, the name, email address, and password get sent over the network, and hence are vulnerable to being intercepted by malicious users. This is a potentially serious security flaw in our application, and the way to fix it is to use Secure Sockets Layer (SSL)<sup><a id="ch07fn13a" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fn13">13</a></sup> to encrypt all relevant information before it leaves the local browser. Although we could use SSL on just the signup page, it’s actually easier to implement it site-wide, which has the additional benefits of securing user login (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08">Chapter 8</a>) and making our application immune to the critical <em>session hijacking</em> vulnerability discussed in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch09.xhtml#sec9_1">Section 9.1</a>.</p>
<p class="footnote"><a id="ch07fn13" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fn13a">13</a>. Technically, SSL is now TLS, for Transport Layer Security, but everyone I know still says “SSL.”</p>
<p class="indent">Although Heroku uses SSL by default, it doesn’t <em>force</em> browsers to use it, thus any users of our application who rely on regular http will be interacting insecurely with the site. You can see how this works by editing the URL in the address bar to change “https” to “http”; the result appears in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fig026">Figure 7.26</a>.</p>
<figure id="ch07fig026" class="image-l">
<img src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/fig07_26.jpg" alt="Image" width="625" height="257" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig07_26.jpg">
<figcaption><p><strong>Figure 7.26:</strong> The result of using an insecure http URL in production.</p></figcaption>
</figure>
<p class="indent">Luckily, forcing browsers to use SSL is as easy as uncommenting a single line in <span class="dark-green"><strong><code>production.rb</code></strong></span>, the configuration file for production applications. As shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex034">Listing 7.34</a>, all we need to do is set <span class="dark-green"><strong><code>config.force_ssl</code></strong></span> to <span class="dark-green"><strong><code>true</code></strong></span>.<span epub:type="pagebreak" id="page_369"></span></p>
<p class="ex-title" id="ch07ex034"><strong>Listing 7.34:</strong> Configuring the application to use SSL in production.</p>
<pre class="pre2"><code>config/environments/production.rb</code></pre>
<p class="codelink"><a id="pf0369-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0369-01a">Click here to view code image</a></p>
<div class="example">
<pre><span class="red">Rails</span><span class="ash">.</span>application<span class="ash">.</span>configure <strong><span class="green">do</span></strong>
  <span class="ash">.</span>
  <span class="ash">.</span>
  <span class="ash">.</span>
  <span class="blue"># Force all access to the app over SSL, use Strict-Transport-Security,</span>
  <span class="blue"># and use secure cookies.</span>
<span class="mark">  config.force_ssl <span class="ash1">=</span> <span class="green3"><strong>true</strong></span></span>
  <span class="ash">.</span>
  <span class="ash">.</span>
  <span class="ash">.</span>
<span class="green"><strong>end</strong></span></pre>
</div>
<p class="indent">At this stage, we need to set up SSL on the remote server. Setting up a production site to use SSL involves purchasing and configuring an <em>SSL certificate</em> for your domain. That’s a lot of work, though, and luckily we won’t need it here: For an application running on a Heroku domain (such as the sample application), we can piggyback on Heroku’s SSL certificate. As a result, when we deploy the application in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#sec7_5_2">Section 7.5.2</a>, SSL will automatically be enabled. (If you want to run SSL on a custom domain, such as <a href="http://www.example.com/">www.example.com</a>, refer to Heroku’s documentation on SSL at <a href="http://devcenter.heroku.com/articles/ssl">devcenter.heroku.com/articles/ssl</a>.)</p>
</section>
<section>
<h4 class="h4" id="sec7_5_2">7.5.2 Production Webserver</h4>
<p class="noindent">Having added SSL, we now need to configure our application to use a webserver suitable for production applications. By default, Heroku uses a pure-Ruby webserver called WEBrick, which is easy to set up and run but isn’t good at handling significant traffic. As a result, WEBrick isn’t suitable for production use, so we’ll replace WEBrick with Puma, an HTTP server that is capable of handling a large number of incoming requests.</p>
<p class="indent">To add the new webserver, we simply follow the Heroku Puma documentation (<a href="http://devcenter.heroku.com/articles/deploying-rails-applications-with-the-puma-web-server">devcenter.heroku.com/articles/deploying-rails-applications-with-the-puma-web-server</a>). The first step is to include the <code>puma</code> gem in our <span class="dark-green"><strong><code>Gemfile</code></strong></span>, but as of Rails 5 Puma is included by default (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch03.xhtml#ch03ex02">Listing 3.2</a>). This means we can skip right to the second step, which is to replace the default contents of the file <span class="dark-green"><strong><code>config/puma.rb</code></strong></span> <span epub:type="pagebreak" id="page_370"></span>with the configuration shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex035">Listing 7.35</a>. The code in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex035">Listing 7.35</a> comes straight from the Heroku documentation,<sup><a id="ch07fn14a" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fn14">14</a></sup> and there is no need to understand it (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch01.xhtml#box1_2">Box 1.2</a>).</p>
<p class="footnote"><a id="ch07fn14" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fn14a">14</a>. <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex035">Listing 7.35</a> changes the formatting slightly so that the code fits in the standard 80 columns.</p>
<p class="ex-title" id="ch07ex035"><strong>Listing 7.35:</strong> The configuration file for the production webserver.</p>
<pre class="pre2"><code>config/puma.rb</code></pre>
<p class="codelink"><a id="pf0370-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0370-01a">Click here to view code image</a></p>
<div class="example">
<pre><span class="blue"># Puma configuration file.</span>
max_threads_count <span class="ash">=</span> <span class="red">ENV</span><span class="ash">.</span>fetch(<span class="maroon">"RAILS_MAX_THREADS"</span>) { <span class="ash">5</span> }
min_threads_count <span class="ash">=</span> <span class="red">ENV</span><span class="ash">.</span>fetch(<span class="maroon">"RAILS_MIN_THREADS"</span>) { max_threads_count }
threads min_threads_count, max_threads_count
port        <span class="red">ENV</span><span class="ash">.</span>fetch(<span class="maroon">"PORT"</span>) { <span class="ash">3000</span> }
environment <span class="red">ENV</span><span class="ash">.</span>fetch(<span class="maroon">"RAILS_ENV"</span>) { <span class="red">ENV</span><span class="ash">[</span><span class="maroon">'RACK_ENV'</span><span class="ash">] ||</span> <span class="maroon">"development"</span> }
pidfile <span class="red">ENV</span><span class="ash">.</span>fetch(<span class="maroon">"PIDFILE"</span>) { <span class="maroon">"tmp/pids/server.pid"</span> }
workers <span class="red">ENV</span><span class="ash">.</span>fetch(<span class="maroon">"WEB_CONCURRENCY"</span>) { <span class="ash">2</span> }
preload_app!
plugin <span class="violet">:tmp_restart</span></pre>
</div>
<p class="indent">We also need to make a <span class="dark-green"><strong><code>Procfile</code></strong></span> to tell Heroku to run a Puma process in production, as shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex036">Listing 7.36</a>. The <span class="dark-green"><strong><code>Procfile</code></strong></span> should be created in your application’s root directory (i.e., in the same directory as the <span class="dark-green"><strong><code>Gemfile</code></strong></span>).</p>
<p class="ex-title" id="ch07ex036"><strong>Listing 7.36:</strong> Defining a <span class="dark-green"><strong><code>Procfile</code></strong></span> for Puma.</p>
<pre class="pre2"><code>./Procfile</code></pre>
<p class="codelink"><a id="pf0370-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0370-02a">Click here to view code image</a></p>
<div class="example">
<pre>web: bundle <span class="green1">exec</span> puma -C config/puma.rb</pre>
</div>
</section>
<section>
<h4 class="h4" id="sec7_5_3">7.5.3 Production Database Configuration</h4>
<p class="noindent">The final step in our production deployment is properly configuring the production database, which (as mentioned briefly in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch02.xhtml#sec2_3_5">Section 2.3.5</a>) is PostgreSQL. My testing indicates that PostgreSQL actually works on Heroku without any configuration, but the official Heroku documentation (<a href="http://devcenter.heroku.com/articles/getting-started-with-rails5">devcenter.heroku.com/articles/getting-started-with-rails5</a>) recommends explicit configuration—so we’ll err on the side of caution and include it.</p>
<p class="indent">The actual change is easy: All we have to do is update the <span class="dark-green"><strong><code>production</code></strong></span> section of the database configuration file, <span class="dark-green"><strong><code>config/database.yml</code></strong></span>. The result, which I adapted from the Heroku docs, is shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex037">Listing 7.37</a>.<span epub:type="pagebreak" id="page_371"></span></p>
<p class="ex-title" id="ch07ex037"><strong>Listing 7.37:</strong> Configuring the database for production.</p>
<pre class="pre2"><code>config/database.yml</code></pre>
<p class="codelink"><a id="pf0371-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0371-01a">Click here to view code image</a></p>
<div class="example">
<pre><span class="blue"># SQLite version 3.x</span>
<span class="blue">#   gem install sqlite3</span>
<span class="blue">#</span>
<span class="blue">#   Ensure the SQLite 3 gem is defined in your Gemfile</span>
<span class="blue">#   gem 'sqlite3'</span>
<span class="blue">#</span>
default: <span class="lighgreen">&amp;default</span>
  adapter: sqlite3
  pool: 5
  timeout: 5000

development:
  &lt;&lt;: <span class="blue1">*default</span>
  database: db/development.sqlite3

<span class="blue"># Warning: The database defined as "test" will be erased and</span>
<span class="blue"># re-generated from your development database when you run "rake".</span>
<span class="blue"># Do not set this db to the same as development or production.</span>
test:
  &lt;&lt;: <span class="blue1">*default</span>
  database: db/test.sqlite3

<span class="mark">production:</span>
<span class="mark">  adapter: postgresql</span>
<span class="mark">  encoding: unicode</span>
<span class="mark">  <span class="lighblue"># For details on connection pooling, see Rails configuration guide</span></span>
<span class="mark">  <span class="lighblue"># https://guides.rubyonrails.org/configuring.html#database-pooling</span></span>
<span class="mark">  pool: &lt;%= ENV.fetch("RAILS_MAX_THREADS") { 5 } %&gt;</span>
<span class="mark">  database: sample_app_production</span>
<span class="mark">  username: sample_app</span>
<span class="mark">  password: &lt;%= ENV['SAMPLE_APP_DATABASE_PASSWORD'] %&gt;</span></pre>
</div>
</section>
<section>
<h4 class="h4" id="sec7_5_4">7.5.4 Production Deployment</h4>
<p class="noindent">With the production webserver and database configuration completed, we’re ready to commit and deploy:<sup><a id="ch07fn15a" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fn15">15</a></sup></p>
<p class="footnote"><a id="ch07fn15" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fn15a">15</a>. We haven’t changed the data model in this chapter, so running the migration at Heroku shouldn’t be necessary, but only if you followed the steps in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch06.xhtml#sec6_4">Section 6.4</a>. Because several readers reported having trouble, I’ve added <span class="dark-green"><strong><code>heroku run rails db:migrate</code></strong></span> as a final step just to be safe.<span epub:type="pagebreak" id="page_372"></span></p>
<p class="codelink"><a id="pf0372-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0372-01a">Click here to view code image</a></p>
<pre class="pre1">$ rails test
$ git add -A
$ git commit -m "Use SSL and the Puma webserver in production"
$ git push &amp;&amp; git push heroku</pre>
<p class="noindent">The signup form is now live, and the result of a successful signup is shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fig027">Figure 7.27</a>. Note the presence of a lock icon in the address bar of <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fig027">Figure 7.27</a>, which indicates that SSL is working.</p>
<figure id="ch07fig027" class="image-l">
<img src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/fig07_27.jpg" alt="Image" width="677" height="521" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig07_27.jpg">
<figcaption><p><strong>Figure 7.27:</strong> Signing up on the live web.</p></figcaption>
</figure>
<section>
<h5 class="h5" id="lev82">Ruby Version Number</h5>
<p class="noindent">When deploying to Heroku, you may get a warning message like this one:</p>
<p class="codelink"><a id="pf0372-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07_images.xhtml#pf0372-02a">Click here to view code image</a></p>
<pre class="pre1">###### WARNING:
       You have not declared a Ruby version in your Gemfile.
       To set your Ruby version add this line to your Gemfile:
       ruby '2.6.3'</pre>
<p class="noindent"><span epub:type="pagebreak" id="page_373"></span>Experience shows that, at the level of this tutorial, the costs associated with including such an explicit Ruby version number outweigh the (negligible) benefits, so you should ignore this warning for now. The main issue is that keeping your sample app and system in sync with the latest Ruby version can be a huge inconvenience,<sup><a id="ch07fn16a" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fn16">16</a></sup> yet it almost never makes a difference which exact Ruby version number you use. Nevertheless, you should bear in mind that, should you ever end up running a mission-critical app on Heroku, specifying an exact Ruby version in the <span class="dark-green"><strong><code>Gemfile</code></strong></span> is recommended to ensure maximum compatibility between development and production environments.</p>
<p class="footnote"><a id="ch07fn16" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fn16a">16</a>. For example, at one point Heroku required Ruby 2.1.4, so I spent several hours trying unsuccessfully to install Ruby 2.1.4 on my local machine—only to discover that Ruby 2.1.5 had been released the previous day. (Attempts to install Ruby 2.1.5 then also failed.)</p>
</section>
<section>
<h5 class="h5" id="lev83">Exercises</h5>
<p class="noindent">Solutions to the exercises are available to all Rails Tutorial purchasers at <a href="https://www.railstutorial.org/aw-solutions">https://www.railstutorial.org/aw-solutions</a>.</p>
<p class="indent">To see other people’s answers and to record your own, subscribe to the Rails Tutorial course or to the Learn Enough All Access Bundle.</p>
<ol class="num">
<li><p class="num">Confirm on your browser that the SSL lock and <span class="dark-green"><strong><code>https</code></strong></span> appear.</p></li>
<li><p class="num">Create a user on the production site using your primary email address. Does your Gravatar appear correctly?</p></li>
</ol>
</section>
</section>
</section>
<section>
<h3 class="h3" id="sec7_6">7.6 Conclusion</h3>
<p class="noindent">Being able to sign up users is a major milestone for our application. Although the sample app has yet to accomplish anything useful, we have laid an essential foundation for all future development. In <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08">Chapter 8</a> and <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch09.xhtml#ch09">Chapter 9</a>, we will complete our authentication machinery by allowing users to log in and out of the application (with optional “remember me” functionality). In <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch10.xhtml#ch10">Chapter 10</a>, we will allow all users to update their account information, and we will allow site administrators to delete users, thereby completing the full suite of Users resource REST actions identified in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07tab01">Table 7.1</a>.</p>
<section>
<h4 class="h4" id="sec7_6_1">7.6.1 What We Learned in this Chapter</h4>
<p class="bullet">• Rails displays useful debug information via the <span class="dark-green"><strong><code>debug</code></strong></span> method.</p>
<p class="bullet">• Sass mixins allow a group of CSS rules to be bundled and reused in multiple places.<span epub:type="pagebreak" id="page_374"></span></p>
<p class="bullet">• Rails comes with three standard environments: <span class="dark-green"><strong><code>development</code></strong></span>, <span class="dark-green"><strong><code>test</code></strong></span>, and <span class="dark-green"><strong><code>production</code></strong></span>.</p>
<p class="bullet">• We can interact with users as a <em>resource</em> through a standard set of REST URLs.</p>
<p class="bullet">• Gravatars provide a convenient way of displaying images to represent users.</p>
<p class="bullet">• The <span class="dark-green"><strong><code>form_with</code></strong></span> helper is used to generate forms for interacting with Active Record objects.</p>
<p class="bullet">• Signup failure renders the new user page and displays error messages automatically determined by Active Record.</p>
<p class="bullet">• Rails provides the <span class="dark-green"><strong><code>flash</code></strong></span> as a standard way to display temporary messages.</p>
<p class="bullet">• Signup success creates a user in the database, redirects to the user show page, and displays a welcome message.</p>
<p class="bullet">• We can use integration tests to verify form submission behavior and catch regressions.</p>
<p class="bullet">• We can configure our production application to use SSL for secure communications and Puma for high performance.</p>
</section>
</section>
</section>
<div class="annotator-outer annotator-viewer viewer annotator-hide">
  <ul class="annotator-widget annotator-listing"></ul>
</div><div class="annotator-modal-wrapper annotator-editor-modal annotator-editor annotator-hide">
	<div class="annotator-outer editor">
		<h2 class="title">Highlight</h2>
		<form class="annotator-widget">
			<ul class="annotator-listing">
			<li class="annotator-item"><textarea id="annotator-field-7" placeholder="Add a note using markdown (optional)" class="js-editor" maxlength="750"></textarea></li></ul>
			<div class="annotator-controls">
				<a class="link-to-markdown" href="https://daringfireball.net/projects/markdown/basics" target="_blank">?</a>
				<ul>
					<li class="delete annotator-hide"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#delete" class="annotator-delete-note button positive">Delete Note</a></li>
					<li class="save"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#save" class="annotator-save annotator-focus button positive">Save Note</a></li>
					<li class="cancel"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#cancel" class="annotator-cancel button">Cancel</a></li>
				</ul>
			</div>
		</form>
	</div>
</div><div class="annotator-modal-wrapper annotator-delete-confirm-modal" style="display: none;">
  <div class="annotator-outer">
    <h2 class="title">Highlight</h2>
      <a class="js-close-delete-confirm annotator-cancel close" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#close">Close</a>
      <div class="annotator-widget">
         <div class="delete-confirm">
            Are you sure you want to permanently delete this note?
         </div>
         <div class="annotator-controls">
            <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#cancel" class="annotator-cancel button js-cancel-delete-confirm">No, I changed my mind</a>
            <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#delete" class="annotator-delete button positive js-delete-confirm">Yes, delete it</a>
         </div>
       </div>
   </div>
</div><div class="annotator-adder" style="display: none;">
	<ul class="adders">
		
		<li class="copy"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#">Copy</a></li>
		
		<li class="add-highlight"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#">Add Highlight</a></li>
		<li class="add-note"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#">
			Add Note
		</a></li>
		
	</ul>
</div></div></div>



  <div class="t-sbo-prev sbo-prev sbo-nav-bottom">
  
    
      
        <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch06.xhtml" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">Chapter 6. Modeling Users</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-bottom">
  
    
      
        <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">Chapter 8. Basic Login</div>
        </a>
    
  
  </div>

</section>
  </div>
<section class="sbo-saved-archives"></section>



          
          
  




    
    
      <div id="js-subscribe-nag" class="subscribe-nag clearfix trial-panel t-subscribe-nag collapsed slideUp">
        
        
          <p class="usage-data">Find answers on the fly, or master something new. Subscribe today. <a href="https://learning.oreilly.com/subscribe/" class="ga-active-trial-subscribe-nag">See pricing options.</a></p>
        

        
        

      </div>

    
    



        
      </div>
      
        

<footer class="pagefoot t-pagefoot" style="padding-bottom: 69px;">
  <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#" class="icon-up" onclick="window.Appcues.track(&#39;JumpTop_HeronBook&#39;)" style="display: none;"><div class="visuallyhidden">Back to top</div></a>
  <ul class="js-footer-nav">
  
    
    <li><a href="https://learning.oreilly.com/public/support/">Support</a></li>
    
    <li><a href="https://learning.oreilly.com/accounts/logout/">Sign Out</a></li>
    
  
  
  </ul>
  <span class="copyright">© 2020 <a href="https://learning.oreilly.com/" target="_blank">O'Reilly Media, Inc</a>.</span>
  
    
    <a href="https://www.oreilly.com/terms/">Terms of Service</a> 
     / 
    
    <a href="https://learning.oreilly.com/privacy">Privacy Policy</a> 
    
    
  
</footer>

      
    
    <script src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/saved_resource(1)" charset="utf-8"></script><script type="text/javascript" id="">(function(){window.medalliaUserIdentifier=document.documentElement.dataset.userUuid;window.medalliaUserName=document.documentElement.dataset.username})();</script>
<script type="text/javascript" id="" src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/embed.js.download"></script>
    <script src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/saved_resource(2)" charset="utf-8"></script>
  

<div></div><div></div><div class="selection_bubble_root" style="display: none;"></div><div class="annotator-notice"></div><div class="font-flyout" style="top: 201.006px; left: 1194.34px;"><div class="font-controls-panel">
	<div class="nightmodes">
		<ul>
			<li class="day"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#" id="day-mode" title="Day Mode">
				<i class="fa fa-sun-o"></i>
				<span>Day Mode</span></a></li>
			<li class="cloudy"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#" id="cloudy-mode" title="Cloudy Mode">
				<i class="fa fa-cloud"></i>
				<span>Cloud Mode</span>
			</a></li>
			<li class="night"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#" id="night-mode" title="Night Mode">
				<i class="fa fa-moon-o"></i>
				<span>Night Mode</span>
			</a></li>
		</ul>
	</div>

	<div class="font-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-font left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-font-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-font right"></i>
		</div>
	</div>

	<div class="column-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-compress left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-column-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-expand right"></i>
		</div>
	</div>

	<a id="reset" class="button" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#">Reset</a>
</div>
</div><script type="text/javascript" async="" src="./Chapter 7. Sign Up - Ruby on Rails Tutorial, 6th Edition_files/generic1604331345324.js.download" charset="UTF-8"></script><script type="text/javascript" id="">function forceInputUppercase(a){var b=a.target.selectionStart,c=a.target.selectionEnd;a.target.value=a.target.value.toUpperCase();a.target.setSelectionRange(b,c)}void 0!=document.getElementById("id_promotion")&&null!=document.getElementById("id_promotion")&&document.getElementById("id_promotion").addEventListener("keyup",forceInputUppercase,!1);
void 0!=document.getElementsByName("promotionCode")[0]&&null!=document.getElementsByName("promotionCode")[0]&&document.getElementsByName("promotionCode")[0].addEventListener("keyup",forceInputUppercase,!1);</script><script type="text/javascript" id="">var nonwExpandable=document.querySelectorAll(".orm-ff-NavigationSubnav-headerListItem a, .orm-ff-NavigationView-headerListItem a");nonwExpandable.forEach(function(a,b){b+1!=nonwExpandable.length?a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"global nav",eventAct:"navigation",eventLbl:a.childNodes[1].textContent})}):b+1==nonwExpandable.length&&a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"user login",eventAct:"logout",eventLbl:"global nav | unified"})})});
var nonwExpandableFo=document.querySelectorAll(".drop-content li:not(.flyout-parent) a");
nonwExpandableFo.forEach(function(a,b){"drop-content"==a.parentNode.parentNode.parentNode.className&&b+1!=nonwExpandableFo.length?a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"global nav",eventAct:"navigation",eventLbl:a.childNodes[1].textContent})}):"drop-content"==a.parentNode.parentNode.parentNode.className&&b+1==nonwExpandableFo.length&&a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"user login",eventAct:"logout",eventLbl:"global nav | unified"})})});
var expandable=document.querySelectorAll(".orm-ff-NavigationSubnav-toggleControls a, .orm-ff-NavigationView-toggleControls a");expandable.forEach(function(a){a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"global nav",eventAct:"navigation",eventLbl:a.parentNode.parentNode.parentNode.querySelectorAll(".orm-Button-btnContentWrap span")[0].childNodes[1].textContent+" | "+a.textContent})})});var flyoutLinks=document.querySelectorAll(".flyout a");
flyoutLinks.forEach(function(a){a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"global nav",eventAct:"navigation",eventLbl:a.closest("li.flyout-parent").getElementsByTagName("a")[0].textContent+" | "+a.textContent})})});</script><span></span><script type="text/javascript" id="">dataLayer.push({"ld.experiment":void 0,"ld.variation":void 0});</script></body></html>