<!DOCTYPE html>
<!-- saved from url=(0080)https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml -->
<html class=" js flexbox flexboxlegacy no-touch websqldatabase indexeddb history csscolumns csstransforms localstorage sessionstorage no-applicationcache svg inlinesvg zoom" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#" itemscope="" itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/" data-offline-url="/" data-url="/library/view/ruby-on-rails/9780136702726/ch10.xhtml" data-csrf-cookie="csrfsafari" data-highlight-privacy="" data-user-id="10224494" data-user-uuid="66943332-5511-462c-876e-5d5b720c7edf" data-username="czjtgu3dkobug4zdmolfga2wembsmu" data-account-type="Trial" data-activated-trial-date="12/02/2020" data-archive="9780136702726" data-publishers="Addison-Wesley Professional" data-htmlfile-name="ch10.xhtml" data-epub-title="Ruby on Rails Tutorial, 6th Edition" data-debug="0" data-testing="0" style=""><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="author" content="O&#39;Reilly Media"><meta name="format-detection" content="telephone=no"><meta http-equiv="cleartype" content="on"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="apple-itunes-app" content="app-id=881697395, app-argument=safaridetail://9780136702726"><link rel="shortcut icon" href="https://www.oreilly.com/favicon.ico"><meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, maximum-scale=1.0"><meta property="twitter:account_id" content="4503599627559754"><link rel="shortcut icon" href="https://learning.oreilly.com/favicon.ico" type="image/x-icon"><link href="./Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition_files/css" rel="stylesheet" type="text/css"><title>Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition</title><link rel="stylesheet" href="./Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition_files/output.731fc84c4f9a.css" type="text/css"><link rel="stylesheet" type="text/css" href="./Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition_files/annotator.e3b0c44298fc.css"><link rel="stylesheet" href="./Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition_files/font-awesome.min.css"><style type="text/css" title="ibis-book">@page{margin:1em 2em}#sbo-rt-content div{margin-top:1em;margin-bottom:1em;margin-left:1em;margin-right:1em;text-align:justify}#sbo-rt-content div.cover img{max-width:99%;max-height:99%}#sbo-rt-content .att{text-align:right}#sbo-rt-content .cover{margin-top:.5em;margin-bottom:.5em;text-align:center}#sbo-rt-content .h1{margin-top:1.5em;margin-bottom:.5em;font-weight:bold;font-size:210%;page-break-after:avoid;border-bottom:solid .1em;text-align:center}#sbo-rt-content .halftitle{margin-top:1em;margin-bottom:2em;font-weight:bold;font-size:210%;page-break-after:avoid;text-align:center}#sbo-rt-content .h2{margin-top:1em;margin-bottom:.1em;font-weight:bold;font-size:180%;border-bottom:solid .1em;page-break-after:avoid;text-align:left}#sbo-rt-content .h2f{margin-top:1em;margin-bottom:2.5em;font-weight:bold;font-size:190%;border-bottom:solid .1em;page-break-after:avoid;text-align:left}#sbo-rt-content .h2t{margin-top:1em;margin-bottom:2em;font-weight:bold;font-size:190%;border-bottom:solid .1em;page-break-after:avoid;text-align:left}#sbo-rt-content .center{text-align:center}#sbo-rt-content .h3{margin-top:.5em;margin-bottom:.001em;font-weight:bold;font-size:160%;page-break-after:avoid;text-align:left}#sbo-rt-content .h4{margin-top:.5em;margin-bottom:.001em;font-weight:bold;font-size:130%;page-break-after:avoid;text-align:left}#sbo-rt-content .h5{margin-top:.5em;margin-bottom:.001em;font-weight:bold;font-size:120%;page-break-after:avoid;text-align:left}#sbo-rt-content ul{margin-top:1em;margin-bottom:1em;margin-left:.2em}#sbo-rt-content ul.sq{list-style-type:square}#sbo-rt-content ul.sq li p,#sbo-rt-content ul.sq li p.noindent{margin-top:.5em;margin-left:1em;margin-bottom:.5em;text-indent:.002em}#sbo-rt-content .left{text-align:left}#sbo-rt-content .ex-title{margin-top:.8em;margin-bottom:.5em;text-indent:.1em;font-size:100%}#sbo-rt-content code{font-family:Courier,Courier New,monospace;font-size:small}#sbo-rt-content pre{font-family:Courier,Courier New,monospace;margin-top:.6em;margin-bottom:1em;margin-left:.1em;line-height:1.3em;font-size:small}#sbo-rt-content .pre3{font-family:Courier,Courier New,monospace;margin-top:1em;margin-bottom:1em;margin-left:2.9em;background-color:#E6E6E6}#sbo-rt-content .equ{margin-top:.8em;margin-bottom:.5em;text-align:center}#sbo-rt-content .footnum{margin-top:.7em;margin-bottom:.5em;text-indent:-1em;margin-left:3.3em}#sbo-rt-content .footnotep{margin-top:.8em;margin-left:.8em;margin-bottom:.5em;text-indent:.8em}#sbo-rt-content .mark1{background-color:#F4F7F9}#sbo-rt-content .codelink{margin-top:.2em;margin-bottom:.5em}#sbo-rt-content .middle img{vertical-align:middle}#sbo-rt-content .box{margin-top:.6em;margin-bottom:1em;margin-left:.1em;margin-right:.8em;padding:.8em;background-color:#E6E6E6}#sbo-rt-content .box-bq{font-size:.8em;margin-top:.8em;margin-bottom:.5em;margin-left:1.6em;text-indent:.1em;background-color:#E6E6E6}#sbo-rt-content .boxip{margin-top:.5em;margin-left:.1em;margin-bottom:.5em;text-indent:.8em;background-color:#E6E6E6}#sbo-rt-content ol.num{list-style-type:number;font-weight:normal}#sbo-rt-content ol.num li p{list-style-type:number;font-weight:normal}#sbo-rt-content ol.num li p,#sbo-rt-content ol.num li p.number{margin-top:.5em;margin-left:.2em;margin-bottom:.5em;text-indent:.002em}#sbo-rt-content .num-p{margin-top:.5em;margin-bottom:.5em;margin-left:0}#sbo-rt-content .bullet{margin-top:.7em;margin-bottom:.5em;text-indent:-.8em;margin-left:2em}#sbo-rt-content .credit{margin-top:.1em;margin-bottom:.1em;text-indent:-1.5em;margin-left:2em}#sbo-rt-content .box-caption{margin-top:.1em;margin-bottom:1em;font-size:125%;font-weight:bold;text-indent:.02em;text-align:left}#sbo-rt-content .example{font-family:Courier,Courier New,monospace;margin-top:.6em;margin-bottom:1em;margin-left:.1em;line-height:1.3em;font-size:small;border-top:.02em solid black;border-bottom:.02em solid black}#sbo-rt-content .image-l{margin-top:.8em;margin-left:1em;text-align:center}#sbo-rt-content .topbot{margin-top:.8em;margin-bottom:.5em;border-bottom:solid black .1em;border-top:solid black .1em;text-indent:.1em}#sbo-rt-content .uln{margin-top:.7em;margin-bottom:.7em;margin-left:2em}#sbo-rt-content .fdash{margin-top:.7em;margin-bottom:.7em;margin-left:2em}#sbo-rt-content .fdash1{margin-top:.7em;margin-bottom:.7em;margin-left:3em}#sbo-rt-content .tr{border-bottom:.1em solid black}#sbo-rt-content th{text-align:left}#sbo-rt-content td{padding-left:.1em;padding-top:0;padding-bottom:0;vertical-align:top;text-align:left}#sbo-rt-content .mark{background-color:#E6E6E6}#sbo-rt-content .pre1{font-family:Courier,Courier New,monospace;margin-top:.2em;margin-bottom:1em;margin-left:0;padding:.8em;background-color:#E6E6E6}#sbo-rt-content .pre2{font-family:Courier,Courier New,monospace;margin-top:.2em;margin-bottom:1em;margin-left:.2em}#sbo-rt-content .tab-thc{margin-top:.1em;margin-bottom:.1em;border-bottom:solid black .1em;text-align:center}#sbo-rt-content .tab-th{margin-top:.1em;border-bottom:solid black .1em;border-top:solid black .1em;text-align:left}#sbo-rt-content .author{margin-top:2.5em;margin-bottom:5.5em;text-align:center;font-size:120%}#sbo-rt-content .pub{margin-top:1.5em;margin-bottom:.5em;text-align:center}#sbo-rt-content .pub1{font-weight:bold;font-size:.9em;margin-top:.1em;margin-bottom:.5em;text-align:center}#sbo-rt-content .copy{margin-top:.9em;margin-bottom:.5em;text-indent:.02em}#sbo-rt-content .copy1{margin-top:.9em;margin-bottom:.2em;text-indent:.02em}#sbo-rt-content .copy2{margin-top:.2em;margin-bottom:.5em;text-indent:.02em}#sbo-rt-content .title{margin-top:1em;margin-bottom:.2em;font-size:125%;font-weight:bold;text-indent:.02em;text-align:center}#sbo-rt-content .noindent{margin-top:.5em;margin-bottom:.5em;text-indent:.1em}#sbo-rt-content .tab-para{margin-top:.1em;margin-bottom:.1em;margin-left:.1em;text-indent:0}#sbo-rt-content .tab-parai{margin-top:.1em;margin-bottom:.1em;margin-left:1.1em;text-indent:-1.1em}#sbo-rt-content .boxnp{margin-top:.5em;margin-bottom:.5em;text-indent:.1em}#sbo-rt-content .toc-intro{margin-top:.1em;margin-bottom:.5em;margin-left:1.5em;text-align:left}#sbo-rt-content .tocchap{margin-top:1.5em;margin-bottom:.4em;margin-left:3.4em;text-indent:-4em}#sbo-rt-content .toclev1{margin-top:.4em;margin-bottom:.4em;margin-left:1em}#sbo-rt-content .toclev2{margin-top:.4em;margin-bottom:.4em;margin-left:2.6em}#sbo-rt-content .toclev1a{margin-top:.4em;margin-bottom:.4em;margin-left:.5em}#sbo-rt-content .toc-index{margin-top:2em;margin-bottom:.4em;margin-left:.7em}#sbo-rt-content .indexmain{margin-top:.4em;margin-bottom:.2em;margin-left:.8em;text-indent:-.8em}#sbo-rt-content .indexsub{margin-top:.4em;margin-bottom:.2em;margin-left:1.7em;text-indent:-.7em}#sbo-rt-content .indexsubsub{margin-top:.4em;margin-bottom:.2em;font-style:italic;margin-left:3em;text-indent:-.9em}#sbo-rt-content figcaption{margin-top:.8em;margin-bottom:.5em;color:black;text-align:left;text-indent:.1em}#sbo-rt-content .subtitle{margin-top:.1em;margin-bottom:1em;font-weight:bold;font-size:150%;page-break-after:avoid;text-align:center}#sbo-rt-content .edition{margin-top:2em;margin-bottom:3em;font-weight:bold;font-size:150%;page-break-after:avoid;text-align:center}#sbo-rt-content .indent{margin-top:.5em;margin-left:.1em;margin-bottom:.5em;text-indent:1.5em}#sbo-rt-content .h2a{margin-top:.1em;margin-bottom:2em;font-weight:bold;font-size:190%;page-break-after:avoid;text-align:left}#sbo-rt-content figure>img{max-width:99%;max-height:99%}#sbo-rt-content figure{margin-top:1em;margin-bottom:1em;margin-left:.5em;margin-right:1.5em}#sbo-rt-content none{list-style-type:none}#sbo-rt-content a{text-decoration:none}#sbo-rt-content .footnote{font-size:.8em;margin-top:.1em;margin-bottom:.5em;margin-left:.8em}#sbo-rt-content .none{margin-top:.5em;margin-left:1em;margin-bottom:.5em;list-style-type:none}#sbo-rt-content div.image-p img{width:80%}#sbo-rt-content .image-p{page-break-before:always;text-align:center}#sbo-rt-content table{border-collapse:collapse;border-spacing:0;background:transparent;vertical-align:top;margin-top:.1em;margin-right:.1em;margin-bottom:.9em;margin-left:0;width:100%}#sbo-rt-content .tab-parar{margin-top:.1em;margin-bottom:.1em;text-indent:.1em;text-align:right}#sbo-rt-content .h2i{margin-top:1em;margin-bottom:2.1em;font-weight:bold;font-size:190%;border-bottom:solid .1em;page-break-after:avoid;text-align:left}#sbo-rt-content pre{overflow:auto;-ms-overflow:auto;-moz-overflow:auto;-webkit-overflow:auto;-ms-padding-bottom:5pt;-moz-padding-bottom:5pt;-webkit-padding-bottom:5pt}#sbo-rt-content .maroon{color:#BB2121}#sbo-rt-content .green{color:#005A00}#sbo-rt-content .green1{color:#48785D}#sbo-rt-content .navy{color:#504B72}#sbo-rt-content .ash{color:#666}#sbo-rt-content .blue{color:#408080}#sbo-rt-content .green3{color:#00A100}#sbo-rt-content .blue1{color:#0000B8}#sbo-rt-content .violet{color:#1A177D}#sbo-rt-content .pink{color:#A131A1}#sbo-rt-content .pink1{color:#A131A1}#sbo-rt-content .red{color:#800}#sbo-rt-content .blue3{color:#2E3192}#sbo-rt-content .red2{color:#B80000}#sbo-rt-content .green4{color:#269200}#sbo-rt-content .ash1{color:#666}#sbo-rt-content .ash2{color:#33484A}#sbo-rt-content .red2{color:#640000}#sbo-rt-content .ash3{color:#7D8F29}#sbo-rt-content .red5{color:#BD7B00}#sbo-rt-content .maroon1{color:#B66600}#sbo-rt-content .blue5{color:#1F3BFF}#sbo-rt-content .red6{color:#B68}#sbo-rt-content .green7{color:#14B600}#sbo-rt-content .maroon2{color:#B66600}#sbo-rt-content .pink2{color:#AC21FF}#sbo-rt-content .pink3{color:#AC21FF}#sbo-rt-content .lighgreen{color:#5FA100}#sbo-rt-content .lighblue{color:#269271}#sbo-rt-content .darkmaroon{color:#269271}#sbo-rt-content .maroon5{color:#A10000}#sbo-rt-content .blue6{color:#0000B9}#sbo-rt-content .marko{background-color:#FAF9CE}#sbo-rt-content .green5{color:#1C8B43}#sbo-rt-content .colork1{color:#136433;font-weight:bold}#sbo-rt-content .colork2{color:#504C72}#sbo-rt-content .colork3{color:#51785D}#sbo-rt-content .colork4{color:#303192}#sbo-rt-content .colork5{color:#955744}#sbo-rt-content .colork6{color:#5C70BA}#sbo-rt-content .colork7{color:#487864}#sbo-rt-content .colork8{color:#5C5778}#sbo-rt-content .colork9{color:#666}#sbo-rt-content .colork10{color:#48785D}#sbo-rt-content .colork11{color:#BC654D}#sbo-rt-content .colork12{color:#3E8185}#sbo-rt-content .colork13{color:#C62425}#sbo-rt-content .colork14{color:#1D8C43}#sbo-rt-content .colork15{color:#0D8140}#sbo-rt-content .colork16{color:#BB2425}#sbo-rt-content .colork17{color:#985744}#sbo-rt-content .colork18{color:#6C8896}#sbo-rt-content .colork19{color:#2A2C80}#sbo-rt-content .colork20{color:#BD2425}#sbo-rt-content .redk1{color:#EE1C25}#sbo-rt-content .colork21{color:#2A2C77}#sbo-rt-content .colork22{color:#955744}#sbo-rt-content .colork23{color:#BC6561}#sbo-rt-content .colork24{color:#BE7D2B}#sbo-rt-content .colork25{color:#8E7C5D}#sbo-rt-content .colork26{color:#7C5778}#sbo-rt-content .colork27{color:#9D1C1F}#sbo-rt-content .colork28{color:#AA5744}#sbo-rt-content .colork29{color:#C59861}#sbo-rt-content .grayk1{color:#C0908E}#sbo-rt-content .pd_green{color:#48785d}#sbo-rt-content .dark-green{color:#146333}#sbo-rt-content .mark1{background-color:#faf9ce}#sbo-rt-content .mark{background-color:#faf9ce}#sbo-rt-content .pd_ash{color:#666}#sbo-rt-content .pd_blue7{color:#6c8896}#sbo-rt-content .pd_blue1{color:#504b72}#sbo-rt-content .pd_red{color:#965744}#sbo-rt-content .pd_red2{color:#bb654e}#sbo-rt-content .pd_red5{color:#ed1c24}#sbo-rt-content .pd_blue5{color:#2e3192}#sbo-rt-content .pd_green4{color:#269200}#sbo-rt-content .pd_green5{color:#1c8b43}#sbo-rt-content .pd_blue3{color:#2c2c78}#sbo-rt-content .pd_orange{color:#c49847}</style><script type="text/javascript" async="" src="./Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition_files/cool-2.1.15.min.js.download"></script><script type="text/javascript" async="" src="./Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition_files/ec.js.download"></script><script type="text/javascript" async="" src="./Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition_files/analytics.js.download"></script><script type="text/javascript" async="" src="./Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition_files/f.txt"></script><script type="text/javascript" async="" src="./Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition_files/js"></script><script crossorigin="anonymous" integrity="sha256-NiDMmov61Y536X/eLXLiDGzFVFmNLtPyu4b5aFB54ks=" type="text/javascript" src="./Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition_files/appcues.main.11e38ef4746fd64ab30c11794299d10b30bcb704.js.download" async=""></script><script async="" src="./Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition_files/gtm.js.download"></script><script> // <![CDATA[
    var g = {
      position_cache: {
        
          "chapter": "/api/v1/book/9780136702726/chapter/ch10.xhtml",
          "book_id": "9780136702726",
          "chapter_uri": "ch10.xhtml",
          "position": 27.4567491080775,
          "user_uuid": "66943332-5511-462c-876e-5d5b720c7edf",
          "next_chapter_uri": "/library/view/ruby-on-rails/9780136702726/ch11.xhtml"
        
      },
      title: "Ruby on Rails Tutorial, 6th Edition",
      author_list: "Michael Hartl",
      format: "book",
      source: "application/epub+zip",
      is_system_book: true,
      is_public: false,
      loaded_from_server: true,
      allow_scripts: false,
      has_mathml: true
    };
    // ]]></script><script src="./Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition_files/modernizr.8e35451ddb64.js.download"></script><script>
    
      

      
        
          window.PUBLIC_ANNOTATIONS = true;
        
      

      window.MOBILE_PUBLIC_ANNOTATIONS = false;

    

    
      window.PRIVACY_CONTROL_OVERRIDE = false;
    

      window.PRIVACY_CONTROL_SWITCH = true;

      window.PUBLISHER_PAGES = true;

      window.SBO = {
        "constants": {
          "SITB_ENDPOINT": "/api/v2/sitb/",
          "SEARCH_SELECT_ENDPOINT": "https://learning.oreilly.com/api/v2/search/select/",
          "ENABLE_ONLINE_TRAINING": true
        }
      };
  </script><link rel="canonical" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch10.xhtml"><meta name="description" content=" Chapter 10 Updating, Showing, and Deleting Users In this chapter, we complete the REST actions for the Users resource (Table 7.1) by adding edit, update, index ... "><meta property="og:title" content="Chapter 10. Updating, Showing, and Deleting Users"><meta itemprop="isPartOf" content="/library/view/ruby-on-rails/9780136702726/"><meta itemprop="name" content="Chapter 10. Updating, Showing, and Deleting Users"><meta property="og:url" itemprop="url" content="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch10.xhtml"><meta property="og:site_name" content="Safari"><meta property="og:image" itemprop="thumbnailUrl" content="https://learning.oreilly.com/library/cover/9780136702726/"><meta property="og:description" itemprop="description" content=" Chapter 10 Updating, Showing, and Deleting Users In this chapter, we complete the REST actions for the Users resource (Table 7.1) by adding edit, update, index ... "><meta itemprop="inLanguage" content="en"><meta itemprop="publisher" content="Addison-Wesley Professional"><meta property="og:type" content="book"><meta property="og:book:isbn" itemprop="isbn" content="9780136702726"><meta property="og:book:author" itemprop="author" content="Michael Hartl"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@OReillyMedia"><style type="text/css" id="font-styles" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-size: &lt;%= font_size %&gt; !important; }"></style><style type="text/css" id="font-family" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-family: &lt;%= font_family %&gt; !important; }"></style><style type="text/css" id="column-width" data-template="#sbo-rt-content { max-width: &lt;%= column_width %&gt;% !important; margin: 0 auto !important; }"></style><noscript><meta http-equiv="refresh" content="0; url=/library/no-js/" /></noscript><script>
    var dataLayer = window.dataLayer || [];

    
      window.medalliaVsgUserIdentifier = '66943332-5511-462c-876e-5d5b720c7edf';
      dataLayer.push({userIdentifier: '66943332-5511-462c-876e-5d5b720c7edf'});
      dataLayer.push({loggedIn: 'yes'});

      
        window.medalliaVsgAccountIdentifier = 'ba5f3401-307d-4b66-90a6-a97047c63525';
        

        window.medalliaVsgIsIndividual = true;
        
          
          dataLayer.push({learningAccountType: 'free trial'});
          
        

        
      
    

    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-5P4V6Z');
    (function () {
      var VERSION = 'V1.1';
      var AUTHOR = 'Awwad';
      if (!window.GtmHelper)
        window.GtmHelper = function () {
          var instance = this;
          var loc = document.location;
          this.version = VERSION;
          this.author = AUTHOR;
          this.readCookie = function (name) {
            var nameEQ = name + "=";
            var ca = document.cookie.split(';');
            for (var i = 0; i < ca.length; i++) {
              var c = ca[i];
              while (c.charAt(0) == ' ') c = c.substring(1, c.length);
              if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
          };
          this.createCookie = function (name, value, days, cookieDomain) {
            var domain = "";
            var expires = "";

            if (days) {
              var date = new Date();
              date.setTime(date.getTime() + Math.ceil(days * 24 * 60 * 60 * 1000));
              var expires = " expires=" + date.toGMTString() + ";";
            }

            if (typeof (cookieDomain) != 'undefined')
              domain = " domain=" + cookieDomain + "; ";

            document.cookie = name + "=" + value + ";" + expires + domain + "path=/";
          };

          this.isDuplicated = function (currentTransactionId) {
            // the previous transaction id:
            var previousTransIdValue = this.readCookie("previousTransId");

            if (currentTransactionId === previousTransIdValue) {
              return true; // Duplication
            } else {
              return false;
            }
          };
        }
    })()
  </script><script defer="" src="./Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition_files/vendor.3eecedff6f59.js.download"></script><script defer="" src="./Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition_files/reader.772cf1e31d6c.js.download"></script><iframe src="./Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition_files/saved_resource.html"></iframe><iframe src="./Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition_files/saved_resource(3).html"></iframe><iframe src="./Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition_files/saved_resource(4).html"></iframe><link rel="stylesheet" type="text/css" integrity="sha256-q9sKb2HpA5fJjN1cK9LjLaEXff5ix81Rv1Y3xJFptPE=" crossorigin="anonymous" href="./Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition_files/container.11e38ef4746fd64ab30c11794299d10b30bcb704.css"><iframe src="./Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition_files/saved_resource(5).html"></iframe><script src="./Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition_files/f(1).txt"></script><script async="" src="./Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition_files/MathJax.js.download"></script><style id="annotator-dynamic-style">.annotator-adder, .annotator-outer, .annotator-notice {
  z-index: 100019;
}
.annotator-filter {
  z-index: 100009;
}</style><style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 2px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 2px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: 1em}
.MathJax_MenuRadioCheck.RTL {right: 1em; left: auto}
.MathJax_MenuLabel {padding: 2px 2em 4px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #CCCCCC; margin: 4px 1px 0px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: Highlight; color: HighlightText}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
</style><style type="text/css" id="kampyleStyle">.noOutline{outline: none !important;}.wcagOutline:focus{outline: 1px dashed #595959 !important;outline-offset: 2px !important;transition: none !important;}</style><style type="text/css">.MathJax_Display {text-align: center; margin: 1em 0em; position: relative; display: block!important; text-indent: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; width: 100%}
.MathJax .merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MathJax .MJX-monospace {font-family: monospace}
.MathJax .MJX-sans-serif {font-family: sans-serif}
#MathJax_Tooltip {background-color: InfoBackground; color: InfoText; border: 1px solid black; box-shadow: 2px 2px 5px #AAAAAA; -webkit-box-shadow: 2px 2px 5px #AAAAAA; -moz-box-shadow: 2px 2px 5px #AAAAAA; -khtml-box-shadow: 2px 2px 5px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true'); padding: 3px 4px; z-index: 401; position: absolute; left: 0; top: 0; width: auto; height: auto; display: none}
.MathJax {display: inline; font-style: normal; font-weight: normal; line-height: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0}
.MathJax:focus, body :focus .MathJax {display: inline-table}
.MathJax.MathJax_FullWidth {text-align: center; display: table-cell!important; width: 10000em!important}
.MathJax img, .MathJax nobr, .MathJax a {border: 0; padding: 0; margin: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; vertical-align: 0; line-height: normal; text-decoration: none}
img.MathJax_strut {border: 0!important; padding: 0!important; margin: 0!important; vertical-align: 0!important}
.MathJax span {display: inline; position: static; border: 0; padding: 0; margin: 0; vertical-align: 0; line-height: normal; text-decoration: none}
.MathJax nobr {white-space: nowrap!important}
.MathJax img {display: inline!important; float: none!important}
.MathJax * {transition: none; -webkit-transition: none; -moz-transition: none; -ms-transition: none; -o-transition: none}
.MathJax_Processing {visibility: hidden; position: fixed; width: 0; height: 0; overflow: hidden}
.MathJax_Processed {display: none!important}
.MathJax_ExBox {display: block!important; overflow: hidden; width: 1px; height: 60ex; min-height: 0; max-height: none}
.MathJax .MathJax_EmBox {display: block!important; overflow: hidden; width: 1px; height: 60em; min-height: 0; max-height: none}
.MathJax_LineBox {display: table!important}
.MathJax_LineBox span {display: table-cell!important; width: 10000em!important; min-width: 0; max-width: none; padding: 0; border: 0; margin: 0}
.MathJax .MathJax_HitBox {cursor: text; background: white; opacity: 0; filter: alpha(opacity=0)}
.MathJax .MathJax_HitBox * {filter: none; opacity: 1; background: transparent}
#MathJax_Tooltip * {filter: none; opacity: 1; background: transparent}
@font-face {font-family: MathJax_Main; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Main-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Main-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Main-bold; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Main-Bold.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Main-Bold.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Main-italic; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Main-Italic.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Main-Italic.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Math-italic; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Math-Italic.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Math-Italic.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Caligraphic; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Caligraphic-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Caligraphic-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Size1; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Size1-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Size1-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Size2; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Size2-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Size2-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Size3; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Size3-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Size3-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Size4; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Size4-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Size4-Regular.otf?V=2.7.1') format('opentype')}
</style><style type="text/css">@font-face {font-family: MathJax_AMS; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_AMS-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_AMS-Regular.otf?V=2.7.1') format('opentype')}
</style></head>


<body class="reading sidenav  scalefonts subscribe-panel library nav-collapsed"><div style="visibility: hidden; overflow: hidden; position: absolute; top: 0px; height: 1px; width: auto; padding: 0px; border: 0px; margin: 0px; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal;"><div id="MathJax_Hidden"></div></div><div id="MathJax_Message" style="display: none;"></div>

    
  <noscript> 
    <iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P4V6Z"
            height="0" width="0"
            style="display:none;visibility:hidden">
    </iframe>
  </noscript>



    
      <div class="working hide" role="status">
        <div class="working-image"></div>
      </div>
      <div class="sbo-site-nav">
        

  


<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#container" class="skip">Skip to content</a><header class="topbar t-topbar"><nav role="navigation" class="js-site-nav"><ul class="topnav"><li><a href="https://learning.oreilly.com/home/" class="l0 nav-icn"><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M11.738 14H9.254v-3.676a.617.617 0 0 0-.621-.613H7.39a.617.617 0 0 0-.62.613V14H4.284a.617.617 0 0 1-.622-.613V10.22c0-.327.132-.64.367-.87l3.547-3.493a.627.627 0 0 1 .875 0l3.54 3.499c.234.229.366.54.367.864v3.167a.617.617 0 0 1-.62.613zM7.57 2.181a.625.625 0 0 1 .882 0l5.77 5.692-.93.92-5.28-5.209-5.28 5.208-.932-.919 5.77-5.692z"></path></svg><span>Home</span></a></li><li class="search"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#" class="t-search-nav trigger nav-icn l0" data-dropdown-selector=".searchbox"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>search icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M31.3 0C20.9 0 12.5 8.4 12.5 18.8 12.5 22.5 13.6 25.9 15.4 28.8L1.2 42.9C-0.4 44.5-0.4 47.2 1.2 48.8 2 49.6 3.1 50 4.2 50 5.2 50 6.3 49.6 7.1 48.8L21.2 34.6C24.1 36.5 27.5 37.5 31.3 37.5 41.6 37.5 50 29.1 50 18.8 50 8.4 41.6 0 31.3 0ZM31.3 31.3C24.4 31.3 18.8 25.6 18.8 18.8 18.8 11.9 24.4 6.3 31.3 6.3 38.1 6.3 43.8 11.9 43.8 18.8 43.8 25.6 38.1 31.3 31.3 31.3Z"></path></g></svg><span>Search</span></a></li><li class="usermenu dropdown"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#" class="trigger l0 nav-icn nav-dropdown"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>navigation arrow</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M0.1 12.5L9.7 3.1C9.8 3 9.9 3 10 3 10.1 3 10.2 3 10.3 3.1L19.9 12.5C20 12.5 20 12.6 20 12.8 20 12.9 20 13 19.9 13L17 15.9C16.9 16 16.8 16 16.7 16 16.5 16 16.4 16 16.4 15.9L10 9.7 3.6 15.9C3.6 16 3.5 16 3.3 16 3.2 16 3.1 16 3 15.9L0.1 13C0 12.9 0 12.8 0 12.7 0 12.7 0 12.6 0.1 12.5Z"></path></g></svg><span>Expand Nav</span></a><div class="drop-content"><ul><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#" class="l1 nav-icn "><!--?xml version="1.0" encoding="UTF-8"?--><svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M8,8 C6.34321755,8 5.00013,6.65691245 5.00013,5.00013 C5.00013,3.34334755 6.34321755,2.00026001 8,2.00026001 C9.65678245,2.00026001 10.99987,3.34334755 10.99987,5.00013 C10.99987,6.65691245 9.65678245,8 8,8 Z M2.33024571,11.3523547 L2.33774538,11.3523547 C3.7622187,9.70968996 5.82947484,8.76608166 8.00374984,8.76608166 C10.1780248,8.76608166 12.245281,9.70968996 13.6697543,11.3523547 C13.8892083,11.6177474 14.0062813,11.9530021 13.99974,12.2973138 L13.99974,13.99974 L2.00026001,13.99974 L2.00026001,12.2973138 C1.99371867,11.9530021 2.11079172,11.6177474 2.33024571,11.3523547 Z" id="path-1"></path></svg><span>Your O'Reilly</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/profile/" class="l2 nav-icn"><span>Profile</span></a></li><li><a href="https://learning.oreilly.com/history/" class="l2 nav-icn"><span>History</span></a></li><li><a href="https://learning.oreilly.com/playlists/" class="l2 nav-icn"><span>Playlists</span></a></li><li><a href="https://learning.oreilly.com/u/66943332-5511-462c-876e-5d5b720c7edf/" class="l2 nav-icn"><span>Highlights</span></a></li></ul></li><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#" class="l1 nav-icn "><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M11.564 2.263l2.172 2.174c.17.168.264.397.264.636V11a.6.6 0 0 1-.6.6h-.6V6.2h-6V2.6a.6.6 0 0 1 .6-.6h3.527c.239 0 .468.095.637.263zM2.6 14a.6.6 0 0 1-.6-.6V6.8a.6.6 0 0 1 .6-.6h1.903a1.2 1.2 0 0 1 .849.352L6.2 7.4H11a.6.6 0 0 1 .6.6v5.4a.6.6 0 0 1-.6.6H2.6zM11 5h1.8L11 3.2V5z"></path></svg><span>Featured</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/featured/navigating-21st-century/" class="l2 nav-icn"><span>Navigating Change</span></a></li><li><a href="https://learning.oreilly.com/recommendations/" class="l2 nav-icn"><span>Recommended</span></a></li></ul></li><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#" class="l1 nav-icn "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>queue icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 29.2C25.4 29.2 25.8 29.1 26.1 28.9L48.7 16.8C49.5 16.4 50 15.5 50 14.6 50 13.7 49.5 12.8 48.7 12.4L26.1 0.3C25.4-0.1 24.6-0.1 23.9 0.3L1.3 12.4C0.5 12.8 0 13.7 0 14.6 0 15.5 0.5 16.4 1.3 16.8L23.9 28.9C24.2 29.1 24.6 29.2 25 29.2ZM7.3 14.6L25 5.2 42.7 14.6 25 24 7.3 14.6ZM48.7 22.4L47.7 21.9 25 34.2 2.3 21.9 1.3 22.4C0.5 22.9 0 23.7 0 24.7 0 25.6 0.5 26.5 1.3 26.9L23.9 39.3C24.2 39.5 24.6 39.6 25 39.6 25.4 39.6 25.8 39.5 26.1 39.3L48.7 26.9C49.5 26.5 50 25.6 50 24.7 50 23.7 49.5 22.9 48.7 22.4ZM48.7 32.8L47.7 32.3 25 44.6 2.3 32.3 1.3 32.8C0.5 33.3 0 34.1 0 35.1 0 36 0.5 36.9 1.3 37.3L23.9 49.7C24.2 49.9 24.6 50 25 50 25.4 50 25.8 49.9 26.1 49.7L48.7 37.3C49.5 36.9 50 36 50 35.1 50 34.1 49.5 33.3 48.7 32.8Z"></path></g></svg><span>Explore</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/topics/" class="l2 nav-icn"><span>All Topics</span></a></li><li><a href="https://learning.oreilly.com/search/?query=&amp;extended_publisher_data=true&amp;highlight=true&amp;include_assessments=false&amp;include_case_studies=true&amp;include_courses=true&amp;include_orioles=true&amp;include_playlists=true&amp;include_collections=true&amp;include_notebooks=true&amp;is_academic_institution_account=false&amp;source=user&amp;formats=book&amp;sort=publication_date&amp;facet_json=true&amp;page=0" class="l2 nav-icn"><span>Early Releases</span></a></li><li><a href="https://learning.oreilly.com/playlists/discover/" class="l2 nav-icn"><span>Shared Playlists</span></a></li><li><a href="https://learning.oreilly.com/search/?query=&amp;extended_publisher_data=true&amp;highlight=true&amp;include_assessments=false&amp;include_case_studies=true&amp;include_courses=true&amp;include_orioles=true&amp;include_playlists=true&amp;include_collections=true&amp;include_notebooks=true&amp;is_academic_institution_account=false&amp;source=user&amp;formats=book&amp;formats=case%20study&amp;formats=learning%20path&amp;formats=live%20online%20training&amp;formats=notebook&amp;formats=oriole&amp;formats=video&amp;sort=popularity&amp;facet_json=true&amp;page=0&amp;collection_type=expert" class="l2 nav-icn"><span>Most Popular Titles</span></a></li><li><a href="https://learning.oreilly.com/resource-centers/" class="l2 nav-icn"><span>Resource Centers</span></a></li></ul></li><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#" class="l1 nav-icn "><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M12.8 3.2A1.2 1.2 0 0 1 14 4.4v8.4a1.2 1.2 0 0 1-1.2 1.2H3.2A1.2 1.2 0 0 1 2 12.8V4.4a1.2 1.2 0 0 1 1.2-1.2h1.2V2h1.2v1.2h4.8V2h1.2v1.2h1.2zm-9.6 9.6h9.6V6.2H3.2v6.6zM8 9.5a1.35 1.35 0 1 1 0-2.7 1.35 1.35 0 0 1 0 2.7zm2.7 2.148v.552H5.3v-.552c0-.321.124-.634.355-.858a3.358 3.358 0 0 1 4.69 0c.23.224.355.537.355.858z"></path></svg><span>Attend</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/live-training/" class="l2 nav-icn"><span>Live Trainings</span></a></li><li><a href="https://learning.oreilly.com/featured/architectural-katas" class="l2 nav-icn"><span>Architectural Katas</span></a></li><li><a href="https://learning.oreilly.com/featured/strata/" class="l2 nav-icn"><span>Strata</span></a></li><li><a href="https://learning.oreilly.com/featured/oscon/" class="l2 nav-icn"><span>Open Source</span></a></li><li><a href="https://learning.oreilly.com/featured/infrastructure-ops/" class="l2 nav-icn"><span>Infra &amp; Ops</span></a></li><li><a href="https://learning.oreilly.com/featured/software-architecture/" class="l2 nav-icn"><span>Software Arch</span></a></li></ul></li><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#" class="l1 nav-icn "><svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M11.6467109,4.35328907 L14.7964612,7.51003884 C15.0678463,7.78304342 15.0678463,8.22395603 14.7964612,8.49696061 L11.6467109,11.6467109 L10.6597892,10.6597892 L13.3055794,8 L10.6597892,5.34021084 L11.6467109,4.35328907 Z M4.35328907,11.6467109 L1.20353875,8.48996116 C0.932153749,8.21695658 0.932153749,7.77604397 1.20353875,7.50303939 L4.35328907,4.35328907 L5.34021084,5.34021084 L2.69442057,8 L5.34021084,10.6597892 L4.35328907,11.6467109 Z M5.84417089,11.4997226 L8.67194674,4.50027742 L10.1838269,4.50027742 L7.35605105,11.4997226 L5.84417089,11.4997226 Z" id="Mask"></path></svg><span>Interact</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/scenarios/?classification=content-scenario" class="l2 nav-icn"><span>Scenarios</span></a></li><li><a href="https://learning.oreilly.com/scenarios/?classification=sandbox-scenario" class="l2 nav-icn"><span>Sandboxes</span></a></li><li><a href="https://learning.oreilly.com/interactive/?classification=jupyter-notebook" class="l2 nav-icn"><span>Jupyter Notebooks</span></a></li></ul></li><li><a href="https://learning.oreilly.com/answers/" class="l1 nav-icn "><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path d="M2.31032699,3.75609006 C4.65421571,1.41371359 8.45302454,1.41472092 10.7955702,3.75860838 C13.1381158,6.10249583 13.1369405,9.90130261 10.7930518,12.243847 C8.44916311,14.5863913 4.65018639,14.5852161 2.30780867,12.2413286 C-0.0346204845,9.89749489 -0.0334929936,6.09853298 2.31032699,3.75609006 Z M8.8198605,4.98016308 C7.34193969,3.86924672 5.23410194,3.98609692 3.88914868,5.33104946 C3.12814393,6.09032122 2.72818176,7.13880077 2.79015179,8.21201133 C2.79115912,8.23064692 2.79233434,8.24928252 2.79350956,8.26791811 L2.79350956,8.26791811 C2.83179539,8.8307976 2.9944077,9.37404287 3.26947292,9.86201677 L3.26947292,9.86201677 L2.77621706,11.7027432 C2.7699968,11.7259241 2.77662063,11.7506624 2.79359185,11.7676337 C2.8105631,11.7846049 2.83530144,11.7912287 2.85848233,11.7850085 L2.85848233,11.7850085 L4.69400524,11.2922565 C5.26306363,11.6167344 5.90703177,11.786885 6.56209849,11.7858479 C8.64827865,11.7858479 10.3395879,10.094542 10.3395879,8.00836292 C10.3405204,6.84135608 9.80105674,5.73967784 8.87862141,5.02482134 L8.87862141,5.02482134 L8.82825492,4.98654283 Z M13.7933062,2 C14.7073496,2.00009863 15.4482759,2.74110484 15.4482759,3.65514822 C15.4482759,4.32460943 15.0449926,4.92814782 14.4264842,5.18432286 C13.8079757,5.44049789 13.096053,5.29885769 12.6226979,4.82545158 C12.1493429,4.35204547 12.0077795,3.64010743 12.2640213,3.02162665 C12.5202631,2.40314587 13.123845,1.99992776 13.7933062,2 Z"></path></svg><span>Answers</span></a></li><li><a href="https://learning.oreilly.com/certifications/" class="l1 nav-icn "><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path d="M12.912 9.18L14 8.014l-1.088-1.18a.304.304 0 01-.075-.268L13.195 5l-1.535-.463a.313.313 0 01-.194-.194l-.462-1.537-1.565.358c-.09.03-.194 0-.269-.074L8.007 2 6.845 3.09a.303.303 0 01-.269.074l-1.565-.358-.462 1.537a.313.313 0 01-.194.194L2.82 5l.358 1.567a.26.26 0 01-.075.269L2 8.015l1.088 1.164c.075.075.09.18.075.269l-.358 1.567 1.535.463c.09.03.164.104.194.194l.462 1.537 1.565-.358c.015 0 .045-.015.075-.015.075 0 .15.03.209.074L8.007 14l1.163-1.09a.303.303 0 01.269-.074l1.565.358.462-1.537a.313.313 0 01.194-.194L13.195 11l-.358-1.567a.338.338 0 01.075-.254zm-6.046 1.37L4.41 8.26l1.16-1.244 1.767 1.649L10.4 5.6l1.202 1.202-4.242 4.243-.495-.495z"></path></svg><span>Certifications</span></a></li><li><a href="https://learning.oreilly.com/preferences/" class="l1 nav-icn "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" width="20" height="20" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z"></path></g></svg><span>Settings</span></a></li><li><a href="https://learning.oreilly.com/public/support/" class="l1 nav-icn "><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M7.363 6.656a2.692 2.692 0 0 1-2.681-2.703c0-1.493 1.2-2.703 2.681-2.703a2.692 2.692 0 0 1 2.682 2.703c0 1.493-1.2 2.703-2.682 2.703zm4.023 2.027c-1.852 0-3.352 1.513-3.352 3.379H2v-1.534c-.006-.31.099-.612.295-.852a6.666 6.666 0 0 1 9.09-.993zm-.543.676h1.12v.304c.003.284.16.543.408.676a.766.766 0 0 0 .77 0l.303-.176.556.966-.302.176a.772.772 0 0 0-.362.676v.08a.772.772 0 0 0 .362.677l.302.21-.556.965-.302-.175a.766.766 0 0 0-.771 0 .778.778 0 0 0-.409.675v.352h-1.106v-.372a.778.778 0 0 0-.409-.676.766.766 0 0 0-.77 0l-.303.176-.556-.912.302-.176a.772.772 0 0 0 .362-.676v-.04-.04a.772.772 0 0 0-.362-.676l-.302-.176.556-.966.289.155a.766.766 0 0 0 .77 0 .778.778 0 0 0 .41-.676V9.36zm1.562 2.703c0-.271-.108-.531-.3-.722a1.001 1.001 0 0 0-.72-.292 1.01 1.01 0 0 0-.992 1.023 1.01 1.01 0 0 0 1.01 1.004 1.01 1.01 0 0 0 1.002-1.013z"></path></svg><span>Support</span></a></li><li><a href="https://get.oreilly.com/email-signup.html" class="l1 nav-icn " target="&quot;_blank&quot;"><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M11.564 2.263l2.172 2.174c.17.168.264.397.264.636V11a.6.6 0 0 1-.6.6h-.6V6.2h-6V2.6a.6.6 0 0 1 .6-.6h3.527c.239 0 .468.095.637.263zM2.6 14a.6.6 0 0 1-.6-.6V6.8a.6.6 0 0 1 .6-.6h1.903a1.2 1.2 0 0 1 .849.352L6.2 7.4H11a.6.6 0 0 1 .6.6v5.4a.6.6 0 0 1-.6.6H2.6zM11 5h1.8L11 3.2V5z"></path></svg><span>Newsletters</span></a></li><li><a href="https://learning.oreilly.com/accounts/logout/" class="l1 nav-icn "><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M2.613 12.63A.607.607 0 0 1 2 12.03V3.602C2 3.269 2.274 3 2.613 3h5.515v1.204H3.226v7.223h4.902v1.203H2.613zM5.677 9.02V6.611h4.903V4.926a.301.301 0 0 1 .19-.274.31.31 0 0 1 .33.063l2.722 2.673a.594.594 0 0 1 0 .849L11.1 10.909a.31.31 0 0 1-.331.063.301.301 0 0 1-.19-.274V9.02H5.677z"></path></svg><span>Sign Out</span></a></li></ul></div></li></ul></nav></header>



      </div>
      <div id="container" class="application" style="height: auto;">
        
          <div class="nav-container clearfix">
            


            
            
          </div>

          

  <div class="js-toc">
    
      <div class="sbo-reading-menu sbo-menu-top"><section class="sbo-toc-container toc-menu"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#" class="sbo-toc-thumb"><span class="sbo-title ss-list"><h1><div class="visuallyhidden">Table of Contents for </div>
      
      Ruby on Rails Tutorial, 6th Edition
      
    </h1></span></a><div class="toc-contents" style="max-height: 0px;">
  <div class="sbo-toc">
    <button type="button" class="sbo-toc-thumb close"><div class="visuallyhidden">Close</div></button>
      <section class="ios-app-teaser">
        <ul>
            <li><a class="js-toc-link toc-link" href="https://itunes.apple.com/gb/app/safari-queue-library-over/id881697395?mt=8" role="button">Install App</a></li>
            <li><a class="js-toc-link toc-link" href="safaridetail://9780136702726" role="button">Open in App</a></li>
        </ul>
      </section>
      <div class="sbo-book-meta">
        
        <span class="cover">
         <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/">
          <img src="./Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition_files/saved_resource" alt="Cover image for Ruby on Rails Tutorial, 6th Edition" height="184" width="141">
        </a>
        </span>
        <span class="title">
          
            
                <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/publisher/addison-wesley-professional/">
                  <img src="./Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition_files/addison-wesley.png" class="publisher-logo video" alt="publisher logo">
                </a>
            
          

          <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/">Ruby on Rails Tutorial, 6th Edition</a>
        </span>
        
        <span class="authors">by Michael Hartl</span>
        

        
        <span class="publishers t-publishers">Published by
          <!-- Show publisher page link if publisher pages switch is on -->
          
            <a class="t-publisher-link toc-link js-toc-link" href="https://learning.oreilly.com/library/publisher/addison-wesley-professional/">
              Addison-Wesley Professional</a>, 2020
          
        </span>
        

    

    </div>
  <ol class="tocList">
    
    
    
     

     <li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/cover.xhtml">
        Cover Page <span class="minutes">(01:09 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/pref00.xhtml">
        About This eBook <span class="minutes">(01:09 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/halftitle.xhtml">
        Halftitle Page <span class="minutes">(01:09 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/title.xhtml">
        Title Page <span class="minutes">(01:09 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/copy.xhtml">
        Copyright Page <span class="minutes">(02:18 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/toc.xhtml#toc">
        Contents <span class="minutes">(05:45 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/pref02.xhtml#pref02">
        Foreword <span class="minutes">(01:09 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/pref03.xhtml#pref03">
        Acknowledgments <span class="minutes">(01:09 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/pref04.xhtml#pref04">
        About the Author <span class="minutes">(01:09 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch01.xhtml#ch01">
        Chapter 1. From Zero to Deploy <span class="minutes">(77:03 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch02.xhtml#ch02">
        Chapter 2. A Toy App <span class="minutes">(50:36 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch03.xhtml#ch03">
        Chapter 3. Mostly Static Pages <span class="minutes">(63:15 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch04.xhtml#ch04">
        Chapter 4. Rails-Flavored Ruby <span class="minutes">(57:30 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch05.xhtml#ch05">
        Chapter 5. Filling in the Layout <span class="minutes">(60:57 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch06.xhtml#ch06">
        Chapter 6. Modeling Users <span class="minutes">(67:51 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07">
        Chapter 7. Sign Up <span class="minutes">(79:21 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08">
        Chapter 8. Basic Login <span class="minutes">(66:42 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch09.xhtml#ch09">
        Chapter 9. Advanced Login <span class="minutes">(52:54 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1 currently-reading">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch10.xhtml#ch10">
        Chapter 10. Updating, Showing, and Deleting Users <span class="minutes">(73:36 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch11.xhtml#ch11">
        Chapter 11. Account Activation <span class="minutes">(55:12 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12">
        Chapter 12. Password Reset <span class="minutes">(48:18 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch13.xhtml#ch13">
        Chapter 13. User Microposts <span class="minutes">(106:57 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch14.xhtml#ch14">
        Chapter 14. Following Users <span class="minutes">(78:12 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/index.xhtml#index">
        Index <span class="minutes">(55:12 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/credits.xhtml#credits">
        Credits <span class="minutes">(19:33 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch01_images.xhtml#ch01_images">
        Code Snippets <span class="minutes">(09:12 mins)</span>
       </a>
      
        
      
   </li></ol>
 </div>



</div></section></div>

    

    <div class="interface-controls interface-controls-top">
      <ul class="interface-control-btns js-bitlist js-reader">
        <li class="js-search-in-archive search-in-archive t-search-in-archive"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#" title="Search in archive" class="js-search-controls search-controls" onclick="window.Appcues.track(&#39;SearchBook_HeronBook&#39;)"><span class="icon">Search in book...</span></a><form class="search-archive-bar js-search-form"><input type="search" name="query" placeholder="Search inside this book..." autocomplete="off"></form><div class="search-archive-results"><div class="js-sitb-results-region"></div></div></li><li class="queue-control"><div class="js-content-uri" data-content-uri="/api/v1/book/9780136702726/chapter/ch10.xhtml"><div class="js-collections-dropdown collections-dropdown menu-bit-cards" onclick="window.Appcues.track(&#39;AddPlaylist_HeronBook&#39;)"><div data-reactroot="" class="menu-dropdown-wrapper js-menu-dropdown-wrapper align-right"><img class="hidden" src="./Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition_files/ajax-transp.gif" alt="loading spinner"><div class="menu-control"><div class="control "><div class="js-playlists-menu"><button class="js-playlist-icon"><svg class="icon-add-to-playlist-sml" viewBox="0 0 16 14" version="1.1" xmlns="http://www.w3.org/2000/svg"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g fill-rule="nonzero" fill="#000000"><g transform="translate(-1.000000, 0.000000)"><rect x="5" y="0" width="12" height="2"></rect><title>Playlists</title><path d="M4.5,14 C6.43299662,14 8,12.4329966 8,10.5 C8,8.56700338 6.43299662,7 4.5,7 C2.56700338,7 1,8.56700338 1,10.5 C1,12.4329966 2.56700338,14 4.5,14 Z M2.5,10 L4,10 L4,8.5 L5,8.5 L5,10 L6.5,10 L6.5,11 L5,11 L5,12.5 L4,12.5 L4,11 L2.5,11 L2.5,10 Z"></path><circle cx="2" cy="5" r="1"></circle><circle cx="1.94117647" cy="1" r="1"></circle><rect x="5" y="4" width="12" height="2"></rect><rect x="9" y="8" width="8" height="2"></rect><rect x="9" y="12" width="8" height="2"></rect></g></g></g></svg><div class="js-playlist-addto-label">Add&nbsp;To</div></button></div></div></div></div></div></div></li><li class="js-font-control-panel font-control-activator"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#" data-push-state="false" id="font-controls" title="Change font size" aria-label="Change font size" onclick="window.Appcues.track(&#39;ChangeFont_HeronBook&#39;)"><span class="icon">Toggle Font Controls</span></a></li><li class="dropdown sharing-controls"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#" class="trigger" data-push-state="false" title="Share" aria-label="Share" onclick="window.Appcues.track(&#39;Share_HeronBook&#39;)"><i class="fa fa-share"></i></a><ul class="social-sharing dropdown-menu"><li class="currently-reading"><a class="twitter share-button t-twitter" target="_blank" aria-label="Share this section on Twitter" title="Share this section on Twitter" href="https://twitter.com/share?url=https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch10.xhtml&amp;text=Ruby%20on%20Rails%20Tutorial%2C%206th%20Edition&amp;via=OReillyMedia"><span>Twitter</span></a></li><li class="currently-reading"><a class="facebook share-button t-facebook" target="_blank" aria-label="Share this section on Facebook" title="Share this section on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch10.xhtml"><span>Facebook</span></a></li><li class="currently-reading"><a class="googleplus share-button t-googleplus" target="_blank" aria-label="Share this secton on Google Plus" title="Share this secton on Google Plus" href="https://plus.google.com/share?url=https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch10.xhtml"><span>Google Plus</span></a></li><li class="currently-reading"><a class="email share-button t-email" aria-label="Share this section via email" title="Share this section via email" href="mailto:?subject=Safari:%20Chapter%2010.%20Updating%2C%20Showing%2C%20and%20Deleting%20Users&amp;body=https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch10.xhtml%0D%0Afrom%20Ruby%20on%20Rails%20Tutorial%2C%206th%20Edition%0D%0A"><span>Email</span></a></li></ul></li><!-- endif request.user.is_authenticated -->
      </ul>
    </div>

      
          
      

    <section role="document"><script src="./Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition_files/48743.js.download"></script>
<script>
  var userId = "66943332-5511-462c-876e-5d5b720c7edf";

  var userObject = {
    firstName: "Trn",
    segment: "Trial",
    admin: "False",
    profileCreatedOn: "2020-12-01",
    academic: ""
  };
  window.Appcues.identify(userId, userObject);
  window.Appcues.page();

  setTimeout(function () {
    window.Appcues.track('ViewingBook_HeronBook')
  }, 20000);
</script>


	  <div class="t-sbo-prev sbo-prev sbo-nav-top">
  
    
      
        <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch11.xhtml" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">Chapter 11. Account Activation</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-top">
  
    
      
        <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch13.xhtml" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">Chapter 13. User Microposts</div>
        </a>
    
  
  </div>



<div id="sbo-rt-content"><div class="annotator-wrapper"><section epub:type="chapter">
<h2 class="h2" id="ch12"><span epub:type="pagebreak" id="page_587"></span>Chapter 12</h2>
<h2 class="h2a">Password Reset</h2>
<p class="noindent">Having completed account activation (and thereby verified the users email address) in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch11.xhtml#ch11">Chapter 11</a>, were now in a good position to implement <em>password reset</em>, which enables us to handle the common case of users forgetting their passwords.<sup><a id="ch12fn1a" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12fn1" class="totri-footnote">1</a></sup> As well see, many of the steps are similar to those for account activation, and we will have several opportunities to apply the lessons learned in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch11.xhtml#ch11">Chapter 11</a>. The beginning is different, though: Unlike account activation, implementing password resets requires both a change to one of our views and two new forms (to handle email and new password submission).</p>
<p class="footnote"><a id="ch12fn1" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12fn1a" class="totri-footnote">1</a>. This chapter is independent of the others apart from using the mailer generation in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch11.xhtml#ch11ex06">Listing 11.6</a>, but it closely parallels <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch11.xhtml#ch11">Chapter 11</a>, so its much easier if youve completed that chapter first.</p>
<p class="indent">Before writing any code, lets mock up the expected sequence for resetting passwords. Well start by adding a forgot password link to the sample applications login form (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12fig01">Figure 12.1</a>). The forgot password link will go to a page with a form that takes an email address as input and sends an email containing a password reset link (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12fig02">Figure 12.2</a>). The reset link will go to a form for resetting the users password (with confirmation), as shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12fig03">Figure 12.3</a>.</p>
<figure id="ch12fig01" class="image-l">
<img src="./Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition_files/fig12_01.jpg" alt="Image" width="677" height="563" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig12_01.jpg">
<figcaption><p><strong>Figure 12.1:</strong> A mockup of a forgot password link.</p></figcaption>
</figure>
<figure id="ch12fig02" class="image-l">
<img src="./Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition_files/fig12_02.jpg" alt="Image" width="677" height="563" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig12_02.jpg">
<figcaption><p><strong>Figure 12.2:</strong> A mockup of the forgot password form.</p></figcaption>
</figure>
<p class="indent">If you worked through <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch11.xhtml#ch11">Chapter 11</a>, you already have a mailer for password resets, which was generated in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch11.xhtml#sec11_2">Section 11.2</a> (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch11.xhtml#ch11ex06">Listing 11.6</a>). In this section, well complete the necessary preliminaries by adding a resource and data model for password resets (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#sec12_1">Section 12.1</a>) to go along with the mailer. Well implement the actual password reset in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#sec12_3">Section 12.3</a>.<span epub:type="pagebreak" id="page_588"></span></p>
<p class="indent"><span epub:type="pagebreak" id="page_589"></span>In analogy with account activations, our general plan is to make a Password Resets resource, with each password reset consisting of a reset token and corresponding reset digest. The primary sequence goes like this:</p>
<ol class="num">
<li><p class="num">When a user requests a password reset, find the user by the submitted email address.</p></li>
<li><p class="num">If the email address exists in the database, generate a reset token and corresponding reset digest.</p></li>
<li><p class="num">Save the reset digest to the database, and then send an email to the user with a link containing the reset token and users email address.</p></li>
<li><p class="num">When the user clicks the link, find the user by email address, and then authenticate the token by comparing it to the reset digest.</p></li>
<li><p class="num">If authenticated, present the user with the form for changing the password.<span epub:type="pagebreak" id="page_590"></span></p></li>
</ol>
<section>
<h3 class="h3" id="sec12_1">12.1 Password Resets Resource</h3>
<p class="noindent">As with sessions (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#sec8_1">Section 8.1</a>) and account activations (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch11.xhtml#ch11">Chapter 11</a>), well model password resets as a resource even though they wont be associated with an Active Record model. Instead, well include the relevant data (including the reset token) in the User model itself.</p>
<p class="indent">Because well be treating password resets as a resource, well interact with them via the standard REST URLs. Unlike the activation link, which required only an <code><strong><span class="colork1">edit</span></strong></code> action, in this case well be rendering both <code><strong><span class="colork1">new</span></strong></code> and <code><strong><span class="colork1">edit</span></strong></code> forms for manipulating password resets, as well as creating and updating them, so well end up using four RESTful routes in total.</p>
<p class="indent">As usual, well make a topic branch for the new feature:</p>
<pre class="pre1"><strong><span class="colork2">$</span></strong> git checkout -b password-reset</pre>
<section>
<h4 class="h4" id="sec12_1_1">12.1.1 Password Resets Controller</h4>
<p class="noindent">Our first step is to generate a controller for the Password Resets resource, in this case making both <code><strong><span class="colork1">new</span></strong></code> and <code><strong><span class="colork1">edit</span></strong></code> actions per our earlier discussion:</p>
<p class="codelink"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12_images.xhtml#pg590a" id="pg590">Click here to view code image</a></p>
<pre class="pre1"><strong><span class="colork2">$</span></strong> rails generate controller PasswordResets new edit --no-test-framework</pre>
<p class="noindent">Note that weve included a flag to skip generating tests. This is because we dont need the controller tests, preferring instead to build on the integration test from <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch11.xhtml#sec11_3_3">Section 11.3.3</a>.</p>
<p class="indent">Because well need forms both for creating new password resets (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12fig02">Figure 12.2</a>) and for updating them by changing the password in the User model (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12fig03">Figure 12.3</a>), we need routes for <code><strong><span class="colork1">new</span></strong></code>, <code><strong><span class="colork1">create</span></strong></code>, <code><strong><span class="colork1">edit</span></strong></code>, and <code><strong><span class="colork1">update</span></strong></code>. We can arrange this with the <code><strong><span class="colork1">resources</span></strong></code> line shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex01">Listing 12.1</a>.</p>
<figure id="ch12fig03" class="image-l">
<img src="./Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition_files/fig12_03.jpg" alt="Image" width="677" height="563" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig12_03.jpg">
<figcaption><p><strong>Figure 12.3:</strong> A mockup of the reset password form.</p></figcaption>
</figure>
<p class="ex-title" id="ch12ex01"><strong>Listing 12.1:</strong> Adding a resource for password resets.</p>
<pre class="pre2">config/routes.rb</pre>
<p class="codelink"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12_images.xhtml#lis12-1a" id="lis12-1">Click here to view code image</a></p>
<div class="example">
<pre><span class="colork28">Rails</span><span class="colork9">.</span>application<span class="colork9">.</span>routes<span class="colork9">.</span>draw <strong><span class="colork10">do</span></strong>
  root   <span class="colork11">'static_pages#home'</span>
  get    <span class="colork11">'/help'</span>,    <span class="colork8">to</span>: <span class="colork11">'static_pages#help'</span>
  get    <span class="colork11">'/about'</span>,   <span class="colork8">to</span>: <span class="colork11">'static_pages#about'</span>
<span epub:type="pagebreak" id="page_591"></span>  get    <span class="colork11">'/contact'</span>, <span class="colork8">to</span>: <span class="colork11">'static_pages#contact'</span>
  get    <span class="colork11">'/signup'</span>,  <span class="colork8">to</span>: <span class="colork11">'users#new'</span>
  get    <span class="colork11">'/login'</span>,   <span class="colork8">to</span>: <span class="colork11">'sessions#new'</span>
  post   <span class="colork11">'/login'</span>,   <span class="colork8">to</span>: <span class="colork11">'sessions#create'</span>
  delete <span class="colork11">'/logout'</span>,  <span class="colork8">to</span>: <span class="colork11">'sessions#destroy'</span>
  resources :<span class="colork8">users</span>
  resources :<span class="colork8">account_activations</span>, <span class="colork8">only</span>: <span class="colork8">[:edit]</span>
<span class="mark">  resources :password_resets, only: [:new, :create, :edit, :update]</span>
<strong><span class="colork10">end</span></strong></pre>
</div>
<p class="noindent">The code in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex01">Listing 12.1</a> arranges for the RESTful routes shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12tab01">Table 12.1</a>. In particular, the first route in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12tab01">Table 12.1</a> gives a link to the forgot password form via</p>
<pre class="pre1">new_password_reset_path</pre>
<p class="noindent">as seen in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex02">Listing 12.2</a> and <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12fig04">Figure 12.4</a>.</p>
<figure id="ch12fig04" class="image-l">
<img src="./Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition_files/fig12_04.jpg" alt="Image" width="677" height="521" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig12_04.jpg">
<figcaption><p><strong>Figure 12.4:</strong> The login page with a forgot password link.</p></figcaption>
</figure>
<p class="ex-title" id="ch12ex02"><strong>Listing 12.2:</strong> Adding a link to password resets.</p>
<pre class="pre2">app/views/sessions/new.html.erb</pre>
<p class="codelink"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12_images.xhtml#lis12-2a" id="lis12-2">Click here to view code image</a></p>
<div class="example">
<pre><span class="colork29">&lt;%</span> provide(<span class="colork8">:title</span>, <span class="colork11">"Log in"</span>) <span class="colork29">%&gt;</span>
&lt;<strong><span class="colork10">h1</span></strong>&gt;Log in&lt;/<strong><span class="colork10">h1</span></strong>&gt;

&lt;<strong><span class="colork10">div</span></strong> <span class="colork22">class</span><span class="colork9">=</span><span class="colork23">"row"</span>&gt;
  &lt;<strong><span class="colork10">div</span></strong> <span class="colork22">class</span><span class="colork9">=</span><span class="colork23">"col-md-6 col-md-offset-3"</span>&gt;
    <span class="colork29">&lt;%=</span> form_with(<span class="colork8">url</span>: login_path, <span class="colork8">scope</span>: :<span class="colork8">session</span>, <span class="colork8">local</span>: <strong><span class="colork10">true</span></strong>) <strong><span class="colork10">do</span></strong> <span class="colork9">|</span>f<span class="colork9">|</span> <span class="colork29">%&gt;</span>

    <span class="colork29">&lt;%=</span> f<span class="colork9">.</span>label <span class="colork8">:email</span> <span class="colork29">%&gt;</span>
    <span class="colork29">&lt;%=</span> f<span class="colork9">.</span>email_field <span class="colork8">:email</span>, <span class="colork8">class</span>: <span class="colork11">'form-control'</span> <span class="colork29">%&gt;</span>

    <span class="colork29">&lt;%=</span> f<span class="colork9">.</span>label <span class="colork8">:password</span> <span class="colork29">%&gt;</span>
<span class="mark">    <span class="colork29">&lt;%=</span> link_to <span class="colork23">"(forgot password)"</span>, new_password_reset_path <span class="colork29">%&gt;</span></span>
   <span class="colork29">&lt;%=</span> f<span class="colork9">.</span>password_field <span class="colork8">:password</span>, <span class="colork8">class</span>: <span class="colork22">'form-control'</span> <span class="colork29">%&gt;</span>

    <span class="colork29">&lt;%=</span> f<span class="colork9">.</span>label <span class="colork8">:remember_me</span>, <span class="colork8">class</span>: <span class="colork22">"checkbox inline"</span> <strong><span class="colork10">do</span></strong> <span class="colork29">%&gt;</span>
      <span class="colork29">&lt;%=</span> f<span class="colork9">.</span>check_box <span class="colork8">:remember_me</span> <span class="colork29">%&gt;</span>
      &lt;<strong><span class="colork10">span</span></strong>&gt;Remember me on this computer&lt;/<strong><span class="colork10">span</span></strong>&gt;
    <span class="colork29">&lt;%</span> <strong><span class="colork10">end</span></strong> <span class="colork29">%&gt;</span>

    <span class="colork29">&lt;%=</span> f<span class="colork9">.</span>submit <span class="colork22">"Log in"</span>, <span class="colork8">class</span>: <span class="colork22">"btn btn-primary"</span> <span class="colork29">%&gt;</span>
  <span class="colork29">&lt;%</span> <strong><span class="colork10">end</span></strong> <span class="colork29">%&gt;</span>

  &lt;<strong><span class="colork10">p</span></strong>&gt;New user? <span class="colork29">&lt;%=</span> link_to <span class="colork22">"Sign up now!"</span>, signup_path <span class="colork29">%&gt;</span>&lt;/<strong><span class="colork10">p</span></strong>&gt;
 &lt;/<strong><span class="colork10">div</span></strong>&gt;
&lt;/<strong><span class="colork10">div</span></strong>&gt;</pre>
</div>
<figure id="ch12tab01">
<figcaption><p class="left"><span epub:type="pagebreak" id="page_592"></span><strong>Table 12.1:</strong> RESTful routes provided by the Password Resets resource in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex01">Listing 12.1</a>.</p></figcaption>
<table class="topbot">
<thead>
<tr>
<th class="tab-th"><p class="tab-para">HTTP request</p></th>
<th class="tab-th"><p class="tab-para">URL</p></th>
<th class="tab-th"><p class="tab-para">Action</p></th>
<th class="tab-th"><p class="tab-para">Named route</p></th>
</tr>
</thead>
<tbody>
<tr>
<td><p class="tab-para"><code>GET</code></p></td>
<td><p class="tab-para">/password_resets/new</p></td>
<td><p class="tab-para"><code><strong><span class="colork1">new</span></strong></code></p></td>
<td><p class="tab-para"><code><strong><span class="colork1">new_password_reset_path</span></strong></code></p></td>
</tr>
<tr>
<td><p class="tab-para"><code>POST</code></p></td>
<td><p class="tab-para">/password_resets</p></td>
<td><p class="tab-para"><code><strong><span class="colork1">create</span></strong></code></p></td>
<td><p class="tab-para"><code><strong><span class="colork1">password_resets_path</span></strong></code></p></td>
</tr>
<tr>
<td><p class="tab-para"><code>GET</code></p></td>
<td><p class="tab-para">/password_resets/&lt;token&gt;/edit</p></td>
<td><p class="tab-para"><code><strong><span class="colork1">edit</span></strong></code></p></td>
<td><p class="tab-para"><code><strong><span class="colork1">edit_password_reset_url (token)</span></strong></code></p></td>
</tr>
<tr>
<td><p class="tab-para"><code>PATCH</code></p></td>
<td><p class="tab-para">/password_resets/&lt;token&gt;</p></td>
<td><p class="tab-para"><code><strong><span class="colork1">update</span></strong></code></p></td>
<td><p class="tab-para"><code><strong><span class="colork1">password_reset_path (token)</span></strong></code></p></td>
</tr>
</tbody>
</table>
</figure>
<section>
<h5 class="h5" id="lev138"><span epub:type="pagebreak" id="page_593"></span>Exercises</h5>
<p>Solutions to the exercises are available to all Rails Tutorial purchasers at <a href="https://www.railstutorial.org/aw-solutions">https://www.railstutorial.org/aw-solutions</a>.</p>
<p class="indent">To see other peoples answers and to record your own, subscribe to the Rails Tutorial course or to the Learn Enough All Access Bundle.</p>
<ol class="num">
<li><p class="num">Verify that the test suite is still <small><span class="colork14">GREEN</span></small>.</p></li>
<li><p class="num">Why does <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12tab01">Table 12.1</a> list the <code><strong><span class="colork1">_url</span></strong></code> form of the <code><strong><span class="colork1">edit</span></strong></code> named route instead of the <code><strong><span class="colork1">_path</span></strong></code> form? <em>Hint</em>: The answer is the same as for the similar account activations exercise (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch11.xhtml#sec11_1_1">Section 11.1.1</a>).</p></li>
</ol></section>
</section>
<section>
<h4 class="h4" id="sec12_1_2">12.1.2 New Password Resets</h4>
<p class="noindent">To create new password resets, we first need to define the data model, which is similar to the one used for account activation (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch11.xhtml#ch11fig01">Figure 11.1</a>). Following the pattern set by remember tokens (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch09.xhtml#ch09">Chapter 9</a>) and account activation tokens (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch11.xhtml#ch11">Chapter 11</a>), password resets will pair a virtual reset token for use in the reset email with a corresponding reset digest for retrieving the user. If we instead stored an unhashed token, an attacker with access to the database could send a reset request to the users email address and then use the token and email to visit the corresponding password reset link, thereby gaining control of the account. Using a digest for password resets is thus essential. As an additional security precaution, well plan to <em>expire</em> the reset link after a couple of hours, which requires recording the time when the reset gets sent. The resulting <code><strong><span class="colork1">reset_digest</span></strong></code> and <code><strong><span class="colork1">reset_sent_at</span></strong></code> attributes appear in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12fig05">Figure 12.5</a>.</p>
<figure id="ch12fig05" class="image-l">
<img src="./Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition_files/fig12_05.jpg" alt="Image" width="607" height="620" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig12_05.jpg">
<figcaption><p><strong>Figure 12.5:</strong> The User model with added password reset attributes.</p></figcaption>
</figure>
<p class="indent">The migration to add the attributes from <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12fig05">Figure 12.5</a> appears as follows:</p>
<p class="codelink"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12_images.xhtml#pg593a" id="pg593">Click here to view code image</a></p>
<pre class="pre1"><strong><span class="colork4">$</span></strong> rails generate migration add_reset_to_users reset_digest:string <strong><span class="redk1">\</span></strong>
&gt; reset_sent_at:datetime</pre>
<p class="noindent">(As in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch11.xhtml#sec11_1_2">Section 11.1.2</a>, the <code><strong><span class="colork1">&gt;</span></strong></code> on the second line is a line continuation character inserted automatically by the shell, and should not be typed literally.) We then migrate as usual:</p>
<pre class="pre1">$ rails db:migrate</pre>
<p class="indent">To make the view for new password resets, well work in analogy with the previous form for making a new nonActive Record resourcenamely, the login <span epub:type="pagebreak" id="page_594"></span>form (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex04">Listing 8.4</a>) for creating a new session, shown again in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex03">Listing 12.3</a> for reference.</p>
<p class="ex-title" id="ch12ex03"><strong>Listing 12.3:</strong> Reviewing the code for the login form.</p>
<pre class="pre2">app/views/sessions/new.html.erb</pre>
<p class="codelink"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12_images.xhtml#lis12-3a" id="lis12-3">Click here to view code image</a></p>
<div class="example">
<pre><span class="colork29">&lt;%</span> provide(<span class="colork8">:title</span>, <span class="colork11">"Log in"</span>) <span class="colork29">%&gt;</span>
&lt;<strong><span class="colork10">h1</span></strong>&gt;Log in&lt;/<strong><span class="colork10">h1</span></strong>&gt;

&lt;<strong><span class="colork10">div</span></strong> <span class="colork22">class</span><span class="colork9">=</span><span class="colork23">"row"</span>&gt;
  &lt;<strong><span class="colork10">div</span></strong> <span class="colork22">class</span><span class="colork9">=</span><span class="colork23">"col-md-6 col-md-offset-3"</span>&gt;
    <span class="colork29">&lt;%=</span> form_with(<span class="colork8">url</span>: login_path, <span class="colork8">scope</span>: :<span class="colork8">session</span>, <span class="colork8">local</span>: <strong><span class="colork10">true</span></strong>) <strong><span class="colork10">do</span></strong> <span class="colork9">|</span>f<span class="colork9">|</span> <span class="colork29">%&gt;</span>
<span epub:type="pagebreak" id="page_595"></span>    <span class="colork29">&lt;%=</span> f<span class="colork9">.</span>label <span class="colork8">:email</span> <span class="colork29">%&gt;</span>
    <span class="colork29">&lt;%=</span> f<span class="colork9">.</span>email_field <span class="colork8">:email</span>, <span class="colork8">class</span>: <span class="colork11">'form-control'</span> <span class="colork29">%&gt;</span>

    <span class="colork29">&lt;%=</span> f<span class="colork9">.</span>label <span class="colork8">:password</span> <span class="colork29">%&gt;</span>
    <span class="colork29">&lt;%=</span> link_to <span class="colork11">"(forgot password)"</span>, new_password_reset_path <span class="colork29">%&gt;</span>
    <span class="colork29">&lt;%=</span> f<span class="colork9">.</span>password_field <span class="colork8">:password</span>, <span class="colork8">class</span>: <span class="colork11">'form-control'</span> <span class="colork29">%&gt;</span>

    <span class="colork29">&lt;%=</span> f<span class="colork9">.</span>label <span class="colork8">:remember_me</span>, <span class="colork8">class</span>: <span class="colork11">"checkbox inline"</span> <strong><span class="colork10">do</span></strong> <span class="colork29">%&gt;</span>
      <span class="colork29">&lt;%=</span> f<span class="colork9">.</span>check_box <span class="colork8">:remember_me</span> <span class="colork29">%&gt;</span>
      &lt;<strong><span class="colork10">span</span></strong>&gt;Remember me on this computer&lt;/<strong><span class="colork10">span</span></strong>&gt;
    <span class="colork29">&lt;%</span> <strong><span class="colork10">end</span></strong> <span class="colork29">%&gt;</span>

    <span class="colork29">&lt;%=</span> f.submit <span class="colork11">"Log in"</span>, <span class="colork8">class</span>: <span class="colork11">"btn btn-primary"</span> <span class="colork29">%&gt;</span>
  <span class="colork29">&lt;%</span> <strong><span class="colork10">end</span></strong> <span class="colork29">%&gt;</span>

    &lt;<strong><span class="colork10">p</span></strong>&gt;New user? <span class="colork29">&lt;%=</span> link_to <span class="colork11">"Sign up now!"</span>, signup_path <span class="colork29">%&gt;</span>&lt;/<strong><span class="colork10">p</span></strong>&gt;
  &lt;/<strong><span class="colork10"><span class="colork10">div</span></span></strong>&gt;
&lt;/<strong><span class="colork10"><span class="colork10">div</span></span></strong>&gt;</pre>
</div>
<p class="indent">The new password resets form has a lot in common with <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex03">Listing 12.3</a>; the most important differences are the use of a different resource and URL in the call to <code><strong><span class="colork1">form_with</span></strong></code> and the omission of the password attribute. The result appears in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex04">Listing 12.4</a> and <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12fig06">Figure 12.6</a>.</p>
<figure id="ch12fig06" class="image-l">
<img src="./Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition_files/fig12_06.jpg" alt="Image" width="677" height="523" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig12_06.jpg">
<figcaption><p><strong>Figure 12.6:</strong> The forgot password form.</p></figcaption>
</figure>
<p class="ex-title" id="ch12ex04"><strong>Listing 12.4:</strong> A new password reset view.</p>
<pre class="pre2">app/views/password_resets/new.html.erb</pre>
<p class="codelink"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12_images.xhtml#lis12-4a" id="lis12-4">Click here to view code image</a></p>
<div class="example">
<pre><span class="colork29">&lt;%</span> provide(<span class="colork8">:title</span>, <span class="colork11">"Forgot password"</span>) <span class="colork29">%&gt;</span>
&lt;<strong><span class="colork10">h1</span></strong>&gt;Forgot password&lt;/<strong><span class="colork10">h1</span></strong>&gt;

&lt;<strong><span class="colork10">div</span></strong> <span class="colork22">class</span><span class="colork9">=</span><span class="colork23">"row"</span>&gt;
  &lt;<strong><span class="colork10">div</span></strong> <span class="colork22">class</span><span class="colork9">=</span><span class="colork23">"col-md-6 col-md-offset-3"</span>&gt;
    <span class="colork29">&lt;%=</span> form_with(url: password_resets_path, <span class="colork8">scope</span>: :<span class="colork8">password_reset</span>,
                  <span class="colork8">local</span>: <strong><span class="colork10">true</span></strong>) <strong><span class="colork10">do</span></strong> <span class="colork9">|</span>f<span class="colork9">|</span> <span class="colork8">%&gt;</span>
      <span class="colork29">&lt;%=</span> f<span class="colork9">.</span>label <span class="colork8">:email</span> <span class="colork29">%&gt;</span>
      <span class="colork29">&lt;%=</span> f<span class="colork9">.</span>email_field :<span class="colork8">email</span>, <span class="colork8">class</span>: <span class="colork11">'form-control'</span> <span class="colork29">%&gt;</span>

      <span class="colork29">&lt;%=</span> f<span class="colork9">.</span>submit <span class="colork11">"Submit"</span>, <span class="colork8">class</span>: <span class="colork11">"btn btn-primary"</span> <span class="colork29">%&gt;</span>
    <span class="colork29">&lt;%</span> <strong><span class="colork10">end</span></strong> <span class="colork29">%&gt;</span>
  &lt;/<strong><span class="colork10">div</span></strong>&gt;
&lt;/<strong><span class="colork10">div</span></strong>&gt;</pre>
</div>
<section>
<h5 class="h5" id="lev139">Exercise</h5>
<p>Solutions to the exercises are available to all Rails Tutorial purchasers at <a href="https://www.railstutorial.org/aw-solutions">https://www.railstutorial.org/aw-solutions</a>.<span epub:type="pagebreak" id="page_596"></span></p>
<p class="indent">To see other peoples answers and to record your own, subscribe to the Rails Tutorial course or to the Learn Enough All Access Bundle.</p>
<ol class="num">
<li><p class="num">Why does the <code><strong><span class="colork1">form_with</span></strong></code> in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex04">Listing 12.4</a> use <code><strong><span class="colork1">:password_reset</span></strong></code> instead of <code><strong><span class="colork1">@password_reset</span></strong></code>?</p></li>
</ol></section>
</section>
<section>
<h4 class="h4" id="sec12_1_3">12.1.3 Password Reset <code>create</code> Action</h4>
<p class="noindent">Upon submitting the form in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12fig06">Figure 12.6</a>, we need to find the user by email address and update its attributes with the password reset token and sent-at time-stamp. We then redirect to the root URL with an informative flash message. As with login (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex011">Listing 8.11</a>), in the case of an invalid submission we re-render the <code><strong><span class="colork1">new</span></strong></code> page with a <code><strong><span class="colork1">flash.now</span></strong></code> message.<sup><a id="ch12fn2a" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12fn2" class="totri-footnote">2</a></sup> The results appear in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex05">Listing 12.5</a>.</p>
<p class="footnote"><a id="ch12fn2" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12fn2a" class="totri-footnote">2</a>. Security concerns about revealing the absence of the given email address are commonly misplaced. In fact, this property is already present in every website that wont let you sign up with an email address thats already in use, which is practically all of them. Thus, indicating that a given email address isnt available for password resets gives potential attackers no additional information.<span epub:type="pagebreak" id="page_597"></span></p>
<p class="ex-title" id="ch12ex05"><strong>Listing 12.5:</strong> A <code><strong><span class="colork1">create</span></strong></code> action for password resets.</p>
<pre class="pre2">app/controllers/password_resets_controller.rb</pre>
<p class="codelink"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12_images.xhtml#lis12-5a" id="lis12-5">Click here to view code image</a></p>
<div class="example">
<pre><strong><span class="colork10">class</span> <span class="colork4">PasswordResetsController</span></strong> <span class="colork11">&lt; ApplicationController</span>

  <strong><span class="colork10">def</span></strong> <span class="colork4">new</span>
  <strong><span class="colork10">end</span></strong>

  <strong><span class="colork10">def</span></strong> <span class="colork4">create</span>
    <span class="colork8">@user =</span> User.find_by(<span class="colork8">email</span>: params<span class="colork8">[:password_reset][:email]</span>.downcase)
    <strong><span class="colork10">if</span></strong> <span class="colork8">@user</span>
      <span class="colork8">@user.</span>create_reset_digest
      <span class="colork8">@user.</span>send_password_reset_email
      flash<span class="colork8">[:info] =</span> <span class="colork11">"Email sent with password reset instructions"</span>
      redirect_to root_url
    <strong><span class="colork10">else</span></strong>
      flash.now<span class="colork8">[:danger] =</span> <span class="colork11">"Email address not found"</span>
      render <span class="colork11">'new'</span>
    <strong><span class="colork10">end</span></strong>
 <strong><span class="colork10">end</span></strong>

 <strong><span class="colork10">def</span></strong> <span class="colork4">edit</span>
 <strong><span class="colork10">end</span></strong>
<strong><span class="colork10">end</span></strong></pre>
</div>
<p class="indent">The code in the User model parallels the <code><strong><span class="colork1">create_activation_digest</span></strong></code> method used in the <code><strong><span class="colork1">before_create</span></strong></code> callback (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch11.xhtml#ch11ex03">Listing 11.3</a>), as seen in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex06">Listing 12.6</a>.</p>
<p class="ex-title" id="ch12ex06"><strong>Listing 12.6:</strong> Adding password reset methods to the User model.</p>
<pre class="pre2">app/models/user.rb</pre>
<p class="codelink"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12_images.xhtml#lis12-6a" id="lis12-6">Click here to view code image</a></p>
<div class="example">
<pre><strong><span class="colork10">class</span> <span class="colork4">User</span></strong> <span class="colork11">&lt; ApplicationRecord</span>
<span class="mark">  <strong><span class="colork15">attr_accessor</span></strong> : <span class="colork8">remember_token</span>, <span class="colork8">:activation_token</span>, <span class="colork8">:reset_token</span></span>
  before_save <span class="colork8">:downcase_email</span>
  before_create <span class="colork8">:create_activation_digest</span>
  <span class="colork9">.</span>
  <span class="colork9">.</span>
  <span class="colork9">.</span>
  <span class="colork18"># Activates an account.</span>
  <strong><span class="colork10">def</span></strong> <span class="colork4">activate</span>
    update_attribute(<span class="colork8">:activated</span>,    <strong><span class="colork10">true</span></strong>)
    update_attribute(<span class="colork8">:activated_at</span>, <span class="colork23">Time.</span>zone.now)
 <strong><span class="colork10">end</span></strong>

  <span class="colork18"># Sends activation email.</span>
<span epub:type="pagebreak" id="page_598"></span> <strong><span class="colork10">def</span></strong> <span class="colork4">send_activation_email</span>
   <span class="colork22">UserMailer.</span>account_activation(<span class="colork8">self</span>).deliver_now
 <strong><span class="colork10">end</span></strong>

 <span class="colork18"># Sets the password reset attributes.</span>
 <strong><span class="colork10">def</span></strong> <span class="colork4">create_reset_digest</span>
<span class="mark">   <span class="colork23">self</span>.reset_token = <span class="colork23">User</span>.new_token</span>
<span class="mark">   update_attribute(<span class="colork8">:reset_digest</span>, <span class="colork23">User</span>.digest(reset_token))</span>
<span class="mark">   update_attribute(<span class="colork8">:reset_sent_at</span>, <span class="colork23">Time</span>.zone.now)</span>
 <strong><span class="colork10">end</span></strong>

 <span class="colork18"># Sends password reset email.</span>
 <strong><span class="colork10">def</span></strong> <span class="colork4">send_password_reset_email</span>
<span class="mark">   <span class="colork23">UserMailer</span>.password_reset(<span class="colork23">self</span>).deliver_now</span>
 <strong><span class="colork10">end</span></strong>

 <strong><span class="colork10">private</span></strong>

   <span class="colork18"># Converts email to all lowercase.</span>
   <strong><span class="colork10">def</span></strong> <span class="colork4">downcase_email</span>
     <span class="colork8">self.</span>email <span class="colork9">=</span> email<span class="colork9">.</span>downcase
   <strong><span class="colork10">end</span></strong>

   <span class="colork18"># Creates and assigns the activation token and digest.</span>
   <strong><span class="colork10">def</span></strong> <span class="colork4">create_activation_digest</span>
     <span class="colork23">self.</span>activation_token <span class="colork23">= User.</span>new_token
     <span class="colork23">self.</span>activation_digest <span class="colork23">= User.</span>digest(activation_token)
   <strong><span class="colork10">end</span></strong>
<strong><span class="colork10">end</span></strong></pre>
</div>
<p class="indent">As shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12fig07">Figure 12.7</a>, at this point the applications behavior for invalid email addresses is already working. To get the application working upon submission of a valid email address as well, we need to define a password reset mailer method.</p>
<figure id="ch12fig07" class="image-l">
<img src="./Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition_files/fig12_07.jpg" alt="Image" width="677" height="523" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig12_07.jpg">
<figcaption><p><strong>Figure 12.7:</strong> The forgot password form for an invalid email address.</p></figcaption>
</figure>
<section>
<h5 class="h5" id="lev140">Exercises</h5>
<p>Solutions to the exercises are available to all Rails Tutorial purchasers at <a href="https://www.railstutorial.org/aw-solutions">https://www.railstutorial.org/aw-solutions</a>.</p>
<p class="indent">To see other peoples answers and to record your own, subscribe to the Rails Tutorial course or to the Learn Enough All Access Bundle.</p>
<ol class="num">
<li><p class="num">Submit a valid email address to the form shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12fig06">Figure 12.6</a>. What error message do you get?<span epub:type="pagebreak" id="page_599"></span></p></li>
<li><p class="num">Confirm at the console that the user in the previous exercise has valid <code><strong><span class="colork1">reset_digest</span></strong></code> and <code><strong><span class="colork1">reset_sent_at</span></strong></code> attributes, despite the error. What are the attribute values?</p></li>
</ol>
</section>
</section>
</section>
<section>
<h3 class="h3" id="sec12_2">12.2 Password Reset Emails</h3>
<p class="noindent">We left <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#sec12_1">Section 12.1</a> with a nearly working <code><strong><span class="colork1">create</span></strong></code> action in the Password Resets controller. The only thing missing is the method to deliver valid password reset emails.</p>
<p class="indent">If you worked through <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch11.xhtml#sec11_1">Section 11.1</a>, you already have a default <code><strong><span class="colork1">password_reset</span></strong></code> method in <code><strong><span class="colork1">app/mailers/user_mailer.rb</span></strong></code> as a result of the User mailer generation in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch11.xhtml#ch11ex06">Listing 11.6</a>. If you skipped <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch11.xhtml#ch11">Chapter 11</a>, you can just copy the code provided in this section (omitting the <code><strong><span class="colork1">account_activation</span></strong></code> and related methods) and create the missing files as necessary.<span epub:type="pagebreak" id="page_600"></span></p>
<section>
<h4 class="h4" id="sec12_2_1">12.2.1 Password Reset Mailer and Templates</h4>
<p class="noindent">In <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex06">Listing 12.6</a>, we applied the design pattern implemented as a refactoring in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch11.xhtml#sec11_3_3">Section 11.3.3</a> by putting the User mailer directly in the model (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex06">Listing 12.6</a>):</p>
<p class="codelink"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12_images.xhtml#pg600a" id="pg600">Click here to view code image</a></p>
<pre class="pre1"><span class="colork5">UserMailer.</span>password_reset(<span class="colork5">self</span>).deliver_now</pre>
<p class="noindent">The password reset mailer method needed to get this working is nearly identical to the mailer for account activation developed in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch11.xhtml#sec11_2">Section 11.2</a>. We first create a <code><strong><span class="colork1">password_reset</span></strong></code> method in the user mailer (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex07">Listing 12.7</a>), and then define view templates for plain-text email (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex08">Listing 12.8</a>) and HTML email (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex09">Listing 12.9</a>).</p>
<p class="ex-title" id="ch12ex07"><strong>Listing 12.7:</strong> Mailing the password reset link.</p>
<pre class="pre2">app/mailers/user_mailer.rb</pre>
<p class="codelink"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12_images.xhtml#lis12-7a" id="lis12-7">Click here to view code image</a></p>
<div class="example">
<pre><strong><span class="colork10">class</span> <span class="colork4">UserMailer</span></strong> <span class="colork11">&lt; ApplicationMailer</span>

  <strong><span class="colork10">def</span></strong> <span class="colork4">account_activation</span>(user)
    <span class="colork8">@user =</span> user
    mail <span class="colork8">to</span>: user.email, <span class="colork8">subject</span>: <span class="colork11">"Account activation"</span>
  <strong><span class="colork10">end</span></strong>

  <strong><span class="colork10">def</span></strong> <span class="colork4">password_reset</span>(user)
<span class="mark">    <span class="colork8">@user</span> = user</span>
<span class="mark">    mail to: user.email, subject: <span class="colork22">"Password reset"</span></span>
  <strong><span class="colork10">end</span></strong>
<strong><span class="colork10">end</span></strong></pre>
</div>
<p class="ex-title" id="ch12ex08"><strong>Listing 12.8:</strong> The password reset plain-text email template.</p>
<pre class="pre2">app/views/user_mailer/password_reset.text.erb</pre>
<p class="codelink"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12_images.xhtml#lis12-8a" id="lis12-8">Click here to view code image</a></p>
<div class="example">
<pre>To reset your password click the link below:

<span class="colork29">&lt;%=</span> edit_password_reset_url(<span class="colork8">@user</span><span class="colork9">.</span>reset_token, <span class="colork8">email</span>: <span class="colork8">@user</span><span class="colork9">.</span>email) <span class="colork29">%&gt;</span>

This link will expire in two hours.

If you did not request your password to be reset, please ignore this email and
your password will stay as it is.</pre>
</div>
<p class="ex-title" id="ch12ex09"><span epub:type="pagebreak" id="page_601"></span><strong>Listing 12.9:</strong> The password reset HTML email template.</p>
<pre class="pre2">app/views/user_mailer/password_reset.html.erb</pre>
<p class="codelink"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12_images.xhtml#lis12-9a" id="lis12-9">Click here to view code image</a></p>
<div class="example">
<pre>&lt;<strong><span class="colork10">h1</span></strong>&gt;Password reset&lt;/<strong><span class="colork10">h1</span></strong>&gt;

&lt;<strong><span class="colork10">p</span></strong>&gt;To reset your password click the link below:&lt;/<strong><span class="colork10">p</span></strong>&gt;

<span class="colork29">&lt;%=</span> link_to <span class="colork11">"Reset password"</span>, edit_password_reset_url(<span class="colork8">@user.</span>reset_token,
                                                      <span class="colork8">email</span>: <span class="colork8">@user.</span>email) <span class="colork29">%&gt;</span>
&lt;<strong><span class="colork10">p</span></strong>&gt;This link will expire in two hours.&lt;/<strong><span class="colork10">p</span></strong>&gt;

&lt;<strong><span class="colork10">p</span></strong>&gt;
If you did not request your password to be reset, please ignore this email and
your password will stay as it is.
&lt;/<strong><span class="colork10">p</span></strong>&gt;</pre>
</div>
<p class="indent">As with account activation emails (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch11.xhtml#sec11_2">Section 11.2</a>), we can preview password reset emails using the Rails email previewer. The code is exactly analogous to <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch11.xhtml#ch11ex018">Listing 11.18</a>, as shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex010">Listing 12.10</a>.</p>
<p class="ex-title" id="ch12ex010"><strong>Listing 12.10:</strong> A working preview method for password reset.</p>
<pre class="pre2">test/mailers/previews/user_mailer_preview.rb</pre>
<p class="codelink"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12_images.xhtml#lis12-10a" id="lis12-10">Click here to view code image</a></p>
<div class="example">
<pre><span class="colork18"># Preview all emails at http://localhost:3000/rails/mailers/user_mailer</span>
<strong><span class="colork10">class</span> <span class="colork4">UserMailerPreview</span></strong> <span class="colork11">&lt; ActionMailer::Preview</span>

  <span class="colork18"># Preview this email at</span>
  <span class="colork18"># http://localhost:3000/rails/mailers/user_mailer/account_activation</span>
  <strong><span class="colork10">def</span></strong> <span class="colork4">account_activation</span>
    user <span class="colork22">= User</span>.first
    user<span class="colork9">.</span>activation_token <span class="colork22">= User.</span>new_token
    <span class="colork22">UserMailer</span><span class="colork9">.</span>account_activation(user)
  <strong><span class="colork10">end</span></strong>

  <span class="colork18"># Preview this email at</span>
  <span class="colork18"># http://localhost:3000/rails/mailers/user_mailer/password_reset</span>
  <strong><span class="colork10">def</span></strong> <span class="colork4">password_reset</span>
<span class="mark">    user = <span class="colork23">User</span>.first</span>
<span class="mark">    user.reset_token = <span class="colork23">User</span>.new_token</span>
<span class="mark">    UserMailer.password_reset(user)</span>
  <strong><span class="colork10">end</span></strong>
<strong><span class="colork10">end</span></strong>
</pre>
</div>
<p class="noindent"><span epub:type="pagebreak" id="page_602"></span>With the code in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex010">Listing 12.10</a>, the HTML and text email previews appear as in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12fig08">Figure 12.8</a> and <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12fig09">Figure 12.9</a>.</p>
<figure id="ch12fig08" class="image-l">
<img src="./Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition_files/fig12_08.jpg" alt="Image" width="677" height="523" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig12_08.jpg">
<figcaption><p><strong>Figure 12.8:</strong> A preview of the HTML version of the password reset email.</p></figcaption>
</figure>
<figure id="ch12fig09" class="image-l">
<img src="./Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition_files/fig12_09.jpg" alt="Image" width="677" height="523" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig12_09.jpg">
<figcaption><p><strong>Figure 12.9:</strong> A preview of the text version of the password reset email.</p></figcaption>
</figure>
<p class="indent">With the code in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex07">Listing 12.7</a>, <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex08">Listing 12.8</a>, and <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex09">Listing 12.9</a>, submission of a valid email address appears as shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12fig010">Figure 12.10</a>. The corresponding email appears in the server log and should look something like <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex011">Listing 12.11</a>.</p>
<figure id="ch12fig010" class="image-l">
<img src="./Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition_files/fig12_10.jpg" alt="Image" width="677" height="523" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig12_10.jpg">
<figcaption><p><strong>Figure 12.10:</strong> The result of submitting a valid email address.</p></figcaption>
</figure>
<p class="ex-title" id="ch12ex011"><strong>Listing 12.11:</strong> A sample password reset email from the server log.</p>
<p class="codelink"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12_images.xhtml#lis12-11a" id="lis12-11">Click here to view code image</a></p>
<div class="example">
<pre>UserMailer#password_reset: processed outbound mail in 6.0ms
Delivered mail 5d609328d5d29_28872b106582ddf4886d8@ip-172-31-25-202.mail (2.8ms)
Date: Sat, 24 Aug 2019 01:30:16 +0000
From: noreply@example.com
To: michael@michaelhartl.com
Message-ID: &lt;5d609328d5d29_28872b106582ddf4886d8@ip-172-31-25-202.mail&gt;
Subject: Password reset
Mime-Version: 1.0
Content-Type: multipart/alternative;
<span epub:type="pagebreak" id="page_603"></span> boundary="--==_mimepart_5d609328d5404_28872b106582ddf488531";
 charset=UTF-8
Content-Transfer-Encoding: 7bit


----==_mimepart_5d609328d5404_28872b106582ddf488531
Content-Type: text/plain;
 charset=UTF-8
Content-Transfer-Encoding: 7bit

To reset your password click the link below:

https://0ebe1dc6d40e4a4bb06e0ca7fe138127.vfs.cloud9.us-east-2.
amazonaws.com/password_resets/cT3mB4pwu7o-hrg6qEDfKg/
edit?email=michael%40michaelhartl.com

This link will expire in two hours.

If you did not request your password to be reset, please ignore this email and
your password will stay as it is.

----==_mimepart_5d609328d5404_28872b106582ddf488531
Content-Type: text/html;
 charset=UTF-8
Content-Transfer-Encoding: 7bit

&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;
    &lt;style&gt;
      /* Email styles need to be inline */
    &lt;/style&gt;
   &lt;/head&gt;

   &lt;body&gt;
     &lt;h1&gt;Password reset&lt;/h1&gt;

&lt;p&gt;To reset your password click the link below:&lt;/p&gt;

&lt;a href="https://0ebe1dc6d40e4a4bb06e0ca7fe138127.vfs.cloud9.us-east-2.
amazonaws.com/password_resets/cT3mB4pwu7o-hrg6qEDfKg/
edit?email=michael%40michaelhartl.com"&gt;Reset password&lt;/a&gt;

&lt;p&gt;This link will expire in two hours.&lt;/p&gt;

&lt;p&gt;
If you did not request your password to be reset, please ignore this email and
your password will stay as it is.
<span epub:type="pagebreak" id="page_604"></span>&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;

----==_mimepart_5d609328d5404_28872b106582ddf488531--</pre>
</div>
<section>
<h5 class="h5" id="lev141">Exercises</h5>
<p>Solutions to the exercises are available to all Rails Tutorial purchasers at <a href="https://www.railstutorial.org/aw-solutions">https://www.railstutorial.org/aw-solutions</a>.</p>
<p class="indent">To see other peoples answers and to record your own, subscribe to the Rails Tutorial course or to the Learn Enough All Access Bundle.</p>
<ol class="num">
<li><p class="num">Preview the email templates in your browser. What do the Date fields read for your previews?</p></li>
<li><p class="num">Submit a valid email address to the new password reset form. What is the content of the generated email in the server log?<span epub:type="pagebreak" id="page_605"></span></p></li>
<li><p class="num">At the console, find the user object corresponding to the email address from the previous exercise and verify that it has valid <code><strong><span class="colork1">reset_digest</span></strong></code> and <code><strong><span class="colork1">reset_sent_at</span></strong></code> attributes.</p></li>
</ol></section>
</section>
<section>
<h4 class="h4" id="sec12_2_2">12.2.2 Email Tests</h4>
<p class="noindent">In analogy with the account activation mailer method test (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch11.xhtml#ch11ex020">Listing 11.20</a>), well write a test of the password reset mailer method, as shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex012">Listing 12.12</a>.</p>
<p class="ex-title" id="ch12ex012"><strong>Listing 12.12:</strong> Adding a test of the password reset mailer method. <small><span class="colork14">GREEN</span></small></p>
<pre class="pre2">test/mailers/user_mailer_test.rb</pre>
<p class="codelink"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12_images.xhtml#lis12-12a" id="lis12-12">Click here to view code image</a></p>
<div class="example">
<pre><span class="colork10">require</span> <span class="colork11">'test_helper'</span>

<strong><span class="colork10">class</span> <span class="colork4">UserMailerTest</span></strong> <span class="colork11">&lt; ActionMailer::TestCase</span>
<span epub:type="pagebreak" id="page_606"></span><span class="colork10">test</span> <span class="colork11">"account_activation"</span> <strong><span class="colork10">do</span></strong>
  user = users(<span class="colork8">:michael</span>)
  user.activation_token <span class="colork5">= User.</span>new_token
  mail <span class="colork5">= UserMailer.</span>account_activation(user)
  assert_equal <span class="colork22">"Account activation"</span>, mail.subject
  assert_equal <span class="colork8">[</span>user.email<span class="colork8">]</span>, mail<span class="colork9">.</span>to
  assert_equal <span class="colork9">[</span><span class="colork22">"noreply@example.com"</span><span class="colork8">]</span>, mail<span class="colork9">.</span>from
  assert_match user<span class="colork9">.</span>name,               mail<span class="colork9">.</span>body<span class="colork9">.</span>encoded
  assert_match user<span class="colork9">.</span>activation_token,   mail<span class="colork9">.</span>body<span class="colork9">.</span>encoded
  assert_match <span class="colork5">CGI</span><span class="colork9">.</span>escape(user<span class="colork9">.</span>email),  mail<span class="colork9">.</span>body<span class="colork9">.</span>encoded
<strong><span class="colork10">end</span></strong>

<span class="colork10">test</span> <span class="colork11">"password_reset"</span> <strong><span class="colork10">do</span></strong>
  user = users(:<span class="colork8">michael</span>)
<span class="mark">  user.reset_token = User.new_token</span>
  mail <span class="colork5">= UserMailer</span>.password_reset(user)
  assert_equal <span class="colork11">"Password reset"</span>, mail.subject
  assert_equal [user.email], mail.to
  assert_equal [<span class="colork11">"noreply@example.com"</span>], mail<span class="colork9">.</span>from
  assert_match user<span class="colork9">.</span>reset_token,        mail<span class="colork9">.</span>body<span class="colork9">.</span>encoded
  assert_match <span class="colork5">CGI</span>.escape(user.email),  mail<span class="colork9">.</span>body<span class="colork9">.</span>encoded
  <strong><span class="colork10">end</span></strong>
<strong><span class="colork10">end</span></strong></pre>
</div>
<p class="noindent">At this point, the test suite should be <small><span class="colork14">GREEN</span></small>:</p>
<p class="ex-title" id="ch12ex013"><strong>Listing 12.13:</strong> <small><span class="colork14">GREEN</span></small></p>
<div class="example">
<pre>$ rails test</pre>
</div>
<section>
<h5 class="h5" id="lev142">Exercises</h5>
<p>Solutions to the exercises are available to all Rails Tutorial purchasers at <a href="https://www.railstutorial.org/aw-solutions">https://www.railstutorial.org/aw-solutions</a>.</p>
<p class="indent">To see other peoples answers and to record your own, subscribe to the Rails Tutorial course or to the Learn Enough All Access Bundle.</p>
<ol class="num">
<li><p class="num">Run just the mailer tests. Are they <small><span class="colork14">GREEN</span></small>?</p></li>
<li><p class="num">Confirm that the test goes <small><span class="redk1">RED</span></small> if you remove the second call to <code><strong><span class="colork1">CGI.escape</span></strong></code> in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex012">Listing 12.12</a>.<span epub:type="pagebreak" id="page_607"></span></p></li>
</ol>
</section>
</section>
</section>
<section>
<h3 class="h3" id="sec12_3">12.3 Resetting the Password</h3>
<p class="noindent">Now that we have a correctly generated email as in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex011">Listing 12.11</a>, we need to write the <code><strong><span class="colork1">edit</span></strong></code> action in the Password Resets controller that actually resets the users password. As in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch11.xhtml#sec11_3_3">Section 11.3.3</a>, well write a thorough integration test as well.</p>
<section>
<h4 class="h4" id="sec12_3_1">12.3.1 Reset <code>edit</code> Action</h4>
<p class="indent">Password reset emails such as that shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex011">Listing 12.11</a> contain links of the following form:</p>
<p class="codelink"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12_images.xhtml#pg607a" id="pg607">Click here to view code image</a></p>
<pre><span class="mark">https://example.com/password_resets/3BdBrXeQZSWqFIDRN8cxHA/edit?email=fu%40bar.</span>com</pre>
<p class="noindent">To get these links to work, we need a form for resetting passwords. This task is similar to updating users via the user edit view (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch10.xhtml#ch10ex02">Listing 10.2</a>) but involves only password and confirmation fields.</p>
<p class="indent">Theres an additional complication, though: We expect to find the user by email address, which means we need its value in both the <code><strong><span class="colork1">edit</span></strong></code> and <code><strong><span class="colork1">update</span></strong></code> actions. The email will automatically be available in the <code><strong><span class="colork1">edit</span></strong></code> action because of its presence in the link just given, but after we submit the form its value will be lost. The solution is to use a <em>hidden field</em> to place (but not display) the email on the page, and then submit it along with the rest of the forms information. The result appears in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex014">Listing 12.14</a>.</p>
<p class="ex-title" id="ch12ex014"><strong>Listing 12.14:</strong> The form to reset a password.</p>
<pre class="pre2">app/views/password_resets/edit.html.erb</pre>
<p class="codelink"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12_images.xhtml#lis12-14a" id="lis12-14">Click here to view code image</a></p>
<div class="example">
<pre><span class="colork29">&lt;%</span> provide(<span class="colork8">:title</span>, <span class="colork22">'Reset password'</span>) <span class="colork29">%&gt;</span>
&lt;<strong><span class="colork10">h1</span></strong>&gt;Reset password&lt;/<strong><span class="colork10">h1</span></strong>&gt;

&lt;<strong><span class="colork10">div</span></strong> <span class="colork22">class</span><span class="colork9">=</span><span class="colork23">"row"</span>&gt;
  &lt;<strong><span class="colork10">div</span></strong> <span class="colork22">class</span><span class="colork9">=</span><span class="colork23">"col-md-6 col-md-offset-3"</span>&gt;
    <span class="colork29">&lt;%=</span> form_with(<span class="colork8">model</span>: <span class="colork8">@user</span>, <span class="colork8">url</span>: password_reset_path(params<span class="colork8">[:id]</span>),
                  <span class="colork8">local</span>: <strong><span class="colork10">true</span></strong>) <strong><span class="colork10">do</span></strong> <span class="colork9">|</span>f<span class="colork9">|</span> <span class="colork29">%&gt;</span>
      <span class="colork29">&lt;%=</span> render <span class="colork22">'shared/error_messages'</span> <span class="colork29">%&gt;</span>

<span class="mark">      <span class="colork29">&lt;%=</span> hidden_field_tag <span class="colork8">:email</span>, <span class="colork8">@user</span>.email <span class="colork29">%&gt;</span></span>

      <span class="colork29">&lt;%=</span> f<span class="colork9">.</span>label <span class="colork8">:password</span> <span class="colork29">%&gt;</span>
      <span class="colork29">&lt;%= </span>f<span class="colork9">.</span>password_field <span class="colork8">:password</span>, <span class="colork8">class</span>: <span class="colork22">'form-control'</span> <span class="colork29">%&gt;</span>
<span epub:type="pagebreak" id="page_608"></span>      <span class="colork29">&lt;%=</span> f<span class="colork9">.</span>label <span class="colork8">:password_confirmation</span>, <span class="colork22">"Confirmation"</span> <span class="colork29">%&gt;</span>
      <span class="colork29">&lt;%=</span> f<span class="colork9">.</span>password_field :<span class="colork8">password_confirmation</span>, <span class="colork8">class</span>: <span class="colork11">'form-control'</span> <span class="colork29">%&gt;</span>

      <span class="colork29">&lt;%=</span> f<span class="colork9">.</span>submit <span class="colork22">"Update password"</span>, <span class="colork8">class</span>: <span class="colork22">"btn btn-primary"</span> <span class="colork29">%&gt;</span>
    <span class="colork29">&lt;%</span> <strong><span class="colork10">end</span></strong> <span class="colork29">%&gt;</span>
  &lt;/<strong><span class="colork10">div</span></strong>&gt;
&lt;/<strong><span class="colork10">div</span></strong>&gt;</pre>
</div>
<p class="noindent">Note that <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex014">Listing 12.14</a> uses the form tag helper</p>
<p class="codelink"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12_images.xhtml#pg608-1a" id="pg608-1">Click here to view code image</a></p>
<pre class="pre1">hidden_field_tag <span class="colork8">:email</span>, <span class="colork8">@user.</span>email</pre>
<p class="noindent">instead of</p>
<p class="codelink"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12_images.xhtml#pg608-2a" id="pg608-2">Click here to view code image</a></p>
<pre class="pre1">f.hidden_field <span class="colork8">:email</span>, <span class="colork8">@user.</span>email</pre>
<p class="noindent">because the reset link puts the email in <code><strong><span class="colork1">params[:email]</span></strong></code>, whereas the latter would put it in <code><strong><span class="colork1">params[:user][:email]</span></strong></code>.</p>
<p class="indent">To get the form to render, we need to define an <code><strong><span class="colork1">@user</span></strong></code> variable in the Password Resets controllers <code><strong><span class="colork1">edit</span></strong></code> action. As with account activation (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch11.xhtml#ch11ex031">Listing 11.31</a>), this involves finding the user corresponding to the email address in <code><strong><span class="colork1">params[:email]</span></strong></code>. We then need to verify that the user is validthat is, that it exists, is activated, and is authenticated according to the reset token from <code><strong><span class="colork1">params[:id]</span></strong></code> (using the generalized <code><strong><span class="colork1">authenticated?</span></strong></code> method defined in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch11.xhtml#ch11ex026">Listing 11.26</a>). Because confirmation of the existence of a valid <code><strong><span class="colork1">@user</span></strong></code> is needed in both the <code><strong><span class="colork1">edit</span></strong></code> and <code><strong><span class="colork1">update</span></strong></code> actions, well put the code to find and validate it in a couple of before filters, as shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex015">Listing 12.15</a>.</p>
<p class="ex-title" id="ch12ex015"><strong>Listing 12.15:</strong> The <code><strong><span class="colork1">edit</span></strong></code> action for password reset.</p>
<pre class="pre2">app/controllers/password_resets_controller.rb</pre>
<p class="codelink"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12_images.xhtml#lis12-15a" id="lis12-15">Click here to view code image</a></p>
<div class="example">
<pre><strong><span class="colork10">class</span> <span class="colork4">PasswordResetsController</span></strong> <span class="colork11">&lt; ApplicationController</span>
<span class="mark">  before_action :get_user,   only: [:edit, :update]</span>
<span class="mark">  before_action :valid_user, only: [:edit, :update]</span>
  <span class="colork9">.</span>
  <span class="colork9">.</span>
  <span class="colork9">.</span>
  <strong><span class="colork10">def</span></strong> <span class="colork4">edit</span>
  <strong><span class="colork10">end</span></strong>

<span class="mark">  <strong><span class="colork10">private</span></strong></span>
<span epub:type="pagebreak" id="page_609"></span>    <strong><span class="colork10">def</span></strong> <span class="colork4">get_user</span>
<span class="mark">      <span class="colork22">@user = User</span>.find_by(<span class="colork8">email</span>: params[:<span class="colork8">email</span>])</span>
    <strong><span class="colork10">end</span></strong>

    <span class="colork18"># Confirms a valid user.</span>
    <strong><span class="colork10">def</span></strong> <span class="colork4">valid_user</span>
<span class="mark">      <strong><span class="colork10">unless</span></strong> ( <span class="colork8">@user</span> <span class="colork23">&amp;&amp;</span> <span class="colork8">@user.</span>activated? <span class="colork23">&amp;&amp;</span></span>
<span class="mark">               <span class="colork8">@user.</span>authenticated?( <span class="colork8">:reset</span>, params<span class="colork8">[</span>:id<span class="colork8">]</span>))</span>
  <span class="mark">      redirect_to root_url</span>
  <span class="mark">    <strong><span class="colork10">end</span></strong></span>
    <strong><span class="colork10">end</span></strong>
<strong><span class="colork10">end</span></strong></pre>
</div>
<p class="indent">In <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex015">Listing 12.15</a>, compare the use of</p>
<p class="codelink"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12_images.xhtml#pg609-1a" id="pg609-1">Click here to view code image</a></p>
<pre class="pre1">authenticated?(:<span class="colork8">reset</span>, params<span class="colork9">[:id]</span>)</pre>
<p class="noindent">to</p>
<p class="codelink"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12_images.xhtml#pg609-2a" id="pg609-2">Click here to view code image</a></p>
<pre class="pre1">authenticated?(<span class="colork8">:remember</span>, cookies<span class="colork8">[:remember_token]</span>)</pre>
<p class="noindent">in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch11.xhtml#ch11ex028">Listing 11.28</a> and to</p>
<p class="codelink"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12_images.xhtml#pg609-3a" id="pg609-3">Click here to view code image</a></p>
<pre class="pre1">authenticated?(<span class="colork8">:activation</span>, params<span class="colork8">[:id]</span>)</pre>
<p class="noindent">in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch11.xhtml#ch11ex031">Listing 11.31</a>. Together, these three uses complete the authentication methods shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch11.xhtml#ch11tab01">Table 11.1</a>.</p>
<p class="indent">With this code, following the link from <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex011">Listing 12.11</a> should render a password reset form. The result of pasting the link from the log (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex011">Listing 12.11</a>) appears in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12fig011">Figure 12.11</a>.</p>
<figure id="ch12fig011" class="image-l">
<img src="./Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition_files/fig12_11.jpg" alt="Image" width="677" height="523" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig12_11.jpg">
<figcaption><p><strong>Figure 12.11:</strong> The password reset form.</p></figcaption>
</figure>
<section>
<h5 class="h5" id="lev143">Exercises</h5>
<p>Solutions to the exercises are available to all Rails Tutorial purchasers at <a href="https://www.railstutorial.org/aw-solutions">https://www.railstutorial.org/aw-solutions</a>.</p>
<p class="indent">To see other peoples answers and to record your own, subscribe to the Rails Tutorial course or to the Learn Enough All Access Bundle.</p>
<ol class="num">
<li><p class="num">Follow the link in the email from the server log in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#sec12_2_1">Section 12.2.1</a>. Does it properly render the form as shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12fig011">Figure 12.11</a>?</p></li>
<li><p class="num">What happens if you submit the form from the previous exercise?<span epub:type="pagebreak" id="page_610"></span></p></li>
</ol>
</section>
</section>
<section>
<h4 class="h4" id="sec12_3_2">12.3.2 Updating the Reset</h4>
<p class="noindent">Unlike the Account Activations <code><strong><span class="colork1">edit</span></strong></code> method, which simply toggles the user from inactive to active, the <code><strong><span class="colork1">edit</span></strong></code> method for Password Resets is a form, which must therefore submit to a corresponding <code><strong><span class="colork1">update</span></strong></code> action. To define this <code><strong><span class="colork1">update</span></strong></code> action, we need to consider four cases:</p>
<ol class="num">
<li><p class="num">An expired password reset</p></li>
<li><p class="num">A failed update due to an invalid password</p></li>
<li><p class="num">A failed update (which initially looks successful) due to an empty password and confirmation</p></li>
<li><p class="num">A successful update</p></li>
</ol>
<p class="noindent">Cases (1), (2), and (4) are fairly straightforward, but Case (3) is non-obvious and is explained in more detail below.<span epub:type="pagebreak" id="page_611"></span></p>
<p class="indent">Case (1) applies to both the <code><strong><span class="colork1">edit</span></strong></code> and <code><strong><span class="colork1">update</span></strong></code> actions, and so logically belongs in a before filter:</p>
<p class="codelink"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12_images.xhtml#pg611-1a" id="pg611-1">Click here to view code image</a></p>
<pre class="pre1">before_action <span class="colork8">:check_expiration</span>, <span class="colork8">only</span>: <span class="colork8">[:edit</span>, <span class="colork8">:update]</span> <span class="colork8"># Case (1)</span></pre>
<p class="noindent">This requires defining a private <code><strong><span class="colork1">check_expiration</span></strong></code> method:</p>
<p class="codelink"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12_images.xhtml#pg611-2a" id="pg611-2">Click here to view code image</a></p>
<pre class="pre1"><span class="colork18"># Checks expiration of reset token.</span>
<strong><span class="colork10">def</span></strong> <span class="colork4">check_expiration</span>
  <strong><span class="colork10">if</span></strong> <span class="colork8">@user.</span>password_reset_expired?
    flash<span class="colork8">[:danger] =</span> <span class="colork22">"Password reset has expired."</span>
    redirect_to new_password_reset_url
  <strong><span class="colork10">end</span></strong>
<strong><span class="colork10">end</span></strong></pre>
<p class="noindent">In the <code><strong><span class="colork1">check_expiration</span></strong></code> method, weve deferred the expiration check to the instance method <code><strong><span class="colork1">password_reset_expired?</span></strong></code>, which is a little tricky and will be defined in a moment.</p>
<p class="indent"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex016">Listing 12.16</a> shows the implementation of these filters, together with the <code><strong><span class="colork1">update</span></strong></code> action that implements Cases (2)(4). Case (2) gets handled by a failed update, with the error messages from the shared partial in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex014">Listing 12.14</a> being displayed automatically when the <code><strong><span class="colork1">edit</span></strong></code> form is re-rendered. Case (4) corresponds to a successful change, and the result is similar to a successful login (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex032">Listing 8.32</a>).</p>
<p class="indent">The only failure case not handled by Case (2) is when the password is empty, which is currently allowed by our User model (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch10.xhtml#ch10ex013">Listing 10.13</a>); thus, this error needs to be caught and handled explicitly.<sup><a id="ch12fn3a" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12fn3" class="totri-footnote">3</a></sup> This is Case (3). Our method in this case is to add an error directly to the <code><strong><span class="colork1">@user</span></strong></code> objects error messages using <code><strong><span class="colork1">errors.add</span></strong></code>:</p>
<p class="footnote"><a id="ch12fn3" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12fn3a" class="totri-footnote">3</a>. We need handle only the case where the password is empty because if the confirmation is empty, the confirmation validation (which is skipped if the password is empty) will catch the problem and supply a relevant error message.</p>
<p class="codelink"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12_images.xhtml#pg611-3a" id="pg611-3">Click here to view code image</a></p>
<pre class="pre1"><span class="colork8">@user.</span>errors.add(<span class="colork8">:password</span>, <span class="colork8">:blank</span>)</pre>
<p class="noindent">This arranges to use the default message for blank content when the password is empty.<sup><a id="ch12fn4a" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12fn4" class="totri-footnote">4</a></sup></p>
<p class="footnote"><a id="ch12fn4" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12fn4a" class="totri-footnote">4</a>. Alert reader Khaled Teilab has noted that one advantage of using <code><strong><span class="colork1">errors.add(:password, :blank)</span></strong></code> is that the resulting message is automatically rendered in the correct language when using the <code>rails-i18n</code> gem.<span epub:type="pagebreak" id="page_612"></span></p>
<p class="indent">The result of putting Cases (1)(4) together is the <code><strong><span class="colork1">update</span></strong></code> action shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex016">Listing 12.16</a>.</p>
<p class="ex-title" id="ch12ex016"><strong>Listing 12.16:</strong> The <code><strong><span class="colork1">update</span></strong></code> action for password reset.</p>
<pre class="pre2">app/controllers/password_resets_controller.rb</pre>
<p class="codelink"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12_images.xhtml#lis12-16a" id="lis12-16">Click here to view code image</a></p>
<div class="example">
<pre><strong><span class="colork10">class</span> <span class="colork4">PasswordResetsController</span></strong> <span class="colork11">&lt; ApplicationController</span>
  before_action <span class="colork8">:get_user</span>,         <span class="colork8">only</span>: <span class="colork8">[:edit</span>, <span class="colork8">:update]</span>
  before_action <span class="colork8">:valid_user</span>,       <span class="colork8">only</span>: <span class="colork8">[:edit</span>, <span class="colork8">:update]</span>
<span class="mark">  before_action :check_expiration, only: [:edit, :update] <span class="colork23"># Case (1)</span></span>

  <strong><span class="colork10">def</span></strong> <span class="colork4">new</span>
  <strong><span class="colork10">end</span></strong>

  <strong><span class="colork10">def</span></strong> <span class="colork4">create</span>
    <span class="colork8">@user = User.</span>find_by(<span class="colork8">email:</span> params<span class="colork8">[:password_reset][:email]</span><span class="colork9">.</span>downcase)
    <strong><span class="colork10">if</span></strong> <span class="colork8">@user</span>
      <span class="colork8">@user.</span>create_reset_digest
      <span class="colork8">@user.</span>send_password_reset_email
      flash<span class="colork8">[:info] =</span> <span class="colork22">"Email sent with password reset instructions"</span>
      redirect_to root_url
    <strong><span class="colork10">else</span></strong>
      flash.now<span class="colork8">[:danger] =</span> <span class="colork22">"Email address not found"</span>
      render <span class="colork22">'new'</span>
    <strong><span class="colork10">end</span></strong>
  <strong><span class="colork10">end</span></strong>

  <strong><span class="colork10">def</span></strong> <span class="colork4">edit</span>
  <strong><span class="colork10">end</span></strong>

  <strong><span class="colork10">def</span></strong> <span class="colork4">update</span>
<span class="mark">    <strong><span class="colork10">if</span></strong> params[ <span class="colork8">:user</span>][ <span class="colork8">:password</span>].empty?            <span class="colork23"># Case (3)</span></span>
      <span class="colork8">@user.</span>errors<span class="colork9">.</span>add(<span class="colork8">:password</span>, <span class="colork22">"can't be empty"</span>)
      render <span class="colork22">'edit'</span>
<span class="mark">    <strong><span class="colork10">elsif</span></strong> <span class="colork8">@user.</span>update(user_params)                 <span class="colork23"># Case (4)</span></span>
      log_in <span class="colork8">@user</span>
      flash<span class="colork8">[:success] =</span> <span class="colork22">"Password has been reset."</span>
      redirect_to <span class="colork8">@user</span>
    <strong><span class="colork10">else</span></strong>
<span class="mark">      render <span class="colork22">'edit'</span>                                 <span class="colork23"># Case (2)</span></span>
    <strong><span class="colork10">end</span></strong>
  <strong><span class="colork10">end</span></strong>

  <strong><span class="colork10">private</span></strong>

    <strong><span class="colork10">def</span></strong> <span class="colork4">user_params</span>
<span epub:type="pagebreak" id="page_613"></span><span class="mark">      params.require( :user).permit( :password, :password_confirmation)</span>
    <strong><span class="colork10">end</span></strong>

    <span class="colork18"># Before filters</span>

    <strong><span class="colork10">def</span></strong> <span class="colork4">get_user</span>
      <span class="colork8">@user =</span> <span class="colork5">User.</span>find_by(<span class="colork8">email</span>: params<span class="colork8">[:email]</span>)
    <strong><span class="colork10">end</span></strong>

    <span class="colork18"># Confirms a valid user.</span>
    <strong><span class="colork10">def</span></strong> <span class="colork4">valid_user</span>
      <strong><span class="colork10">unless</span></strong> (<span class="colork8">@user &amp;&amp; @user</span><span class="colork9">.</span>activated? <span class="colork8">&amp;&amp;</span>
              <span class="colork8">@user.</span>authenticated?(<span class="colork8">:reset</span>, params<span class="colork8">[:id]</span>))
        redirect_to root_url
      <strong><span class="colork10">end</span></strong>
    <strong><span class="colork10">end</span></strong>

    <span class="colork18"># Checks expiration of reset token.</span>
<span class="mark">    <strong><span class="colork10">def</span></strong> <span class="colork4">check_expiration</span></span>
      <strong><span class="colork10">if</span></strong> <span class="colork8">@user.</span>password_reset_expired?
        flash[<span class="colork8">:danger</span>] <span class="colork22">= "Password reset has expired."</span>
        redirect_to new_password_reset_url
      <strong><span class="colork10">end</span></strong>
    <strong><span class="colork10">end</span></strong>
<strong><span class="colork10">end</span></strong></pre>
</div>
<p class="noindent">Note that weve added a <code><strong><span class="colork1">user_params</span></strong></code> method permitting both the password and password confirmation attributes (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#sec7_3_2">Section 7.3.2</a>).</p>
<p class="indent">As noted earlier, the implementation in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex016">Listing 12.16</a> delegates the boolean test for password reset expiration to the User model via the code</p>
<pre class="pre1"><span class="colork8">@user.</span>password_reset_expired?</pre>
<p class="noindent">To get this to work, we need to define the <code><strong><span class="colork1">password_reset_expired?</span></strong></code> method. As indicated in the email templates from <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#sec12_2_1">Section 12.2.1</a>, well consider a password reset to be expired if it was sent more than two hours ago. We can express this condition in Ruby as follows:</p>
<pre class="pre1">reset_sent_at <span class="colork8">&lt; 2.</span>hours<span class="colork9">.</span>ago</pre>
<p class="noindent">This can be confusing if you read <code><strong><span class="colork1">&lt;</span></strong></code> as less than, because then it sounds like Password reset sent less than two hours ago, which is the opposite of what we want. In this <span epub:type="pagebreak" id="page_614"></span>context, its better to read <code><strong><span class="colork1">&lt;</span></strong></code> as earlier than, which gives something like Password reset sent earlier than two hours ago. That <em>is</em> what we want, and it leads to the <code><strong><span class="colork1">password_reset_expired?</span></strong></code> method in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex017">Listing 12.17</a>. (For a formal demonstration that the comparison is correct, see the proof in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#sec12_6">Section 12.6</a>.)</p>
<p class="ex-title" id="ch12ex017"><strong>Listing 12.17:</strong> Adding password reset methods to the User model.</p>
<pre class="pre2">app/models/user.rb</pre>
<p class="codelink"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12_images.xhtml#lis12-17a" id="lis12-17">Click here to view code image</a></p>
<div class="example">
<pre><strong><span class="colork10">class</span> <span class="colork4">User</span></strong> <span class="colork11">&lt; ApplicationRecord</span>
  <strong><span class="colork9">.</span></strong>
  <strong><span class="colork9">.</span></strong>
  <strong><span class="colork9">.</span></strong>
  <span class="colork18"># Returns true if a password reset has expired.</span>
  <strong><span class="colork10">def</span></strong> <span class="colork4">password_reset_expired?</span>
<span class="mark">    reset_sent_at &lt; 2.hours.ago</span>
  <strong><span class="colork10">end</span></strong>

  <strong><span class="colork10">private</span></strong>
    <strong><span class="colork9">.</span></strong>
    <strong><span class="colork9">.</span></strong>
    <strong><span class="colork9">.</span></strong>
<strong><span class="colork10">end</span></strong></pre>
</div>
<p class="indent">With the code in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex017">Listing 12.17</a>, the <code><strong><span class="colork1">update</span></strong></code> action in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex016">Listing 12.16</a> should be working. The results for invalid and valid submissions are shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12fig012">Figure 12.12</a> and <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12fig013">Figure 12.13</a>, respectively. (Lacking the patience to wait two hours, well cover the third branch in a test, which is left as an exercise (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#sec12_3_3">Section 12.3.3</a>).)</p>
<figure id="ch12fig012" class="image-l">
<img src="./Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition_files/fig12_12.jpg" alt="Image" width="677" height="523" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig12_12.jpg">
<figcaption><p><strong>Figure 12.12:</strong> A failed password reset.</p></figcaption>
</figure>
<figure id="ch12fig013" class="image-l">
<img src="./Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition_files/fig12_13.jpg" alt="Image" width="677" height="523" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig12_13.jpg">
<figcaption><p><strong>Figure 12.13:</strong> A successful password reset.</p></figcaption>
</figure>
<section>
<h5 class="h5" id="lev144">Exercises</h5>
<p>Solutions to the exercises are available to all Rails Tutorial purchasers at <a href="https://www.railstutorial.org/aw-solutions">https://www.railstutorial.org/aw-solutions</a>.</p>
<p class="indent">To see other peoples answers and to record your own, subscribe to the Rails Tutorial course or to the Learn Enough All Access Bundle.</p>
<ol class="num">
<li><p class="num">Follow the email link from <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#sec12_2_1">Section 12.2.1</a> again and submit mismatched passwords to the form. What is the error message?</p></li>
<li><p class="num">In the console, find the user belonging to the email link, and retrieve the value of the <code><strong><span class="colork1">password_digest</span></strong></code> attribute. Now submit valid matching passwords to the form shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12fig012">Figure 12.12</a>. Did the submission appear to work? How did it affect the value of <code><strong><span class="colork1">password_digest</span></strong></code>? <em>Hint</em>: Use <code><strong><span class="colork1">user.reload</span></strong></code> to retrieve the new value.<span epub:type="pagebreak" id="page_615"></span></p></li>
</ol>
</section>
</section>
<section>
<h4 class="h4" id="sec12_3_3">12.3.3 Password Reset Test</h4>
<p class="noindent">In this section, well write an integration test covering two of the three branches in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex016">Listing 12.16</a>, invalid and valid submission. (As noted earlier, testing the third branch is left as an exercise (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#sec12_3_3">Section 12.3.3</a>).) Well get started by generating a test file for password resets:</p>
<p class="codelink"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12_images.xhtml#pg615a" id="pg615">Click here to view code image</a></p>
<pre class="pre1"><strong><span class="colork4">$</span></strong> rails generate integration_test password_resets
      <span class="colork5">invoke  test_unit</span>
      <span class="colork5">create    test/integration/password_resets_test.rb</span></pre>
<p class="indent">The steps to test password resets broadly parallel the test for account activation from <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch11.xhtml#ch11ex033">Listing 11.33</a>, though there is a difference at the outset: We first visit the forgot password form and submit invalid and then valid email addresses, the latter of which creates a password reset token and sends the reset email. We then visit the link from the <span epub:type="pagebreak" id="page_616"></span>email and again submit invalid and valid information, verifying the correct behavior in each case. The resulting test, shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex018">Listing 12.18</a>, is an excellent exercise in reading code.</p>
<p class="ex-title" id="ch12ex018"><strong>Listing 12.18:</strong> An integration test for password resets.</p>
<pre class="pre2">test/integration/password_resets_test.rb</pre>
<p class="codelink"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12_images.xhtml#lis12-18a" id="lis12-18">Click here to view code image</a></p>
<div class="example">
<pre><span class="colork10">require</span> <span class="colork22">'test_helper'</span>

<strong><span class="colork10">class</span> <span class="colork4">PasswordResetsTest</span></strong> <span class="colork11">&lt; ActionDispatch::IntegrationTest</span>

  <strong><span class="colork10">def</span></strong> <span class="colork4">setup</span>
    <span class="colork5">ActionMailer::Base.</span>deliveries<span class="colork9">.</span>clear
    <span class="colork8">@user =</span> users(<span class="colork8">:michael</span>)
  <strong><span class="colork10">end</span></strong>
<span epub:type="pagebreak" id="page_617"></span>  <span class="colork8">test</span> <span class="colork11">"password resets"</span> <strong><span class="colork10">do</span></strong>
    get new_password_reset_path
    assert_template <span class="colork11">'password_resets/new'</span>
    assert_select <span class="colork11">'input[name=?]'</span>, <span class="colork11">'password_reset[email]'</span>
    <span class="colork18"># Invalid email</span>
    post password_resets_path, <span class="colork8">params</span>: { <span class="colork8">password_reset</span>: { <span class="colork8">email</span>: <span class="colork22">""</span> } }
    assert_not flash<span class="colork9">.</span>empty?
    assert_template <span class="colork22">'password_resets/new'</span>
    <span class="colork18"># Valid email</span>
    post password_resets_path,
         <span class="colork8">params</span>: { <span class="colork8">password_reset</span>: { <span class="colork8">email</span>: <span class="colork8">@user.</span>email } }
    assert_not_equal <span class="colork8">@user.</span>reset_digest, <span class="colork8">@user.</span>reload.reset_digest
    assert_equal <span class="colork5">1, ActionMailer::Base.</span>deliveries.size
    assert_not flash.empty?
    assert_redirected_to root_url
    <span class="colork18"># Password reset form</span>
    user = assigns(:user)
    <span class="colork18"># Wrong email</span>
    get edit_password_reset_path(user.reset_token, <span class="colork8">email</span>: <span class="colork22">""</span>)
    assert_redirected_to root_url
    <span class="colork18"># Inactive user</span>
    user.toggle!(:<span class="colork8">activated</span>)
    get edit_password_reset_path(user<span class="colork9">.</span>reset_token, <span class="colork8">email</span>: user<span class="colork9">.</span>email)
    assert_redirected_to root_url
    user.toggle!(<span class="colork8">:activated</span>)
    <span class="colork18"># Right email, wrong token</span>
    get edit_password_reset_path(<span class="colork22">'wrong token'</span>, <span class="colork8">email</span>: user.email)
    assert_redirected_to root_url
    <span class="colork18"># Right email, right token</span>
    get edit_password_reset_path(user.reset_token, <span class="colork8">email</span>: user<span class="colork9">.</span>email)
    assert_template <span class="colork22">'password_resets/edit'</span>
    assert_select <span class="colork22">"input[name=email][type=hidden][value=?]"</span>, user<span class="colork9">.</span>email
    <span class="colork18"># Invalid password &amp; confirmation</span>
    patch password_reset_path(user.reset_token),
          <span class="colork8">params</span>: { <span class="colork8">email</span>: user<span class="colork9">.</span>email,
                    user: { <span class="colork8">password</span>:              <span class="colork22">"foobaz"</span>,
                            <span class="colork8">password_confirmation</span>: <span class="colork22">"barquux"</span> } }
    assert_select <span class="colork22">'div#error_explanation'</span>
    <span class="colork18"># Empty password</span>
    patch password_reset_path(user.reset_token),
          <span class="colork8">params</span>: { <span class="colork8">email</span>: user<span class="colork9">.</span>email,
                    <span class="colork8">user</span>: { <span class="colork8">password</span>:              <span class="colork22">""</span>,
                            <span class="colork8">password_confirmation</span>: <span class="colork22">""</span> } }
    assert_select <span class="colork22">'div#error_explanation'</span>
    <span class="colork18"># Valid password &amp; confirmation</span>
    patch password_reset_path(user<span class="colork9">.</span>reset_token),
          <span class="colork8">params</span>: { <span class="colork8">email</span>: user<span class="colork9">.</span>email,
                    <span class="colork8">user</span>: { <span class="colork8">password</span>:              <span class="colork22">"foobaz"</span>,
<span epub:type="pagebreak" id="page_618"></span>                            <span class="colork8">password_confirmation</span>: <span class="colork22">"foobaz"</span> } }
    assert is_logged_in?
    assert_not flash.empty?
    assert_redirected_to user
  <strong><span class="colork10">end</span></strong>
<strong><span class="colork10">end</span></strong></pre>
</div>
<p class="indent">Most of the ideas in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex018">Listing 12.18</a> have appeared previously in this tutorial; the only really novel element is the test of the <code><strong><span class="colork1">input</span></strong></code> tag:</p>
<p class="codelink"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12_images.xhtml#pg618-1a" id="pg618-1">Click here to view code image</a></p>
<pre class="pre1">assert_select <span class="colork5">"input[name=email][type=hidden][value=?]"</span>, user<span class="colork9">.</span>email</pre>
<p class="noindent">This makes sure that there is an <code><strong><span class="colork1">input</span></strong></code> tag with the right name, (hidden) type, and email address:</p>
<p class="codelink"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12_images.xhtml#pg618-2a" id="pg618-2">Click here to view code image</a></p>
<pre class="pre1">&lt;<strong><span class="colork10">input</span></strong> <span class="colork22">id</span><span class="colork9">=</span><span class="colork23">"email"</span> <span class="colork22">name</span><span class="colork9">=</span><span class="colork23">"email"</span> <span class="colork22">type</span><span class="colork9">=</span><span class="colork23">"hidden"</span> <span class="colork22">value</span><span class="colork9">=</span><span class="colork23">"michael@example.com"</span> /&gt;</pre>
<p class="indent">With the code as in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex018">Listing 12.18</a>, our test suite should be <small><span class="colork14">GREEN</span></small>:</p>
<p class="ex-title" id="ch12ex019"><strong>Listing 12.19:</strong> <small><span class="colork14">GREEN</span></small></p>
<div class="example">
<pre>$ rails test</pre>
</div>
<section>
<h5 class="h5" id="lev145">Exercises</h5>
<p>Solutions to the exercises are available to all Rails Tutorial purchasers at <a href="https://www.railstutorial.org/aw-solutions">https://www.railstutorial.org/aw-solutions</a>.</p>
<p class="indent">To see other peoples answers and to record your own, subscribe to the Rails Tutorial course or to the Learn Enough All Access Bundle.</p>
<ol class="num">
<li><p class="num">In <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex06">Listing 12.6</a>, the <code><strong><span class="colork1">create_reset_digest</span></strong></code> method makes two calls to <code><strong><span class="colork1">update_attribute</span></strong></code>, each of which requires a separate database operation. By filling in the template shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex020">Listing 12.20</a>, replace the two <code><strong><span class="colork1">update_attribute</span></strong></code> calls with a single call to <code><strong><span class="colork1">update_columns</span></strong></code>, which hits the database only once. After making the changes, verify that the test suite is still <small><span class="colork14">GREEN</span></small>. (For convenience, <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex020">Listing 12.20</a> includes the results of solving the exercise in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch11.xhtml#ch11ex039">Listing 11.39</a>.)</p></li>
<li><p class="num">Write an integration test for the expired password reset branch in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex016">Listing 12.16</a> by filling in the template shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex021">Listing 12.21</a>. (This code introduces <code><strong><span class="colork1">response.body</span></strong></code>, which returns the full HTML body of the page.) There are <span epub:type="pagebreak" id="page_619"></span>many ways to test for the result of an expiration, but the method suggested by <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex021">Listing 12.21</a> is to (case-insensitively) check that the response body includes the word expired.</p></li>
<li><p class="num">Expiring password resets after a couple of hours is a nice security precaution, but an even more secure solution is available for cases where a public computer is used. The reason is that the password reset link remains active for two hours and can be used even if logged out. If a user reset their password from a public machine, anyone could press the back button and change the password (and get logged in to the site). To fix this, add the code shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex022">Listing 12.22</a> to clear the reset digest on successful password update.<sup><a id="ch12fn5a" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12fn5" class="totri-footnote">5</a></sup></p>
<p class="footnote"><a id="ch12fn5" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12fn5a" class="totri-footnote">5</a>. Thanks to reader Tristan Ludowyk for suggesting this feature and for providing both a detailed description and a suggested implementation.</p></li>
<li><p class="num">Add a line to <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex018">Listing 12.18</a> to test for the clearing of the reset digest in the previous exercise. <em>Hint</em>: Combine <code><strong><span class="colork1">assert_nil</span></strong></code> (first seen in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch09.xhtml#ch09ex025">Listing 9.25</a>) with <code><strong><span class="colork1">user.reload</span></strong></code> (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch11.xhtml#ch11ex033">Listing 11.33</a>) to test the <code><strong><span class="colork1">reset_digest</span></strong></code> attribute directly.</p></li>
</ol>
<p class="ex-title" id="ch12ex020"><strong>Listing 12.20:</strong> A template for using <code><strong><span class="colork1">update_columns</span></strong></code>.</p>
<pre class="pre2">app/models/user.rb</pre>
<p class="codelink"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12_images.xhtml#lis12-20a" id="lis12-20">Click here to view code image</a></p>
<div class="example">
<pre><strong><span class="colork10">class</span> <span class="colork4">User</span></strong> <span class="colork11">&lt; ApplicationRecord</span>
  <strong><span class="colork10">attr_accessor</span></strong> :<span class="colork8">remember_token</span>, :<span class="colork8">activation_token</span>, :<span class="colork8">reset_token</span>
  before_save <span class="colork8">:downcase_email</span>
  before_create <span class="colork8">:create_activation_digest</span>
  <span class="colork9">.</span>
  <span class="colork9">.</span>
  <span class="colork9">.</span>
  <span class="colork18"># Activates an account.</span>
  <strong><span class="colork10">def</span></strong> <span class="colork4">activate</span>
    update_columns(<span class="colork8">activated</span>: <strong><span class="colork10">true</span></strong>, <span class="colork8">activated_at</span>: <span class="colork22">Time</span><span class="colork9">.</span>zone<span class="colork9">.</span>now)
  <strong><span class="colork10">end</span></strong>

  <span class="colork18"># Sends activation email.</span>
  <strong><span class="colork10">def</span></strong> <span class="colork4">send_activation_email</span>
    <span class="colork22">UserMailer</span>.account_activation(<span class="colork22">self</span>)<span class="colork9">.</span>deliver_now
  <strong><span class="colork10">end</span></strong>

  <span class="colork18"># Sets the password reset attributes.</span>
  <strong><span class="colork10">def</span></strong> <span class="colork4">create_reset_digest</span>
    <span class="colork22">self.</span>reset_token <span class="colork22">= User.</span>new_token
<span epub:type="pagebreak" id="page_620"></span><span class="mark">    update_columns( <span class="colork8">reset_digest</span>: <span class="colork23">FILL_IN</span>, reset_sent_at: <span class="colork23">FILL_IN</span>)</span>
  <strong><span class="colork10">end</span></strong>

  <span class="colork18"># Sends password reset email.</span>
  <strong><span class="colork10">def</span></strong> <span class="colork4">send_password_reset_email</span>
    <span class="colork22">UserMailer.</span>password_reset(<span class="colork22">self</span>).deliver_now
  <strong><span class="colork10">end</span></strong>

  <strong><span class="colork10">private</span></strong>

    <span class="colork18"># Converts email to all lowercase.</span>
    <strong><span class="colork10">def</span></strong> <span class="colork4">downcase_email</span>
      <span class="colork8">self.</span>email <span class="colork9">=</span> email.downcase
    <strong><span class="colork10">end</span></strong>

    <span class="colork18"># Creates and assigns the activation token and digest.</span>
    <strong><span class="colork10">def</span></strong> <span class="colork4">create_activation_digest</span>
      <span class="colork22">self.</span>activation_token <span class="colork22">= User.</span>new_token
      <span class="colork22">self.</span>activation_digest <span class="colork22">= User.</span>digest(activation_token)
    <strong><span class="colork10">end</span></strong>
<strong><span class="colork10">end</span></strong></pre>
</div>
<p class="ex-title" id="ch12ex021"><strong>Listing 12.21:</strong> A test for an expired password reset. <small><span class="colork14">GREEN</span></small></p>
<pre class="pre2">test/integration/password_resets_test.rb</pre>
<p class="codelink"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12_images.xhtml#lis12-21a" id="lis12-21">Click here to view code image</a></p>
<div class="example">
<pre><span class="colork10">require</span> <span class="colork22">'test_helper'</span>

<strong><span class="colork8">class</span> <span class="colork4">PasswordResetsTest</span></strong> <span class="colork11">&lt; ActionDispatch::IntegrationTest</span>

  <strong><span class="colork10">def</span></strong> <span class="colork4">setup</span>
    <span class="colork22">ActionMailer::Base.</span>deliveries<span class="colork9">.</span>clear
    <span class="colork8">@user =</span> users(:<span class="colork8">michael</span>)
  <strong><span class="colork10">end</span></strong>
  <span class="colork9">.</span>
  <span class="colork9">.</span>
  <span class="colork9">.</span>
  <span class="colork8">test</span> <span class="colork22">"expired token"</span> <strong><span class="colork10">do</span></strong>
    get new_password_reset_path
    post password_resets_path,
         <span class="colork8">params</span>: { <span class="colork8">password_reset</span>: { <span class="colork8">email</span>: <span class="colork8">@user.</span>email } }

    <span class="colork8">@user =</span> assigns(<span class="colork8">:user</span>)
    <span class="colork8">@user.</span>update_attribute(<span class="colork8">:reset_sent_at</span>, <span class="colork8">3.</span>hours<span class="colork9">.</span>ago)
    patch password_reset_path(<span class="colork8">@user.</span>reset_token),
          <span class="colork8">params</span>: { <span class="colork8">email</span>: <span class="colork8">@user</span>.email,
                    <span class="colork8">user</span>: { <span class="colork8">password</span>:              <span class="colork22">"foobar"</span>,
<span epub:type="pagebreak" id="page_621"></span>                            <span class="colork8">password_confirmation</span>: <span class="colork22">"foobar"</span> } }
    assert_response <span class="colork8">:redirect</span>
    follow_redirect!
<span class="mark">    assert_match <span class="colork22">/FILL_IN/i</span>, response.body</span>
  <strong><span class="colork10">end</span></strong>
<strong><span class="colork10">end</span></strong></pre>
</div>
<p class="ex-title" id="ch12ex022"><strong>Listing 12.22:</strong> Clearing the reset digest on successful password reset.</p>
<pre class="pre2">app/controllers/password_resets_controller.rb</pre>
<p class="codelink"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12_images.xhtml#lis12-22a" id="lis12-22">Click here to view code image</a></p>
<div class="example">
<pre><strong><span class="colork10">class</span> <span class="colork4">PasswordResetsController</span></strong> <span class="colork11">&lt; ApplicationController</span>
  <span class="colork9">.</span>
  <span class="colork9">.</span>
  <span class="colork9">.</span>
  <strong><span class="colork10">def</span></strong> <span class="colork4">update</span>
    <strong><span class="colork10">if</span></strong> params<span class="colork8">[:user][:password].</span>empty?
      <span class="colork8">@user.</span>errors.add(<span class="colork8">:password</span>, <span class="colork22">"can't be empty"</span>)
      render <span class="colork22">'edit'</span>
    <strong><span class="colork10">elsif</span></strong> <span class="colork8">@user.</span>update(user_params)
      log_in <span class="colork8">@user</span>
<span class="mark">      @user.update_attribute(:reset_digest, <strong><span class="colork10">nil</span></strong>)</span>
      flash<span class="colork8">[:success] =</span> <span class="colork20">"Password has been reset."</span>
      redirect_to <span class="colork8">@user</span>
    <strong><span class="colork10">else</span></strong>
      render <span class="colork22">'edit'</span>
    <strong><span class="colork10">end</span></strong>
  <strong><span class="colork10">end</span></strong>
  <span class="colork9">.</span>
  <span class="colork9">.</span>
  <span class="colork9">.</span>
<strong><span class="colork10">end</span></strong></pre>
</div>
</section>
</section>
</section>
<section>
<h3 class="h3" id="sec12_4">12.4 Email in Production (Take Two)</h3>
<p class="noindent">Now that weve got password resets working in development, in this section well get them working in production as well. The steps are exactly the same as for account activations, so if you already worked through <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch11.xhtml#sec11_4">Section 11.4</a> you can skip right to <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex024">Listing 12.24</a>.</p>
<p class="indent">To send email in production, well use SendGrid, which is available as an addon at Heroku for verified accounts. (Using SendGrid requires adding credit card information to your Heroku account, but there is no charge when verifying an <span epub:type="pagebreak" id="page_622"></span>account.) For our purposes, the starter tier (which as of this writing is limited to 400 emails a day but costs nothing) is the best fit. We can add it to our app as follows:</p>
<p class="codelink"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12_images.xhtml#pg622a" id="pg622">Click here to view code image</a></p>
<pre class="pre1"><strong><span class="colork4">$</span></strong> heroku addons:create sendgrid:starter</pre>
<p class="noindent">(This might fail on systems with older version of Herokus command-line interface. In this case, either upgrade to the latest Heroku toolbelt or try the older syntax <code><strong><span class="colork1">heroku addons:add sendgrid:starter</span></strong></code>.)</p>
<p class="indent">To configure our application to use SendGrid, we need to fill out the SMTP settings for our production environment. As shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex023">Listing 12.23</a>, you will also have to define a <code><strong><span class="colork1">host</span></strong></code> variable with the address of your production website.</p>
<p class="ex-title" id="ch12ex023"><strong>Listing 12.23:</strong> Configuring Rails to use SendGrid in production.</p>
<pre class="pre2">config/environments/production.rb</pre>
<p class="codelink"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12_images.xhtml#lis12-23a" id="lis12-23">Click here to view code image</a></p>
<div class="example">
<pre><span class="colork5">Rails.</span>application.configure <strong><span class="colork10">do</span></strong>
  <span class="colork9">.</span>
  <span class="colork9">.</span>
  <span class="colork9">.</span>
  config<span class="colork9">.</span>action_mailer<span class="colork9">.</span>raise_delivery_errors <span class="colork9">=</span> <strong><span class="colork10">true</span></strong>
  config<span class="colork9">.</span>action_mailer<span class="colork9">.</span>delivery_method <span class="colork9">=</span> :<span class="colork8">smtp</span>
  host <span class="colork9">=</span> <span class="colork22">'&lt;your heroku app&gt;.herokuapp.com'</span>
  config<span class="colork9">.</span>action_mailer<span class="colork9">.</span>default_url_options = { <span class="colork8">host</span>: host }
  <span class="colork5">ActionMailer::Base</span>.smtp_settings <span class="colork9">=</span> {
    <span class="colork8">:address        =&gt;</span> <span class="colork22">'smtp.sendgrid.net'</span>,
    <span class="colork8">:port           =&gt;</span> <span class="colork22">'587'</span>,
    <span class="colork8">:authentication =&gt;</span> <span class="colork22">:plain</span>,
    <span class="colork8">:user_name      =&gt;</span> <span class="colork22">ENV['SENDGRID_USERNAME']</span>,
    <span class="colork8">:password       =&gt;</span> <span class="colork22">ENV['SENDGRID_PASSWORD']</span>,
    <span class="colork8">:domain         =&gt;</span> <span class="colork22">'heroku.com'</span>,
    <span class="colork8">:enable_starttls_auto =&gt;</span> <strong><span class="colork10">true</span></strong>
  }
  <span class="colork9">.</span>
  <span class="colork9">.</span>
  <span class="colork9">.</span>
<strong><span class="colork10">end</span></strong></pre>
</div>
<p class="indent">The email configuration in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch11.xhtml#ch11ex041">Listing 11.41</a> includes the <code><strong><span class="colork1">user_name</span></strong></code> and <code><strong><span class="colork1">password</span></strong></code> of the SendGrid account, but note that they are accessed via the <code><strong><span class="colork1">ENV</span></strong></code> environment variable instead of being hard-coded. This is a best practice for production applications, which for security reasons should never expose sensitive information such as <span epub:type="pagebreak" id="page_623"></span>raw passwords in source code. In the present case, these variables are configured automatically via the SendGrid add-on, but well see an example in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch13.xhtml#sec13_4_4">Section 13.4.4</a> where well have to define them ourselves.</p>
<p class="indent">At this point, you should merge the topic branch into <code><strong><span class="colork1">master</span></strong></code> (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex024">Listing 12.24</a>).</p>
<p class="ex-title" id="ch12ex024"><strong>Listing 12.24:</strong> Merging the <code><strong><span class="colork1">password-reset</span></strong></code> branch into <code><strong><span class="colork1">master</span></strong></code>.</p>
<p class="codelink"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12_images.xhtml#lis12-24a" id="lis12-24">Click here to view code image</a></p>
<div class="example">
<pre>$ rails test
$ git add -A
$ git commit -m "Add password reset"
$ git checkout master
$ git merge password-reset</pre>
</div>
<p class="indent">Then push up to the remote repository and deploy to Heroku:</p>
<p class="codelink"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12_images.xhtml#pg623a" id="pg623">Click here to view code image</a></p>
<pre class="pre1">$ rails test
$ git push &amp;&amp; git push heroku
$ heroku run rails db:migrate</pre>
<p class="indent">Once the Heroku deploy has finished, you can reset your password by clicking the (forgot password) link (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12fig04">Figure 12.4</a>). The result should be a reset email, as shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12fig014">Figure 12.14</a>. Following the link and making invalid or valid submissions should work as it did in development (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12fig012">Figure 12.12</a> and <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12fig013">Figure 12.13</a>). Likewise, upon successfully changing the password, the user should be redirected to the profile page (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12fig015">Figure 12.15</a>).</p>
<figure id="ch12fig014" class="image-l">
<img src="./Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition_files/fig12_14.jpg" alt="Image" width="677" height="270" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig12_14.jpg">
<figcaption><p><strong>Figure 12.14:</strong> A password reset email sent in production.<span epub:type="pagebreak" id="page_624"></span></p></figcaption>
</figure>
<figure id="ch12fig015" class="image-l">
<img src="./Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition_files/fig12_15.jpg" alt="Image" width="677" height="523" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig12_15.jpg">
<figcaption><p><strong>Figure 12.15:</strong> The result of a successful password reset in production.</p></figcaption>
</figure>
<section>
<h5 class="h5" id="lev146">Exercises</h5>
<p>Solutions to the exercises are available to all Rails Tutorial purchasers at <a href="https://www.railstutorial.org/aw-solutions">https://www.railstutorial.org/aw-solutions</a>.</p>
<p class="indent">To see other peoples answers and to record your own, subscribe to the Rails Tutorial course or to the Learn Enough All Access Bundle.</p>
<ol class="num">
<li><p class="num">Sign up for a new account in production. Did you get the email?</p></li>
<li><p class="num">Click on the link in the activation email to confirm that it works. What is the corresponding entry in the server log? <em>Hint</em>: Run <code><strong><span class="colork1">heroku logs</span></strong></code> at the command line.</p></li>
<li><p class="num">Are you able to successfully update your password?</p></li>
</ol>
</section>
</section>
<section>
<h3 class="h3" id="sec12_5">12.5 Conclusion</h3>
<p class="noindent">With the added password resets, our sample applications signup, login, and logout machinery is complete and professional-grade. The rest of the <em>Ruby on Rails Tutorial</em> <span epub:type="pagebreak" id="page_625"></span>builds on this foundation to make a site with Twitter-like microposts (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch13.xhtml#ch13">Chapter 13</a>) and a status feed of posts from followed users (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch14.xhtml#ch14">Chapter 14</a>). In the process, well learn about some of the most powerful features of Rails, including image upload, custom database queries, and advanced data modeling with <code><strong><span class="colork1">has_many</span></strong></code> and <code><strong><span class="colork1">has_many :through</span></strong></code>.</p>
<section>
<h4 class="h4" id="sec12_5_1">12.5.1 What We Learned in this Chapter</h4>
<p class="bullet"> Like sessions and account activations, password resets can be modeled as a resource despite not being Active Record objects.</p>
<p class="bullet"> Rails can generate Action Mailer actions and views to send email.</p>
<p class="bullet"> Action Mailer supports both plain-text and HTML mail.</p>
<p class="bullet"> As with ordinary actions and views, instance variables defined in mailer actions are available in mailer views.</p>
<p class="bullet"> Password resets use a generated token to create a unique URL for resetting passwords.</p>
<p class="bullet"> Password resets use a hashed reset digest to securely identify valid reset requests.</p>
<p class="bullet"> Both mailer tests and integration tests are useful for verifying the behavior of the User mailer.</p>
<p class="bullet"> We can send email in production using SendGrid.</p>
</section>
</section>
<section>
<h3 class="h3" id="sec12_6">12.6 Proof of Expiration Comparison</h3>
<p class="noindent">We saw in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#sec12_3">Section 12.3</a> that the comparison test for determining when a password reset has expired is</p>
<pre class="pre1">reset_sent_at <span class="colork22">&lt; 2.</span>hours<span class="colork9">.</span>ago</pre>
<p class="noindent">as seen in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex017">Listing 12.17</a>. This looks likes it might be read as reset sent less than two hours ago, which is the opposite of what we want. In this section, well prove that the above comparison is correct.<sup><a id="ch12fn6a" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12fn6" class="totri-footnote">6</a></sup></p>
<p class="footnote"><a id="ch12fn6" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12fn6a" class="totri-footnote">6</a>. This proof is the price you pay for reading a web development tutorial written by a Ph.D. physicist. Just be grateful I couldnt find a way to work <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-1-Frame" tabindex="0" style="position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;msup&gt;&lt;mrow&gt;&lt;mi mathvariant=&quot;italic&quot;&gt;&amp;#x127;&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;msup&gt;&lt;mrow&gt;&lt;mo&gt;&amp;#x2207;&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;V&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;&amp;#x3C8;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;E&lt;/mi&gt;&lt;mi&gt;&amp;#x3C8;&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1" style="width: 11.405em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.26em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.958em, 1010.24em, 4.058em, -999.974em); top: -3.242em; left: 0em;"><span class="mrow" id="MathJax-Span-2"><span class="mrow" id="MathJax-Span-3"><span class="mrow" id="MathJax-Span-4"><span class="mo" id="MathJax-Span-5" style="vertical-align: 0em;"><span style="font-family: MathJax_Size2;">(</span></span><span class="mo" id="MathJax-Span-6" style="font-family: MathJax_Main;"></span><span class="mfrac" id="MathJax-Span-7"><span style="display: inline-block; position: relative; width: 1.1em; height: 0px; margin-right: 0.146em; margin-left: 0.146em;"><span style="position: absolute; clip: rect(3.247em, 1000.74em, 4.153em, -999.974em); top: -4.435em; left: 50%; margin-left: -0.379em;"><span class="mrow" id="MathJax-Span-8"><span class="msup" id="MathJax-Span-9"><span style="display: inline-block; position: relative; width: 0.766em; height: 0px;"><span style="position: absolute; clip: rect(3.39em, 1000.41em, 4.153em, -999.974em); top: -4.005em; left: 0em;"><span class="mrow" id="MathJax-Span-10"><span class="mi" id="MathJax-Span-11" style="font-size: 70.7%; font-family: MathJax_AMS;"><span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.291em; left: 0.432em;"><span class="mrow" id="MathJax-Span-12"><span class="mn" id="MathJax-Span-13" style="font-size: 50%; font-family: MathJax_Main;">2</span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(3.39em, 1000.98em, 4.153em, -999.974em); top: -3.623em; left: 50%; margin-left: -0.475em;"><span class="mrow" id="MathJax-Span-14"><span class="mn" id="MathJax-Span-15" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-16" style="font-size: 70.7%; font-family: MathJax_Math-italic;">m</span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(0.861em, 1001.08em, 1.195em, -999.974em); top: -1.286em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.1em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.052em;"></span></span></span></span><span class="msup" id="MathJax-Span-17"><span style="display: inline-block; position: relative; width: 1.243em; height: 0px;"><span style="position: absolute; clip: rect(3.199em, 1000.79em, 4.201em, -999.974em); top: -4.005em; left: 0em;"><span class="mrow" id="MathJax-Span-18"><span class="mo" id="MathJax-Span-19" style="font-family: MathJax_Main;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.435em; left: 0.813em;"><span class="mrow" id="MathJax-Span-20"><span class="mn" id="MathJax-Span-21" style="font-size: 70.7%; font-family: MathJax_Main;">2</span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mo" id="MathJax-Span-22" style="font-family: MathJax_Main; padding-left: 0.241em;">+</span><span class="mi" id="MathJax-Span-23" style="font-family: MathJax_Math-italic; padding-left: 0.241em;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.193em;"></span></span><span class="mo" id="MathJax-Span-24" style="vertical-align: 0em;"><span style="font-family: MathJax_Size2;">)</span></span></span><span class="mi" id="MathJax-Span-25" style="font-family: MathJax_Math-italic; padding-left: 0.146em;"></span><span class="mo" id="MathJax-Span-26" style="font-family: MathJax_Main; padding-left: 0.289em;">=</span><span class="mi" id="MathJax-Span-27" style="font-family: MathJax_Math-italic; padding-left: 0.289em;">E<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.05em;"></span></span><span class="mi" id="MathJax-Span-28" style="font-family: MathJax_Math-italic;"></span></span></span><span style="display: inline-block; width: 0px; height: 3.247em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.792em; border-left: 0px solid; width: 0px; height: 2.121em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mrow><mo>(</mo><mo></mo><mfrac><mrow><msup><mrow><mi mathvariant="italic"></mi></mrow><mrow><mn>2</mn></mrow></msup></mrow><mrow><mn>2</mn><mi>m</mi></mrow></mfrac><msup><mrow><mo></mo></mrow><mrow><mn>2</mn></mrow></msup><mo>+</mo><mi>V</mi><mo>)</mo></mrow><mi></mi><mo>=</mo><mi>E</mi><mi></mi></mrow></math></span></span><script type="math/mml" id="MathJax-Element-1"><math xmlns:m="http://www.w3.org/1998/Math/MathML"><mrow><mrow><mo>(</mo><mo></mo><mfrac><mrow><msup><mrow><mi mathvariant="italic"></mi></mrow><mrow><mn>2</mn></mrow></msup></mrow><mrow><mn>2</mn><mi>m</mi></mrow></mfrac><msup><mrow><mo></mo></mrow><mrow><mn>2</mn></mrow></msup><mo>+</mo><mi>V</mi><mo>)</mo></mrow><mi></mi><mo>=</mo><mi>E</mi><mi></mi></mrow></math></script> or <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-2-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow&gt;&lt;msup&gt;&lt;mrow&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mi&gt;&amp;#x3BC;&lt;/mi&gt;&lt;mi&gt;&amp;#x3BD;&lt;/mi&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;8&lt;/mn&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x3C0;&lt;/mi&gt;&lt;msup&gt;&lt;mrow&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mi&gt;&amp;#x3BC;&lt;/mi&gt;&lt;mi&gt;&amp;#x3BD;&lt;/mi&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;4&lt;/mn&gt;&lt;mi&gt;&amp;#x3C4;&lt;/mi&gt;&lt;msup&gt;&lt;mrow&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mi&gt;&amp;#x3BC;&lt;/mi&gt;&lt;mi&gt;&amp;#x3BD;&lt;/mi&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-29" style="width: 11.596em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.451em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.291em, 1010.38em, 2.579em, -999.974em); top: -2.192em; left: 0em;"><span class="mrow" id="MathJax-Span-30"><span class="mrow" id="MathJax-Span-31"><span class="msup" id="MathJax-Span-32"><span style="display: inline-block; position: relative; width: 1.672em; height: 0px;"><span style="position: absolute; clip: rect(3.151em, 1000.74em, 4.153em, -999.974em); top: -4.005em; left: 0em;"><span class="mrow" id="MathJax-Span-33"><span class="mi" id="MathJax-Span-34" style="font-family: MathJax_Math-italic;">G</span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.435em; left: 0.766em;"><span class="mrow" id="MathJax-Span-35"><span class="mi" id="MathJax-Span-36" style="font-size: 70.7%; font-family: MathJax_Math-italic;"></span><span class="mi" id="MathJax-Span-37" style="font-size: 70.7%; font-family: MathJax_Math-italic;"><span style="display: inline-block; overflow: hidden; height: 1px; width: 0.05em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mo" id="MathJax-Span-38" style="font-family: MathJax_Main; padding-left: 0.289em;">=</span><span class="mn" id="MathJax-Span-39" style="font-family: MathJax_Main; padding-left: 0.289em;">8</span><span class="mi" id="MathJax-Span-40" style="font-family: MathJax_Math-italic;"><span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="msup" id="MathJax-Span-41"><span style="display: inline-block; position: relative; width: 1.672em; height: 0px;"><span style="position: absolute; clip: rect(3.199em, 1000.69em, 4.153em, -999.974em); top: -4.005em; left: 0em;"><span class="mrow" id="MathJax-Span-42"><span class="mi" id="MathJax-Span-43" style="font-family: MathJax_Math-italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.146em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.387em; left: 0.813em;"><span class="mrow" id="MathJax-Span-44"><span class="mi" id="MathJax-Span-45" style="font-size: 70.7%; font-family: MathJax_Math-italic;"></span><span class="mi" id="MathJax-Span-46" style="font-size: 70.7%; font-family: MathJax_Math-italic;"><span style="display: inline-block; overflow: hidden; height: 1px; width: 0.05em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mrow" id="MathJax-Span-47" style="padding-left: 0.146em;"><span class="mo" id="MathJax-Span-48" style="font-family: MathJax_Main;">(</span><span class="mo" id="MathJax-Span-49" style="font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-50" style="font-family: MathJax_Main; padding-left: 0.289em;">4</span><span class="mi" id="MathJax-Span-51" style="font-family: MathJax_Math-italic;"><span style="display: inline-block; overflow: hidden; height: 1px; width: 0.098em;"></span></span><span class="msup" id="MathJax-Span-52"><span style="display: inline-block; position: relative; width: 1.672em; height: 0px;"><span style="position: absolute; clip: rect(3.199em, 1000.69em, 4.153em, -999.974em); top: -4.005em; left: 0em;"><span class="mrow" id="MathJax-Span-53"><span class="mi" id="MathJax-Span-54" style="font-family: MathJax_Math-italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.146em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.387em; left: 0.813em;"><span class="mrow" id="MathJax-Span-55"><span class="mi" id="MathJax-Span-56" style="font-size: 70.7%; font-family: MathJax_Math-italic;"></span><span class="mi" id="MathJax-Span-57" style="font-size: 70.7%; font-family: MathJax_Math-italic;"><span style="display: inline-block; overflow: hidden; height: 1px; width: 0.05em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mo" id="MathJax-Span-58" style="font-family: MathJax_Main;">)</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.197em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.315em; border-left: 0px solid; width: 0px; height: 1.221em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msup><mrow><mi>G</mi></mrow><mrow><mi></mi><mi></mi></mrow></msup><mo>=</mo><mn>8</mn><mi mathvariant="normal"></mi><msup><mrow><mi>T</mi></mrow><mrow><mi></mi><mi></mi></mrow></msup><mrow><mo>(</mo><mo>=</mo><mn>4</mn><mi></mi><msup><mrow><mi>T</mi></mrow><mrow><mi></mi><mi></mi></mrow></msup><mo>)</mo></mrow></mrow></math></span></span><script type="math/mml" id="MathJax-Element-2"><math xmlns:m="http://www.w3.org/1998/Math/MathML"><mrow><msup><mrow><mi>G</mi></mrow><mrow><mi></mi><mi></mi></mrow></msup><mo>=</mo><mn>8</mn><mi mathvariant="normal"></mi><msup><mrow><mi>T</mi></mrow><mrow><mi></mi><mi></mi></mrow></msup><mrow><mo>(</mo><mo>=</mo><mn>4</mn><mi></mi><msup><mrow><mi>T</mi></mrow><mrow><mi></mi><mi></mi></mrow></msup><mo>)</mo></mrow></mrow></math></script> into the exposition.<span epub:type="pagebreak" id="page_626"></span></p>
<p class="indent">We start by defining two time intervals. Let <em>t<sub>r</sub></em> be the time interval since sending the password reset and let <em>t<sub>e</sub></em> be the expiration time limit (e.g., two hours). A password reset has expired if the time interval since the reset was sent is greater than the expiration limit:</p>
<p class="equ" id="equ12_1"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-3-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow&gt;&lt;mtable&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x394;&lt;/mi&gt;&lt;msub&gt;&lt;mrow&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;&amp;gt;&lt;/mo&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x394;&lt;/mi&gt;&lt;msub&gt;&lt;mrow&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mn&gt;12.1&lt;/mn&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-59" style="width: 9.115em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.208em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.243em, 1007.95em, 2.579em, -999.974em); top: -2.145em; left: 0em;"><span class="mrow" id="MathJax-Span-60"><span class="mrow" id="MathJax-Span-61"><span class="mtable" id="MathJax-Span-62" style="padding-right: 0.146em; padding-left: 0.146em;"><span style="display: inline-block; position: relative; width: 7.922em; height: 0px;"><span style="position: absolute; clip: rect(3.199em, 1004.56em, 4.344em, -999.974em); top: -4.005em; left: 0em;"><span style="display: inline-block; position: relative; width: 4.535em; height: 0px;"><span style="position: absolute; clip: rect(3.151em, 1004.56em, 4.296em, -999.974em); top: -3.957em; left: 50%; margin-left: -2.288em;"><span class="mtd" id="MathJax-Span-63"><span class="mrow" id="MathJax-Span-64"><span class="mi" id="MathJax-Span-65" style="font-family: MathJax_Main;"></span><span class="msub" id="MathJax-Span-66"><span style="display: inline-block; position: relative; width: 0.766em; height: 0px;"><span style="position: absolute; clip: rect(3.247em, 1000.31em, 4.153em, -999.974em); top: -4.005em; left: 0em;"><span class="mrow" id="MathJax-Span-67"><span class="mi" id="MathJax-Span-68" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.384em;"><span class="mrow" id="MathJax-Span-69"><span class="mi" id="MathJax-Span-70" style="font-size: 70.7%; font-family: MathJax_Math-italic;">r</span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mo" id="MathJax-Span-71" style="font-family: MathJax_Main; padding-left: 0.289em;">&gt;</span><span class="mi" id="MathJax-Span-72" style="font-family: MathJax_Main; padding-left: 0.289em;"></span><span class="msub" id="MathJax-Span-73"><span style="display: inline-block; position: relative; width: 0.766em; height: 0px;"><span style="position: absolute; clip: rect(3.247em, 1000.31em, 4.153em, -999.974em); top: -4.005em; left: 0em;"><span class="mrow" id="MathJax-Span-74"><span class="mi" id="MathJax-Span-75" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.384em;"><span class="mrow" id="MathJax-Span-76"><span class="mi" id="MathJax-Span-77" style="font-size: 70.7%; font-family: MathJax_Math-italic;">e</span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(3.151em, 1002.46em, 4.439em, -999.974em); top: -4.005em; left: 5.346em;"><span style="display: inline-block; position: relative; width: 2.579em; height: 0px;"><span style="position: absolute; clip: rect(3.103em, 1002.46em, 4.392em, -999.974em); top: -3.957em; left: 50%; margin-left: -1.286em;"><span class="mtd" id="MathJax-Span-78"><span class="mrow" id="MathJax-Span-79"><span class="mrow" id="MathJax-Span-80"><span class="mo" id="MathJax-Span-81" style="font-family: MathJax_Main;">(</span><span class="mn" id="MathJax-Span-82" style="font-family: MathJax_Main;">12.1</span><span class="mo" id="MathJax-Span-83" style="font-family: MathJax_Main;">)</span></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.149em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.368em; border-left: 0px solid; width: 0px; height: 1.274em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mtable><mtr><mtd><mi mathvariant="normal"></mi><msub><mrow><mi>t</mi></mrow><mrow><mi>r</mi></mrow></msub><mo>&gt;</mo><mi mathvariant="normal"></mi><msub><mrow><mi>t</mi></mrow><mrow><mi>e</mi></mrow></msub></mtd><mtd><mrow><mo>(</mo><mn>12.1</mn><mo>)</mo></mrow></mtd></mtr></mtable></mrow></math></span></span><script type="math/mml" id="MathJax-Element-3"><math xmlns:m="http://www.w3.org/1998/Math/MathML"><mrow><mtable><mtr><mtd><mi mathvariant="normal"></mi><msub><mrow><mi>t</mi></mrow><mrow><mi>r</mi></mrow></msub><mo>&gt;</mo><mi mathvariant="normal"></mi><msub><mrow><mi>t</mi></mrow><mrow><mi>e</mi></mrow></msub></mtd><mtd><mrow><mo>(</mo><mn>12.1</mn><mo>)</mo></mrow></mtd></mtr></mtable></mrow></math></script></p>
<p class="noindent">If we write the time now as <em>t<sub>N</sub></em>, the password reset sending time as <em>t<sub>r</sub></em>, and the expiration time as <em>t<sub>e</sub></em> (e.g., two hours ago), then we have</p>
<p class="equ" id="equ12_2"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-4-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow&gt;&lt;mtable&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x394;&lt;/mi&gt;&lt;msub&gt;&lt;mrow&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x394;&lt;/mi&gt;&lt;msub&gt;&lt;mrow&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mrow&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mn&gt;12.2&lt;/mn&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-84" style="width: 11.643em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.498em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.243em, 1010.24em, 2.579em, -999.974em); top: -2.145em; left: 0em;"><span class="mrow" id="MathJax-Span-85"><span class="mrow" id="MathJax-Span-86"><span class="mtable" id="MathJax-Span-87" style="padding-right: 0.146em; padding-left: 0.146em;"><span style="display: inline-block; position: relative; width: 10.212em; height: 0px;"><span style="position: absolute; clip: rect(3.199em, 1006.85em, 4.344em, -999.974em); top: -4.005em; left: 0em;"><span style="display: inline-block; position: relative; width: 6.872em; height: 0px;"><span style="position: absolute; clip: rect(3.151em, 1006.85em, 4.296em, -999.974em); top: -3.957em; left: 50%; margin-left: -3.433em;"><span class="mtd" id="MathJax-Span-88"><span class="mrow" id="MathJax-Span-89"><span class="mi" id="MathJax-Span-90" style="font-family: MathJax_Main;"></span><span class="msub" id="MathJax-Span-91"><span style="display: inline-block; position: relative; width: 0.766em; height: 0px;"><span style="position: absolute; clip: rect(3.247em, 1000.31em, 4.153em, -999.974em); top: -4.005em; left: 0em;"><span class="mrow" id="MathJax-Span-92"><span class="mi" id="MathJax-Span-93" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.384em;"><span class="mrow" id="MathJax-Span-94"><span class="mi" id="MathJax-Span-95" style="font-size: 70.7%; font-family: MathJax_Math-italic;">r</span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mo" id="MathJax-Span-96" style="font-family: MathJax_Main; padding-left: 0.289em;">=</span><span class="mi" id="MathJax-Span-97" style="font-family: MathJax_Main; padding-left: 0.289em;"></span><span class="msub" id="MathJax-Span-98"><span style="display: inline-block; position: relative; width: 1.052em; height: 0px;"><span style="position: absolute; clip: rect(3.247em, 1000.31em, 4.153em, -999.974em); top: -4.005em; left: 0em;"><span class="mrow" id="MathJax-Span-99"><span class="mi" id="MathJax-Span-100" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.384em;"><span class="mrow" id="MathJax-Span-101"><span class="mi" id="MathJax-Span-102" style="font-size: 70.7%; font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.05em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mo" id="MathJax-Span-103" style="font-family: MathJax_Main; padding-left: 0.241em;"></span><span class="msub" id="MathJax-Span-104" style="padding-left: 0.241em;"><span style="display: inline-block; position: relative; width: 0.766em; height: 0px;"><span style="position: absolute; clip: rect(3.247em, 1000.31em, 4.153em, -999.974em); top: -4.005em; left: 0em;"><span class="mrow" id="MathJax-Span-105"><span class="mi" id="MathJax-Span-106" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.384em;"><span class="mrow" id="MathJax-Span-107"><span class="mi" id="MathJax-Span-108" style="font-size: 70.7%; font-family: MathJax_Math-italic;">r</span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(3.151em, 1002.46em, 4.439em, -999.974em); top: -4.005em; left: 7.636em;"><span style="display: inline-block; position: relative; width: 2.579em; height: 0px;"><span style="position: absolute; clip: rect(3.103em, 1002.46em, 4.392em, -999.974em); top: -3.957em; left: 50%; margin-left: -1.286em;"><span class="mtd" id="MathJax-Span-109"><span class="mrow" id="MathJax-Span-110"><span class="mrow" id="MathJax-Span-111"><span class="mo" id="MathJax-Span-112" style="font-family: MathJax_Main;">(</span><span class="mn" id="MathJax-Span-113" style="font-family: MathJax_Main;">12.2</span><span class="mo" id="MathJax-Span-114" style="font-family: MathJax_Main;">)</span></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.149em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.368em; border-left: 0px solid; width: 0px; height: 1.274em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mtable><mtr><mtd><mi mathvariant="normal"></mi><msub><mrow><mi>t</mi></mrow><mrow><mi>r</mi></mrow></msub><mo>=</mo><mi mathvariant="normal"></mi><msub><mrow><mi>t</mi></mrow><mrow><mi>N</mi></mrow></msub><mo></mo><msub><mrow><mi>t</mi></mrow><mrow><mi>r</mi></mrow></msub></mtd><mtd><mrow><mo>(</mo><mn>12.2</mn><mo>)</mo></mrow></mtd></mtr></mtable></mrow></math></span></span><script type="math/mml" id="MathJax-Element-4"><math xmlns:m="http://www.w3.org/1998/Math/MathML"><mrow><mtable><mtr><mtd><mi mathvariant="normal"></mi><msub><mrow><mi>t</mi></mrow><mrow><mi>r</mi></mrow></msub><mo>=</mo><mi mathvariant="normal"></mi><msub><mrow><mi>t</mi></mrow><mrow><mi>N</mi></mrow></msub><mo></mo><msub><mrow><mi>t</mi></mrow><mrow><mi>r</mi></mrow></msub></mtd><mtd><mrow><mo>(</mo><mn>12.2</mn><mo>)</mo></mrow></mtd></mtr></mtable></mrow></math></script></p>
<p class="noindent">and</p>
<p class="equ" id="equ12_3"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-5-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow&gt;&lt;mtable&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x394;&lt;/mi&gt;&lt;msub&gt;&lt;mrow&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x394;&lt;/mi&gt;&lt;msub&gt;&lt;mrow&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mrow&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mn&gt;12.3&lt;/mn&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-115" style="width: 11.643em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.498em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.243em, 1010.24em, 2.579em, -999.974em); top: -2.145em; left: 0em;"><span class="mrow" id="MathJax-Span-116"><span class="mrow" id="MathJax-Span-117"><span class="mtable" id="MathJax-Span-118" style="padding-right: 0.146em; padding-left: 0.146em;"><span style="display: inline-block; position: relative; width: 10.212em; height: 0px;"><span style="position: absolute; clip: rect(3.199em, 1006.9em, 4.344em, -999.974em); top: -4.005em; left: 0em;"><span style="display: inline-block; position: relative; width: 6.872em; height: 0px;"><span style="position: absolute; clip: rect(3.151em, 1006.9em, 4.296em, -999.974em); top: -3.957em; left: 50%; margin-left: -3.433em;"><span class="mtd" id="MathJax-Span-119"><span class="mrow" id="MathJax-Span-120"><span class="mi" id="MathJax-Span-121" style="font-family: MathJax_Main;"></span><span class="msub" id="MathJax-Span-122"><span style="display: inline-block; position: relative; width: 0.766em; height: 0px;"><span style="position: absolute; clip: rect(3.247em, 1000.31em, 4.153em, -999.974em); top: -4.005em; left: 0em;"><span class="mrow" id="MathJax-Span-123"><span class="mi" id="MathJax-Span-124" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.384em;"><span class="mrow" id="MathJax-Span-125"><span class="mi" id="MathJax-Span-126" style="font-size: 70.7%; font-family: MathJax_Math-italic;">e</span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mo" id="MathJax-Span-127" style="font-family: MathJax_Main; padding-left: 0.289em;">=</span><span class="mi" id="MathJax-Span-128" style="font-family: MathJax_Main; padding-left: 0.289em;"></span><span class="msub" id="MathJax-Span-129"><span style="display: inline-block; position: relative; width: 1.052em; height: 0px;"><span style="position: absolute; clip: rect(3.247em, 1000.31em, 4.153em, -999.974em); top: -4.005em; left: 0em;"><span class="mrow" id="MathJax-Span-130"><span class="mi" id="MathJax-Span-131" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.384em;"><span class="mrow" id="MathJax-Span-132"><span class="mi" id="MathJax-Span-133" style="font-size: 70.7%; font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.05em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mo" id="MathJax-Span-134" style="font-family: MathJax_Main; padding-left: 0.241em;"></span><span class="msub" id="MathJax-Span-135" style="padding-left: 0.241em;"><span style="display: inline-block; position: relative; width: 0.766em; height: 0px;"><span style="position: absolute; clip: rect(3.247em, 1000.31em, 4.153em, -999.974em); top: -4.005em; left: 0em;"><span class="mrow" id="MathJax-Span-136"><span class="mi" id="MathJax-Span-137" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.384em;"><span class="mrow" id="MathJax-Span-138"><span class="mi" id="MathJax-Span-139" style="font-size: 70.7%; font-family: MathJax_Math-italic;">e</span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(3.151em, 1002.46em, 4.439em, -999.974em); top: -4.005em; left: 7.683em;"><span style="display: inline-block; position: relative; width: 2.579em; height: 0px;"><span style="position: absolute; clip: rect(3.103em, 1002.46em, 4.392em, -999.974em); top: -3.957em; left: 50%; margin-left: -1.286em;"><span class="mtd" id="MathJax-Span-140"><span class="mrow" id="MathJax-Span-141"><span class="mrow" id="MathJax-Span-142"><span class="mo" id="MathJax-Span-143" style="font-family: MathJax_Main;">(</span><span class="mn" id="MathJax-Span-144" style="font-family: MathJax_Main;">12.3</span><span class="mo" id="MathJax-Span-145" style="font-family: MathJax_Main;">)</span></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.149em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.368em; border-left: 0px solid; width: 0px; height: 1.274em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mtable><mtr><mtd><mi mathvariant="normal"></mi><msub><mrow><mi>t</mi></mrow><mrow><mi>e</mi></mrow></msub><mo>=</mo><mi mathvariant="normal"></mi><msub><mrow><mi>t</mi></mrow><mrow><mi>N</mi></mrow></msub><mo></mo><msub><mrow><mi>t</mi></mrow><mrow><mi>e</mi></mrow></msub></mtd><mtd><mrow><mo>(</mo><mn>12.3</mn><mo>)</mo></mrow></mtd></mtr></mtable></mrow></math></span></span><script type="math/mml" id="MathJax-Element-5"><math xmlns:m="http://www.w3.org/1998/Math/MathML"><mrow><mtable><mtr><mtd><mi mathvariant="normal"></mi><msub><mrow><mi>t</mi></mrow><mrow><mi>e</mi></mrow></msub><mo>=</mo><mi mathvariant="normal"></mi><msub><mrow><mi>t</mi></mrow><mrow><mi>N</mi></mrow></msub><mo></mo><msub><mrow><mi>t</mi></mrow><mrow><mi>e</mi></mrow></msub></mtd><mtd><mrow><mo>(</mo><mn>12.3</mn><mo>)</mo></mrow></mtd></mtr></mtable></mrow></math></script></p>
<p class="noindent">Plugging Eq. (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#equ12_2">12.2</a>) and Eq. (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#equ12_3">12.3</a>) into Eq. (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#equ12_1">12.1</a>) then gives</p>
<p class="equ"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-6-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow&gt;&lt;mtable&gt;&lt;mtr&gt;&lt;mtd columnalign=&quot;right&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x394;&lt;/mi&gt;&lt;msub&gt;&lt;mrow&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mo&gt;&amp;gt;&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x394;&lt;/mi&gt;&lt;msub&gt;&lt;mrow&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd columnalign=&quot;right&quot;&gt;&lt;msub&gt;&lt;mrow&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mrow&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mo&gt;&amp;gt;&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;msub&gt;&lt;mrow&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mrow&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd columnalign=&quot;right&quot;&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mrow&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mo&gt;&amp;gt;&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mrow&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-146" style="width: 9.83em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.829em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(-0.188em, 1008.66em, 3.962em, -999.974em); top: -2.145em; left: 0em;"><span class="mrow" id="MathJax-Span-147"><span class="mrow" id="MathJax-Span-148"><span class="mtable" id="MathJax-Span-149" style="padding-right: 0.146em; padding-left: 0.146em;"><span style="display: inline-block; position: relative; width: 8.542em; height: 0px;"><span style="position: absolute; clip: rect(2.483em, 1003.08em, 6.491em, -999.974em); top: -4.721em; left: 0em;"><span style="display: inline-block; position: relative; width: 3.103em; height: 0px;"><span style="position: absolute; clip: rect(3.151em, 1001.6em, 4.296em, -999.974em); top: -5.389em; right: 0em;"><span class="mtd" id="MathJax-Span-150"><span class="mrow" id="MathJax-Span-151"><span class="mi" id="MathJax-Span-152" style="font-family: MathJax_Main;"></span><span class="msub" id="MathJax-Span-153"><span style="display: inline-block; position: relative; width: 0.766em; height: 0px;"><span style="position: absolute; clip: rect(3.247em, 1000.31em, 4.153em, -999.974em); top: -4.005em; left: 0em;"><span class="mrow" id="MathJax-Span-154"><span class="mi" id="MathJax-Span-155" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.384em;"><span class="mrow" id="MathJax-Span-156"><span class="mi" id="MathJax-Span-157" style="font-size: 70.7%; font-family: MathJax_Math-italic;">r</span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(3.247em, 1003.08em, 4.296em, -999.974em); top: -3.957em; right: 0em;"><span class="mtd" id="MathJax-Span-169"><span class="mrow" id="MathJax-Span-170"><span class="msub" id="MathJax-Span-171"><span style="display: inline-block; position: relative; width: 1.052em; height: 0px;"><span style="position: absolute; clip: rect(3.247em, 1000.31em, 4.153em, -999.974em); top: -4.005em; left: 0em;"><span class="mrow" id="MathJax-Span-172"><span class="mi" id="MathJax-Span-173" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.384em;"><span class="mrow" id="MathJax-Span-174"><span class="mi" id="MathJax-Span-175" style="font-size: 70.7%; font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.05em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mo" id="MathJax-Span-176" style="font-family: MathJax_Main; padding-left: 0.241em;"></span><span class="msub" id="MathJax-Span-177" style="padding-left: 0.241em;"><span style="display: inline-block; position: relative; width: 0.766em; height: 0px;"><span style="position: absolute; clip: rect(3.247em, 1000.31em, 4.153em, -999.974em); top: -4.005em; left: 0em;"><span class="mrow" id="MathJax-Span-178"><span class="mi" id="MathJax-Span-179" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.384em;"><span class="mrow" id="MathJax-Span-180"><span class="mi" id="MathJax-Span-181" style="font-size: 70.7%; font-family: MathJax_Math-italic;">r</span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(3.247em, 1001.55em, 4.296em, -999.974em); top: -2.526em; right: 0em;"><span class="mtd" id="MathJax-Span-198"><span class="mrow" id="MathJax-Span-199"><span class="mo" id="MathJax-Span-200" style="font-family: MathJax_Main;"></span><span class="msub" id="MathJax-Span-201"><span style="display: inline-block; position: relative; width: 0.766em; height: 0px;"><span style="position: absolute; clip: rect(3.247em, 1000.31em, 4.153em, -999.974em); top: -4.005em; left: 0em;"><span class="mrow" id="MathJax-Span-202"><span class="mi" id="MathJax-Span-203" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.384em;"><span class="mrow" id="MathJax-Span-204"><span class="mi" id="MathJax-Span-205" style="font-size: 70.7%; font-family: MathJax_Math-italic;">r</span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.726em;"></span></span><span style="position: absolute; clip: rect(2.388em, 1000.69em, 6.109em, -999.974em); top: -4.435em; left: 3.867em;"><span style="display: inline-block; position: relative; width: 0.766em; height: 0px;"><span style="position: absolute; clip: rect(3.342em, 1000.69em, 4.201em, -999.974em); top: -5.389em; left: 50%; margin-left: -0.379em;"><span class="mtd" id="MathJax-Span-158"><span class="mrow" id="MathJax-Span-159"><span class="mo" id="MathJax-Span-160" style="font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(3.342em, 1000.69em, 4.201em, -999.974em); top: -3.957em; left: 50%; margin-left: -0.379em;"><span class="mtd" id="MathJax-Span-182"><span class="mrow" id="MathJax-Span-183"><span class="mo" id="MathJax-Span-184" style="font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(3.342em, 1000.69em, 4.201em, -999.974em); top: -2.526em; left: 50%; margin-left: -0.379em;"><span class="mtd" id="MathJax-Span-206"><span class="mrow" id="MathJax-Span-207"><span class="mo" id="MathJax-Span-208" style="font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.439em;"></span></span><span style="position: absolute; clip: rect(2.483em, 1003.08em, 6.491em, -999.974em); top: -4.721em; left: 5.441em;"><span style="display: inline-block; position: relative; width: 3.103em; height: 0px;"><span style="position: absolute; clip: rect(3.151em, 1001.6em, 4.296em, -999.974em); top: -5.389em; left: 0em;"><span class="mtd" id="MathJax-Span-161"><span class="mrow" id="MathJax-Span-162"><span class="mi" id="MathJax-Span-163" style="font-family: MathJax_Main;"></span><span class="msub" id="MathJax-Span-164"><span style="display: inline-block; position: relative; width: 0.766em; height: 0px;"><span style="position: absolute; clip: rect(3.247em, 1000.31em, 4.153em, -999.974em); top: -4.005em; left: 0em;"><span class="mrow" id="MathJax-Span-165"><span class="mi" id="MathJax-Span-166" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.384em;"><span class="mrow" id="MathJax-Span-167"><span class="mi" id="MathJax-Span-168" style="font-size: 70.7%; font-family: MathJax_Math-italic;">e</span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(3.247em, 1003.08em, 4.296em, -999.974em); top: -3.957em; left: 0em;"><span class="mtd" id="MathJax-Span-185"><span class="mrow" id="MathJax-Span-186"><span class="msub" id="MathJax-Span-187"><span style="display: inline-block; position: relative; width: 1.052em; height: 0px;"><span style="position: absolute; clip: rect(3.247em, 1000.31em, 4.153em, -999.974em); top: -4.005em; left: 0em;"><span class="mrow" id="MathJax-Span-188"><span class="mi" id="MathJax-Span-189" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.384em;"><span class="mrow" id="MathJax-Span-190"><span class="mi" id="MathJax-Span-191" style="font-size: 70.7%; font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.05em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mo" id="MathJax-Span-192" style="font-family: MathJax_Main; padding-left: 0.241em;"></span><span class="msub" id="MathJax-Span-193" style="padding-left: 0.241em;"><span style="display: inline-block; position: relative; width: 0.766em; height: 0px;"><span style="position: absolute; clip: rect(3.247em, 1000.31em, 4.153em, -999.974em); top: -4.005em; left: 0em;"><span class="mrow" id="MathJax-Span-194"><span class="mi" id="MathJax-Span-195" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.384em;"><span class="mrow" id="MathJax-Span-196"><span class="mi" id="MathJax-Span-197" style="font-size: 70.7%; font-family: MathJax_Math-italic;">e</span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(3.247em, 1001.55em, 4.296em, -999.974em); top: -2.526em; left: 0em;"><span class="mtd" id="MathJax-Span-209"><span class="mrow" id="MathJax-Span-210"><span class="mo" id="MathJax-Span-211" style="font-family: MathJax_Main;"></span><span class="msub" id="MathJax-Span-212"><span style="display: inline-block; position: relative; width: 0.766em; height: 0px;"><span style="position: absolute; clip: rect(3.247em, 1000.31em, 4.153em, -999.974em); top: -4.005em; left: 0em;"><span class="mrow" id="MathJax-Span-213"><span class="mi" id="MathJax-Span-214" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.384em;"><span class="mrow" id="MathJax-Span-215"><span class="mi" id="MathJax-Span-216" style="font-size: 70.7%; font-family: MathJax_Math-italic;">e</span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.726em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.149em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.904em; border-left: 0px solid; width: 0px; height: 4.398em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mtable><mtr><mtd columnalign="right"><mi mathvariant="normal"></mi><msub><mrow><mi>t</mi></mrow><mrow><mi>r</mi></mrow></msub></mtd><mtd><mo>&gt;</mo></mtd><mtd columnalign="left"><mi mathvariant="normal"></mi><msub><mrow><mi>t</mi></mrow><mrow><mi>e</mi></mrow></msub></mtd></mtr><mtr><mtd columnalign="right"><msub><mrow><mi>t</mi></mrow><mrow><mi>N</mi></mrow></msub><mo></mo><msub><mrow><mi>t</mi></mrow><mrow><mi>r</mi></mrow></msub></mtd><mtd><mo>&gt;</mo></mtd><mtd columnalign="left"><msub><mrow><mi>t</mi></mrow><mrow><mi>N</mi></mrow></msub><mo></mo><msub><mrow><mi>t</mi></mrow><mrow><mi>e</mi></mrow></msub></mtd></mtr><mtr><mtd columnalign="right"><mo></mo><msub><mrow><mi>t</mi></mrow><mrow><mi>r</mi></mrow></msub></mtd><mtd><mo>&gt;</mo></mtd><mtd columnalign="left"><mo></mo><msub><mrow><mi>t</mi></mrow><mrow><mi>e</mi></mrow></msub></mtd></mtr></mtable></mrow></math></span></span><script type="math/mml" id="MathJax-Element-6"><math xmlns:m="http://www.w3.org/1998/Math/MathML"><mrow><mtable><mtr><mtd columnalign="right"><mi mathvariant="normal"></mi><msub><mrow><mi>t</mi></mrow><mrow><mi>r</mi></mrow></msub></mtd><mtd><mo>&gt;</mo></mtd><mtd columnalign="left"><mi mathvariant="normal"></mi><msub><mrow><mi>t</mi></mrow><mrow><mi>e</mi></mrow></msub></mtd></mtr><mtr><mtd columnalign="right"><msub><mrow><mi>t</mi></mrow><mrow><mi>N</mi></mrow></msub><mo></mo><msub><mrow><mi>t</mi></mrow><mrow><mi>r</mi></mrow></msub></mtd><mtd><mo>&gt;</mo></mtd><mtd columnalign="left"><msub><mrow><mi>t</mi></mrow><mrow><mi>N</mi></mrow></msub><mo></mo><msub><mrow><mi>t</mi></mrow><mrow><mi>e</mi></mrow></msub></mtd></mtr><mtr><mtd columnalign="right"><mo></mo><msub><mrow><mi>t</mi></mrow><mrow><mi>r</mi></mrow></msub></mtd><mtd><mo>&gt;</mo></mtd><mtd columnalign="left"><mo></mo><msub><mrow><mi>t</mi></mrow><mrow><mi>e</mi></mrow></msub></mtd></mtr></mtable></mrow></math></script></p>
<p class="noindent">Multiplying through by 1 then yields</p>
<p class="equ" id="equ12_4"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-7-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow&gt;&lt;mtable&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mrow&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;&amp;lt;&lt;/mo&gt;&lt;msub&gt;&lt;mrow&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mn&gt;12.4&lt;/mn&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-217" style="width: 7.254em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.538em; height: 0px; font-size: 111%;"><span style="position: absolute; clip: rect(1.243em, 1006.28em, 2.579em, -999.974em); top: -2.145em; left: 0em;"><span class="mrow" id="MathJax-Span-218"><span class="mrow" id="MathJax-Span-219"><span class="mtable" id="MathJax-Span-220" style="padding-right: 0.146em; padding-left: 0.146em;"><span style="display: inline-block; position: relative; width: 6.252em; height: 0px;"><span style="position: absolute; clip: rect(3.247em, 1002.89em, 4.344em, -999.974em); top: -4.005em; left: 0em;"><span style="display: inline-block; position: relative; width: 2.865em; height: 0px;"><span style="position: absolute; clip: rect(3.247em, 1002.89em, 4.296em, -999.974em); top: -3.957em; left: 50%; margin-left: -1.429em;"><span class="mtd" id="MathJax-Span-221"><span class="mrow" id="MathJax-Span-222"><span class="msub" id="MathJax-Span-223"><span style="display: inline-block; position: relative; width: 0.766em; height: 0px;"><span style="position: absolute; clip: rect(3.247em, 1000.31em, 4.153em, -999.974em); top: -4.005em; left: 0em;"><span class="mrow" id="MathJax-Span-224"><span class="mi" id="MathJax-Span-225" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.384em;"><span class="mrow" id="MathJax-Span-226"><span class="mi" id="MathJax-Span-227" style="font-size: 70.7%; font-family: MathJax_Math-italic;">r</span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mo" id="MathJax-Span-228" style="font-family: MathJax_Main; padding-left: 0.289em;">&lt;</span><span class="msub" id="MathJax-Span-229" style="padding-left: 0.289em;"><span style="display: inline-block; position: relative; width: 0.766em; height: 0px;"><span style="position: absolute; clip: rect(3.247em, 1000.31em, 4.153em, -999.974em); top: -4.005em; left: 0em;"><span class="mrow" id="MathJax-Span-230"><span class="mi" id="MathJax-Span-231" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.384em;"><span class="mrow" id="MathJax-Span-232"><span class="mi" id="MathJax-Span-233" style="font-size: 70.7%; font-family: MathJax_Math-italic;">e</span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(3.151em, 1002.46em, 4.439em, -999.974em); top: -4.005em; left: 3.676em;"><span style="display: inline-block; position: relative; width: 2.579em; height: 0px;"><span style="position: absolute; clip: rect(3.103em, 1002.46em, 4.392em, -999.974em); top: -3.957em; left: 50%; margin-left: -1.286em;"><span class="mtd" id="MathJax-Span-234"><span class="mrow" id="MathJax-Span-235"><span class="mrow" id="MathJax-Span-236"><span class="mo" id="MathJax-Span-237" style="font-family: MathJax_Main;">(</span><span class="mn" id="MathJax-Span-238" style="font-family: MathJax_Main;">12.4</span><span class="mo" id="MathJax-Span-239" style="font-family: MathJax_Main;">)</span></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.149em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.368em; border-left: 0px solid; width: 0px; height: 1.274em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mtable><mtr><mtd><msub><mrow><mi>t</mi></mrow><mrow><mi>r</mi></mrow></msub><mo>&lt;</mo><msub><mrow><mi>t</mi></mrow><mrow><mi>e</mi></mrow></msub></mtd><mtd><mrow><mo>(</mo><mn>12.4</mn><mo>)</mo></mrow></mtd></mtr></mtable></mrow></math></span></span><script type="math/mml" id="MathJax-Element-7"><math xmlns:m="http://www.w3.org/1998/Math/MathML"><mrow><mtable><mtr><mtd><msub><mrow><mi>t</mi></mrow><mrow><mi>r</mi></mrow></msub><mo>&lt;</mo><msub><mrow><mi>t</mi></mrow><mrow><mi>e</mi></mrow></msub></mtd><mtd><mrow><mo>(</mo><mn>12.4</mn><mo>)</mo></mrow></mtd></mtr></mtable></mrow></math></script></p>
<p class="noindent">Converting Eq. (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#equ12_4">12.4</a>) to code with the value <em>t<sub>e</sub></em> = 2 hours ago gives the <code><strong><span class="colork1">password_reset_expired?</span></strong></code> method shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12ex017">Listing 12.17</a>:</p>
<p class="codelink"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12_images.xhtml#pg626-6a" id="pg626-6">Click here to view code image</a></p>
<pre class="pre1"><strong><span class="colork10">def</span></strong> <span class="colork4">password_reset_expired?</span>
  reset_sent_at <span class="colork8">&lt; 2.</span>hours<span class="colork9">.</span>ago
<strong><span class="colork10">end</span></strong></pre>
<p class="noindent">As noted in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#sec12_3">Section 12.3</a>, if we read <code><strong><span class="colork1">&lt;</span></strong></code> as earlier than instead of less than, this code makes sense as the English sentence The password reset was sent earlier than two hours ago.</p>
</section>
</section>
<div class="annotator-outer annotator-viewer viewer annotator-hide">
  <ul class="annotator-widget annotator-listing"></ul>
</div><div class="annotator-modal-wrapper annotator-editor-modal annotator-editor annotator-hide">
	<div class="annotator-outer editor">
		<h2 class="title">Highlight</h2>
		<form class="annotator-widget">
			<ul class="annotator-listing">
			<li class="annotator-item"><textarea id="annotator-field-14" placeholder="Add a note using markdown (optional)" class="js-editor" maxlength="750"></textarea></li></ul>
			<div class="annotator-controls">
				<a class="link-to-markdown" href="https://daringfireball.net/projects/markdown/basics" target="_blank">?</a>
				<ul>
					<li class="delete annotator-hide"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#delete" class="annotator-delete-note button positive">Delete Note</a></li>
					<li class="save"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#save" class="annotator-save annotator-focus button positive">Save Note</a></li>
					<li class="cancel"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#cancel" class="annotator-cancel button">Cancel</a></li>
				</ul>
			</div>
		</form>
	</div>
</div><div class="annotator-modal-wrapper annotator-delete-confirm-modal" style="display: none;">
  <div class="annotator-outer">
    <h2 class="title">Highlight</h2>
      <a class="js-close-delete-confirm annotator-cancel close" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#close">Close</a>
      <div class="annotator-widget">
         <div class="delete-confirm">
            Are you sure you want to permanently delete this note?
         </div>
         <div class="annotator-controls">
            <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#cancel" class="annotator-cancel button js-cancel-delete-confirm">No, I changed my mind</a>
            <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#delete" class="annotator-delete button positive js-delete-confirm">Yes, delete it</a>
         </div>
       </div>
   </div>
</div><div class="annotator-adder" style="display: none;">
	<ul class="adders">
		
		<li class="copy"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#">Copy</a></li>
		
		<li class="add-highlight"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#">Add Highlight</a></li>
		<li class="add-note"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#">
			Add Note
		</a></li>
		
	</ul>
</div></div></div>



  <div class="t-sbo-prev sbo-prev sbo-nav-bottom">
  
    
      
        <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch11.xhtml" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">Chapter 11. Account Activation</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-bottom">
  
    
      
        <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch13.xhtml" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">Chapter 13. User Microposts</div>
        </a>
    
  
  </div>

</section>
  </div>
<section class="sbo-saved-archives"></section>



          
          
  




    
    
      <div id="js-subscribe-nag" class="subscribe-nag clearfix trial-panel t-subscribe-nag collapsed slideUp">
        
        
          <p class="usage-data">Find answers on the fly, or master something new. Subscribe today. <a href="https://learning.oreilly.com/subscribe/" class="ga-active-trial-subscribe-nag">See pricing options.</a></p>
        

        
        

      </div>

    
    



        
      </div>
      
        

<footer class="pagefoot t-pagefoot" style="padding-bottom: 69px;">
  <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#" class="icon-up" onclick="window.Appcues.track(&#39;JumpTop_HeronBook&#39;)" style="display: none;"><div class="visuallyhidden">Back to top</div></a>
  <ul class="js-footer-nav">
  
    
    <li><a href="https://learning.oreilly.com/public/support/">Support</a></li>
    
    <li><a href="https://learning.oreilly.com/accounts/logout/">Sign Out</a></li>
    
  
  
  </ul>
  <span class="copyright"> 2020 <a href="https://learning.oreilly.com/" target="_blank">O'Reilly Media, Inc</a>.</span>
  
    
    <a href="https://www.oreilly.com/terms/">Terms of Service</a> 
     / 
    
    <a href="https://learning.oreilly.com/privacy">Privacy Policy</a> 
    
    
  
</footer>

      
    
    <script src="./Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition_files/saved_resource(1)" charset="utf-8"></script><script type="text/javascript" id="">(function(){window.medalliaUserIdentifier=document.documentElement.dataset.userUuid;window.medalliaUserName=document.documentElement.dataset.username})();</script>
<script type="text/javascript" id="" src="./Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition_files/embed.js.download"></script>
    <script src="./Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition_files/saved_resource(2)" charset="utf-8"></script>
  

<div></div><div></div><div class="selection_bubble_root" style="display: none;"></div><div class="annotator-notice"></div><div class="font-flyout" style="top: 201.006px; left: 1194.34px;"><div class="font-controls-panel">
	<div class="nightmodes">
		<ul>
			<li class="day"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#" id="day-mode" title="Day Mode">
				<i class="fa fa-sun-o"></i>
				<span>Day Mode</span></a></li>
			<li class="cloudy"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#" id="cloudy-mode" title="Cloudy Mode">
				<i class="fa fa-cloud"></i>
				<span>Cloud Mode</span>
			</a></li>
			<li class="night"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#" id="night-mode" title="Night Mode">
				<i class="fa fa-moon-o"></i>
				<span>Night Mode</span>
			</a></li>
		</ul>
	</div>

	<div class="font-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-font left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-font-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-font right"></i>
		</div>
	</div>

	<div class="column-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-compress left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-column-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-expand right"></i>
		</div>
	</div>

	<a id="reset" class="button" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#">Reset</a>
</div>
</div><script type="text/javascript" async="" src="./Chapter 12. Password Reset - Ruby on Rails Tutorial, 6th Edition_files/generic1604331345324.js.download" charset="UTF-8"></script><script type="text/javascript" id="">function forceInputUppercase(a){var b=a.target.selectionStart,c=a.target.selectionEnd;a.target.value=a.target.value.toUpperCase();a.target.setSelectionRange(b,c)}void 0!=document.getElementById("id_promotion")&&null!=document.getElementById("id_promotion")&&document.getElementById("id_promotion").addEventListener("keyup",forceInputUppercase,!1);
void 0!=document.getElementsByName("promotionCode")[0]&&null!=document.getElementsByName("promotionCode")[0]&&document.getElementsByName("promotionCode")[0].addEventListener("keyup",forceInputUppercase,!1);</script><script type="text/javascript" id="">var nonwExpandable=document.querySelectorAll(".orm-ff-NavigationSubnav-headerListItem a, .orm-ff-NavigationView-headerListItem a");nonwExpandable.forEach(function(a,b){b+1!=nonwExpandable.length?a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"global nav",eventAct:"navigation",eventLbl:a.childNodes[1].textContent})}):b+1==nonwExpandable.length&&a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"user login",eventAct:"logout",eventLbl:"global nav | unified"})})});
var nonwExpandableFo=document.querySelectorAll(".drop-content li:not(.flyout-parent) a");
nonwExpandableFo.forEach(function(a,b){"drop-content"==a.parentNode.parentNode.parentNode.className&&b+1!=nonwExpandableFo.length?a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"global nav",eventAct:"navigation",eventLbl:a.childNodes[1].textContent})}):"drop-content"==a.parentNode.parentNode.parentNode.className&&b+1==nonwExpandableFo.length&&a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"user login",eventAct:"logout",eventLbl:"global nav | unified"})})});
var expandable=document.querySelectorAll(".orm-ff-NavigationSubnav-toggleControls a, .orm-ff-NavigationView-toggleControls a");expandable.forEach(function(a){a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"global nav",eventAct:"navigation",eventLbl:a.parentNode.parentNode.parentNode.querySelectorAll(".orm-Button-btnContentWrap span")[0].childNodes[1].textContent+" | "+a.textContent})})});var flyoutLinks=document.querySelectorAll(".flyout a");
flyoutLinks.forEach(function(a){a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"global nav",eventAct:"navigation",eventLbl:a.closest("li.flyout-parent").getElementsByTagName("a")[0].textContent+" | "+a.textContent})})});</script><span></span><script type="text/javascript" id="">dataLayer.push({"ld.experiment":void 0,"ld.variation":void 0});</script><div style="position: absolute; width: 0px; height: 0px; overflow: hidden; padding: 0px; border: 0px; margin: 0px;"><div id="MathJax_Font_Test" style="position: absolute; visibility: hidden; top: 0px; left: 0px; width: auto; padding: 0px; border: 0px; margin: 0px; white-space: nowrap; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; font-size: 40px; font-weight: normal; font-style: normal; font-family: MathJax_Size2, sans-serif;"></div></div></body></html>