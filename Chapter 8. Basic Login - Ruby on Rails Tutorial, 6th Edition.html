<!DOCTYPE html>
<!-- saved from url=(0080)https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml -->
<html class=" js flexbox flexboxlegacy no-touch websqldatabase indexeddb history csscolumns csstransforms localstorage sessionstorage no-applicationcache svg inlinesvg zoom" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#" itemscope="" itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/" data-offline-url="/" data-url="/library/view/ruby-on-rails/9780136702726/ch10.xhtml" data-csrf-cookie="csrfsafari" data-highlight-privacy="" data-user-id="10224494" data-user-uuid="66943332-5511-462c-876e-5d5b720c7edf" data-username="czjtgu3dkobug4zdmolfga2wembsmu" data-account-type="Trial" data-activated-trial-date="12/02/2020" data-archive="9780136702726" data-publishers="Addison-Wesley Professional" data-htmlfile-name="ch10.xhtml" data-epub-title="Ruby on Rails Tutorial, 6th Edition" data-debug="0" data-testing="0" style=""><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="author" content="O&#39;Reilly Media"><meta name="format-detection" content="telephone=no"><meta http-equiv="cleartype" content="on"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="apple-itunes-app" content="app-id=881697395, app-argument=safaridetail://9780136702726"><link rel="shortcut icon" href="https://www.oreilly.com/favicon.ico"><meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, maximum-scale=1.0"><meta property="twitter:account_id" content="4503599627559754"><link rel="shortcut icon" href="https://learning.oreilly.com/favicon.ico" type="image/x-icon"><link href="./Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition_files/css" rel="stylesheet" type="text/css"><title>Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition</title><link rel="stylesheet" href="./Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition_files/output.731fc84c4f9a.css" type="text/css"><link rel="stylesheet" type="text/css" href="./Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition_files/annotator.e3b0c44298fc.css"><link rel="stylesheet" href="./Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition_files/font-awesome.min.css"><style type="text/css" title="ibis-book">@page{margin:1em 2em}#sbo-rt-content div{margin-top:1em;margin-bottom:1em;margin-left:1em;margin-right:1em;text-align:justify}#sbo-rt-content div.cover img{max-width:99%;max-height:99%}#sbo-rt-content .att{text-align:right}#sbo-rt-content .cover{margin-top:.5em;margin-bottom:.5em;text-align:center}#sbo-rt-content .h1{margin-top:1.5em;margin-bottom:.5em;font-weight:bold;font-size:210%;page-break-after:avoid;border-bottom:solid .1em;text-align:center}#sbo-rt-content .halftitle{margin-top:1em;margin-bottom:2em;font-weight:bold;font-size:210%;page-break-after:avoid;text-align:center}#sbo-rt-content .h2{margin-top:1em;margin-bottom:.1em;font-weight:bold;font-size:180%;border-bottom:solid .1em;page-break-after:avoid;text-align:left}#sbo-rt-content .h2f{margin-top:1em;margin-bottom:2.5em;font-weight:bold;font-size:190%;border-bottom:solid .1em;page-break-after:avoid;text-align:left}#sbo-rt-content .h2t{margin-top:1em;margin-bottom:2em;font-weight:bold;font-size:190%;border-bottom:solid .1em;page-break-after:avoid;text-align:left}#sbo-rt-content .center{text-align:center}#sbo-rt-content .h3{margin-top:.5em;margin-bottom:.001em;font-weight:bold;font-size:160%;page-break-after:avoid;text-align:left}#sbo-rt-content .h4{margin-top:.5em;margin-bottom:.001em;font-weight:bold;font-size:130%;page-break-after:avoid;text-align:left}#sbo-rt-content .h5{margin-top:.5em;margin-bottom:.001em;font-weight:bold;font-size:120%;page-break-after:avoid;text-align:left}#sbo-rt-content ul{margin-top:1em;margin-bottom:1em;margin-left:.2em}#sbo-rt-content ul.sq{list-style-type:square}#sbo-rt-content ul.sq li p,#sbo-rt-content ul.sq li p.noindent{margin-top:.5em;margin-left:1em;margin-bottom:.5em;text-indent:.002em}#sbo-rt-content .left{text-align:left}#sbo-rt-content .ex-title{margin-top:.8em;margin-bottom:.5em;text-indent:.1em;font-size:100%}#sbo-rt-content code{font-family:Courier,Courier New,monospace;font-size:small}#sbo-rt-content pre{font-family:Courier,Courier New,monospace;margin-top:.6em;margin-bottom:1em;margin-left:.1em;line-height:1.3em;font-size:small}#sbo-rt-content .pre3{font-family:Courier,Courier New,monospace;margin-top:1em;margin-bottom:1em;margin-left:2.9em;background-color:#E6E6E6}#sbo-rt-content .equ{margin-top:.8em;margin-bottom:.5em;text-align:center}#sbo-rt-content .footnum{margin-top:.7em;margin-bottom:.5em;text-indent:-1em;margin-left:3.3em}#sbo-rt-content .footnotep{margin-top:.8em;margin-left:.8em;margin-bottom:.5em;text-indent:.8em}#sbo-rt-content .mark1{background-color:#F4F7F9}#sbo-rt-content .codelink{margin-top:.2em;margin-bottom:.5em}#sbo-rt-content .middle img{vertical-align:middle}#sbo-rt-content .box{margin-top:.6em;margin-bottom:1em;margin-left:.1em;margin-right:.8em;padding:.8em;background-color:#E6E6E6}#sbo-rt-content .box-bq{font-size:.8em;margin-top:.8em;margin-bottom:.5em;margin-left:1.6em;text-indent:.1em;background-color:#E6E6E6}#sbo-rt-content .boxip{margin-top:.5em;margin-left:.1em;margin-bottom:.5em;text-indent:.8em;background-color:#E6E6E6}#sbo-rt-content ol.num{list-style-type:number;font-weight:normal}#sbo-rt-content ol.num li p{list-style-type:number;font-weight:normal}#sbo-rt-content ol.num li p,#sbo-rt-content ol.num li p.number{margin-top:.5em;margin-left:.2em;margin-bottom:.5em;text-indent:.002em}#sbo-rt-content .num-p{margin-top:.5em;margin-bottom:.5em;margin-left:0}#sbo-rt-content .bullet{margin-top:.7em;margin-bottom:.5em;text-indent:-.8em;margin-left:2em}#sbo-rt-content .credit{margin-top:.1em;margin-bottom:.1em;text-indent:-1.5em;margin-left:2em}#sbo-rt-content .box-caption{margin-top:.1em;margin-bottom:1em;font-size:125%;font-weight:bold;text-indent:.02em;text-align:left}#sbo-rt-content .example{font-family:Courier,Courier New,monospace;margin-top:.6em;margin-bottom:1em;margin-left:.1em;line-height:1.3em;font-size:small;border-top:.02em solid black;border-bottom:.02em solid black}#sbo-rt-content .image-l{margin-top:.8em;margin-left:1em;text-align:center}#sbo-rt-content .topbot{margin-top:.8em;margin-bottom:.5em;border-bottom:solid black .1em;border-top:solid black .1em;text-indent:.1em}#sbo-rt-content .uln{margin-top:.7em;margin-bottom:.7em;margin-left:2em}#sbo-rt-content .fdash{margin-top:.7em;margin-bottom:.7em;margin-left:2em}#sbo-rt-content .fdash1{margin-top:.7em;margin-bottom:.7em;margin-left:3em}#sbo-rt-content .tr{border-bottom:.1em solid black}#sbo-rt-content th{text-align:left}#sbo-rt-content td{padding-left:.1em;padding-top:0;padding-bottom:0;vertical-align:top;text-align:left}#sbo-rt-content .mark{background-color:#E6E6E6}#sbo-rt-content .pre1{font-family:Courier,Courier New,monospace;margin-top:.2em;margin-bottom:1em;margin-left:0;padding:.8em;background-color:#E6E6E6}#sbo-rt-content .pre2{font-family:Courier,Courier New,monospace;margin-top:.2em;margin-bottom:1em;margin-left:.2em}#sbo-rt-content .tab-thc{margin-top:.1em;margin-bottom:.1em;border-bottom:solid black .1em;text-align:center}#sbo-rt-content .tab-th{margin-top:.1em;border-bottom:solid black .1em;border-top:solid black .1em;text-align:left}#sbo-rt-content .author{margin-top:2.5em;margin-bottom:5.5em;text-align:center;font-size:120%}#sbo-rt-content .pub{margin-top:1.5em;margin-bottom:.5em;text-align:center}#sbo-rt-content .pub1{font-weight:bold;font-size:.9em;margin-top:.1em;margin-bottom:.5em;text-align:center}#sbo-rt-content .copy{margin-top:.9em;margin-bottom:.5em;text-indent:.02em}#sbo-rt-content .copy1{margin-top:.9em;margin-bottom:.2em;text-indent:.02em}#sbo-rt-content .copy2{margin-top:.2em;margin-bottom:.5em;text-indent:.02em}#sbo-rt-content .title{margin-top:1em;margin-bottom:.2em;font-size:125%;font-weight:bold;text-indent:.02em;text-align:center}#sbo-rt-content .noindent{margin-top:.5em;margin-bottom:.5em;text-indent:.1em}#sbo-rt-content .tab-para{margin-top:.1em;margin-bottom:.1em;margin-left:.1em;text-indent:0}#sbo-rt-content .tab-parai{margin-top:.1em;margin-bottom:.1em;margin-left:1.1em;text-indent:-1.1em}#sbo-rt-content .boxnp{margin-top:.5em;margin-bottom:.5em;text-indent:.1em}#sbo-rt-content .toc-intro{margin-top:.1em;margin-bottom:.5em;margin-left:1.5em;text-align:left}#sbo-rt-content .tocchap{margin-top:1.5em;margin-bottom:.4em;margin-left:3.4em;text-indent:-4em}#sbo-rt-content .toclev1{margin-top:.4em;margin-bottom:.4em;margin-left:1em}#sbo-rt-content .toclev2{margin-top:.4em;margin-bottom:.4em;margin-left:2.6em}#sbo-rt-content .toclev1a{margin-top:.4em;margin-bottom:.4em;margin-left:.5em}#sbo-rt-content .toc-index{margin-top:2em;margin-bottom:.4em;margin-left:.7em}#sbo-rt-content .indexmain{margin-top:.4em;margin-bottom:.2em;margin-left:.8em;text-indent:-.8em}#sbo-rt-content .indexsub{margin-top:.4em;margin-bottom:.2em;margin-left:1.7em;text-indent:-.7em}#sbo-rt-content .indexsubsub{margin-top:.4em;margin-bottom:.2em;font-style:italic;margin-left:3em;text-indent:-.9em}#sbo-rt-content figcaption{margin-top:.8em;margin-bottom:.5em;color:black;text-align:left;text-indent:.1em}#sbo-rt-content .subtitle{margin-top:.1em;margin-bottom:1em;font-weight:bold;font-size:150%;page-break-after:avoid;text-align:center}#sbo-rt-content .edition{margin-top:2em;margin-bottom:3em;font-weight:bold;font-size:150%;page-break-after:avoid;text-align:center}#sbo-rt-content .indent{margin-top:.5em;margin-left:.1em;margin-bottom:.5em;text-indent:1.5em}#sbo-rt-content .h2a{margin-top:.1em;margin-bottom:2em;font-weight:bold;font-size:190%;page-break-after:avoid;text-align:left}#sbo-rt-content figure>img{max-width:99%;max-height:99%}#sbo-rt-content figure{margin-top:1em;margin-bottom:1em;margin-left:.5em;margin-right:1.5em}#sbo-rt-content none{list-style-type:none}#sbo-rt-content a{text-decoration:none}#sbo-rt-content .footnote{font-size:.8em;margin-top:.1em;margin-bottom:.5em;margin-left:.8em}#sbo-rt-content .none{margin-top:.5em;margin-left:1em;margin-bottom:.5em;list-style-type:none}#sbo-rt-content div.image-p img{width:80%}#sbo-rt-content .image-p{page-break-before:always;text-align:center}#sbo-rt-content table{border-collapse:collapse;border-spacing:0;background:transparent;vertical-align:top;margin-top:.1em;margin-right:.1em;margin-bottom:.9em;margin-left:0;width:100%}#sbo-rt-content .tab-parar{margin-top:.1em;margin-bottom:.1em;text-indent:.1em;text-align:right}#sbo-rt-content .h2i{margin-top:1em;margin-bottom:2.1em;font-weight:bold;font-size:190%;border-bottom:solid .1em;page-break-after:avoid;text-align:left}#sbo-rt-content pre{overflow:auto;-ms-overflow:auto;-moz-overflow:auto;-webkit-overflow:auto;-ms-padding-bottom:5pt;-moz-padding-bottom:5pt;-webkit-padding-bottom:5pt}#sbo-rt-content .maroon{color:#BB2121}#sbo-rt-content .green{color:#005A00}#sbo-rt-content .green1{color:#48785D}#sbo-rt-content .navy{color:#504B72}#sbo-rt-content .ash{color:#666}#sbo-rt-content .blue{color:#408080}#sbo-rt-content .green3{color:#00A100}#sbo-rt-content .blue1{color:#0000B8}#sbo-rt-content .violet{color:#1A177D}#sbo-rt-content .pink{color:#A131A1}#sbo-rt-content .pink1{color:#A131A1}#sbo-rt-content .red{color:#800}#sbo-rt-content .blue3{color:#2E3192}#sbo-rt-content .red2{color:#B80000}#sbo-rt-content .green4{color:#269200}#sbo-rt-content .ash1{color:#666}#sbo-rt-content .ash2{color:#33484A}#sbo-rt-content .red2{color:#640000}#sbo-rt-content .ash3{color:#7D8F29}#sbo-rt-content .red5{color:#BD7B00}#sbo-rt-content .maroon1{color:#B66600}#sbo-rt-content .blue5{color:#1F3BFF}#sbo-rt-content .red6{color:#B68}#sbo-rt-content .green7{color:#14B600}#sbo-rt-content .maroon2{color:#B66600}#sbo-rt-content .pink2{color:#AC21FF}#sbo-rt-content .pink3{color:#AC21FF}#sbo-rt-content .lighgreen{color:#5FA100}#sbo-rt-content .lighblue{color:#269271}#sbo-rt-content .darkmaroon{color:#269271}#sbo-rt-content .maroon5{color:#A10000}#sbo-rt-content .blue6{color:#0000B9}#sbo-rt-content .marko{background-color:#FAF9CE}#sbo-rt-content .green5{color:#1C8B43}#sbo-rt-content .colork1{color:#136433;font-weight:bold}#sbo-rt-content .colork2{color:#504C72}#sbo-rt-content .colork3{color:#51785D}#sbo-rt-content .colork4{color:#303192}#sbo-rt-content .colork5{color:#955744}#sbo-rt-content .colork6{color:#5C70BA}#sbo-rt-content .colork7{color:#487864}#sbo-rt-content .colork8{color:#5C5778}#sbo-rt-content .colork9{color:#666}#sbo-rt-content .colork10{color:#48785D}#sbo-rt-content .colork11{color:#BC654D}#sbo-rt-content .colork12{color:#3E8185}#sbo-rt-content .colork13{color:#C62425}#sbo-rt-content .colork14{color:#1D8C43}#sbo-rt-content .colork15{color:#0D8140}#sbo-rt-content .colork16{color:#BB2425}#sbo-rt-content .colork17{color:#985744}#sbo-rt-content .colork18{color:#6C8896}#sbo-rt-content .colork19{color:#2A2C80}#sbo-rt-content .colork20{color:#BD2425}#sbo-rt-content .redk1{color:#EE1C25}#sbo-rt-content .colork21{color:#2A2C77}#sbo-rt-content .colork22{color:#955744}#sbo-rt-content .colork23{color:#BC6561}#sbo-rt-content .colork24{color:#BE7D2B}#sbo-rt-content .colork25{color:#8E7C5D}#sbo-rt-content .colork26{color:#7C5778}#sbo-rt-content .colork27{color:#9D1C1F}#sbo-rt-content .colork28{color:#AA5744}#sbo-rt-content .colork29{color:#C59861}#sbo-rt-content .grayk1{color:#C0908E}#sbo-rt-content .pd_green{color:#48785d}#sbo-rt-content .dark-green{color:#146333}#sbo-rt-content .mark1{background-color:#faf9ce}#sbo-rt-content .mark{background-color:#faf9ce}#sbo-rt-content .pd_ash{color:#666}#sbo-rt-content .pd_blue7{color:#6c8896}#sbo-rt-content .pd_blue1{color:#504b72}#sbo-rt-content .pd_red{color:#965744}#sbo-rt-content .pd_red2{color:#bb654e}#sbo-rt-content .pd_red5{color:#ed1c24}#sbo-rt-content .pd_blue5{color:#2e3192}#sbo-rt-content .pd_green4{color:#269200}#sbo-rt-content .pd_green5{color:#1c8b43}#sbo-rt-content .pd_blue3{color:#2c2c78}#sbo-rt-content .pd_orange{color:#c49847}</style><script type="text/javascript" async="" src="./Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition_files/cool-2.1.15.min.js.download"></script><script type="text/javascript" async="" src="./Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition_files/ec.js.download"></script><script type="text/javascript" async="" src="./Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition_files/analytics.js.download"></script><script type="text/javascript" async="" src="./Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition_files/f.txt"></script><script type="text/javascript" async="" src="./Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition_files/js"></script><script crossorigin="anonymous" integrity="sha256-NiDMmov61Y536X/eLXLiDGzFVFmNLtPyu4b5aFB54ks=" type="text/javascript" src="./Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition_files/appcues.main.11e38ef4746fd64ab30c11794299d10b30bcb704.js.download" async=""></script><script async="" src="./Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition_files/gtm.js.download"></script><script> // <![CDATA[
    var g = {
      position_cache: {
        
          "chapter": "/api/v1/book/9780136702726/chapter/ch10.xhtml",
          "book_id": "9780136702726",
          "chapter_uri": "ch10.xhtml",
          "position": 27.4567491080775,
          "user_uuid": "66943332-5511-462c-876e-5d5b720c7edf",
          "next_chapter_uri": "/library/view/ruby-on-rails/9780136702726/ch11.xhtml"
        
      },
      title: "Ruby on Rails Tutorial, 6th Edition",
      author_list: "Michael Hartl",
      format: "book",
      source: "application/epub+zip",
      is_system_book: true,
      is_public: false,
      loaded_from_server: true,
      allow_scripts: false,
      has_mathml: true
    };
    // ]]></script><script src="./Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition_files/modernizr.8e35451ddb64.js.download"></script><script>
    
      

      
        
          window.PUBLIC_ANNOTATIONS = true;
        
      

      window.MOBILE_PUBLIC_ANNOTATIONS = false;

    

    
      window.PRIVACY_CONTROL_OVERRIDE = false;
    

      window.PRIVACY_CONTROL_SWITCH = true;

      window.PUBLISHER_PAGES = true;

      window.SBO = {
        "constants": {
          "SITB_ENDPOINT": "/api/v2/sitb/",
          "SEARCH_SELECT_ENDPOINT": "https://learning.oreilly.com/api/v2/search/select/",
          "ENABLE_ONLINE_TRAINING": true
        }
      };
  </script><link rel="canonical" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch10.xhtml"><meta name="description" content=" Chapter 10 Updating, Showing, and Deleting Users In this chapter, we complete the REST actions for the Users resource (Table 7.1) by adding edit, update, index ... "><meta property="og:title" content="Chapter 10. Updating, Showing, and Deleting Users"><meta itemprop="isPartOf" content="/library/view/ruby-on-rails/9780136702726/"><meta itemprop="name" content="Chapter 10. Updating, Showing, and Deleting Users"><meta property="og:url" itemprop="url" content="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch10.xhtml"><meta property="og:site_name" content="Safari"><meta property="og:image" itemprop="thumbnailUrl" content="https://learning.oreilly.com/library/cover/9780136702726/"><meta property="og:description" itemprop="description" content=" Chapter 10 Updating, Showing, and Deleting Users In this chapter, we complete the REST actions for the Users resource (Table 7.1) by adding edit, update, index ... "><meta itemprop="inLanguage" content="en"><meta itemprop="publisher" content="Addison-Wesley Professional"><meta property="og:type" content="book"><meta property="og:book:isbn" itemprop="isbn" content="9780136702726"><meta property="og:book:author" itemprop="author" content="Michael Hartl"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@OReillyMedia"><style type="text/css" id="font-styles" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-size: &lt;%= font_size %&gt; !important; }"></style><style type="text/css" id="font-family" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-family: &lt;%= font_family %&gt; !important; }"></style><style type="text/css" id="column-width" data-template="#sbo-rt-content { max-width: &lt;%= column_width %&gt;% !important; margin: 0 auto !important; }"></style><noscript><meta http-equiv="refresh" content="0; url=/library/no-js/" /></noscript><script>
    var dataLayer = window.dataLayer || [];

    
      window.medalliaVsgUserIdentifier = '66943332-5511-462c-876e-5d5b720c7edf';
      dataLayer.push({userIdentifier: '66943332-5511-462c-876e-5d5b720c7edf'});
      dataLayer.push({loggedIn: 'yes'});

      
        window.medalliaVsgAccountIdentifier = 'ba5f3401-307d-4b66-90a6-a97047c63525';
        

        window.medalliaVsgIsIndividual = true;
        
          
          dataLayer.push({learningAccountType: 'free trial'});
          
        

        
      
    

    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-5P4V6Z');
    (function () {
      var VERSION = 'V1.1';
      var AUTHOR = 'Awwad';
      if (!window.GtmHelper)
        window.GtmHelper = function () {
          var instance = this;
          var loc = document.location;
          this.version = VERSION;
          this.author = AUTHOR;
          this.readCookie = function (name) {
            var nameEQ = name + "=";
            var ca = document.cookie.split(';');
            for (var i = 0; i < ca.length; i++) {
              var c = ca[i];
              while (c.charAt(0) == ' ') c = c.substring(1, c.length);
              if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
          };
          this.createCookie = function (name, value, days, cookieDomain) {
            var domain = "";
            var expires = "";

            if (days) {
              var date = new Date();
              date.setTime(date.getTime() + Math.ceil(days * 24 * 60 * 60 * 1000));
              var expires = " expires=" + date.toGMTString() + ";";
            }

            if (typeof (cookieDomain) != 'undefined')
              domain = " domain=" + cookieDomain + "; ";

            document.cookie = name + "=" + value + ";" + expires + domain + "path=/";
          };

          this.isDuplicated = function (currentTransactionId) {
            // the previous transaction id:
            var previousTransIdValue = this.readCookie("previousTransId");

            if (currentTransactionId === previousTransIdValue) {
              return true; // Duplication
            } else {
              return false;
            }
          };
        }
    })()
  </script><script defer="" src="./Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition_files/vendor.3eecedff6f59.js.download"></script><script defer="" src="./Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition_files/reader.772cf1e31d6c.js.download"></script><iframe src="./Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition_files/saved_resource.html"></iframe><iframe src="./Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition_files/saved_resource(3).html"></iframe><iframe src="./Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition_files/saved_resource(4).html"></iframe><link rel="stylesheet" type="text/css" integrity="sha256-q9sKb2HpA5fJjN1cK9LjLaEXff5ix81Rv1Y3xJFptPE=" crossorigin="anonymous" href="./Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition_files/container.11e38ef4746fd64ab30c11794299d10b30bcb704.css"><iframe src="./Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition_files/saved_resource(5).html"></iframe><script src="./Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition_files/f(1).txt"></script><script async="" src="./Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition_files/MathJax.js.download"></script><style id="annotator-dynamic-style">.annotator-adder, .annotator-outer, .annotator-notice {
  z-index: 100019;
}
.annotator-filter {
  z-index: 100009;
}</style><style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 2px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 2px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: 1em}
.MathJax_MenuRadioCheck.RTL {right: 1em; left: auto}
.MathJax_MenuLabel {padding: 2px 2em 4px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #CCCCCC; margin: 4px 1px 0px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: Highlight; color: HighlightText}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
</style><style type="text/css" id="kampyleStyle">.noOutline{outline: none !important;}.wcagOutline:focus{outline: 1px dashed #595959 !important;outline-offset: 2px !important;transition: none !important;}</style></head>


<body class="reading sidenav  scalefonts subscribe-panel library nav-collapsed"><div id="MathJax_Message" style="display: none;"></div>

    
  <noscript> 
    <iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P4V6Z"
            height="0" width="0"
            style="display:none;visibility:hidden">
    </iframe>
  </noscript>



    
      <div class="working hide" role="status">
        <div class="working-image"></div>
      </div>
      <div class="sbo-site-nav">
        

  


<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#container" class="skip">Skip to content</a><header class="topbar t-topbar"><nav role="navigation" class="js-site-nav"><ul class="topnav"><li><a href="https://learning.oreilly.com/home/" class="l0 nav-icn"><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M11.738 14H9.254v-3.676a.617.617 0 0 0-.621-.613H7.39a.617.617 0 0 0-.62.613V14H4.284a.617.617 0 0 1-.622-.613V10.22c0-.327.132-.64.367-.87l3.547-3.493a.627.627 0 0 1 .875 0l3.54 3.499c.234.229.366.54.367.864v3.167a.617.617 0 0 1-.62.613zM7.57 2.181a.625.625 0 0 1 .882 0l5.77 5.692-.93.92-5.28-5.209-5.28 5.208-.932-.919 5.77-5.692z"></path></svg><span>Home</span></a></li><li class="search"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#" class="t-search-nav trigger nav-icn l0" data-dropdown-selector=".searchbox"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>search icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M31.3 0C20.9 0 12.5 8.4 12.5 18.8 12.5 22.5 13.6 25.9 15.4 28.8L1.2 42.9C-0.4 44.5-0.4 47.2 1.2 48.8 2 49.6 3.1 50 4.2 50 5.2 50 6.3 49.6 7.1 48.8L21.2 34.6C24.1 36.5 27.5 37.5 31.3 37.5 41.6 37.5 50 29.1 50 18.8 50 8.4 41.6 0 31.3 0ZM31.3 31.3C24.4 31.3 18.8 25.6 18.8 18.8 18.8 11.9 24.4 6.3 31.3 6.3 38.1 6.3 43.8 11.9 43.8 18.8 43.8 25.6 38.1 31.3 31.3 31.3Z"></path></g></svg><span>Search</span></a></li><li class="usermenu dropdown"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#" class="trigger l0 nav-icn nav-dropdown"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>navigation arrow</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M0.1 12.5L9.7 3.1C9.8 3 9.9 3 10 3 10.1 3 10.2 3 10.3 3.1L19.9 12.5C20 12.5 20 12.6 20 12.8 20 12.9 20 13 19.9 13L17 15.9C16.9 16 16.8 16 16.7 16 16.5 16 16.4 16 16.4 15.9L10 9.7 3.6 15.9C3.6 16 3.5 16 3.3 16 3.2 16 3.1 16 3 15.9L0.1 13C0 12.9 0 12.8 0 12.7 0 12.7 0 12.6 0.1 12.5Z"></path></g></svg><span>Expand Nav</span></a><div class="drop-content"><ul><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#" class="l1 nav-icn "><!--?xml version="1.0" encoding="UTF-8"?--><svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M8,8 C6.34321755,8 5.00013,6.65691245 5.00013,5.00013 C5.00013,3.34334755 6.34321755,2.00026001 8,2.00026001 C9.65678245,2.00026001 10.99987,3.34334755 10.99987,5.00013 C10.99987,6.65691245 9.65678245,8 8,8 Z M2.33024571,11.3523547 L2.33774538,11.3523547 C3.7622187,9.70968996 5.82947484,8.76608166 8.00374984,8.76608166 C10.1780248,8.76608166 12.245281,9.70968996 13.6697543,11.3523547 C13.8892083,11.6177474 14.0062813,11.9530021 13.99974,12.2973138 L13.99974,13.99974 L2.00026001,13.99974 L2.00026001,12.2973138 C1.99371867,11.9530021 2.11079172,11.6177474 2.33024571,11.3523547 Z" id="path-1"></path></svg><span>Your O'Reilly</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/profile/" class="l2 nav-icn"><span>Profile</span></a></li><li><a href="https://learning.oreilly.com/history/" class="l2 nav-icn"><span>History</span></a></li><li><a href="https://learning.oreilly.com/playlists/" class="l2 nav-icn"><span>Playlists</span></a></li><li><a href="https://learning.oreilly.com/u/66943332-5511-462c-876e-5d5b720c7edf/" class="l2 nav-icn"><span>Highlights</span></a></li></ul></li><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#" class="l1 nav-icn "><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M11.564 2.263l2.172 2.174c.17.168.264.397.264.636V11a.6.6 0 0 1-.6.6h-.6V6.2h-6V2.6a.6.6 0 0 1 .6-.6h3.527c.239 0 .468.095.637.263zM2.6 14a.6.6 0 0 1-.6-.6V6.8a.6.6 0 0 1 .6-.6h1.903a1.2 1.2 0 0 1 .849.352L6.2 7.4H11a.6.6 0 0 1 .6.6v5.4a.6.6 0 0 1-.6.6H2.6zM11 5h1.8L11 3.2V5z"></path></svg><span>Featured</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/featured/navigating-21st-century/" class="l2 nav-icn"><span>Navigating Change</span></a></li><li><a href="https://learning.oreilly.com/recommendations/" class="l2 nav-icn"><span>Recommended</span></a></li></ul></li><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#" class="l1 nav-icn "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>queue icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 29.2C25.4 29.2 25.8 29.1 26.1 28.9L48.7 16.8C49.5 16.4 50 15.5 50 14.6 50 13.7 49.5 12.8 48.7 12.4L26.1 0.3C25.4-0.1 24.6-0.1 23.9 0.3L1.3 12.4C0.5 12.8 0 13.7 0 14.6 0 15.5 0.5 16.4 1.3 16.8L23.9 28.9C24.2 29.1 24.6 29.2 25 29.2ZM7.3 14.6L25 5.2 42.7 14.6 25 24 7.3 14.6ZM48.7 22.4L47.7 21.9 25 34.2 2.3 21.9 1.3 22.4C0.5 22.9 0 23.7 0 24.7 0 25.6 0.5 26.5 1.3 26.9L23.9 39.3C24.2 39.5 24.6 39.6 25 39.6 25.4 39.6 25.8 39.5 26.1 39.3L48.7 26.9C49.5 26.5 50 25.6 50 24.7 50 23.7 49.5 22.9 48.7 22.4ZM48.7 32.8L47.7 32.3 25 44.6 2.3 32.3 1.3 32.8C0.5 33.3 0 34.1 0 35.1 0 36 0.5 36.9 1.3 37.3L23.9 49.7C24.2 49.9 24.6 50 25 50 25.4 50 25.8 49.9 26.1 49.7L48.7 37.3C49.5 36.9 50 36 50 35.1 50 34.1 49.5 33.3 48.7 32.8Z"></path></g></svg><span>Explore</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/topics/" class="l2 nav-icn"><span>All Topics</span></a></li><li><a href="https://learning.oreilly.com/search/?query=&amp;extended_publisher_data=true&amp;highlight=true&amp;include_assessments=false&amp;include_case_studies=true&amp;include_courses=true&amp;include_orioles=true&amp;include_playlists=true&amp;include_collections=true&amp;include_notebooks=true&amp;is_academic_institution_account=false&amp;source=user&amp;formats=book&amp;sort=publication_date&amp;facet_json=true&amp;page=0" class="l2 nav-icn"><span>Early Releases</span></a></li><li><a href="https://learning.oreilly.com/playlists/discover/" class="l2 nav-icn"><span>Shared Playlists</span></a></li><li><a href="https://learning.oreilly.com/search/?query=&amp;extended_publisher_data=true&amp;highlight=true&amp;include_assessments=false&amp;include_case_studies=true&amp;include_courses=true&amp;include_orioles=true&amp;include_playlists=true&amp;include_collections=true&amp;include_notebooks=true&amp;is_academic_institution_account=false&amp;source=user&amp;formats=book&amp;formats=case%20study&amp;formats=learning%20path&amp;formats=live%20online%20training&amp;formats=notebook&amp;formats=oriole&amp;formats=video&amp;sort=popularity&amp;facet_json=true&amp;page=0&amp;collection_type=expert" class="l2 nav-icn"><span>Most Popular Titles</span></a></li><li><a href="https://learning.oreilly.com/resource-centers/" class="l2 nav-icn"><span>Resource Centers</span></a></li></ul></li><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#" class="l1 nav-icn "><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M12.8 3.2A1.2 1.2 0 0 1 14 4.4v8.4a1.2 1.2 0 0 1-1.2 1.2H3.2A1.2 1.2 0 0 1 2 12.8V4.4a1.2 1.2 0 0 1 1.2-1.2h1.2V2h1.2v1.2h4.8V2h1.2v1.2h1.2zm-9.6 9.6h9.6V6.2H3.2v6.6zM8 9.5a1.35 1.35 0 1 1 0-2.7 1.35 1.35 0 0 1 0 2.7zm2.7 2.148v.552H5.3v-.552c0-.321.124-.634.355-.858a3.358 3.358 0 0 1 4.69 0c.23.224.355.537.355.858z"></path></svg><span>Attend</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/live-training/" class="l2 nav-icn"><span>Live Trainings</span></a></li><li><a href="https://learning.oreilly.com/featured/architectural-katas" class="l2 nav-icn"><span>Architectural Katas</span></a></li><li><a href="https://learning.oreilly.com/featured/strata/" class="l2 nav-icn"><span>Strata</span></a></li><li><a href="https://learning.oreilly.com/featured/oscon/" class="l2 nav-icn"><span>Open Source</span></a></li><li><a href="https://learning.oreilly.com/featured/infrastructure-ops/" class="l2 nav-icn"><span>Infra &amp; Ops</span></a></li><li><a href="https://learning.oreilly.com/featured/software-architecture/" class="l2 nav-icn"><span>Software Arch</span></a></li></ul></li><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#" class="l1 nav-icn "><svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M11.6467109,4.35328907 L14.7964612,7.51003884 C15.0678463,7.78304342 15.0678463,8.22395603 14.7964612,8.49696061 L11.6467109,11.6467109 L10.6597892,10.6597892 L13.3055794,8 L10.6597892,5.34021084 L11.6467109,4.35328907 Z M4.35328907,11.6467109 L1.20353875,8.48996116 C0.932153749,8.21695658 0.932153749,7.77604397 1.20353875,7.50303939 L4.35328907,4.35328907 L5.34021084,5.34021084 L2.69442057,8 L5.34021084,10.6597892 L4.35328907,11.6467109 Z M5.84417089,11.4997226 L8.67194674,4.50027742 L10.1838269,4.50027742 L7.35605105,11.4997226 L5.84417089,11.4997226 Z" id="Mask"></path></svg><span>Interact</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/scenarios/?classification=content-scenario" class="l2 nav-icn"><span>Scenarios</span></a></li><li><a href="https://learning.oreilly.com/scenarios/?classification=sandbox-scenario" class="l2 nav-icn"><span>Sandboxes</span></a></li><li><a href="https://learning.oreilly.com/interactive/?classification=jupyter-notebook" class="l2 nav-icn"><span>Jupyter Notebooks</span></a></li></ul></li><li><a href="https://learning.oreilly.com/answers/" class="l1 nav-icn "><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path d="M2.31032699,3.75609006 C4.65421571,1.41371359 8.45302454,1.41472092 10.7955702,3.75860838 C13.1381158,6.10249583 13.1369405,9.90130261 10.7930518,12.243847 C8.44916311,14.5863913 4.65018639,14.5852161 2.30780867,12.2413286 C-0.0346204845,9.89749489 -0.0334929936,6.09853298 2.31032699,3.75609006 Z M8.8198605,4.98016308 C7.34193969,3.86924672 5.23410194,3.98609692 3.88914868,5.33104946 C3.12814393,6.09032122 2.72818176,7.13880077 2.79015179,8.21201133 C2.79115912,8.23064692 2.79233434,8.24928252 2.79350956,8.26791811 L2.79350956,8.26791811 C2.83179539,8.8307976 2.9944077,9.37404287 3.26947292,9.86201677 L3.26947292,9.86201677 L2.77621706,11.7027432 C2.7699968,11.7259241 2.77662063,11.7506624 2.79359185,11.7676337 C2.8105631,11.7846049 2.83530144,11.7912287 2.85848233,11.7850085 L2.85848233,11.7850085 L4.69400524,11.2922565 C5.26306363,11.6167344 5.90703177,11.786885 6.56209849,11.7858479 C8.64827865,11.7858479 10.3395879,10.094542 10.3395879,8.00836292 C10.3405204,6.84135608 9.80105674,5.73967784 8.87862141,5.02482134 L8.87862141,5.02482134 L8.82825492,4.98654283 Z M13.7933062,2 C14.7073496,2.00009863 15.4482759,2.74110484 15.4482759,3.65514822 C15.4482759,4.32460943 15.0449926,4.92814782 14.4264842,5.18432286 C13.8079757,5.44049789 13.096053,5.29885769 12.6226979,4.82545158 C12.1493429,4.35204547 12.0077795,3.64010743 12.2640213,3.02162665 C12.5202631,2.40314587 13.123845,1.99992776 13.7933062,2 Z"></path></svg><span>Answers</span></a></li><li><a href="https://learning.oreilly.com/certifications/" class="l1 nav-icn "><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path d="M12.912 9.18L14 8.014l-1.088-1.18a.304.304 0 01-.075-.268L13.195 5l-1.535-.463a.313.313 0 01-.194-.194l-.462-1.537-1.565.358c-.09.03-.194 0-.269-.074L8.007 2 6.845 3.09a.303.303 0 01-.269.074l-1.565-.358-.462 1.537a.313.313 0 01-.194.194L2.82 5l.358 1.567a.26.26 0 01-.075.269L2 8.015l1.088 1.164c.075.075.09.18.075.269l-.358 1.567 1.535.463c.09.03.164.104.194.194l.462 1.537 1.565-.358c.015 0 .045-.015.075-.015.075 0 .15.03.209.074L8.007 14l1.163-1.09a.303.303 0 01.269-.074l1.565.358.462-1.537a.313.313 0 01.194-.194L13.195 11l-.358-1.567a.338.338 0 01.075-.254zm-6.046 1.37L4.41 8.26l1.16-1.244 1.767 1.649L10.4 5.6l1.202 1.202-4.242 4.243-.495-.495z"></path></svg><span>Certifications</span></a></li><li><a href="https://learning.oreilly.com/preferences/" class="l1 nav-icn "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" width="20" height="20" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z"></path></g></svg><span>Settings</span></a></li><li><a href="https://learning.oreilly.com/public/support/" class="l1 nav-icn "><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M7.363 6.656a2.692 2.692 0 0 1-2.681-2.703c0-1.493 1.2-2.703 2.681-2.703a2.692 2.692 0 0 1 2.682 2.703c0 1.493-1.2 2.703-2.682 2.703zm4.023 2.027c-1.852 0-3.352 1.513-3.352 3.379H2v-1.534c-.006-.31.099-.612.295-.852a6.666 6.666 0 0 1 9.09-.993zm-.543.676h1.12v.304c.003.284.16.543.408.676a.766.766 0 0 0 .77 0l.303-.176.556.966-.302.176a.772.772 0 0 0-.362.676v.08a.772.772 0 0 0 .362.677l.302.21-.556.965-.302-.175a.766.766 0 0 0-.771 0 .778.778 0 0 0-.409.675v.352h-1.106v-.372a.778.778 0 0 0-.409-.676.766.766 0 0 0-.77 0l-.303.176-.556-.912.302-.176a.772.772 0 0 0 .362-.676v-.04-.04a.772.772 0 0 0-.362-.676l-.302-.176.556-.966.289.155a.766.766 0 0 0 .77 0 .778.778 0 0 0 .41-.676V9.36zm1.562 2.703c0-.271-.108-.531-.3-.722a1.001 1.001 0 0 0-.72-.292 1.01 1.01 0 0 0-.992 1.023 1.01 1.01 0 0 0 1.01 1.004 1.01 1.01 0 0 0 1.002-1.013z"></path></svg><span>Support</span></a></li><li><a href="https://get.oreilly.com/email-signup.html" class="l1 nav-icn " target="&quot;_blank&quot;"><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M11.564 2.263l2.172 2.174c.17.168.264.397.264.636V11a.6.6 0 0 1-.6.6h-.6V6.2h-6V2.6a.6.6 0 0 1 .6-.6h3.527c.239 0 .468.095.637.263zM2.6 14a.6.6 0 0 1-.6-.6V6.8a.6.6 0 0 1 .6-.6h1.903a1.2 1.2 0 0 1 .849.352L6.2 7.4H11a.6.6 0 0 1 .6.6v5.4a.6.6 0 0 1-.6.6H2.6zM11 5h1.8L11 3.2V5z"></path></svg><span>Newsletters</span></a></li><li><a href="https://learning.oreilly.com/accounts/logout/" class="l1 nav-icn "><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M2.613 12.63A.607.607 0 0 1 2 12.03V3.602C2 3.269 2.274 3 2.613 3h5.515v1.204H3.226v7.223h4.902v1.203H2.613zM5.677 9.02V6.611h4.903V4.926a.301.301 0 0 1 .19-.274.31.31 0 0 1 .33.063l2.722 2.673a.594.594 0 0 1 0 .849L11.1 10.909a.31.31 0 0 1-.331.063.301.301 0 0 1-.19-.274V9.02H5.677z"></path></svg><span>Sign Out</span></a></li></ul></div></li></ul></nav></header>



      </div>
      <div id="container" class="application" style="height: auto;">
        
          <div class="nav-container clearfix">
            


            
            
          </div>

          

  <div class="js-toc">
    
      <div class="sbo-reading-menu sbo-menu-top"><section class="sbo-toc-container toc-menu"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#" class="sbo-toc-thumb"><span class="sbo-title ss-list"><h1><div class="visuallyhidden">Table of Contents for </div>
      
      Ruby on Rails Tutorial, 6th Edition
      
    </h1></span></a><div class="toc-contents" style="max-height: 0px;">
  <div class="sbo-toc">
    <button type="button" class="sbo-toc-thumb close"><div class="visuallyhidden">Close</div></button>
      <section class="ios-app-teaser">
        <ul>
            <li><a class="js-toc-link toc-link" href="https://itunes.apple.com/gb/app/safari-queue-library-over/id881697395?mt=8" role="button">Install App</a></li>
            <li><a class="js-toc-link toc-link" href="safaridetail://9780136702726" role="button">Open in App</a></li>
        </ul>
      </section>
      <div class="sbo-book-meta">
        
        <span class="cover">
         <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/">
          <img src="./Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition_files/saved_resource" alt="Cover image for Ruby on Rails Tutorial, 6th Edition" height="184" width="141">
        </a>
        </span>
        <span class="title">
          
            
                <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/publisher/addison-wesley-professional/">
                  <img src="./Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition_files/addison-wesley.png" class="publisher-logo video" alt="publisher logo">
                </a>
            
          

          <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/">Ruby on Rails Tutorial, 6th Edition</a>
        </span>
        
        <span class="authors">by Michael Hartl</span>
        

        
        <span class="publishers t-publishers">Published by
          <!-- Show publisher page link if publisher pages switch is on -->
          
            <a class="t-publisher-link toc-link js-toc-link" href="https://learning.oreilly.com/library/publisher/addison-wesley-professional/">
              Addison-Wesley Professional</a>, 2020
          
        </span>
        

    

    </div>
  <ol class="tocList">
    
    
    
     

     <li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/cover.xhtml">
        Cover Page <span class="minutes">(01:09 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/pref00.xhtml">
        About This eBook <span class="minutes">(01:09 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/halftitle.xhtml">
        Halftitle Page <span class="minutes">(01:09 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/title.xhtml">
        Title Page <span class="minutes">(01:09 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/copy.xhtml">
        Copyright Page <span class="minutes">(02:18 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/toc.xhtml#toc">
        Contents <span class="minutes">(05:45 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/pref02.xhtml#pref02">
        Foreword <span class="minutes">(01:09 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/pref03.xhtml#pref03">
        Acknowledgments <span class="minutes">(01:09 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/pref04.xhtml#pref04">
        About the Author <span class="minutes">(01:09 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch01.xhtml#ch01">
        Chapter 1. From Zero to Deploy <span class="minutes">(77:03 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch02.xhtml#ch02">
        Chapter 2. A Toy App <span class="minutes">(50:36 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch03.xhtml#ch03">
        Chapter 3. Mostly Static Pages <span class="minutes">(63:15 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch04.xhtml#ch04">
        Chapter 4. Rails-Flavored Ruby <span class="minutes">(57:30 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch05.xhtml#ch05">
        Chapter 5. Filling in the Layout <span class="minutes">(60:57 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch06.xhtml#ch06">
        Chapter 6. Modeling Users <span class="minutes">(67:51 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07">
        Chapter 7. Sign Up <span class="minutes">(79:21 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08">
        Chapter 8. Basic Login <span class="minutes">(66:42 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch09.xhtml#ch09">
        Chapter 9. Advanced Login <span class="minutes">(52:54 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1 currently-reading">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch10.xhtml#ch10">
        Chapter 10. Updating, Showing, and Deleting Users <span class="minutes">(73:36 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch11.xhtml#ch11">
        Chapter 11. Account Activation <span class="minutes">(55:12 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch12.xhtml#ch12">
        Chapter 12. Password Reset <span class="minutes">(48:18 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch13.xhtml#ch13">
        Chapter 13. User Microposts <span class="minutes">(106:57 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch14.xhtml#ch14">
        Chapter 14. Following Users <span class="minutes">(78:12 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/index.xhtml#index">
        Index <span class="minutes">(55:12 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/credits.xhtml#credits">
        Credits <span class="minutes">(19:33 mins)</span>
       </a>
      
        
      
    
    
     

     </li><li class="toc-level1">
        
        <a class="js-toc-link toc-link" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch01_images.xhtml#ch01_images">
        Code Snippets <span class="minutes">(09:12 mins)</span>
       </a>
      
        
      
   </li></ol>
 </div>



</div></section></div>

    

    <div class="interface-controls interface-controls-top">
      <ul class="interface-control-btns js-bitlist js-reader">
        <li class="js-search-in-archive search-in-archive t-search-in-archive"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#" title="Search in archive" class="js-search-controls search-controls" onclick="window.Appcues.track(&#39;SearchBook_HeronBook&#39;)"><span class="icon">Search in book...</span></a><form class="search-archive-bar js-search-form"><input type="search" name="query" placeholder="Search inside this book..." autocomplete="off"></form><div class="search-archive-results"><div class="js-sitb-results-region"></div></div></li><li class="queue-control"><div class="js-content-uri" data-content-uri="/api/v1/book/9780136702726/chapter/ch10.xhtml"><div class="js-collections-dropdown collections-dropdown menu-bit-cards" onclick="window.Appcues.track(&#39;AddPlaylist_HeronBook&#39;)"><div data-reactroot="" class="menu-dropdown-wrapper js-menu-dropdown-wrapper align-right"><img class="hidden" src="./Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition_files/ajax-transp.gif" alt="loading spinner"><div class="menu-control"><div class="control "><div class="js-playlists-menu"><button class="js-playlist-icon"><svg class="icon-add-to-playlist-sml" viewBox="0 0 16 14" version="1.1" xmlns="http://www.w3.org/2000/svg"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g fill-rule="nonzero" fill="#000000"><g transform="translate(-1.000000, 0.000000)"><rect x="5" y="0" width="12" height="2"></rect><title>Playlists</title><path d="M4.5,14 C6.43299662,14 8,12.4329966 8,10.5 C8,8.56700338 6.43299662,7 4.5,7 C2.56700338,7 1,8.56700338 1,10.5 C1,12.4329966 2.56700338,14 4.5,14 Z M2.5,10 L4,10 L4,8.5 L5,8.5 L5,10 L6.5,10 L6.5,11 L5,11 L5,12.5 L4,12.5 L4,11 L2.5,11 L2.5,10 Z"></path><circle cx="2" cy="5" r="1"></circle><circle cx="1.94117647" cy="1" r="1"></circle><rect x="5" y="4" width="12" height="2"></rect><rect x="9" y="8" width="8" height="2"></rect><rect x="9" y="12" width="8" height="2"></rect></g></g></g></svg><div class="js-playlist-addto-label">Add&nbsp;To</div></button></div></div></div></div></div></div></li><li class="js-font-control-panel font-control-activator"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#" data-push-state="false" id="font-controls" title="Change font size" aria-label="Change font size" onclick="window.Appcues.track(&#39;ChangeFont_HeronBook&#39;)"><span class="icon">Toggle Font Controls</span></a></li><li class="dropdown sharing-controls"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#" class="trigger" data-push-state="false" title="Share" aria-label="Share" onclick="window.Appcues.track(&#39;Share_HeronBook&#39;)"><i class="fa fa-share"></i></a><ul class="social-sharing dropdown-menu"><li class="currently-reading"><a class="twitter share-button t-twitter" target="_blank" aria-label="Share this section on Twitter" title="Share this section on Twitter" href="https://twitter.com/share?url=https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch10.xhtml&amp;text=Ruby%20on%20Rails%20Tutorial%2C%206th%20Edition&amp;via=OReillyMedia"><span>Twitter</span></a></li><li class="currently-reading"><a class="facebook share-button t-facebook" target="_blank" aria-label="Share this section on Facebook" title="Share this section on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch10.xhtml"><span>Facebook</span></a></li><li class="currently-reading"><a class="googleplus share-button t-googleplus" target="_blank" aria-label="Share this secton on Google Plus" title="Share this secton on Google Plus" href="https://plus.google.com/share?url=https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch10.xhtml"><span>Google Plus</span></a></li><li class="currently-reading"><a class="email share-button t-email" aria-label="Share this section via email" title="Share this section via email" href="mailto:?subject=Safari:%20Chapter%2010.%20Updating%2C%20Showing%2C%20and%20Deleting%20Users&amp;body=https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch10.xhtml%0D%0Afrom%20Ruby%20on%20Rails%20Tutorial%2C%206th%20Edition%0D%0A"><span>Email</span></a></li></ul></li><!-- endif request.user.is_authenticated -->
      </ul>
    </div>

      
          
      

    <section role="document"><script src="./Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition_files/48743.js.download"></script>
<script>
  var userId = "66943332-5511-462c-876e-5d5b720c7edf";

  var userObject = {
    firstName: "Trn",
    segment: "Trial",
    admin: "False",
    profileCreatedOn: "2020-12-01",
    academic: ""
  };
  window.Appcues.identify(userId, userObject);
  window.Appcues.page();

  setTimeout(function () {
    window.Appcues.track('ViewingBook_HeronBook')
  }, 20000);
</script>


	  <div class="t-sbo-prev sbo-prev sbo-nav-top">
  
    
      
        <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">Chapter 7. Sign Up</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-top">
  
    
      
        <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch09.xhtml" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">Chapter 9. Advanced Login</div>
        </a>
    
  
  </div>



<div id="sbo-rt-content"><div class="annotator-wrapper"><section epub:type="chapter">
<h2 class="h2" id="ch08"><span epub:type="pagebreak" id="page_375"></span>Chapter 8</h2>
<h2 class="h2a">Basic Login</h2>
<p class="noindent">Now that new users can sign up for our site (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07">Chapter 7</a>), its time to give them the ability to log in and log out. In this chapter, well implement a basic but still fully functional login system: The application will maintain the logged-in state until the browser is closed by the user. The resulting authentication system will allow us to customize the site and implement an authorization model based on login status and identity of the current user. For example, well be able to update the site header with login/logout links and a profile link.</p>
<p class="indent">In <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch10.xhtml#ch10">Chapter 10</a>, well impose a security model in which only logged-in users can visit the user index page, only the correct user can access the page for editing their information, and only administrative users can delete other users from the database. Finally, in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch13.xhtml#ch13">Chapter 13</a>, well use the identity of a logged-in user to create microposts associated with that user, and in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch14.xhtml#ch14">Chapter 14</a> well allow the current user to follow other users of the application (thereby receiving a feed of their microposts).</p>
<p class="indent">The authentication system from this chapter will also serve a foundation for the more advanced login system developed in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch09.xhtml#ch09">Chapter 9</a>. Instead of forgetting users on browser close, <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch09.xhtml#ch09">Chapter 9</a> will start by <em>automatically</em> remembering users, and will then <em>optionally</em> remember users based on the value of a remember me check box. As a result, taken together <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08">Chapter 8</a> and <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch09.xhtml#ch09">Chapter 9</a> develop all three of the most common types of login systems on the web.<span epub:type="pagebreak" id="page_376"></span></p>
<section>
<h3 class="h3" id="sec8_1">8.1 Sessions</h3>
<p class="noindent">HTTP is a <em>stateless protocol</em>, treating each request as an independent transaction that is unable to use information from any previous requests. This means there is no way within the Hypertext Transfer Protocol to remember a users identity from page to page; instead, web applications requiring user login must use a <em>session</em>, which is a semipermanent connection between two computers (such as a client computer running a web browser and a server running Rails).</p>
<p class="indent">The most common techniques for implementing sessions in Rails involve using <em>cookies</em>, which are small pieces of text placed on the users browser. Because cookies persist from one page to the next, they can store information (such as a user id) that can be used by the application to retrieve the logged-in user from the database. In this section and in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#sec8_2">Section 8.2</a>, well use the Rails method called <span class="dark-green"><strong><code>session</code></strong></span> to make temporary sessions that expire automatically on browser close.<sup><a id="ch08fn1a" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fn1" class="totri-footnote">1</a></sup> In <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch09.xhtml#ch09">Chapter 9</a>, well learn how to make longer-lived sessions using the closely related <strong><span class="dark-green"><code>cookies</code></span></strong> method.</p>
<p class="footnote"><a id="ch08fn1" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fn1a" class="totri-footnote">1</a>. Some browsers offer an option to restore such sessions via a continue where you left off feature, but Rails has no control over this behavior. In such cases, the session cookie may persist even after logging out of the application.</p>
<p class="indent">Its convenient to model sessions as a RESTful resource: Visiting the login page will render a form for <em>new</em> sessions, logging in will <em>create</em> a session, and logging out will <em>destroy</em> it. Unlike the Users resource, which uses a database back end (via the User model) to persist data, the Sessions resource will use cookies, and much of the work involved in login comes from building this cookie-based authentication machinery. In this section and the next, well prepare for this work by constructing a Sessions controller, a login form, and the relevant controller actions. Well then complete user login in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#sec8_2">Section 8.2</a> by adding the necessary session-manipulation code.</p>
<p class="indent">As in previous chapters, well do our work on a topic branch and merge in the changes at the end:</p>
<pre class="pre1"><strong><span class="navy">$</span></strong> git checkout -b basic-login</pre>
<section>
<h4 class="h4" id="sec8_1_1">8.1.1 Sessions Controller</h4>
<p class="noindent">The elements of logging in and out correspond to particular REST actions of the Sessions controller: The login form is handled by the <strong><span class="dark-green"><code>new</code></span></strong> action (covered in this section), actually logging in is handled by sending a <code>POST</code> request to the <strong><span class="dark-green"><code>create</code></span></strong> action <span epub:type="pagebreak" id="page_377"></span>(<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#sec8_2">Section 8.2</a>), and logging out is handled by sending a <code>DELETE</code> request to the <strong><span class="dark-green"><code>destroy</code></span></strong> action (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#sec8_3">Section 8.3</a>). (Recall the association of HTTP verbs with REST actions from <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07tab01">Table 7.1</a>.)</p>
<p class="indent">To get started, well generate a Sessions controller with a <strong><span class="dark-green"><code>new</code></span></strong> action (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex01">Listing 8.1</a>).</p>
<p class="ex-title" id="ch08ex01"><strong>Listing 8.1:</strong> Generating the Sessions controller.</p>
<p class="codelink"><a id="pf0377-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0377-01a">Click here to view code image</a></p>
<div class="example">
<pre><strong><span class="navy">$</span></strong> rails generate controller Sessions new</pre>
</div>
<p class="noindent">(Including <strong><span class="dark-green"><code>new</code></span></strong> actually generates <em>views</em> as well, which is why we dont include actions like <strong><span class="dark-green"><code>create</code></span></strong> and <strong><span class="dark-green"><code>destroy</code></span></strong> that dont correspond to views.) Following the model from <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#sec7_2">Section 7.2</a> for the signup page, our plan is to create a login form for creating new sessions, as mocked up in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fig01">Figure 8.1</a>.</p>
<figure id="ch08fig01" class="image-l">
<img src="./Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition_files/fig08_01.jpg" alt="Image" width="677" height="583" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig08_01.jpg">
<figcaption><p><strong>Figure 8.1:</strong> A mockup of the login form.</p></figcaption>
</figure>
<p class="indent"><span epub:type="pagebreak" id="page_378"></span>Unlike the Users resource, which used the special <strong><span class="dark-green"><code>resources</code></span></strong> method to obtain a full suite of RESTful routes automatically (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex03">Listing 7.3</a>), the Sessions resource will use only named routes, handling <code>GET</code> and <code>POST</code> requests with the <strong><span class="dark-green"><code>login</code></span></strong> route and <code>DELETE</code> requests with the <strong><span class="dark-green"><code>logout</code></span></strong> route. The result appears in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex02">Listing 8.2</a> (which also deletes the unneeded routes generated by <strong><span class="dark-green"><code>rails generate controller</code></span></strong>).</p>
<p class="ex-title" id="ch08ex02"><strong>Listing 8.2:</strong> Adding a resource to get the standard RESTful actions for sessions. <span class="red5"><small>RED</small></span></p>
<p><code>config/routes.rb</code></p>
<p class="codelink"><a id="pf0378-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0378-01a">Click here to view code image</a></p>
<div class="example">
<pre><span class="red">Rails</span><span class="ash">.</span>application<span class="ash">.</span>routes<span class="ash">.</span>draw <strong><span class="green">do</span></strong>
  root   <span class="maroon">'static_pages#home'</span>
  get    <span class="maroon">'/help'</span>,    <span class="violet">to</span>: <span class="maroon">'static_pages#help'</span>
  get    <span class="maroon">'/about'</span>,   <span class="violet">to</span>: <span class="maroon">'static_pages#about'</span>
  get    <span class="maroon">'/contact'</span>, <span class="violet">to</span>: <span class="maroon">'static_pages#contact'</span>
  get    <span class="maroon">'/signup'</span>,  <span class="violet">to</span>: <span class="maroon">'users#new'</span>
  get    <span class="maroon">'/login'</span>,   <span class="violet">to</span>: <span class="maroon">'sessions#new'</span>
<span class="mark">  get    <span class="red2">'/login'</span>,   <span class="blue1">to</span>: <span class="red2">'sessions#new'</span></span>
<span class="mark">  post   <span class="red2">'/login'</span>,   <span class="blue1">to</span>: <span class="red2">'sessions#create'</span></span>
<span class="mark">  delete <span class="red2">'/logout'</span>,  <span class="blue1">to</span>: <span class="red2">'sessions#destroy'</span></span>
  resources <span class="violet">:users</span>
<strong><span class="green">end</span></strong></pre>
</div>
<p class="noindent">With the routes in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex02">Listing 8.2</a>, we also need to update the test generated in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex01">Listing 8.1</a> with the new login route, as shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex03">Listing 8.3</a>.</p>
<p class="ex-title" id="ch08ex03"><strong>Listing 8.3:</strong> Updating the Sessions controller test to use the login route. <span class="green5"><small>GREEN</small></span></p>
<p><code>test/controllers/sessions_controller_test.rb</code></p>
<p class="codelink"><a id="pf0378-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0378-02a">Click here to view code image</a></p>
<div class="example">
<pre><span class="green1">require</span> <span class="maroon">'test_helper'</span>

<strong><span class="green">class</span></strong> <strong><span class="blue3">SessionsControllerTest</span></strong> <span class="ash">&lt;</span> <span class="red">ActionDispatch</span><span class="ash">::</span><span class="red">IntegrationTest</span>

  <span class="green1">test</span> <span class="maroon">"should get new"</span> <strong><span class="green">do</span></strong>
<span class="mark">    get login_path</span>
    assert_response <span class="violet">:success</span>
  <strong><span class="green">end</span></strong>
<strong><span class="green">end</span></strong></pre>
</div>
<p class="indent">The routes defined in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex02">Listing 8.2</a> correspond to URLs and actions similar to those for users (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07tab01">Table 7.1</a>), as shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08tab01">Table 8.1</a>.<span epub:type="pagebreak" id="page_379"></span></p>
<figure id="ch08tab01">
<figcaption><p class="left"><strong>Table 8.1:</strong> Routes provided by the sessions rules in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex02">Listing 8.2</a>.</p></figcaption>
<table class="topbot">
<thead>
<tr>
<th class="tab-th"><p class="tab-para">HTTP request</p></th>
<th class="tab-th"><p class="tab-para">URL</p></th>
<th class="tab-th"><p class="tab-para">Named route</p></th>
<th class="tab-th"><p class="tab-para">Action</p></th>
<th class="tab-th"><p class="tab-para">Purpose</p></th>
</tr>
</thead>
<tbody>
<tr>
<td><p class="tab-para"><code>GET</code></p></td>
<td><p class="tab-para">/login</p></td>
<td><p class="tab-para"><strong><span class="dark-green"><code>login_path</code></span></strong></p></td>
<td><p class="tab-para"><strong><span class="dark-green"><code>new</code></span></strong></p></td>
<td><p class="tab-para">page for a new session (login)</p></td>
</tr>
<tr>
<td><p class="tab-para"><code>POST</code></p></td>
<td><p class="tab-para">/login</p></td>
<td><p class="tab-para"><strong><span class="dark-green"><code>login_path</code></span></strong></p></td>
<td><p class="tab-para"><strong><span class="dark-green"><code>create</code></span></strong></p></td>
<td><p class="tab-para">create a new session (login)</p></td>
</tr>
<tr>
<td><p class="tab-para"><code>DELETE</code></p></td>
<td><p class="tab-para">/logout</p></td>
<td><p class="tab-para"><strong><span class="dark-green"><code>logout_path</code></span></strong></p></td>
<td><p class="tab-para"><strong><span class="dark-green"><code>destroy</code></span></strong></p></td>
<td><p class="tab-para">delete a session (log out)</p></td>
</tr>
</tbody>
</table>
</figure>
<p class="indent">Since weve now added several custom named routes, its useful to look at the complete list of the routes for our application, which we can generate using <strong><span class="dark-green"><code>rails routes</code></span></strong>:</p>
<p class="codelink"><a id="pf0379-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0379-01a">Click here to view code image</a></p>
<pre class="pre1"><strong><span class="navy">$</span></strong> rails routes
   <span class="green">Prefix Verb   URI Pattern               Controller#Action</span>
     <span class="green">root GET    /                         static_pages#home</span>
     <span class="green">help GET    /help(.:format)           static_pages#help</span>
    <span class="green">about GET    /about(.:format)          static_pages#about</span>
  <span class="green">contact GET    /contact(.:format)        static_pages#contact</span>
   <span class="green">signup GET    /signup(.:format)         users#new</span>
    <span class="green">login GET    /login(.:format)          sessions#new</span>
          <span class="green">POST   /login(.:format)          sessions#create</span>
   <span class="green">logout DELETE /logout(.:format)         sessions#destroy</span>
    <span class="green">users GET    /users(.:format)          users#index</span>
          <span class="green">POST   /users(.:format)          users#create</span>
 <span class="green">new_user GET    /users/new(.:format)      users#new</span>
<span class="green">edit_user GET    /users/:id/edit(.:format) users#edit</span>
     <span class="green">user GET    /users/:id(.:format)      users#show</span>
          <span class="green">PATCH  /users/:id(.:format)      users#update</span>
          <span class="green">PUT    /users/:id(.:format)      users#update</span>
          <span class="green">DELETE /users/:id(.:format)      users#destroy</span></pre>
<p class="noindent">Its not necessary to understand these results in detail, but viewing the routes in this manner gives us a high-level overview of the actions supported by our application.</p>
<section>
<h5 class="h5" id="lev85">Exercises</h5>
<p class="noindent">Solutions to the exercises are available to all Rails Tutorial purchasers at <a href="https://www.railstutorial.org/aw-solutions">https://www.railstutorial.org/aw-solutions</a>.</p>
<p class="indent">To see other peoples answers and to record your own, subscribe to the Rails Tutorial course or to the Learn Enough All Access Bundle.</p>
<ol class="num">
<li><p class="num">What is the difference between <code>GET <strong>login_path</strong></code> and <code>POST <strong>login_path</strong></code>?</p></li>
<li><p class="num">By piping the results of <strong><span class="dark-green"><code>rails routes</code></span></strong> to <strong><span class="dark-green"><code>grep</code></span></strong>, list all the routes associated with the Users resource. Do the same for Sessions. How many routes does each resource <span epub:type="pagebreak" id="page_380"></span>have? <em>Hint</em>: Refer to the section on grep in <em>Learn Enough Command Line to Be Dangerous</em> (<a href="http://www.learnenough.com/command-line">www.learnenough.com/command-line</a>).</p></li>
</ol></section>
</section>
<section>
<h4 class="h4" id="sec8_1_2">8.1.2 Login Form</h4>
<p class="noindent">Having defined the relevant controller and route, now well fill in the view for new sessionsthat is, the login form. Comparing <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fig01">Figure 8.1</a> with <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fig012">Figure 7.12</a>, we see that the login form is similar in appearance to the signup form, except it has two fields (email and password) instead of four.</p>
<p class="indent">As seen in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fig02">Figure 8.2</a>, when the login information is invalid we want to re-render the login page and display an error message. In <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#sec7_3_3">Section 7.3.3</a>, we used an error-messages partial to display error messages, but we saw in that section that those <span epub:type="pagebreak" id="page_381"></span>messages are provided automatically by Active Record. This wont work for session creation errors because the session isnt an Active Record object, so well render the error as a flash message instead.</p>
<figure id="ch08fig02" class="image-l">
<img src="./Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition_files/fig08_02.jpg" alt="Image" width="677" height="583" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig08_02.jpg">
<figcaption><p><strong>Figure 8.2:</strong> A mockup of login failure.</p></figcaption>
</figure>
<p class="indent">Recall from <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex015">Listing 7.15</a> that the signup form uses the <strong><span class="dark-green"><code>form_with</code></span></strong> helper, taking as an argument the user instance variable <strong><span class="dark-green"><code>@user</code></span></strong>:</p>
<p class="codelink"><a id="pf0381-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0381-01a">Click here to view code image</a></p>
<pre class="pre1"><span class="red5">&lt;%=</span> form_with(<span class="violet">model</span>: <span class="violet">@user</span>, <span class="violet">local</span>: <strong><span class="green">true</span></strong>) <strong><span class="green">do</span></strong> <span class="ash">|</span>f<span class="ash">|</span> <span class="red5">%&gt;</span>
  .
  .
  .
<span class="red5">&lt;%</span> <strong><span class="green">end</span></strong> <span class="red5">%&gt;</span></pre>
<p class="noindent">The main difference between the session form and the signup form is that we have no Session model, and hence no analogue for the <strong><span class="dark-green"><code>@user</code></span></strong> variable. This means that, in constructing the new session form, we have to give <strong><span class="dark-green"><code>form_with</code></span></strong> slightly different information. In particular, whereas</p>
<p class="codelink"><a id="pf0381-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0381-02a">Click here to view code image</a></p>
<pre class="pre1">form_with(<span class="violet">model</span>: <span class="violet">@user</span>, <span class="violet">local</span>: <strong><span class="green">true</span></strong>)</pre>
<p class="noindent">enables Rails to infer that the <strong><span class="dark-green"><code>action</code></span></strong> of the form should be to <code>POST</code> to the URL /users, in the case of sessions we need to indicate the corresponding URL, along with the <em>scope</em> (in this case, the session):</p>
<p class="codelink"><a id="pf0381-03" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0381-03a">Click here to view code image</a></p>
<pre class="pre1">form_with(<span class="violet">url</span>: login_path, <span class="violet">scope</span>: <span class="violet">:session</span>, <span class="violet">local</span>: <strong><span class="green">true</span></strong>)</pre>
<p class="indent">With the proper <strong><span class="dark-green"><code>form_with</code></span></strong> in hand, its easy to make a login form to match the mockup in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fig01">Figure 8.1</a> using the signup form (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex015">Listing 7.15</a>) as a model, as shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex04">Listing 8.4</a>.</p>
<p class="ex-title" id="ch08ex04"><strong>Listing 8.4:</strong> Code for the login form.</p>
<p><code>app/views/sessions/new.html.erb</code></p>
<p class="codelink"><a id="pf0381-04" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0381-04a">Click here to view code image</a></p>
<div class="example">
<pre><span class="red5">&lt;%</span> provide(<span class="violet">:title</span>, <span class="maroon">"Log in"</span>) <span class="red5">%&gt;</span>
&lt;<strong><span class="green">h1</span></strong>&gt;Log in&lt;/<strong><span class="green">h1</span></strong>&gt;

&lt;<strong><span class="green">div</span></strong> <span class="ash3">class</span><span class="ash">=</span><span class="maroon">"row"</span>&gt;
  &lt;<strong><span class="green">div</span></strong> <span class="ash3">class</span><span class="ash">=</span><span class="maroon">"col-md-6 col-md-offset-3"</span>&gt;
    <span class="red5">&lt;%=</span> form_with(<span class="violet">url</span>: login_path, <span class="violet">scope</span>: <span class="violet">:session</span>, <span class="violet">local</span>: <strong><span class="green">true</span></strong>) <strong><span class="green">do</span></strong> <span class="ash">|</span>f<span class="ash">|</span> <span class="red5">%&gt;</span>
<span epub:type="pagebreak" id="page_382"></span>    <span class="red5">&lt;%=</span> f<span class="ash">.</span>label <span class="violet">:email</span> <span class="red5">%&gt;</span>
    <span class="red5">&lt;%=</span> f<span class="ash">.</span>email_field <span class="violet">:email</span>, <span class="violet">class</span>: <span class="maroon">'form-control'</span> <span class="red5">%&gt;</span>

    <span class="red5">&lt;%=</span> f<span class="ash">.</span>label <span class="violet">:password</span> <span class="red5">%&gt;</span>
    <span class="red5">&lt;%=</span> f<span class="ash">.</span>password_field <span class="violet">:password</span>, <span class="violet">class</span>: <span class="maroon">'form-control'</span> <span class="red5">%&gt;</span>

    <span class="red5">&lt;%=</span> f<span class="ash">.</span>submit <span class="maroon">"Log in"</span>, <span class="violet">class</span>: <span class="maroon">"btn btn-primary"</span> <span class="red5">%&gt;</span>
  <span class="red5">&lt;%</span> <strong><span class="green">end</span></strong> <span class="red5">%&gt;</span>

  &lt;<strong><span class="green">p</span></strong>&gt;New user? <span class="red5">&lt;%=</span> link_to <span class="maroon">"Sign up now!"</span>, signup_path <span class="red5">%&gt;</span>&lt;/<strong><span class="green">p</span></strong>&gt;
 &lt;/<strong><span class="green">div</span></strong>&gt;
&lt;/<strong><span class="green">div</span></strong>&gt;</pre>
</div>
<p class="noindent">Note that weve added a link to the signup page for convenience. With the code in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex04">Listing 8.4</a>, the login form appears as in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fig03">Figure 8.3</a>. (Because the Log in navigation link hasnt yet been filled in, youll have to type the /login URL directly into your address bar. Well fix this blemish in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#sec8_2_3">Section 8.2.3</a>.)</p>
<figure id="ch08fig03" class="image-l">
<img src="./Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition_files/fig08_03.jpg" alt="Image" width="677" height="521" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig08_03.jpg">
<figcaption><p><strong>Figure 8.3:</strong> The login form.</p></figcaption>
</figure>
<p class="indent"><span epub:type="pagebreak" id="page_383"></span>The generated form HTML appears in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex05">Listing 8.5</a>.</p>
<p class="ex-title" id="ch08ex05"><strong>Listing 8.5:</strong> HTML for the login form produced by <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex04">Listing 8.4</a>.</p>
<p class="codelink"><a id="pf0383-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0383-01a">Click here to view code image</a></p>
<div class="example">
<pre>&lt;<strong><span class="green">form</span></strong> <span class="ash3">accept-charset</span><span class="ash">=</span><span class="maroon">"UTF-8"</span> <span class="ash3">action</span><span class="ash">=</span><span class="maroon">"/login"</span> <span class="ash3">method</span><span class="ash">=</span><span class="maroon">"post"</span>&gt;
  &lt;<strong><span class="green">input</span></strong> <span class="ash3">name</span><span class="ash">=</span><span class="maroon">"authenticity_token"</span> <span class="ash3">type</span><span class="ash">=</span><span class="maroon">"hidden"</span>
         <span class="ash3">value</span><span class="ash">=</span><span class="maroon">"NNb6+J/j46LcrgYUC60wQ2titMuJQ5lLqyAbnbAUkdo="</span> /&gt;
  &lt;<strong><span class="green">label</span></strong> <span class="ash3">for</span><span class="ash">=</span><span class="maroon">"session_email"</span>&gt;Email&lt;/<strong><span class="green">label</span></strong>&gt;
  &lt;<strong><span class="green">input</span></strong> <span class="ash3">class</span><span class="ash">=</span><span class="maroon">"form-control"</span> <span class="ash3">id</span><span class="ash">=</span><span class="maroon">"session_email"</span>
         <span class="ash3">name</span><span class="ash">=</span><span class="maroon">"session[email]"</span> <span class="ash3">type</span><span class="ash">=</span><span class="maroon">"email"</span> /&gt;
  &lt;<strong><span class="green">label</span></strong> <span class="ash3">for</span><span class="ash">=</span><span class="maroon">"session_password"</span>&gt;Password&lt;/<strong><span class="green">label</span></strong>&gt;
  &lt;<strong><span class="green">input</span></strong> <span class="ash3">id</span><span class="ash">=</span><span class="maroon">"session_password"</span> <span class="ash3">name</span><span class="ash">=</span><span class="maroon">"session[password]"</span>
         <span class="ash3">type</span><span class="ash">=</span><span class="maroon">"password"</span> /&gt;
  &lt;<strong><span class="green">input</span></strong> <span class="ash3">class</span><span class="ash">=</span><span class="maroon">"btn btn-primary"</span> <span class="ash3">name</span><span class="ash">=</span><span class="maroon">"commit"</span> <span class="ash3">type</span><span class="ash">=</span><span class="maroon">"submit"</span>
      <span class="ash3">value</span><span class="ash">=</span><span class="maroon">"Log in"</span> /&gt;
&lt;/<strong><span class="green">form</span></strong>&gt;</pre>
</div>
<p class="noindent">Comparing <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex05">Listing 8.5</a> with <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex017">Listing 7.17</a>, you might be able to guess that submitting this form will result in a <strong><span class="dark-green"><code>params</code></span></strong> hash, where <strong><span class="dark-green"><code>params[:session][:email]</code></span></strong> and <strong><span class="dark-green"><code>params[:session][:password]</code></span></strong> correspond to the email and password fields, respectively.</p>
<section>
<h5 class="h5" id="lev86">Exercise</h5>
<p class="noindent">Solutions to the exercises are available to all Rails Tutorial purchasers at <a href="https://www.railstutorial.org/aw-solutions">https://www.railstutorial.org/aw-solutions</a>.</p>
<p class="indent">To see other peoples answers and to record your own, subscribe to the Rails Tutorial course or to the Learn Enough All Access Bundle.</p>
<ol class="num">
<li><p class="num">Submissions from the form defined in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex04">Listing 8.4</a> will be routed to the Session controllers <strong><span class="dark-green"><code>create</code></span></strong> action. How does Rails know to do this? <em>Hint</em>: Refer to <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08tab01">Table 8.1</a> and the first line of <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex05">Listing 8.5</a>.</p></li>
</ol></section>
</section>
<section>
<h4 class="h4" id="sec8_1_3">8.1.3 Finding and Authenticating a User</h4>
<p class="noindent">As in the case of creating users (signup), the first step in creating sessions (login) is to handle <em>invalid</em> input. Well start by reviewing what happens when a form gets <span epub:type="pagebreak" id="page_384"></span>submitted, and then arrange for helpful error messages to appear in the case of login failure (as mocked up in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fig02">Figure 8.2</a>). Then well lay the foundation for successful login (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#sec8_2">Section 8.2</a>) by evaluating each login submission based on the validity of its email/password combination.</p>
<p class="indent">Lets start by defining a minimalist <strong><span class="dark-green"><code>create</code></span></strong> action for the Sessions controller, along with empty <strong><span class="dark-green"><code>new</code></span></strong> and <strong><span class="dark-green"><code>destroy</code></span></strong> actions (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex06">Listing 8.6</a>). The <strong><span class="dark-green"><code>create</code></span></strong> action in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex06">Listing 8.6</a> does nothing but render the <strong><span class="dark-green"><code>new</code></span></strong> view, but its enough to get us started. Submitting the /sessions/new form then yields the result shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fig04">Figure 8.4</a> and <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fig05">Figure 8.5</a>.</p>
<figure id="ch08fig04" class="image-l">
<img src="./Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition_files/fig08_04.jpg" alt="Image" width="677" height="520" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig08_04.jpg">
<figcaption><p><strong>Figure 8.4:</strong> The initial failed login, with <strong><span class="dark-green"><code>create</code></span></strong> as in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex06">Listing 8.6</a>.<span epub:type="pagebreak" id="page_385"></span></p></figcaption>
</figure>
<figure id="ch08fig05" class="image-l">
<img src="./Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition_files/fig08_05.jpg" alt="Image" width="677" height="225" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig08_05.jpg">
<figcaption><p><strong>Figure 8.5:</strong> A closer look at the debug information from <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fig04">Figure 8.4</a>.</p></figcaption>
</figure>
<p class="ex-title" id="ch08ex06"><strong>Listing 8.6:</strong> A preliminary version of the Sessions <strong><span class="dark-green"><code>create</code></span></strong> action.</p>
<p><code>app/controllers/sessions_controller.rb</code></p>
<p class="codelink"><a id="pf0385-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0385-01a">Click here to view code image</a></p>
<div class="example">
<pre><strong><span class="green">class</span></strong> <strong><span class="blue3">SessionsController</span></strong> <span class="ash">&lt;</span> <span class="red">ApplicationController</span>

  <strong><span class="green">def</span></strong> <span class="blue3">new</span>
  <strong><span class="green">end</span></strong>

  <strong><span class="green">def</span></strong> <span class="blue3">create</span>
<span class="mark">    render <span class="red2">'new'</span></span>
  <strong><span class="green">end</span></strong>

  <strong><span class="green">def</span></strong> <span class="blue3">destroy</span>
  <strong><span class="green">end</span></strong>
<strong><span class="green">end</span></strong></pre>
</div>
<p class="indent">Carefully inspecting the debug information in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fig05">Figure 8.5</a> shows that, as hinted at the end of <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#sec8_1_2">Section 8.1.2</a>, the submission results in a <strong><span class="dark-green"><code>params</code></span></strong> hash containing the email and password under the key <strong><span class="dark-green"><code>session</code></span></strong>, which (omitting some irrelevant details used internally by Rails) appears as follows:</p>
<p class="codelink"><a id="pf0385-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0385-02a">Click here to view code image</a></p>
<pre class="pre1"><span class="blue5">---</span>
session:
  email: <span class="red2">'user@example.com'</span>
  password: <span class="red2">'foobar'</span>
commit: Log in
action: create
controller: sessions</pre>
<p class="noindent"><span epub:type="pagebreak" id="page_386"></span>As with the case of user signup (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07fig016">Figure 7.16</a>), these parameters form a <em>nested</em> hash like the one we saw in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch04.xhtml#ch04ex013">Listing 4.13</a>. In particular, <strong><span class="dark-green"><code>params</code></span></strong> contains a nested hash of the form</p>
<p class="codelink"><a id="pf0386-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0386-01a">Click here to view code image</a></p>
<pre class="pre1">{ <span class="violet">session</span>: { <span class="violet">password</span>: <span class="maroon">"foobar"</span>, <span class="violet">email</span>: <span class="maroon">"user@example.com"</span> } }</pre>
<p class="noindent">This means that</p>
<pre class="pre1">params<span class="ash">[</span><span class="violet">:session</span><span class="ash">]</span></pre>
<p class="noindent">is itself a hash:</p>
<p class="codelink"><a id="pf0386-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0386-02a">Click here to view code image</a></p>
<pre class="pre1">{ <span class="violet">password</span>: <span class="maroon">"foobar"</span>, <span class="violet">email</span>: <span class="maroon">"user@example.com"</span> }</pre>
<p class="noindent">As a result,</p>
<pre class="pre1">params<span class="ash">[</span><span class="violet">:session</span><span class="ash">][</span><span class="violet">:email</span><span class="ash">]</span></pre>
<p class="noindent">is the submitted email address and</p>
<pre class="pre1">params<span class="ash">[</span><span class="violet">:session</span><span class="ash">][</span><span class="violet">:password</span><span class="ash">]</span></pre>
<p class="noindent">is the submitted password.</p>
<p class="indent">In other words, inside the <strong><span class="dark-green"><code>create</code></span></strong> action the <strong><span class="dark-green"><code>params</code></span></strong> hash has all the information needed to authenticate users by email and password. Not coincidentally, we already have exactly the methods we need: the <strong><span class="dark-green"><code>User.find_by</code></span></strong> method provided by Active Record (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch06.xhtml#sec6_1_4">Section 6.1.4</a>) and the <strong><span class="dark-green"><code>authenticate</code></span></strong> method provided by <strong><span class="dark-green"><code>has_secure_password</code></span></strong> (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch06.xhtml#sec6_3_4">Section 6.3.4</a>). Recalling that <strong><span class="dark-green"><code>authenticate</code></span></strong> returns <strong><span class="dark-green"><code>false</code></span></strong> for an invalid authentication (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch06.xhtml#sec6_3_4">Section 6.3.4</a>), our strategy for user login can be summarized as shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex07">Listing 8.7</a>.<span epub:type="pagebreak" id="page_387"></span></p>
<p class="ex-title" id="ch08ex07"><strong>Listing 8.7:</strong> Finding and authenticating a user.</p>
<p><code>app/controllers/sessions_controller.rb</code></p>
<p class="codelink"><a id="pf0387-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0387-01a">Click here to view code image</a></p>
<div class="example">
<pre><strong><span class="green">class</span></strong> <strong><span class="blue3">SessionsController</span></strong> <span class="ash">&lt;</span> <span class="red">ApplicationController</span>

  <strong><span class="green">def</span></strong> <span class="blue3">new</span>
  <strong><span class="green">end</span></strong>

  <strong><span class="green">def</span></strong> <span class="blue3">create</span>
<span class="mark">    user <span class="ash1">=</span> <span class="red2">User</span><span class="ash1">.</span>find_by(<span class="blue1">email:</span> params<span class="ash1">[</span><span class="blue1">:session</span><span class="ash1">][</span><span class="blue1">:email</span><span class="ash1">].</span>downcase)</span>
<span class="mark">    <strong><span class="green3">if</span></strong> user <span class="ash1">&amp;&amp;</span> user<span class="ash1">.</span>authenticate(params<span class="ash1">[</span><span class="blue1">:session</span><span class="ash1">][</span><span class="blue1">:password</span><span class="ash1">]</span>)</span>
      <span class="blue"># Log the user in and redirect to the user's show page.</span>
    <strong><span class="green">else</span></strong>
      <span class="blue"># Create an error message.</span>
      render <span class="maroon">'new'</span>
    <strong><span class="green">end</span></strong>
  <strong><span class="green">end</span></strong>

  <strong><span class="green">def</span></strong> <span class="blue3">destroy</span>
  <strong><span class="green">end</span></strong>
<strong><span class="green">end</span></strong></pre>
</div>
<p class="noindent">The first highlighted line in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex07">Listing 8.7</a> pulls the user out of the database using the submitted email address. (Recall from <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch06.xhtml#sec6_2_5">Section 6.2.5</a> that email addresses are saved as all lowercase, so here we use the <strong><span class="dark-green"><code>downcase</code></span></strong> method to ensure a match when the submitted address is valid.) The next line can be a bit confusing but is fairly common in idiomatic Rails programming:</p>
<p class="codelink"><a id="pf0387-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0387-02a">Click here to view code image</a></p>
<pre class="pre1">user <span class="ash">&amp;&amp;</span> user<span class="ash">.</span>authenticate(params<span class="ash">[</span><span class="violet">:session</span><span class="ash">][</span><span class="violet">:password</span><span class="ash">]</span>)</pre>
<p class="noindent">This line uses <strong><span class="dark-green"><code>&amp;&amp;</code></span></strong> (logical <em>and</em>) to determine if the resulting user is valid. Taking into account that any object other than <strong><span class="dark-green"><code>nil</code></span></strong> and <strong><span class="dark-green"><code>false</code></span></strong> itself is <strong><span class="dark-green"><code>true</code></span></strong> in a boolean context (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch04.xhtml#sec4_2_2">Section 4.2.2</a>), the possibilities appear as in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08tab02">Table 8.2</a>. We see from <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08tab02">Table 8.2</a> that the <strong><span class="dark-green"><code>if</code></span></strong> statement is <strong><span class="dark-green"><code>true</code></span></strong> only if a user with the given email both exists in the database and has the given passwordexactly as required.</p>
<section>
<h5 class="h5" id="lev87">Exercise</h5>
<p class="noindent">Solutions to the exercises are available to all Rails Tutorial purchasers at <a href="https://www.railstutorial.org/aw-solutions">https://www.railstutorial.org/aw-solutions</a>.</p>
<p class="indent">To see other peoples answers and to record your own, subscribe to the Rails Tutorial course or to the Learn Enough All Access Bundle.<span epub:type="pagebreak" id="page_388"></span></p>
<figure id="ch08tab02">
<figcaption><p class="left"><strong>Table 8.2:</strong> Possible results of <strong><span class="dark-green"><code>user &amp;&amp; user.authenticate(...)</code></span></strong>.</p></figcaption>
<table class="topbot">
<thead>
<tr>
<th class="tab-th"><p class="tab-para">User</p></th>
<th class="tab-th"><p class="tab-para">Password</p></th>
<th class="tab-th"><p class="tab-para">a &amp;&amp; b</p></th>
</tr>
</thead>
<tbody>
<tr>
<td><p class="tab-para">nonexistent</p></td>
<td><p class="tab-para"><em>anything</em></p></td>
<td><p class="tab-para"><strong><span class="dark-green"><code>(nil &amp;&amp; [anything]) == false</code></span></strong></p></td>
</tr>
<tr>
<td><p class="tab-para">valid user</p></td>
<td><p class="tab-para">wrong password</p></td>
<td><p class="tab-para"><strong><span class="dark-green"><code>(true &amp;&amp; false) == false</code></span></strong></p></td>
</tr>
<tr>
<td><p class="tab-para">valid user</p></td>
<td><p class="tab-para">right password</p></td>
<td><p class="tab-para"><strong><span class="dark-green"><code>(true &amp;&amp; true) == true</code></span></strong></p>
</td>
</tr>
</tbody>
</table>
</figure>
<ol class="num">
<li><p class="num">Using the Rails console, confirm each of the values in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08tab02">Table 8.2</a>. Start with <strong><span class="dark-green"><code>user = nil</code></span></strong>, and then use <strong><span class="dark-green"><code>user = User.first</code></span></strong>. <em>Hint</em>: To coerce the result to a boolean value, use the bang-bang trick from <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch04.xhtml#sec4_2_2">Section 4.2.2</a>, as in <strong><span class="dark-green"><code>!!(user &amp;&amp; user.authenticate('foobar'))</code></span></strong>.</p></li>
</ol></section>
</section>
<section>
<h4 class="h4" id="sec8_1_4">8.1.4 Rendering with a Flash Message</h4>
<p class="noindent">Recall from <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#sec7_3_3">Section 7.3.3</a> that we displayed signup errors using the User model error messages. These errors are associated with a particular Active Record object, but this strategy wont work here because the session isnt an Active Record model. Instead, well put a message in the flash to be displayed upon failed login. A first, slightly incorrect, attempt appears in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex08">Listing 8.8</a>.</p>
<p class="ex-title" id="ch08ex08"><strong>Listing 8.8:</strong> An (unsuccessful) attempt at handling failed login.</p>
<p><code>app/controllers/sessions_controller.rb</code></p>
<p class="codelink"><a id="pf0388-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0388-01a">Click here to view code image</a></p>
<div class="example">
<pre><strong><span class="green">class</span></strong> <strong><span class="blue3">SessionsController</span></strong> <span class="ash">&lt;</span> <span class="red">ApplicationController</span>

  <strong><span class="green">def</span></strong> <span class="blue3">new</span>
  <strong><span class="green">end</span></strong>

  <strong><span class="green">def</span></strong> <span class="blue3">create</span>
    user <span class="ash">=</span> <span class="red">User</span><span class="ash">.</span>find_by(<span class="violet">email</span>: params<span class="ash">[</span><span class="violet">:session</span><span class="ash">][</span><span class="violet">:email</span><span class="ash">].</span>downcase)
    <strong><span class="green">if</span></strong> user <span class="ash">&amp;&amp;</span> user<span class="ash">.</span>authenticate(params<span class="ash">[</span><span class="violet">:session</span><span class="ash">][</span><span class="violet">:password</span><span class="ash">]</span>)
      <span class="blue"># Log the user in and redirect to the user's show page.</span>
    <strong><span class="green">else</span></strong>
<span class="mark">      flash<span class="ash">[</span><span class="violet">:danger</span><span class="ash">] =</span> <span class="maroon">'Invalid email/password combination'</span> <span class="blue"># Not quite right!</span></span>
      render <span class="maroon">'new'</span>
    <strong><span class="green">end</span></strong>
  <strong><span class="green">end</span></strong>
<span epub:type="pagebreak" id="page_389"></span>  <strong><span class="green">def</span></strong> <span class="blue3">destroy</span>
  <strong><span class="green">end</span></strong>
<strong><span class="green">end</span></strong></pre>
</div>
<p class="noindent">Because of the flash message display in the site layout (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex029">Listing 7.29</a>), the <strong><span class="dark-green"><code>flash[:danger]</code></span></strong> message automatically gets displayed; because of the Bootstrap CSS, it automatically gets nice styling (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fig06">Figure 8.6</a>).</p>
<figure id="ch08fig06" class="image-l">
<img src="./Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition_files/fig08_06.jpg" alt="Image" width="677" height="523" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig08_06.jpg">
<figcaption><p><strong>Figure 8.6:</strong> The flash message for a failed login.</p></figcaption>
</figure>
<p class="indent">Unfortunately, as noted in the text and in the comment in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex08">Listing 8.8</a>, this code isnt quite right. The page looks fine, though, so whats the problem? The issue is that the contents of the flash persist for one <em>request</em>, butunlike a redirect, which we used in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex027">Listing 7.27</a>re-rendering a template with <strong><span class="dark-green"><code>render</code></span></strong> doesnt count as a request. The result is that the flash message persists one request longer than we want. For example, if we submit invalid login information and then click on the Home page, the flash gets displayed a second time (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fig07">Figure 8.7</a>). Fixing this blemish is the task of <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#sec8_1_5">Section 8.1.5</a>.<span epub:type="pagebreak" id="page_390"></span></p>
<figure id="ch08fig07" class="image-l">
<img src="./Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition_files/fig08_07.jpg" alt="Image" width="677" height="523" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig08_07.jpg">
<figcaption><p><strong>Figure 8.7:</strong> An example of flash persistence.</p></figcaption>
</figure>
</section>
<section>
<h4 class="h4" id="sec8_1_5">8.1.5 A Flash Test</h4>
<p class="noindent">The incorrect flash behavior is a minor bug in our application. According to the testing guidelines from <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch03.xhtml#box3_3">Box 3.3</a>, this is exactly the sort of situation where we should write a test to catch the error so that it doesnt recur. Well thus write a short integration test for the login form submission before proceeding. In addition to documenting the bug and preventing a regression, this will give us a good foundation for further integration tests of login and logout.</p>
<p class="indent">We start by generating an integration test for our applications login behavior:</p>
<p class="codelink"><a id="pf0390-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0390-01a">Click here to view code image</a></p>
<pre class="pre1"><span class="mark"><strong>$</strong> rails generate integration_test users_login</span>
      <span class="green">invoke  test_unit</span>
      <span class="green">create    test/integration/users_login_test.rb</span></pre>
<p class="noindent">Next, we need a test to capture the sequence shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fig06">Figure 8.6</a> and <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fig07">Figure 8.7</a>. The basic steps appear as follows:<span epub:type="pagebreak" id="page_391"></span></p>
<ol class="num">
<li><p class="num">Visit the login path.</p></li>
<li><p class="num">Verify that the new sessions form renders properly.</p></li>
<li><p class="num">Post to the sessions path with an invalid <strong><span class="dark-green"><code>params</code></span></strong> hash.</p></li>
<li><p class="num">Verify that the new sessions form gets re-rendered and that a flash message appears.</p></li>
<li><p class="num">Visit another page (such as the Home page).</p></li>
<li><p class="num">Verify that the flash message <em>doesnt</em> appear on the new page.</p></li>
</ol>
<p class="noindent">A test implementing these steps appears in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex09">Listing 8.9</a>.</p>
<p class="ex-title" id="ch08ex09"><strong>Listing 8.9:</strong> A test to catch unwanted flash persistence. <span class="red5"><small>RED</small></span></p>
<p><code>test/integration/users_login_test.rb</code></p>
<p class="codelink"><a id="pf0391-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0391-01a">Click here to view code image</a></p>
<div class="example">
<pre><span class="green1">require</span> <span class="maroon">'test_helper'</span>

<strong><span class="green">class</span></strong> <strong><span class="blue3">UsersLoginTest</span></strong> <span class="ash">&lt;</span> <span class="red">ActionDispatch</span><span class="ash">::</span><span class="red">IntegrationTest</span>

  <span class="green1">test</span> <span class="maroon">"login with invalid information"</span> <strong><span class="green">do</span></strong>
    get login_path
    assert_template <span class="maroon">'sessions/new'</span>
    post login_path, <span class="violet">params</span>: { <span class="violet">session</span>: { <span class="violet">email</span>: <span class="maroon">""</span>, <span class="violet">password</span>: <span class="maroon">""</span> } }
    assert_template <span class="maroon">'sessions/new'</span>
    assert_not flash<span class="ash">.</span>empty?
    get root_path
    assert flash<span class="ash">.</span>empty?
  <strong><span class="green">end</span></strong>
<strong><span class="green">end</span></strong></pre>
</div>
<p class="indent">After adding the test in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex09">Listing 8.9</a>, the login test should be <span class="red5"><small>RED</small></span>:</p>
<p class="ex-title" id="ch08ex010"><strong>Listing 8.10:</strong> <span class="red5"><small>RED</small></span></p>
<p class="codelink"><a id="pf0391-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0391-02a">Click here to view code image</a></p>
<div class="example">
<pre>$ rails test test/integration/users_login_test.rb</pre>
</div>
<p class="noindent">This code shows how to run one (and only one) test file using <strong><span class="dark-green"><code>rails test</code></span></strong> and the full path to the file.</p>
<p class="indent">The way to get the failing test in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex09">Listing 8.9</a> to pass is to replace <strong><span class="dark-green"><code>flash</code></span></strong> with the special variant <strong><span class="dark-green"><code>flash.now</code></span></strong>, which is specifically designed for displaying flash messages <span epub:type="pagebreak" id="page_392"></span>on rendered pages. Unlike the contents of <strong><span class="dark-green"><code>flash</code></span></strong>, the contents of <strong><span class="dark-green"><code>flash.now</code></span></strong> disappear as soon as there is an additional request, which is exactly the behavior weve tested in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex09">Listing 8.9</a>. With this substitution, the corrected application code appears as in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex011">Listing 8.11</a>.</p>
<p class="ex-title" id="ch08ex011"><strong>Listing 8.11:</strong> Correct code for failed login. <span class="green5"><small>GREEN</small></span></p>
<p><code>app/controllers/sessions_controller.rb</code></p>
<p class="codelink"><a id="pf0392-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0392-01a">Click here to view code image</a></p>
<div class="example">
<pre><strong><span class="green">class</span></strong> <strong><span class="blue3">SessionsController</span></strong> <span class="ash">&lt;</span> <span class="red">ApplicationController</span>

  <strong><span class="green">def</span></strong> <span class="blue3">new</span>
  <strong><span class="green">end</span></strong>

  <strong><span class="green">def</span></strong> <span class="blue3">create</span>
    user <span class="ash">=</span> <span class="red">User</span><span class="ash">.</span>find_by(<span class="violet">email</span>: params<span class="ash">[</span><span class="violet">:session</span><span class="ash">][</span><span class="violet">:email</span><span class="ash">].</span>downcase)
    <strong><span class="green">if</span></strong> user <span class="ash">&amp;&amp;</span> user<span class="ash">.</span>authenticate(params<span class="ash">[</span><span class="violet">:session</span><span class="ash">][</span><span class="violet">:password</span><span class="ash">]</span>)
      <span class="blue"># Log the user in and redirect to the user's show page.</span>
    <strong><span class="green">else</span></strong>
<span class="mark">      flash<span class="ash1">.</span>now<span class="ash1">[</span><span class="blue1">:danger</span><span class="ash1">] =</span> <span class="red2">'Invalid email/password combination'</span></span>
      render <span class="maroon">'new'</span>
    <strong><span class="green">end</span></strong>
  <strong><span class="green">end</span></strong>

  <strong><span class="green">def</span></strong> <span class="blue3">destroy</span>
  <strong><span class="green">end</span></strong>
<strong><span class="green">end</span></strong></pre>
</div>
<p class="indent">We can then verify that both the login integration test and the full test suite are <span class="green5"><small>GREEN</small></span>:</p>
<p class="ex-title" id="ch08ex012"><strong>Listing 8.12:</strong> <span class="green5"><small>GREEN</small></span></p>
<p class="codelink"><a id="pf0392-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0392-02a">Click here to view code image</a></p>
<div class="example">
<pre>$ rails test test/integration/users_login_test.rb
$ rails test</pre>
</div>
<section>
<h5 class="h5" id="lev88">Exercise</h5>
<p class="noindent">Solutions to the exercises are available to all Rails Tutorial purchasers at <a href="https://www.railstutorial.org/aw-solutions">https://www.railstutorial.org/aw-solutions</a>.</p>
<p class="indent">To see other peoples answers and to record your own, subscribe to the Rails Tutorial course or to the Learn Enough All Access Bundle.<span epub:type="pagebreak" id="page_393"></span></p>
<ol class="num">
<li><p class="num">Verify in your browser that the sequence from <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#sec8_1_4">Section 8.1.4</a> works correctlythat is, that the flash message disappears when you click on a second page.</p></li>
</ol>
</section>
</section>
</section>
<section>
<h3 class="h3" id="sec8_2">8.2 Logging In</h3>
<p class="noindent">Now that our login form can handle invalid submissions, the next step is to handle valid submissions correctly by actually logging a user in. In this section, well log the user in with a temporary session cookie that expires automatically upon browser close. In <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch09.xhtml#sec9_1">Section 9.1</a>, well add sessions that persist even after closing the browser.</p>
<p class="indent">Implementing sessions will involve defining a large number of related functions for use across multiple controllers and views. You may recall from <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch04.xhtml#sec4_2_4">Section 4.2.4</a> that Ruby provides a <em>module</em> facility for packaging such functions in one place. Conveniently, a Sessions helper module was generated automatically when generating the Sessions controller (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#sec8_1_1">Section 8.1.1</a>). Moreover, such helpers are automatically included in Rails views; by including the module into the base class of all controllers (the Application controller), we arrange to make them available in our controllers as well (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex013">Listing 8.13</a>).<sup><a id="ch08fn2a" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fn2" class="totri-footnote">2</a></sup></p>
<p class="footnote"><a id="ch08fn2" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fn2a" class="totri-footnote">2</a>. I like this technique because it connects to the pure Ruby way of including modules, but Rails 4 introduced a technique called <em>concerns</em> that can also be used for this purpose. To learn how to use concerns, run a search here for how to use concerns in Rails.</p>
<p class="ex-title" id="ch08ex013"><strong>Listing 8.13:</strong> Including the Sessions helper module into the Application controller.</p>
<p><code>app/controllers/application_controller.rb</code></p>
<p class="codelink"><a id="pf0393-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0393-01a">Click here to view code image</a></p>
<div class="example">
<pre><strong><span class="green">class</span></strong> <strong><span class="blue3">ApplicationController</span></strong> <span class="ash">&lt;</span> <span class="red">ActionController</span><span class="ash">::</span><span class="red">Base</span>
<span class="mark">  <strong><span class="green3">include</span></strong> <span class="red2">SessionsHelper</span></span>
<strong><span class="green">end</span></strong></pre>
</div>
<p class="noindent">With this configuration complete, were now ready to write the code to log users in.<span epub:type="pagebreak" id="page_394"></span></p>
<section>
<h4 class="h4" id="sec8_2_1">8.2.1 The <code>log_in</code> Method</h4>
<p class="noindent">Logging a user in is simple with the help of the <strong><span class="dark-green"><code>session</code></span></strong> method defined by Rails. (This method is separate and distinct from the Sessions controller generated in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#sec8_1_1">Section 8.1.1</a>.) We can treat <strong><span class="dark-green"><code>session</code></span></strong> as if it were a hash, and assign to it as follows:</p>
<pre class="pre1">session<span class="ash">[</span><span class="violet">:user_id</span><span class="ash">] =</span> user<span class="ash">.</span>id</pre>
<p class="noindent">This places a temporary cookie on the users browser containing an encrypted version of the users id, which allows us to retrieve the id on subsequent pages using <strong><span class="dark-green"><code>session[:user_id]</code></span></strong>. In contrast to the persistent cookie created by the <strong><span class="dark-green"><code>cookies</code></span></strong> method (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch09.xhtml#sec9_1">Section 9.1</a>), the temporary cookie created by the <strong><span class="dark-green"><code>session</code></span></strong> method expires immediately when the browser is closed.</p>
<p class="indent">Because well want to use the same login technique in several places, well define a method called <strong><span class="dark-green"><code>log_in</code></span></strong> in the Sessions helper, as shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex014">Listing 8.14</a>.</p>
<p class="ex-title" id="ch08ex014"><strong>Listing 8.14:</strong> The <strong><span class="dark-green"><code>log_in</code></span></strong> function.</p>
<p><code>app/helpers/sessions_helper.rb</code></p>
<p class="codelink"><a id="pf0394-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0394-01a">Click here to view code image</a></p>
<div class="example">
<pre><strong><span class="green">module</span></strong> <strong><span class="blue3">SessionsHelper</span></strong>

  <span class="blue"># Logs in the given user.</span>
  <strong><span class="green">def</span></strong> <span class="blue3">log_in</span>(user)
<span class="mark">    session<span class="ash1">[</span><span class="blue1">:user_id</span><span class="ash1">] =</span> user<span class="ash1">.</span>id</span>
  <strong><span class="green">end</span></strong>
<strong><span class="green">end</span></strong></pre>
</div>
<p class="indent">Because temporary cookies created using the <strong><span class="dark-green"><code>session</code></span></strong> method are automatically encrypted, the code in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex014">Listing 8.14</a> is secure, and there is no way for an attacker to use the session information to log in as the user. This applies only to temporary sessions initiated with the <strong><span class="dark-green"><code>session</code></span></strong> method, though, and is <em>not</em> the case for persistent sessions created using the <strong><span class="dark-green"><code>cookies</code></span></strong> method. Permanent cookies are vulnerable to a <em>session hijacking</em> attack, so in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch09.xhtml#ch09">Chapter 9</a> well have to be much more careful about the information we place on the users browser.<span epub:type="pagebreak" id="page_395"></span></p>
<p class="indent">With the <strong><span class="dark-green"><code>log_in</code></span></strong> method defined in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex014">Listing 8.14</a>, were now ready to complete the session <strong><span class="dark-green"><code>create</code></span></strong> action by logging the user in and redirecting to the users profile page. The result appears in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex015">Listing 8.15</a>.<sup><a id="ch08fn3a" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fn3" class="totri-footnote">3</a></sup></p>
<p class="footnote"><a id="ch08fn3" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fn3a" class="totri-footnote">3</a>. The <strong><span class="dark-green"><code>log_in</code></span></strong> method is available in the Sessions controller because of the module inclusion in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex013">Listing 8.13</a>.</p>
<p class="ex-title" id="ch08ex015"><strong>Listing 8.15:</strong> Logging in a user.</p>
<p><code>app/controllers/sessions_controller.rb</code></p>
<p class="codelink"><a id="pf0395-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0395-01a">Click here to view code image</a></p>
<div class="example">
<pre> <span class="gray">1</span>   <strong><span class="green">class</span></strong> <strong><span class="blue3">SessionsController</span></strong> <span class="ash">&lt;</span> <span class="red">ApplicationController</span>
 <span class="gray">2</span>
 <span class="gray">3</span>     <strong><span class="green">def</span></strong> <span class="blue3">new</span>
 <span class="gray">4</span>     <strong><span class="green">end</span></strong>
 <span class="gray">5</span>
 <span class="gray">6</span>     <strong><span class="green">def</span></strong> <span class="blue3">create</span>
 <span class="gray">7</span>       user <span class="ash">=</span> <span class="red">User</span><span class="ash">.</span>find_by(<span class="violet">email</span>: params<span class="ash">[</span><span class="violet">:session</span><span class="ash">][</span><span class="violet">:email</span><span class="ash">].</span>downcase)
 <span class="gray">8</span>       <strong><span class="green">if</span></strong> user <span class="ash">&amp;&amp;</span> user<span class="ash">.</span>authenticate(params<span class="ash">[</span><span class="violet">:session</span><span class="ash">][</span><span class="violet">:password</span><span class="ash">]</span>)
 <span class="gray">9</span>   <span class="mark">      log_in user</span>
<span class="gray">10</span>   <span class="mark">      redirect_to user</span>
<span class="gray">11</span>       <strong><span class="green">else</span></strong>
<span class="gray">12</span>         flash<span class="ash">.</span>now<span class="ash">[</span><span class="violet">:danger</span><span class="ash">] =</span> <span class="maroon">'Invalid email/password combination'</span>
<span class="gray">13</span>         render <span class="maroon">'new'</span>
<span class="gray">14</span>       <strong><span class="green">end</span></strong>
<span class="gray">15</span>     <strong><span class="green">end</span></strong>
<span class="gray">16</span>
<span class="gray">17</span>     <strong><span class="green">def</span></strong> <span class="blue3">destroy</span>
<span class="gray">18</span>     <strong><span class="green">end</span></strong>
<span class="gray">19</span>   <strong><span class="green">end</span></strong></pre>
</div>
<p class="noindent">Note the compact redirect</p>
<pre class="pre1">redirect_to user</pre>
<p class="noindent">which we saw earlier in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#sec7_4_1">Section 7.4.1</a>. Rails automatically converts it to the route for the users profile page:</p>
<pre class="pre1">user_url(user)</pre>
<p class="indent">With the <strong><span class="dark-green"><code>create</code></span></strong> action defined in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex015">Listing 8.15</a>, the login form defined in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex04">Listing 8.4</a> should now be working. It doesnt have any effects on the application display, <span epub:type="pagebreak" id="page_396"></span>though, so short of inspecting the browser session directly theres no way to tell that youre logged in. As a first step toward enabling more visible changes, in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#sec8_2_2">Section 8.2.2</a> well retrieve the current user from the database using the id in the session. In <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#sec8_2_3">Section 8.2.3</a>, well change the links on the application layout, including a URL to the current users profile.</p>
<section>
<h5 class="h5" id="lev89">Exercises</h5>
<p class="noindent">Solutions to the exercises are available to all Rails Tutorial purchasers at <a href="https://www.railstutorial.org/aw-solutions">https://www.railstutorial.org/aw-solutions</a>.</p>
<p class="indent">To see other peoples answers and to record your own, subscribe to the Rails Tutorial course or to the Learn Enough All Access Bundle.</p>
<ol class="num">
<li><p class="num">Log in with a valid user and inspect your browsers cookies. What is the value of the session content? <em>Hint</em>: If you dont know how to view your browsers cookies, Google it to find out (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch01.xhtml#box1_2">Box 1.2</a>).</p></li>
<li><p class="num">What is the value of the <strong><span class="dark-green"><code>Expires</code></span></strong> attribute from the previous exercise?</p></li>
</ol></section>
</section>
<section>
<h4 class="h4" id="sec8_2_2">8.2.2 Current User</h4>
<p class="noindent">Having placed the users id securely in the temporary session, we are now in a position to retrieve it on subsequent pages, which well do by defining a <strong><span class="dark-green"><code>current_user</code></span></strong> method to find the user in the database corresponding to the session id. The purpose of <strong><span class="dark-green"><code>current_user</code></span></strong> is to allow constructions such as</p>
<pre class="pre1"><span class="red5">&lt;%=</span> current_user<span class="ash">.</span>name <span class="red5">%&gt;</span></pre>
<p class="noindent">and</p>
<pre class="pre1">redirect_to current_user</pre>
<p class="indent">To find the current user, one possibility is to use the <strong><span class="dark-green"><code>find</code></span></strong> method, as on the user profile page (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex05">Listing 7.5</a>):</p>
<pre class="pre1"><span class="red">User</span><span class="ash">.</span>find(session<span class="ash">[</span><span class="violet">:user_id</span><span class="ash">]</span>)</pre>
<p class="noindent">But recall from <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch06.xhtml#sec6_1_4">Section 6.1.4</a> that <strong><span class="dark-green"><code>find</code></span></strong> raises an exception if the user id doesnt exist. This behavior is appropriate on the user profile page because it will happen only if the <span epub:type="pagebreak" id="page_397"></span>id is invalid, but in the present case <strong><span class="dark-green"><code>session[:user_id]</code></span></strong> will often be <strong><span class="dark-green"><code>nil</code></span></strong> (i.e., for non-logged-in users). To handle this possibility, well use the same <strong><span class="dark-green"><code>find_by</code></span></strong> method we used to find by email address in the <strong><span class="dark-green"><code>create</code></span></strong> method, but with <strong><span class="dark-green"><code>id</code></span></strong> in place of <strong><span class="dark-green"><code>email</code></span></strong>:</p>
<pre class="pre1"><span class="red">User</span><span class="ash">.</span>find_by(<span class="green1">id</span>: session<span class="ash">[</span><span class="violet">:user_id</span><span class="ash">]</span>)</pre>
<p class="noindent">Rather than raising an exception, this method returns <strong><span class="dark-green"><code>nil</code></span></strong> (indicating no such user) if the id is invalid.</p>
<p class="indent">We could now define the <strong><span class="dark-green"><code>current_user</code></span></strong> method as follows:</p>
<p class="codelink"><a id="pf0397-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0397-02a">Click here to view code image</a></p>
<pre class="pre1"><strong><span class="green">def</span></strong> <span class="blue3">current_user</span>
  <strong><span class="green">if</span></strong> session<span class="ash">[</span><span class="violet">:user_id</span><span class="ash">]</span>
    <span class="red">User</span><span class="ash">.</span>find_by(<span class="green1">id</span>: session<span class="ash">[</span><span class="violet">:user_id</span><span class="ash">]</span>)
  <strong><span class="green">end</span></strong>
<strong><span class="green">end</span></strong></pre>
<p class="noindent">(If the session user id doesnt exist, the function just falls off the end and returns <strong><span class="dark-green"><code>nil</code></span></strong> automatically, which is exactly what we want.) This would work fine, but it would hit the database multiple times if, for example, <strong><span class="dark-green"><code>current_user</code></span></strong> appeared multiple times on a page. Instead, well follow a common Ruby convention by storing the result of <strong><span class="dark-green"><code>User.find_by</code></span></strong> in an instance variable, which hits the database the first time but returns the instance variable immediately on subsequent invocations:<sup><a id="ch08fn4a" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fn4" class="totri-footnote">4</a></sup></p>
<p class="footnote"><a id="ch08fn4" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fn4a" class="totri-footnote">4</a>. This practice of remembering variable assignments from one method invocation to the next is known as <em>memoization</em>. (This is a technical term, <em>not</em> a misspelling of memorizationa subtlety lost on the hapless copyeditor of a previous edition of this book.)</p>
<p class="codelink"><a id="pf0397-03" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0397-03a">Click here to view code image</a></p>
<pre class="pre1"><strong><span class="green">if</span></strong> <span class="violet">@current_user</span><span class="ash">.</span>nil?
  <span class="violet">@current_user</span> <span class="ash">=</span> <span class="red">User</span><span class="ash">.</span>find_by(<span class="green1">id</span>: session<span class="ash">[</span><span class="violet">:user_id</span><span class="ash">]</span>)
<strong><span class="green">else</span></strong>
  <span class="violet">@current_user</span>
<strong><span class="green">end</span></strong></pre>
<p class="noindent">Recalling the <em>or</em> operator <code>||</code> seen in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch04.xhtml#sec4_2_2">Section 4.2.2</a>, we can rewrite this as follows:</p>
<p class="codelink"><a id="pf0397-04" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0397-04a">Click here to view code image</a></p>
<pre class="pre1"><span class="violet">@current_user</span> <span class="ash">=</span> <span class="violet">@current_user</span> <span class="ash">||</span> <span class="red">User</span><span class="ash">.</span>find_by(<span class="green1">id</span>: session<span class="ash">[</span><span class="violet">:user_id</span><span class="ash">]</span>)</pre>
<p class="indent">Because a User object is true in a boolean context, the call to <strong><span class="dark-green"><code>find_by</code></span></strong> gets executed only if <strong><span class="dark-green"><code>@current_user</code></span></strong> hasnt yet been assigned.<span epub:type="pagebreak" id="page_398"></span></p>
<p class="indent">Although the preceding code would work, its not idiomatically correct Ruby. Instead, the proper way to write the assignment to <strong><span class="dark-green"><code>@current_user</code></span></strong> is like this:</p>
<p class="codelink"><a id="pf0398-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0398-01a">Click here to view code image</a></p>
<pre class="pre1"><span class="violet">@current_user</span> <span class="ash">||=</span> <span class="red">User</span><span class="ash">.</span>find_by(<span class="green1">id</span>: session<span class="ash">[</span><span class="violet">:user_id</span><span class="ash">]</span>)</pre>
<p class="noindent">This uses the potentially confusing but frequently used <strong><span class="dark-green"><code>||=</code></span></strong> (or equals) operator (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#box8_1">Box 8.1</a>).</p>
<div class="box">
<p class="box-caption" id="box8_1"><strong>Box 8.1: What the *$@! is</strong> <strong><span class="dark-green"><code>||=</code></span></strong> <strong>?</strong></p>
<p class="boxnp">The <code>||=</code> (or equals) assignment operator is a common Ruby idiom and is thus important for aspiring Rails developers to recognize. Although at first it may seem mysterious, <em>or equals</em> is easy to understand by analogy.</p>
<p class="boxip">We start by noting the common pattern of incrementing a variable:</p>
<pre>x = x + 1</pre>
<p class="boxnp">Many languages provide a syntactic shortcut for this operation. In Ruby (and in C, C++, Perl, Python, Java, and others), it can also appear as follows:</p>
<pre>x += 1</pre>
<p class="boxnp">Analogous constructs exist for other operators as well:</p>
<pre>$ rails console
&gt;&gt; x = 1
=&gt; 1
&gt;&gt; x += 1
=&gt; 2
&gt;&gt; x *= 3
=&gt; 6
&gt;&gt; x -= 8
=&gt; -2
&gt;&gt; x /= 2
=&gt; -1</pre>
<p class="boxnp">In each case, the pattern is that <code>x = x O y</code> and <code>x O= y</code> are equivalent for any operator <code>O</code>.</p>
<p class="boxip">Another common Ruby pattern is assigning to a variable if its <code>nil</code> but otherwise leaving it alone. Recalling the <em>or</em> operator <code>||</code> seen in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch04.xhtml#sec4_2_2">Section 4.2.2</a>, we can write this as follows:</p>
<pre>&gt;&gt; @foo
=&gt; nil
&gt;&gt; @foo = @foo || "bar"
<span epub:type="pagebreak" id="page_399"></span>=&gt; "bar"
&gt;&gt; @foo = @foo || "baz"
=&gt; "bar"</pre>
<p class="boxnp">Since <code>nil</code> is false in a boolean context, the first assignment to <code>@foo</code> is <code>nil || "bar"</code>, which evaluates to <code>"bar"</code>. Similarly, the second assignment is <code>@foo || "baz"</code>, equivalent to <code>"bar" || "baz"</code>, which also evaluates to <code>"bar"</code>. This is because anything other than <code>nil</code> or <code>false</code> is <code>true</code> in a boolean context, and the series of <code>||</code> expressions terminates after the first true expression is evaluated. (This practice of evaluating <code>||</code> expressions from left to right and stopping on the first true value is known as <em>short-circuit evaluation</em>. The same principle applies to <code>&amp;&amp;</code> statements, except in this case evaluation stops on the first <em>false</em> value.)</p>
<p class="boxip">Comparing the console sessions for the various operators, we see that <code>@foo = @foo || "bar"</code> follows the <code>x = x O y</code> pattern with <code>||</code> in the place of <code>O</code>:</p>
<p class="codelink"><a id="pf0399-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0399-01a">Click here to view code image</a></p>
<pre>x    =   x  +    1       -&gt;     x     +=   1
x    =   x  *    3       -&gt;     x     *=   3
x    =   x  -    8       -&gt;     x     -=   8
x    =   x   /   2       -&gt;     x     /=   2
@foo = @foo || "bar"     -&gt;     @foo ||= "bar"</pre>
<p class="boxnp">Thus <code>@foo = @foo || "bar"</code> and <code>@foo ||= "bar"</code> are equivalent. In the context of the current user, this suggests the following construction:</p>
<p class="codelink"><a id="pf0399-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0399-02a">Click here to view code image</a></p>
<pre>@current_user ||= User.find_by(id: session[:user_id])</pre>
<p class="boxnp">Voil!</p>
<p class="boxip">(Technically, Ruby evaluates the expression <code>@foo || @foo = "bar"</code>, which avoids an unnecessary assignment when <code>@foo</code> is not <code>nil</code> or <code>false</code>. But this expression doesnt explain the <code>||=</code> notation as well, so the discussion here uses the nearly equivalent <code>@foo = @foo || "bar"</code>.)</p>
</div>
<p class="indent">Applying the results of this discussion yields the succinct <strong><span class="dark-green"><code>current_user</code></span></strong> method shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex016">Listing 8.16</a>. (Theres a slight amount of repetition in the use of <strong><span class="dark-green"><code>session[:user_id]</code></span></strong>, which well eliminate in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch09.xhtml#sec9_1_2">Section 9.1.2</a>.)</p>
<p class="ex-title" id="ch08ex016"><strong>Listing 8.16:</strong> Finding the current user in the session.</p>
<p><code>app/helpers/sessions_helper.rb</code></p>
<p class="codelink"><a id="pf0399-03" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0399-03a">Click here to view code image</a></p>
<div class="example">
<pre><strong><span class="green">module</span></strong> <strong><span class="blue3">SessionsHelper</span></strong>

  <span class="blue"># Logs in the given user.</span>
  <strong><span class="green">def</span></strong> <span class="blue3">log_in</span>(user)
<span epub:type="pagebreak" id="page_400"></span>    session<span class="ash">[</span><span class="violet">:user_id</span><span class="ash">] =</span> user<span class="ash">.</span>id
  <strong><span class="green">end</span></strong>

  <span class="blue"># Returns the current logged-in user (if any).</span>
  <strong><span class="green">def</span></strong> <span class="blue3">current_user</span>
<span class="mark">    <strong><span class="green3">if</span></strong> session<span class="ash1">[</span><span class="blue1">:user_id</span><span class="ash1">]</span></span>
<span class="mark">      <span class="blue1">@current_user</span> <span class="ash1">||=</span> <span class="red2">User</span><span class="ash1">.</span>find_by(<span class="green3">id</span>: session<span class="ash1">[</span><span class="blue1">:user_id</span><span class="ash1">]</span>)</span>
<span class="mark">    <strong><span class="green3">end</span></strong></span>
  <strong><span class="green">end</span></strong>
<strong><span class="green">end</span></strong></pre>
</div>
<p class="noindent">With the working <strong><span class="dark-green"><code>current_user</code></span></strong> method in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex016">Listing 8.16</a>, were now in a position to make changes to our application based on user login status.</p>
<section>
<h5 class="h5" id="lev90">Exercises</h5>
<p class="noindent">Solutions to the exercises are available to all Rails Tutorial purchasers at <a href="https://www.railstutorial.org/aw-solutions">https://www.railstutorial.org/aw-solutions</a>.</p>
<p class="indent">To see other peoples answers and to record your own, subscribe to the Rails Tutorial course or to the Learn Enough All Access Bundle.</p>
<ol class="num">
<li><p class="num">Confirm at the console that <strong><span class="dark-green"><code>User.find_by(id: ...)</code></span></strong> returns <strong><span class="dark-green"><code>nil</code></span></strong> when the corresponding user doesnt exist.</p></li>
<li><p class="num">In a Rails console, create a <strong><span class="dark-green"><code>session</code></span></strong> hash with key <strong><span class="dark-green"><code>:user_id</code></span></strong>. By following the steps in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex017">Listing 8.17</a>, confirm that the <strong><span class="dark-green"><code>||=</code></span></strong> operator works as required.</p></li>
</ol>
<p class="ex-title" id="ch08ex017"><strong>Listing 8.17:</strong> Simulating <strong><span class="dark-green"><code>session</code></span></strong> in the console.</p>
<p class="codelink"><a id="pf0400-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0400-02a">Click here to view code image</a></p>
<div class="example">
<pre><strong><span class="navy">&gt;&gt;</span></strong> session <span class="ash">=</span> {}
<strong><span class="navy">&gt;&gt;</span></strong> session<span class="ash">[</span><span class="violet">:user_id</span><span class="ash">] =</span> <strong><span class="green">nil</span></strong>
<strong><span class="navy">&gt;&gt;</span></strong> <span class="violet">@current_user</span> <span class="ash">||=</span> <span class="red">User</span><span class="ash">.</span>find_by(<span class="green1">id</span>: session<span class="ash">[</span><span class="violet">:user_id</span><span class="ash">]</span>)
<span class="mark"><span class="green">&lt;What happens here?&gt;</span></span>
<strong><span class="navy">&gt;&gt;</span></strong> session<span class="ash">[</span><span class="violet">:user_id</span><span class="ash">]=</span> <span class="red">User</span><span class="ash">.</span>first<span class="ash">.</span>id
<strong><span class="navy">&gt;&gt;</span></strong> <span class="violet">@current_user</span> <span class="ash">||=</span> <span class="red">User</span><span class="ash">.</span>find_by(<span class="green1">id</span>: session<span class="ash">[</span><span class="violet">:user_id</span><span class="ash">]</span>)
<span class="mark"><span class="green">&lt;What happens here?&gt;</span></span>
<strong><span class="navy">&gt;&gt;</span></strong> <span class="violet">@current_user</span> <span class="ash">||=</span> <span class="red">User</span><span class="ash">.</span>find_by(<span class="green1">id</span>: session<span class="ash">[</span><span class="violet">:user_id</span><span class="ash">]</span>)
<span class="mark"><span class="green">&lt;What happens here?&gt;</span></span></pre>
</div>
</section>
</section>
<section>
<h4 class="h4" id="sec8_2_3"><span epub:type="pagebreak" id="page_401"></span>8.2.3 Changing the Layout Links</h4>
<p class="noindent">The first practical application of logging in involves changing the layout links based on login status. In particular, as seen in the <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fig08">Figure 8.8</a> mockup,<sup><a id="ch08fn5a" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fn5" class="totri-footnote">5</a></sup> well add links for logging out, for user settings, for listing all users, and for the current users profile page. Note in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fig08">Figure 8.8</a> that the logout and profile links appear in a dropdown Account menu; well see in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex019">Listing 8.19</a> how to make such a menu with Bootstrap.</p>
<p class="footnote"><a id="ch08fn5" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fn5a" class="totri-footnote">5</a>. Image retrieved from <a href="https://www.flickr.com/photos/elevy/14730820387">https://www.flickr.com/photos/elevy/14730820387</a> on 2016-06-03. Copyright  2014 by Elias Levy and used unaltered under the terms of the Creative Commons Attribution 2.0 Generic license.</p>
<figure id="ch08fig08" class="image-l">
<img src="./Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition_files/fig08_08.jpg" alt="Image" width="677" height="582" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig08_08.jpg">
<figcaption><p><strong>Figure 8.8:</strong> A mockup of the user profile after a successful login.</p></figcaption>
</figure>
<p class="indent"><span epub:type="pagebreak" id="page_402"></span>At this point, in real life I would consider writing an integration test to capture the behavior described earlier. As noted in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch03.xhtml#box3_3">Box 3.3</a>, as you become more familiar with the testing tools in Rails, you may find yourself more inclined to write tests first. In this case, though, such a test involves several new ideas, so for now its best deferred to its own section (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#sec8_2_4">Section 8.2.4</a>).</p>
<p class="indent">The way to change the links in the site layout involves using an if-else statement inside embedded Ruby to show one set of links if the user is logged in and another set of links otherwise:</p>
<p class="codelink"><a id="pf0402-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0402-01a">Click here to view code image</a></p>
<pre class="pre1"><span class="red5">&lt;%</span> <strong><span class="green">if</span></strong> logged_in? <span class="red5">%&gt;</span>
  # Links for logged-in users
<span class="red5">&lt;%</span> <strong><span class="green">else</span></strong> <span class="red5">%&gt;</span>
  # Links for non-logged-in-users
<span class="red5">&lt;%</span> <strong><span class="green">end</span></strong> <span class="red5">%&gt;</span></pre>
<p class="noindent">This kind of code requires the existence of a <strong><span class="dark-green"><code>logged_in?</code></span></strong> boolean method, which well now define.</p>
<p class="indent">A user is logged in if there is a current user in the sessionthat is, if <strong><span class="dark-green"><code>current_user</code></span></strong> is not <strong><span class="dark-green"><code>nil</code></span></strong>. Checking for this requires the use of the not operator (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch04.xhtml#sec4_2_2">Section 4.2.2</a>), written using an exclamation point <strong><span class="dark-green"><code>!</code></span></strong> and usually read as bang. The resulting <strong><span class="dark-green"><code>logged_in?</code></span></strong> method appears in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex018">Listing 8.18</a>.</p>
<p class="ex-title" id="ch08ex018"><strong>Listing 8.18:</strong> The <strong><span class="dark-green"><code>logged_in?</code></span></strong> helper method.</p>
<p><code>app/helpers/sessions_helper.rb</code></p>
<p class="codelink"><a id="pf0402-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0402-02a">Click here to view code image</a></p>
<div class="example">
<pre><strong><span class="green">module</span></strong> <strong><span class="blue3">SessionsHelper</span></strong>

  <span class="blue"># Logs in the given user.</span>
  <strong><span class="green">def</span></strong> <span class="blue3">log_in</span>(user)
    session<span class="ash">[</span><span class="violet">:user_id</span><span class="ash">] =</span> user<span class="ash">.</span>id
  <strong><span class="green">end</span></strong>

  <span class="blue"># Returns the current logged-in user (if any).</span>
  <strong><span class="green">def</span></strong> <span class="blue3">current_user</span>
    <strong><span class="green">if</span></strong> session<span class="ash">[</span><span class="violet">:user_id</span><span class="ash">]</span>
      <span class="violet">@current_user</span> <span class="ash">||=</span> <span class="red">User</span><span class="ash">.</span>find_by(<span class="green1">id</span>: session<span class="ash">[</span><span class="violet">:user_id</span><span class="ash">]</span>)
    <strong><span class="green">end</span></strong>
  <strong><span class="green">end</span></strong>
<span epub:type="pagebreak" id="page_403"></span>
  <span class="blue"># Returns true if the user is logged in, false otherwise.</span>
  <strong><span class="green">def</span></strong> <span class="blue3">logged_in?</span>
<span class="mark">    <span class="ash1">!</span>current_user<span class="ash1">.</span>nil?</span>
  <strong><span class="green">end</span></strong>
<strong><span class="green">end</span></strong></pre>
</div>
<p class="indent">With the addition in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex018">Listing 8.18</a>, were now ready to change the layout links if a user is logged in. There are four new links, two of which are stubbed out (to be completed in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch10.xhtml#ch10">Chapter 10</a>):</p>
<p class="codelink"><a id="pf0403-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0403-02a">Click here to view code image</a></p>
<pre class="pre1"><span class="red5">&lt;%=</span> link_to <span class="maroon">"Users"</span>,    <span class="maroon">'#'</span> <span class="red5">%&gt;</span>
<span class="red5">&lt;%=</span> link_to <span class="maroon">"Settings"</span>, <span class="maroon">'#'</span> <span class="red5">%&gt;</span></pre>
<p class="noindent">The logout link, meanwhile, uses the logout path defined in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex02">Listing 8.2</a>:</p>
<p class="codelink"><a id="pf0403-03" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0403-03a">Click here to view code image</a></p>
<pre class="pre1"><span class="red5">&lt;%=</span> link_to <span class="maroon">"Log out"</span>, logout_path, <span class="green1">method</span>: <span class="violet">:delete</span> <span class="red5">%&gt;</span></pre>
<p class="noindent">Notice that the logout link passes a hash argument indicating that it should submit an HTTP <code>DELETE</code> request.<sup><a id="ch08fn6a" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fn6" class="totri-footnote">6</a></sup> Well also add a profile link as follows:</p>
<p class="footnote"><a id="ch08fn6" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fn6a" class="totri-footnote">6</a>. Web browsers cant actually issue <code>DELETE</code> requests; Rails fakes it with JavaScript.</p>
<p class="codelink"><a id="pf0403-04" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0403-04a">Click here to view code image</a></p>
<pre class="pre1"><span class="red5">&lt;%=</span> link_to <span class="maroon">"Profile"</span>, current_user <span class="red5">%&gt;</span></pre>
<p class="noindent">Here we could write</p>
<p class="codelink"><a id="pf0403-05" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0403-05a">Click here to view code image</a></p>
<pre class="pre1"><span class="red5">&lt;%=</span> link_to <span class="maroon">"Profile"</span>, user_path(current_user) <span class="red5">%&gt;</span></pre>
<p class="noindent">but as usual Rails allows us to link directly to the user by automatically converting <strong><span class="dark-green"><code>current_user</code></span></strong> into <strong><span class="dark-green"><code>user_path(current_user)</code></span></strong> in this context. Finally, when users <em>arent</em> logged in, well use the login path defined in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex02">Listing 8.2</a> to make a link to the login form:</p>
<p class="codelink"><a id="pf0403-06" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0403-06a">Click here to view code image</a></p>
<pre class="pre1"><span class="red5">&lt;%=</span> link_to <span class="maroon">"Log in"</span>, login_path <span class="red5">%&gt;</span></pre>

<p class="noindent">Putting everything together gives the updated header partial shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex019">Listing 8.19</a>.</p>
<p class="ex-title" id="ch08ex019"><span epub:type="pagebreak" id="page_404"></span><strong>Listing 8.19:</strong> Changing the layout links for logged-in users.</p>
<p><code>app/views/layouts/_header.html.erb</code></p>
<p class="codelink"><a id="pf0404-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0404-01a">Click here to view code image</a></p>
<div class="example">
<pre>&lt;<strong><span class="green">header</span></strong> <span class="ash3">class</span><span class="ash">=</span><span class="maroon">"navbar navbar-fixed-top navbar-inverse"</span>&gt;
  &lt;<strong><span class="green">div</span></strong> <span class="ash3">class</span><span class="ash">=</span><span class="maroon">"container"</span>&gt;
    <span class="red5">&lt;%=</span> link_to <span class="maroon">"sample app"</span>, root_path, <span class="green1">id</span>: <span class="maroon">"logo"</span> <span class="red5">%&gt;</span>
    &lt;<strong><span class="green">nav</span></strong>&gt;
      &lt;<strong><span class="green">ul</span></strong> <span class="ash3">class</span><span class="ash">=</span><span class="maroon">"nav navbar-nav navbar-right"</span>&gt;
        &lt;<strong><span class="green">li</span></strong>&gt;<span class="red5">&lt;%=</span> link_to <span class="maroon">"Home"</span>, root_path <span class="red5">%&gt;</span>&lt;/<strong><span class="green">li</span></strong>&gt;
        &lt;<strong><span class="green">li</span></strong>&gt;<span class="red5">&lt;%=</span> link_to <span class="maroon">"Help"</span>, help_path <span class="red5">%&gt;</span>&lt;/<strong><span class="green">li</span></strong>&gt;
<span class="mark">        <span class="maroon1">&lt;%</span> <strong><span class="green3">if</span></strong> logged_in? <span class="maroon1">%&gt;</span></span>
<span class="mark">          <span class="green3">&lt;</span><strong><span class="green3">li</span></strong><span class="green3">&gt;</span><span class="maroon1">&lt;%=</span> link_to <span class="red2">"Users"</span>, <span class="red2">"#"</span> <span class="maroon1">%&gt;</span><span class="green3">&lt;/</span><strong><span class="green3">li</span></strong><span class="green3">&gt;</span></span>
          &lt;<strong><span class="green">li</span></strong> <span class="ash3">class</span><span class="ash">=</span><span class="maroon">"dropdown"</span>&gt;
            &lt;<strong><span class="green">a</span></strong> <span class="ash3">href</span><span class="ash">=</span><span class="maroon">"#"</span> <span class="ash3">class</span><span class="ash">=</span><span class="maroon">"dropdown-toggle"</span> <span class="ash3">data-toggle</span><span class="ash">=</span><span class="maroon">"dropdown"</span>&gt;
              Account &lt;<strong><span class="green">b</span></strong> <span class="ash3">class</span><span class="ash">=</span><span class="maroon">"caret"</span>&gt;&lt;/<strong><span class="green">b</span></strong>&gt;
            &lt;/<strong><span class="green">a</span></strong>&gt;
            &lt;<strong><span class="green">ul</span></strong> <span class="ash3">class</span><span class="ash">=</span><span class="maroon">"dropdown-menu"</span>&gt;
<span class="mark">              <span class="green3">&lt;</span><strong><span class="green3">li</span></strong><span class="green3">&gt;</span><span class="maroon1">&lt;%=</span> link_to <span class="red2">"Profile"</span>, current_user <span class="maroon1">%&gt;</span><span class="green3">&lt;/</span><strong><span class="green3">li</span></strong><span class="green3">&gt;</span></span>
<span class="mark">              <span class="green3">&lt;</span><strong><span class="green3">li</span></strong><span class="green3">&gt;</span><span class="maroon1">&lt;%=</span> link_to <span class="red2">"Settings"</span>, <span class="red2">"#"</span> <span class="maroon1">%&gt;</span><span class="green3">&lt;/</span><strong><span class="green3">li</span></strong><span class="green3">&gt;</span></span>
              &lt;<strong><span class="green">li</span></strong> <span class="ash3">class</span><span class="ash">=</span><span class="maroon">"divider"</span>&gt;&lt;/<strong><span class="green">li</span></strong>&gt;
              &lt;<strong><span class="green">li</span></strong>&gt;
                <span class="maroon1">&lt;%=</span> link_to <span class="red2">"Log out"</span>, logout_path, <span class="green3">method:</span> <span class="red2">"delete"</span> <span class="maroon1">%&gt;</span>
              <span class="mark">&lt;/<strong><span class="green">li</span></strong>&gt;</span>
            &lt;/<strong><span class="green">ul</span></strong>&gt;
          &lt;/<strong><span class="green">li</span></strong>&gt;
        <span class="maroon1">&lt;%</span> <strong><span class="green3">else</span></strong> <span class="maroon1">%&gt;</span>
<span class="mark">          <span class="green3">&lt;</span><strong><span class="green3">li</span></strong><span class="green3">&gt;</span><span class="maroon1">&lt;%=</span> link_to <span class="red2">"Log in"</span>, login_path <span class="maroon1">%&gt;</span><span class="green3">&lt;/</span><strong><span class="green3">li</span></strong><span class="green3">&gt;</span></span>
<span class="mark">        <span class="maroon1">&lt;%</span> <strong><span class="green3">end</span></strong> <span class="maroon1">%&gt;</span></span>
<span class="mark">      &lt;/<strong><span class="green">ul</span></strong>&gt;</span>
    &lt;/<strong><span class="green">nav</span></strong>&gt;
  &lt;/<strong><span class="green">div</span></strong>&gt;
&lt;/<strong><span class="green">header</span></strong>&gt;</pre>
</div>
<p class="indent">As part of including the new links into the layout, <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex019">Listing 8.19</a> takes advantage of Bootstraps ability to make dropdown menus.<sup><a id="ch08fn7a" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fn7" class="totri-footnote">7</a></sup> Note in particular the inclusion of the special Bootstrap CSS classes such as <strong><span class="dark-green"><code>dropdown</code></span></strong>, <strong><span class="dark-green"><code>dropdown-menu</code></span></strong>, and so forth. To activate the dropdown menu, we need to include Bootstraps custom Java-Script library into our application (which is <em>not</em> included automatically as part of the <code>bootstrap-sass</code> gem in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch05.xhtml#ch05ex05">Listing 5.5</a>), as well as the jQuery library.</p>
<p class="footnote"><a id="ch08fn7" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fn7a" class="totri-footnote">7</a>. See the Bootstrap components page (<a href="http://getbootstrap.com/docs/3.4/components">getbootstrap.com/docs/3.4/components</a>) for more information.<span epub:type="pagebreak" id="page_405"></span></p>
<p class="indent"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch05.xhtml#sec5_2">Section 5.2</a> mentioned briefly that the Rails asset pipeline works in parallel with Webpack and Yarn, and we need to put both to work to include the necessary Java-Script. The first step is to install both jQuery and Bootstraps JavaScript library in our application, which coincidentally needs the same version number for each:</p>
<p class="codelink"><a id="pf0405-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0405-01a">Click here to view code image</a></p>
<pre class="pre1"><strong><span class="navy">$</span></strong> yarn add jquery@3.4.1 bootstrap@3.4.1</pre>
<p class="indent">To make jQuery available in our application, we need to edit Webpacks environment file and add the content shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex020">Listing 8.20</a>.</p>
<p class="ex-title" id="ch08ex020"><strong>Listing 8.20:</strong> Adding jQuery configuration to Webpack.</p>
<p><code>config/webpack/environment.js</code></p>
<p class="codelink"><a id="pf0405-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0405-02a">Click here to view code image</a></p>
<div class="example">
<pre><strong><span class="green">const</span></strong> { environment } <span class="ash">=</span> require(<span class="maroon">'@rails/webpacker'</span>)

<span class="mark"><strong><span class="green3">const</span></strong> webpack <span class="ash1">=</span> require(<span class="red2">'webpack'</span>)</span>
<span class="mark">environment.plugins.prepend(<span class="red2">'Provide'</span>,</span>
<span class="mark">  <strong><span class="green3">new</span></strong> webpack.ProvidePlugin({</span>
<span class="mark">    $<span class="ash1">:</span> <span class="red2">'jquery/src/jquery'</span>,</span>
<span class="mark">    jQuery<span class="ash1">:</span> <span class="red2">'jquery/src/jquery'</span></span>
<span class="mark">  })</span>
<span class="mark">)</span>

module.exports <span class="ash">=</span> environment</pre>
</div>
<p class="indent">Finally, we need to require jQuery and import Bootstrap in our <strong><span class="dark-green"><code>application.js</code></span></strong> file, as shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex021">Listing 8.21</a>.<sup><a id="ch08fn8a" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fn8" class="totri-footnote">8</a></sup></p>
<p class="footnote"><a id="ch08fn8" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fn8a" class="totri-footnote">8</a>. For what its worth, I dont know offhand why one uses <strong><span class="dark-green"><code>require</code></span></strong> and the other uses <strong><span class="dark-green"><code>import</code></span></strong>.</p>
<p class="ex-title" id="ch08ex021"><strong>Listing 8.21:</strong> Requiring and importing the necessary JavaScript libraries.</p>
<p><code>app/javascript/packs/application.js</code></p>
<p class="codelink"><a id="pf0405-03" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0405-03a">Click here to view code image</a></p>
<div class="example">
<pre><span class="green1">require</span>(<span class="maroon">"@rails/ujs"</span>)<span class="ash">.</span>start()
<span class="green1">require</span>(<span class="maroon">"turbolinks"</span>)<span class="ash">.</span>start()
<span class="green1">require</span>(<span class="maroon">"@rails/activestorage"</span>)<span class="ash">.</span>start()
<span class="green1">require</span>(<span class="maroon">"channels"</span>)
<span class="mark">require(<span class="red2">"jquery"</span>)</span>
<strong><span class="green3">import</span></strong> <span class="red2">"bootstrap"</span></pre>
</div>
<p class="indent"><span epub:type="pagebreak" id="page_406"></span>At this point, you should visit the login path and log in as a valid user (username <code><strong><a href="mailto:example@railstutorial.org">example@railstutorial.org</a></strong></code>, password <strong><span class="dark-green"><code>foobar</code></span></strong>), which effectively tests the code in the previous three sections.<sup><a id="ch08fn9a" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fn9" class="totri-footnote">9</a></sup> With the code in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex019">Listing 8.19</a> and <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex021">Listing 8.21</a>, you should see the dropdown menu and links for logged-in users, as shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fig09">Figure 8.9</a>.</p>
<p class="footnote"><a id="ch08fn9" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fn9a" class="totri-footnote">9</a>. You may have to restart the webserver to get this to work (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch01.xhtml#box1_2">Box 1.2</a>).</p>
<figure id="ch08fig09" class="image-l">
<img src="./Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition_files/fig08_09.jpg" alt="Image" width="677" height="521" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig08_09.jpg">
<figcaption><p><strong>Figure 8.9:</strong> A logged-in user with new links and a dropdown menu.</p></figcaption>
</figure>
<p class="indent">If you quit your browser completely, you should also be able to verify that the application forgets your login status, requiring you to log in again to see the changes made in the previous session.<sup><a id="ch08fn10a" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fn10">10</a></sup></p>
<p class="footnote"><a id="ch08fn10" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fn10a">10</a>. If youre using the cloud IDE, I recommend using a different browser to test the login behavior so that you dont have to close down the browser running the IDE.</p>
<section>
<h5 class="h5" id="lev91">Mobile styling</h5>
<p class="noindent">Now that weve got the dropdown menu working, were going to take an opportunity to add a few design tweaks for mobile devices, thereby fulfilling a promise made in <span epub:type="pagebreak" id="page_407"></span><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch05.xhtml#sec5_1">Section 5.1</a>.<sup><a id="ch08fn11a" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fn11">11</a></sup> As noted in that section, this is not a tutorial on web design, so well be making the minimum set of changes needed to make the mobile app look nice, but you can find a much more detailed treatment of mobile styling in <em>Learn Enough CSS &amp; Layout to Be Dangerous</em> (<a href="http://www.learnenough.com/css-and-layout">www.learnenough.com/css-and-layout</a>), especially <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch09.xhtml#ch09">Chapter 9</a>, Mobile media queries.</p>
<p class="footnote"><a id="ch08fn11" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fn11a">11</a>. Several of these changes were based on or inspired by the excellent work of <em>Rails Tutorial</em> reader Craig Zeise.</p>
<p class="indent">Our first step in applying some mobile-friendly design is to view our current app as it appears in a mobile device. One possibility is simply using a smartphone to view the site, but this can be inconvenient, especially if the development app is running behind a cloud IDE login wall or on a local network (which is often inaccessible to outside devices). A more convenient alternative is to use a feature of the Safari web browser known as Responsive Design Mode, which can be activated as shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fig010">Figure 8.10</a>.<sup><a id="ch08fn12a" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fn12">12</a></sup> This mode gives us the ability to view the app as it appears in any of a number of different mobile devices, as seen in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fig011">Figure 8.11</a>.<sup><a id="ch08fn13a" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fn13">13</a></sup></p>
<p class="footnote"><a id="ch08fn12" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fn12a">12</a>. See Mobile viewport in <em>Learn Enough CSS &amp; Layout to Be Dangerous</em> (<a href="http://www.learnenough.com/css-and-layout">www.learnenough.com/css-and-layout</a>) for yet another alternative.</p>
<p class="footnote"><a id="ch08fn13" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fn13a">13</a>. To change the aspect ratio from portrait to landscape for any of the devices, simply double-click on the corresponding icon. Back when we were making <em>Learn Enough CSS &amp; Layout to Be Dangerous</em> (<a href="http://www.learnenough.com/css-and-layout">www.learnenough.com/css-and-layout</a>), it took me and my coauthor Lee Donahoe a surprisingly long time to figure this out.</p>
<figure id="ch08fig010" class="image-l">
<img src="./Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition_files/fig08_10.jpg" alt="Image" width="604" height="802" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig08_10.jpg">
<figcaption><p><strong>Figure 8.10:</strong> The menu item to enter Safaris Responsive Design Mode.</p></figcaption>
</figure>
<figure id="ch08fig011" class="image-l">
<img src="./Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition_files/fig08_11.jpg" alt="Image" width="677" height="625" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig08_11.jpg">
<figcaption><p><strong>Figure 8.11:</strong> Safaris Responsive Design Mode.</p></figcaption>
</figure>
<p class="indent">Now lets take a look at the profile page from <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fig09">Figure 8.9</a> as it appears in a mobile device. As seen in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fig012">Figure 8.12</a>, the menu items currently arent nicely aligned, and the menu itself takes over a large part of the top of the screen. Meanwhile, the footer navigation links appear in an awkward location, squished up against the other link in the footer. These are the only major issues we need to address, and well be able to fix both of them with a surprisingly small amount of code.</p>
<figure id="ch08fig012" class="image-l">
<img src="./Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition_files/fig08_12.jpg" alt="Image" width="521" height="890" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig08_12.jpg">
<figcaption><p><strong>Figure 8.12:</strong> The current mobile view of a user profile.</p></figcaption>
</figure>
<p class="indent">Our first step is to add a special <strong><span class="dark-green"><code>meta</code></span></strong> tag called the <em>viewport</em>, which lets developers switch between desktop and mobile modes.<sup><a id="ch08fn14a" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fn14">14</a></sup> The result, which goes in the application template, appears in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex022">Listing 8.22</a>.</p>
<p class="footnote"><a id="ch08fn14" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fn14a">14</a>. See Mobile viewport in <em>Learn Enough CSS &amp; Layout to Be Dangerous</em> (<a href="http://www.learnenough.com/css-and-layout">www.learnenough.com/css-and-layout</a>) for more details.</p>
<p class="ex-title" id="ch08ex022"><strong>Listing 8.22:</strong> Adding the viewport <strong><span class="dark-green"><code>meta</code></span></strong> tag.</p>
<p><code>app/views/layouts/application.html.erb</code></p>
<p class="codelink"><a id="pf0407-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0407-01a">Click here to view code image</a></p>
<div class="example">
<pre><span class="red5">&lt;!DOCTYPE html&gt;</span>
&lt;<strong><span class="green">html</span></strong>&gt;
  &lt;<strong><span class="green">head</span></strong>&gt;
<span epub:type="pagebreak" id="page_408"></span>    &lt;<strong><span class="green">title</span></strong>&gt;<span class="red5">&lt;%=</span> full_title(<strong><span class="green">yield</span></strong>(<span class="violet">:title</span>)) <span class="red5">%&gt;</span>&lt;/<strong><span class="green">title</span></strong>&gt;
    &lt;<strong><span class="green">meta</span></strong> <span class="ash3">charset</span><span class="ash">=</span><span class="maroon">"utf-8"</span>&gt;
<span class="mark">    &lt;<strong><span class="green3">meta</span></strong> <span class="lighgreen">name</span><span class="ash1">=</span><span class="red2">"viewport"</span> <span class="lighgreen">content</span><span class="ash1">=</span><span class="red2">"width=device-width, initial-scale=1"</span>&gt;</span>
    <span class="red5">&lt;%=</span> csrf_meta_tags <span class="red5">%&gt;</span>
    <span class="red5">&lt;%=</span> csp_meta_tag <span class="red5">%&gt;</span>
    .
    .
    .</pre>
</div>
<p class="indent"><span epub:type="pagebreak" id="page_409"></span>To fix the menu, well use a so-called hamburger menu (named for its unintentional resemblance to a hamburger) when in mobile mode. This involves adding some markup to the header file from <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex019">Listing 8.19</a>, as shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex023">Listing 8.23</a>.<sup><a id="ch08fn15a" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fn15">15</a></sup></p>
<p class="footnote"><a id="ch08fn15" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fn15a">15</a>. I might never have figured this out on my own. Thanks again to Craig Zeise for his fantastic volunteer effort.<span epub:type="pagebreak" id="page_410"></span><span epub:type="pagebreak" id="page_411"></span></p>
<p class="ex-title" id="ch08ex023"><strong>Listing 8.23:</strong> Adding the markup for a hamburger menu.</p>
<p><code>app/views/layouts/_header.html.erb</code></p>
<p class="codelink"><a id="pf0411-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0411-01a">Click here to view code image</a></p>
<div class="example">
<pre>&lt;<strong><span class="green">header</span></strong> <span class="ash3">class</span><span class="ash">=</span><span class="maroon">"navbar navbar-fixed-top navbar-inverse"</span>&gt;
  &lt;<strong><span class="green">div</span></strong> <span class="ash3">class</span><span class="ash">=</span><span class="maroon">"container"</span>&gt;
    <span class="red5">&lt;%=</span> link_to <span class="maroon">"sample app"</span>, root_path, <span class="green1">id</span>: <span class="maroon">"logo"</span> <span class="red5">%&gt;</span>
    &lt;<strong><span class="green">nav</span></strong>&gt;
<span class="mark">      &lt;<strong><span class="green3">div</span></strong> <span class="lighgreen">class</span><span class="ash1">=</span><span class="red2">"navbar-header"</span>&gt;</span>
<span class="mark">      &lt;<strong><span class="green3">button</span></strong> <span class="lighgreen">type</span><span class="ash1">=</span><span class="red2">"button"</span> <span class="lighgreen">class</span><span class="ash1">=</span><span class="red2">"navbar-toggle collapsed"</span></span>
<span class="mark">              <span class="green3">data-toggle</span><span class="ash1">=</span><span class="red2">"collapse"</span></span>
<span class="mark">              <span class="lighgreen">data-target</span><span class="ash1">=</span><span class="red2">"#bs-example-navbar-collapse-1"</span></span>
<span class="mark">              <span class="lighgreen">aria-expanded</span><span class="ash1">=</span><span class="red2">"false"</span>&gt;</span>
<span class="mark">        &lt;<strong><span class="green3">span</span></strong> <span class="lighgreen">class</span><span class="ash1">=</span><span class="red2">"sr-only"</span>&gt;Toggle navigation&lt;/<strong><span class="green3">span</span></strong>&gt;</span>
<span class="mark">        &lt;<strong><span class="green3">span</span></strong> <span class="lighgreen">class</span><span class="ash1">=</span><span class="red2">"icon-bar"</span>&gt;&lt;/<strong><span class="green3">span</span></strong>&gt;</span>
<span class="mark">        &lt;<strong><span class="green3">span</span></strong> <span class="lighgreen">class</span><span class="ash1">=</span><span class="red2">"icon-bar"</span>&gt;&lt;/<strong><span class="green3">span</span></strong>&gt;</span>
<span class="mark">        &lt;<strong><span class="green3">span</span></strong> <span class="lighgreen">class</span><span class="ash1">=</span><span class="red2">"icon-bar"</span>&gt;&lt;/<strong><span class="green3">span</span></strong>&gt;</span>
<span class="mark">      &lt;/<strong><span class="green3">button</span></strong>&gt;</span>
    &lt;/<strong><span class="green3">div</span></strong>&gt;
<span class="mark">    &lt;<strong><span class="green3">ul</span></strong> <span class="lighgreen">class</span><span class="ash1">=</span><span class="red2">"nav navbar-nav navbar-right collapse navbar-collapse"</span></span>
<span class="mark">        <span class="lighgreen">id</span><span class="ash1">=</span><span class="red2">"bs-example-navbar-collapse-1"</span>&gt;</span>
      .
      .
      .
    &lt;/<strong><span class="green">ul</span></strong>&gt;
  &lt;/<strong><span class="green">nav</span></strong>&gt;
 &lt;/<strong><span class="green">div</span></strong>&gt;
&lt;/<strong><span class="green">header</span></strong>&gt;</pre>
</div>
<p class="indent">The result of <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex023">Listing 8.23</a> appears in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fig013">Figure 8.13</a>. Pressing or clicking the hamburger icon then opens the menu, as shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fig014">Figure 8.14</a>. Note what a significant improvement this is compared to the default menu shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fig012">Figure 8.12</a>.</p>
<figure id="ch08fig013" class="image-l">
<img src="./Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition_files/fig08_13.jpg" alt="Image" width="521" height="888" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig08_13.jpg">
<figcaption><p><strong>Figure 8.13:</strong> Using a hamburger menu for mobile.</p></figcaption>
</figure>
<figure id="ch08fig014" class="image-l">
<img src="./Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition_files/fig08_14.jpg" alt="Image" width="521" height="881" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig08_14.jpg">
<figcaption><p><strong>Figure 8.14:</strong> The view after clicking the hamburger menu.</p></figcaption>
</figure>
<p class="indent">As a final step, well add a little CSS to fix the footer issue. The trick is to use a <em>media query</em> to apply different CSS for mobile devices than for desktop computers. The result, obtained after some trial-and-error in a web inspector, appears in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex024">Listing 8.24</a>.<sup><a id="ch08fn16a" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fn16">16</a></sup> Note that the new styles will be applied when the width of the device is less than 800 pixels, which is a common threshold (known as a breakpoint) for mobile devices.</p>
<p class="footnote"><a id="ch08fn16" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fn16a">16</a>. Thanks to Learn Enough cofounder and <em>Learn Enough CSS &amp; Layout to Be Dangerous</em> (<a href="http://www.learnenough.com/css-and-layout">www.learnenough.com/css-and-layout</a>) coauthor Lee Donahoe for his assistance.<span epub:type="pagebreak" id="page_412"></span><span epub:type="pagebreak" id="page_413"></span></p>
<p class="noindent"><span epub:type="pagebreak" id="page_414"></span>After refreshing the browser to apply the style in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex024">Listing 8.24</a>, our app appears as shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fig015">Figure 8.15</a>.</p>
<figure id="ch08fig015" class="image-l">
<img src="./Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition_files/fig08_15.jpg" alt="Image" width="521" height="883" data-mfp-src="/library/view/ruby-on-rails/9780136702726/graphics/fig08_15.jpg">
<figcaption><p><strong>Figure 8.15:</strong> The footer styled for mobile.</p></figcaption>
</figure>
<p class="ex-title" id="ch08ex024"><strong>Listing 8.24:</strong> Updating the footer CSS.</p>
<p><code>app/assets/stylesheets/custom.scss</code></p>
<p class="codelink"><a id="pf0414-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0414-01a">Click here to view code image</a></p>
<div class="example">
<pre><strong><span class="blue3">.</span></strong>
<strong><span class="blue3">.</span></strong>
<strong><span class="blue3">.</span></strong>
<span class="ash">/*</span> <strong><span class="green">footer</span></strong> <span class="ash">*/</span>

<strong><span class="green">footer</span></strong> {
  <strong><span class="blue3">.</span></strong>
  <strong><span class="blue3">.</span></strong>
  <strong><span class="blue3">.</span></strong>
}
<strong><span class="green">@media</span></strong> (<span class="red">max-width</span><span class="ash">: 800</span><strong><span class="darkmaroon">px</span></strong>) {
  <strong><span class="green">footer</span></strong> {
    <strong><span class="green">small</span></strong> {
      <strong><span class="green">display</span></strong><span class="pink2">:</span> <strong><span class="green">block</span></strong><span class="ash">;</span>
      <strong><span class="green">float</span></strong><span class="pink2">:</span> <strong><span class="green">none</span></strong><span class="ash">;</span>
      <strong><span class="green">margin-bottom</span></strong><span class="pink2">:</span> <strong><span class="green">1em</span></strong><span class="ash">;</span>
    }
    <strong><span class="green">ul</span></strong> {
      <strong><span class="green">float</span></strong><span class="pink2">:</span> <strong><span class="green">none</span></strong><span class="ash">;</span>
      <strong><span class="green">padding</span></strong><span class="pink2">:</span> <strong><span class="green">0</span></strong><span class="ash">;</span>
      <strong><span class="green">li</span></strong> {
        <strong><span class="green">float</span></strong><span class="pink2">:</span> <strong><span class="green">none</span></strong><span class="ash">;</span>
        <strong><span class="green">margin-left</span></strong><span class="pink2">:</span> <strong><span class="green">0</span></strong><span class="ash">;</span>
      }
    }
  }
}</pre>
</div>
<p class="indent">With that, our mobile styling is done, and were ready to add some tests for the layout links added in this section.</p>
</section>
<section>
<h5 class="h5" id="lev92">Exercises</h5>
<p class="noindent">Solutions to the exercises are available to all Rails Tutorial purchasers at <a href="https://www.railstutorial.org/aw-solutions">https://www.railstutorial.org/aw-solutions</a>.</p>
<p class="indent">To see other peoples answers and to record your own, subscribe to the Rails Tutorial course or to the Learn Enough All Access Bundle.<span epub:type="pagebreak" id="page_415"></span><span epub:type="pagebreak" id="page_416"></span></p>
<ol class="num">
<li><p class="num">Using the cookie inspector in your browser (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#sec8_2_1">Section 8.2.1</a>), remove the session cookie and confirm that the layout links revert to the non-logged-in state.</p></li>
<li><p class="num">Log in again, confirming that the layout links change correctly. Then quit your browser and start it again to confirm that the layout links revert to the non-logged-in state. (If your browser has a remember where I left off feature that automatically restores the session, be sure to disable it in this step (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch01.xhtml#box1_2">Box 1.2</a>).)</p></li>
</ol></section>
</section>
<section>
<h4 class="h4" id="sec8_2_4">8.2.4 Testing Layout Changes</h4>
<p class="noindent">Having verified by hand that the application is behaving properly upon successful login, before moving on well write an integration test to capture that behavior and catch regressions. Well build on the test from <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex09">Listing 8.9</a> and write a series of steps to verify the following sequence of actions:</p>
<ol class="num">
<li><p class="num">Visit the login path.</p></li>
<li><p class="num">Post valid information to the sessions path.</p></li>
<li><p class="num">Verify that the login link disappears.</p></li>
<li><p class="num">Verify that a logout link appears</p></li>
<li><p class="num">Verify that a profile link appears.</p></li>
</ol>
<p class="indent">To see these changes, our test needs to log in as a previously registered user, which means that such a user must already exist in the database. The default Rails way to do this is to use <em>fixtures</em>, which are a way of organizing data for loading into the test database. We discovered in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch06.xhtml#sec6_2_5">Section 6.2.5</a> that we needed to delete the default fixtures so that our email uniqueness tests would pass (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch06.xhtml#ch06ex031">Listing 6.31</a>). Now were ready to start filling in that empty file with custom fixtures of our own.</p>
<p class="indent">In the present case, we need only one user, whose information should consist of a valid name and email address. Because well need to log the user in, we also have to include a valid password to compare with the password submitted to the Sessions controllers <strong><span class="dark-green"><code>create</code></span></strong> action. Referring to the data model in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch06.xhtml#ch06fig09">Figure 6.9</a>, we see that this means creating a <strong><span class="dark-green"><code>password_digest</code></span></strong> attribute for the user fixture, which well accomplish by defining a <strong><span class="dark-green"><code>digest</code></span></strong> method of our own.</p>
<p class="indent">As discussed in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch06.xhtml#sec6_3_1">Section 6.3.1</a>, the password digest is created using bcrypt (via <strong><span class="dark-green"><code>has_secure_password</code></span></strong>), so well need to create the fixture password using the <span epub:type="pagebreak" id="page_417"></span>same method. By inspecting the secure password source code, we find that this method is</p>
<p class="codelink"><a id="pf0417-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0417-01a">Click here to view code image</a></p>
<pre class="pre1"><span class="red">BCrypt</span><span class="ash">::</span><span class="red">Password</span><span class="ash">.</span>create(string, <span class="violet">cost</span>: cost)</pre>
<p class="noindent">where <strong><span class="dark-green"><code>string</code></span></strong> is the string to be hashed and <strong><span class="dark-green"><code>cost</code></span></strong> is the <em>cost parameter</em> that determines the computational cost to calculate the hash. Specifying a high cost makes it computationally intractable to use the hash to determine the original password, which is an important security precaution in a production environment, but in tests we want the <strong><span class="dark-green"><code>digest</code></span></strong> method to be as fast as possible. The secure password source code has a line for this as well:</p>
<p class="codelink"><a id="pf0417-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0417-02a">Click here to view code image</a></p>
<pre class="pre1">cost <span class="ash">=</span> <span class="red">ActiveModel</span><span class="ash">::</span><span class="red">SecurePassword</span><span class="ash">.</span>min_cost ? <span class="red">BCrypt</span><span class="ash">::</span><span class="red">Engine</span><span class="ash">::</span><span class="red">MIN_COST</span> :
                                              <span class="red">BCrypt</span><span class="ash">::</span><span class="red">Engine</span><span class="ash">.</span>cost</pre>
<p class="noindent">This rather obscure code, which you dont need to understand in detail, arranges for precisely the behavior we want: It uses the minimum cost parameter in tests and a normal (high) cost parameter in production. (Well learn more about the strange <strong><span class="dark-green"><code>?</code></span></strong>-<strong><span class="dark-green"><code>:</code></span></strong> notation in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch09.xhtml#sec9_2">Section 9.2</a>.)</p>
<p class="indent">There are several places we could put the resulting <strong><span class="dark-green"><code>digest</code></span></strong> method, but well have an opportunity in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch09.xhtml#sec9_1_1">Section 9.1.1</a> to reuse <strong><span class="dark-green"><code>digest</code></span></strong> in the User model. This suggests placing the method in <strong><span class="dark-green"><code>user.rb</code></span></strong>. Because we wont necessarily have access to a user object when calculating the digest (as will be the case in the fixtures file), well attach the <strong><span class="dark-green"><code>digest</code></span></strong> method to the User class itself, which (as we saw briefly in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch04.xhtml#sec4_4_1">Section 4.4.1</a>) makes it a <em>class method</em>. The result appears in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex025">Listing 8.25</a>.</p>
<p class="ex-title" id="ch08ex025"><strong>Listing 8.25:</strong> Adding a digest method for use in fixtures.</p>
<p><code>app/models/user.rb</code></p>
<p class="codelink"><a id="pf0417-03" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0417-03a">Click here to view code image</a></p>
<div class="example">
<pre><strong><span class="green">class</span></strong> <strong><span class="blue3">User</span></strong> <span class="ash">&lt;</span> <span class="red">ApplicationRecord</span>
  before_save { <span class="green">self</span><span class="ash">.</span>email <span class="ash">=</span> email<span class="ash">.</span>downcase }
  validates <span class="violet">:name</span>, <span class="violet">presence</span>: <strong><span class="green">true</span></strong>, <span class="violet">length</span>: { <span class="violet">maximum</span>: <span class="ash">50</span> }
  <span class="red">VALID_EMAIL_REGEX</span> <span class="ash">=</span> <span class="red6">/\A[\w+\-.]+@[a-z\d\-.]+\.[a-z]+\z/i</span>
  validates <span class="violet">:email</span>, <span class="violet">presence</span>: <strong><span class="green">true</span></strong>, <span class="violet">length</span>: { <span class="violet">maximum</span>: <span class="ash">255</span> },
                    <span class="green1">format</span>: { <span class="violet">with</span>: <span class="red">VALID_EMAIL_REGEX</span> },
                    <span class="violet">uniqueness</span>: <strong><span class="green">true</span></strong>
  has_secure_password
  validates <span class="violet">:password</span>, <span class="violet">presence</span>: <strong><span class="green">true</span></strong>, <span class="violet">length</span>: { <span class="violet">minimum</span>: <span class="ash">6</span> }<span epub:type="pagebreak" id="page_418"></span>
  <span class="blue"># Returns the hash digest of the given string.</span>
  <strong><span class="green">def</span></strong> <strong><span class="blue3">User</span></strong><span class="ash">.</span><span class="blue3">digest</span>(string)
<span class="mark">    cost <span class="ash">=</span> <span class="red">ActiveModel</span><span class="ash">::</span><span class="red">SecurePassword</span><span class="ash">.</span>min_cost ? <span class="red">BCrypt</span><span class="ash">::</span><span class="red">Engine</span><span class="ash">::</span><span class="red">MIN_COST</span> :</span>
<span class="mark">                                                  <span class="red">BCrypt</span><span class="ash">::</span><span class="red">Engine</span><span class="ash">.</span>cost</span>
<span class="mark">    <span class="red">BCrypt</span><span class="ash">::</span><span class="red">Password</span><span class="ash">.</span>create(string, <span class="violet">cost</span>: cost)</span>
  <strong><span class="green">end</span></strong>
<strong><span class="green">end</span></strong></pre>
</div>
<p class="indent">With the <strong><span class="dark-green"><code>digest</code></span></strong> method from <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex025">Listing 8.25</a>, we are now ready to create a user fixture for a valid user, as shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex026">Listing 8.26</a>.<sup><a id="ch08fn17a" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fn17">17</a></sup></p>
<p class="footnote"><a id="ch08fn17" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fn17a">17</a>. Indentation in fixture files must take the form of spaces, not tabs, so take care when copying code like that shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex026">Listing 8.26</a>.</p>
<p class="ex-title" id="ch08ex026"><strong>Listing 8.26:</strong> A fixture for testing user login.</p>
<p><code>test/fixtures/users.yml</code></p>
<p class="codelink"><a id="pf0418-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0418-02a">Click here to view code image</a></p>
<div class="example">
<pre>michael:
  name: Michael Example
  email: michael@example.com
  password_digest: &lt;%= User.digest('password') %&gt;</pre>
</div>
<p class="noindent">Note that fixtures support embedded Ruby, which allows us to use</p>
<pre class="pre1"><span class="ash">&lt;%=</span> <span class="red">User</span><span class="ash">.</span>digest(<span class="maroon">'password'</span>) <span class="ash">%&gt;</span></pre>
<p class="noindent">to create the valid password digest for the test user.</p>
<p class="indent">Although weve defined the <strong><span class="dark-green"><code>password_digest</code></span></strong> attribute required by <strong><span class="dark-green"><code>has_secure_password</code></span></strong>, sometimes its convenient to refer to the plain (virtual) password as well. Unfortunately, this is impossible to arrange with fixtures, and adding a <strong><span class="dark-green"><code>password</code></span></strong> attribute to <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex026">Listing 8.26</a> causes Rails to complain that there is no such column in the database (which is true). Well make do by adopting the convention that all fixture users have the same password (<strong><span class="dark-green"><code>'password'</code></span></strong>).</p>
<p class="indent">Having created a fixture with a valid user, we can retrieve it inside a test as follows:</p>
<pre class="pre1">user <span class="ash">=</span> users(<span class="violet">:michael</span>)</pre>
<p class="noindent"><span epub:type="pagebreak" id="page_419"></span>Here <strong><span class="dark-green"><code>users</code></span></strong> corresponds to the fixture filename <strong><span class="dark-green"><code>users.yml</code></span></strong>, while the symbol <strong><span class="dark-green"><code>:michael</code></span></strong> references user with the key shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex026">Listing 8.26</a>.</p>
<p class="indent">Armed with our fixture user as above, we can now write a test for the layout links by converting the sequence enumerated at the beginning of this section into code, as shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex027">Listing 8.27</a>.</p>
<p class="ex-title" id="ch08ex027"><strong>Listing 8.27:</strong> A test for a user logging in with valid information. <span class="green5"><small>GREEN</small></span></p>
<p><code>test/integration/users_login_test.rb</code></p>
<p class="codelink"><a id="pf0419-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0419-01a">Click here to view code image</a></p>
<div class="example">
<pre><span class="green1">require</span> <span class="maroon">'test_helper'</span>

<strong><span class="green">class</span></strong> <strong><span class="blue3">UsersLoginTest</span></strong> <span class="ash">&lt;</span> <span class="red">ActionDispatch</span><span class="ash">::</span><span class="red">IntegrationTest</span>

<span class="mark">  <strong><span class="green">def</span></strong> <span class="blue3">setup</span></span>
<span class="mark">    <span class="violet">@user</span> <span class="ash">=</span> users(<span class="violet">:michael</span>)</span>
<span class="mark">  <strong><span class="green">end</span></strong></span>

  <span class="green1">test</span> <span class="maroon">"login with valid information"</span> <strong><span class="green">do</span></strong>
    get login_path
    post login_path, <span class="violet">params</span>: { <span class="violet">session</span>: { <span class="violet">email</span>: <span class="violet">@user</span><span class="ash">.</span>email,
                                          <span class="violet">password</span>: <span class="maroon">'password'</span> } }
    assert_redirected_to <span class="violet">@user</span>
    follow_redirect!
    assert_template <span class="maroon">'users/show'</span>
    assert_select <span class="maroon">"a[href=?]"</span>, login_path, <span class="violet">count</span>: <span class="ash">0</span>
    assert_select <span class="maroon">"a[href=?]"</span>, logout_path
    assert_select <span class="maroon">"a[href=?]"</span>, user_path(<span class="violet">@user</span>)
  <strong><span class="green">end</span></strong>
<strong><span class="green">end</span></strong></pre>
</div>
<p class="noindent">Here weve used</p>
<pre class="pre1">assert_redirected_to <span class="violet">@user</span></pre>
<p class="noindent">to check the right redirect target and</p>
<pre class="pre1">follow_redirect!</pre>
<p class="noindent">to actually visit the target page. <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex027">Listing 8.27</a> also confirms that the login link disappears by verifying that there are <em>zero</em> login path links on the page:</p>
<p class="codelink"><a id="pf0419-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0419-02a">Click here to view code image</a></p>
<pre class="pre1">assert_select <span class="maroon">"a[href=?]"</span>, login_path, <span class="violet">count</span>: <span class="ash">0</span></pre>
<p class="noindent"><span epub:type="pagebreak" id="page_420"></span>By including the extra <strong><span class="dark-green"><code>count: 0</code></span></strong> option, we tell <strong><span class="dark-green"><code>assert_select</code></span></strong> that we expect zero links matching the given pattern. (Compare this to <strong><span class="dark-green"><code>count: 2</code></span></strong> in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch05.xhtml#ch05ex032">Listing 5.32</a>, which checks for exactly two matching links.)</p>
<p class="indent">Because the application code was already working, this test should be <span class="green5"><small>GREEN</small></span>:</p>
<p class="ex-title" id="ch08ex028"><strong>Listing 8.28:</strong> <span class="green5"><small>GREEN</small></span></p>
<p class="codelink"><a id="pf0420-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0420-01a">Click here to view code image</a></p>
<div class="example">
<pre>$ rails test test/integration/users_login_test.rb</pre>
</div>
<section>
<h5 class="h5" id="lev93">Exercises</h5>
<p class="noindent">Solutions to the exercises are available to all Rails Tutorial purchasers at <a href="https://www.railstutorial.org/aw-solutions">https://www.railstutorial.org/aw-solutions</a>.</p>
<p class="indent">To see other peoples answers and to record your own, subscribe to the Rails Tutorial course or to the Learn Enough All Access Bundle.</p>
<ol class="num">
<li><p class="num">Confirm by commenting out everything after <strong><span class="dark-green"><code>if user</code></span></strong> in line 8 of <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex015">Listing 8.15</a> that the tests still pass even if we dont authenticate the user by email and password, as shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex029">Listing 8.29</a>. This is because <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex09">Listing 8.9</a> doesnt test the case of a correct user email but incorrect password. Fix this serious omission in our test suite by adding a valid email to the Users login test (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex030">Listing 8.30</a>). Verify that the tests are <span class="red5"><small>RED</small></span>, then remove the line 8 comment to get back to <span class="green5"><small>GREEN</small></span>. (Because its so important, well add this test to the main code in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#sec8_3">Section 8.3</a>.)</p></li>
<li><p class="num">Use the safe navigation operator <strong><span class="dark-green"><code>&amp;.</code></span></strong> to simplify the boolean test in line 8 of <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex015">Listing 8.15</a>, as shown in line 8 of <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex031">Listing 8.31</a>.<sup><a id="ch08fn18a" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fn18">18</a></sup> This Ruby feature allows us to condense the common pattern of <strong><span class="dark-green"><code>obj &amp;&amp;</code></span></strong> obj.method into <strong><span class="dark-green"><code>obj&amp;.method</code></span></strong>. Confirm that the tests in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex030">Listing 8.30</a> still pass after the change.</p></li>
</ol>
<p class="footnote"><a id="ch08fn18" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fn18a">18.</a> Thanks to reader Aviv Levinsky for suggesting this addition.</p>
<p class="ex-title" id="ch08ex029"><strong>Listing 8.29:</strong> Commenting out the authentication code, but tests still <span class="green5"><small>GREEN</small></span>.</p>
<p><code>app/controllers/sessions_controller.rb</code></p>
<p class="codelink"><a id="pf0420-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0420-02a">Click here to view code image</a></p>
<div class="example">
<pre><strong><span class="green">class</span></strong> <strong><span class="blue3">SessionsController</span></strong> <span class="ash">&lt;</span> <span class="red">ApplicationController</span>

  <strong><span class="green">def</span></strong> <span class="blue3">new</span>
  <strong><span class="green">end</span></strong>
<span epub:type="pagebreak" id="page_421"></span>
  <strong><span class="green">def</span></strong> <span class="blue3">create</span>
    user <span class="ash">=</span> <span class="red">User</span><span class="ash">.</span>find_by(<span class="violet">email</span>: params<span class="ash">[</span><span class="violet">:session</span><span class="ash">][</span><span class="violet">:email</span><span class="ash">].</span>downcase)
<span class="mark">    <strong><span class="green3">if</span></strong> user <span class="lighblue"># &amp;&amp; user.authenticate(params[:session][:password])</span></span>
      log_in user
      redirect_to user
    <strong><span class="green">else</span></strong>
      flash<span class="ash">.</span>now<span class="ash">[</span><span class="violet">:danger</span><span class="ash">] =</span> <span class="maroon">'Invalid email/password combination'</span>
      render <span class="maroon">'new'</span>
    <strong><span class="green">end</span></strong>
  <strong><span class="green">end</span></strong>

  <strong><span class="green">def</span></strong> <span class="blue3">destroy</span>
  <strong><span class="green">end</span></strong>
<strong><span class="green">end</span></strong></pre>
</div>
<p class="ex-title" id="ch08ex030"><strong>Listing 8.30:</strong> Testing the case of valid user email, invalid password.</p>
<p><code>test/integration/users_login_test.rb</code></p>
<p class="codelink"><a id="pf0421-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0421-02a">Click here to view code image</a></p>
<div class="example">
<pre><span class="green1">require</span> <span class="maroon">'test_helper'</span>

<strong><span class="green">class</span></strong> <strong><span class="blue3">UsersLoginTest</span></strong> <span class="ash">&lt;</span> <span class="red">ActionDispatch</span><span class="ash">::</span><span class="red">IntegrationTest</span>

  <strong><span class="green">def</span></strong> <span class="blue3">setup</span>
    <span class="violet">@user</span> <span class="ash">=</span> users(<span class="violet">:michael</span>)
  <strong><span class="green">end</span></strong>
<span class="mark">  <span class="green3">test</span> <span class="red2">"login with valid email/invalid password"</span> <strong><span class="green3">do</span></strong></span>
    get login_path
    assert_template <span class="maroon">'sessions/new'</span>
<span class="mark">    post login_path, <span class="blue1">params</span>: { <span class="blue1">session</span>: { <span class="blue1">email</span>: <span class="pink1">FILL_IN</span>,</span>
<span class="mark">                                          <span class="blue1">password</span>: <span class="red2">"invalid"</span> } }</span>
    assert_template <span class="maroon">'sessions/new'</span>
    assert_not flash<span class="ash">.</span>empty?
    get root_path
    assert flash<span class="ash">.</span>empty?
  <strong><span class="green">end</span></strong>
  <span class="ash">.</span>
  <span class="ash">.</span>
  <span class="ash">.</span>
<strong><span class="green">end</span></strong></pre>
</div>
<p class="ex-title" id="ch08ex031"><span epub:type="pagebreak" id="page_422"></span><strong>Listing 8.31:</strong> Using the safe navigation operator <strong><span class="dark-green"><code>&amp;.</code></span></strong> to simplify the login code.</p>
<p><code>app/controllers/sessions_controller.rb</code></p>
<p class="codelink"><a id="pf0422-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0422-01a">Click here to view code image</a></p>
<div class="example">
<pre><strong><span class="green">class</span></strong> <strong><span class="blue3">SessionsController</span></strong> <span class="ash">&lt;</span> <span class="red">ApplicationController</span>

  <strong><span class="green">def</span></strong> <span class="blue3">new</span>
  <strong><span class="green">end</span></strong>

  <strong><span class="green">def</span></strong> <span class="blue3">create</span>
    user <span class="ash">=</span> <span class="red">User</span><span class="ash">.</span>find_by(<span class="violet">email</span>: params<span class="ash">[</span><span class="violet">:session</span><span class="ash">][</span><span class="violet">:email</span><span class="ash">].</span>downcase)
<span class="mark">    <strong><span class="green3">if</span></strong> user<span class="ash1">&amp;.</span>authenticate(params<span class="ash1">[</span><span class="blue1">:session</span><span class="ash1">][</span><span class="blue1">:password</span><span class="ash1">]</span>)</span>
      log_in user
      redirect_to user
    <strong><span class="green">else</span></strong>
      flash<span class="ash">.</span>now<span class="ash">[</span><span class="violet">:danger</span><span class="ash">] =</span> <span class="maroon">'Invalid email/password combination'</span>
      render <span class="maroon">'new'</span>
    <strong><span class="green">end</span></strong>
  <strong><span class="green">end</span></strong>

  <strong><span class="green">def</span></strong> <span class="blue3">destroy</span>
    log_out
    redirect_to root_url
  <strong><span class="green">end</span></strong>
<strong><span class="green">end</span></strong></pre>
</div>
</section>
</section>
<section>
<h4 class="h4" id="sec8_2_5">8.2.5 Login Upon Signup</h4>
<p class="noindent">Although our authentication system is now working, newly registered users might be confused, as they are not logged in by default. Because it would be strange to force users to log in immediately after signing up, well log in new users automatically as part of the signup process. To arrange this behavior, all we need to do is add a call to <strong><span class="dark-green"><code>log_in</code></span></strong> in the Users controller <strong><span class="dark-green"><code>create</code></span></strong> action, as shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex032">Listing 8.32</a>.<sup><a id="ch08fn19a" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fn19">19</a></sup></p>
<p class="footnote"><a id="ch08fn19" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fn19a">19</a>. As with the Sessions controller, the <strong><span class="dark-green"><code>log_in</code></span></strong> method is available in the Users controller because of the module inclusion in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex013">Listing 8.13</a>.</p>
<p class="ex-title" id="ch08ex032"><strong>Listing 8.32:</strong> Logging in the user upon signup.</p>
<p><code>app/controllers/users_controller.rb</code></p>
<p class="codelink"><a id="pf0422-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0422-02a">Click here to view code image</a></p>
<div class="example">
<pre><strong><span class="green">class</span></strong> <strong><span class="blue3">UsersController</span></strong> <span class="ash">&lt;</span> <span class="red">ApplicationController</span>

  <strong><span class="green">def</span></strong> <span class="blue3">show</span>
<span epub:type="pagebreak" id="page_423"></span>    <span class="violet">@user</span> <span class="ash">=</span> <span class="red">User</span><span class="ash">.</span>find(params<span class="ash">[</span><span class="violet">:id</span><span class="ash">]</span>)
  <strong><span class="green">end</span></strong>

  <strong><span class="green">def</span></strong> <span class="blue3">new</span>
    <span class="violet">@user</span> <span class="ash">=</span> <span class="red">User</span><span class="ash">.</span>new
  <strong><span class="green">end</span></strong>

  <strong><span class="green">def</span></strong> <span class="blue3">create</span>
    <span class="violet">@user</span> <span class="ash">=</span> <span class="red">User</span><span class="ash">.</span>new(user_params)
    <strong><span class="green">if</span></strong> <span class="violet">@user</span><span class="ash">.</span>save
<span class="mark">      log_in <span class="violet">@user</span></span>
      flash<span class="ash">[</span><span class="violet">:success</span><span class="ash">] =</span> <span class="maroon">"Welcome to the Sample App!"</span>
      redirect_to <span class="violet">@user</span>
    <strong><span class="green">else</span></strong>
      render <span class="maroon">'new'</span>
    <strong><span class="green">end</span></strong>
  <strong><span class="green">end</span></strong>

  <strong><span class="green">private</span></strong>

    <strong><span class="green">def</span></strong> <span class="blue3">user_params</span>
      params<span class="ash">.</span>require(<span class="violet">:user</span>)<span class="ash">.</span>permit(<span class="violet">:name</span>, <span class="violet">:email</span>, <span class="violet">:password</span>,
                                   <span class="violet">:password_confirmation</span>)
    <strong><span class="green">end</span></strong>
<strong><span class="green">end</span></strong></pre>
</div>
<p class="indent">To test the behavior from <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex032">Listing 8.32</a>, we can add a line to the test from <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml#ch07ex031">Listing 7.31</a> to check that the user is logged in. Its helpful in this context to define an <strong><span class="dark-green"><code>is_logged_in?</code></span></strong> helper method to parallel the <strong><span class="dark-green"><code>logged_in?</code></span></strong> helper defined in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex018">Listing 8.18</a>, which returns <strong><span class="dark-green"><code>true</code></span></strong> if theres a user id in the (test) session and false otherwise (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex033">Listing 8.33</a>). (Because helper methods arent available in tests, we cant use the <strong><span class="dark-green"><code>current_user</code></span></strong> as in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex018">Listing 8.18</a>, but the <strong><span class="dark-green"><code>session</code></span></strong> method is available, so we use that instead.) Here we use <strong><span class="dark-green"><code>is_logged_in?</code></span></strong> instead of <strong><span class="dark-green"><code>logged_in?</code></span></strong> so that the test helper and Sessions helper methods have different names, which prevents them from being mistaken for each other.<sup><a id="ch08fn20a" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fn20">20</a></sup> (In this case we could actually just include the Sessions helper and use <strong><span class="dark-green"><code>logged_in?</code></span></strong> directly, but this technique would fail in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch09.xhtml#ch09">Chapter 9</a> <span epub:type="pagebreak" id="page_424"></span>due to details of how cookies are handled in tests, so instead we define a test-specific method that will work in all cases.)</p>
<p class="footnote"><a id="ch08fn20" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fn20a">20</a>. For example, I once had a test suite that was <span class="green5"><small>GREEN</small></span> even after I accidentally deleted the main <strong><span class="dark-green"><code>log_in</code></span></strong> method in the Sessions helper. The reason is that the tests were happily using a test helper with the same name, thereby passing even though the application was completely broken. As with <strong><span class="dark-green"><code>is_logged_in?</code></span></strong>, well avoid this issue by defining the test helper <strong><span class="dark-green"><code>log_in_as</code></span></strong> in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch09.xhtml#ch09ex024">Listing 9.24</a>.</p>
<p class="ex-title" id="ch08ex033"><strong>Listing 8.33:</strong> A boolean method for checking login status inside tests.</p>
<p><code>test/test_helper.rb</code></p>
<p class="codelink"><a id="pf0424-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0424-01a">Click here to view code image</a></p>
<div class="example">
<pre><span class="red">ENV</span><span class="ash">[</span><span class="maroon">'RAILS_ENV'</span><span class="ash">] ||=</span> <span class="maroon">'test'</span>
<span class="ash">.</span>
<span class="ash">.</span>
<span class="ash">.</span>
<strong><span class="green">class</span></strong> <strong><span class="blue3">ActiveSupport</span></strong><span class="ash">::</span><span class="red">TestCase</span>
  fixtures <span class="violet">:all</span>

  <span class="blue"># Returns true if a test user is logged in.</span>
<span class="mark">  <strong><span class="green">def</span></strong> <span class="blue3">is_logged_in?</span></span>
<span class="mark">    <span class="ash">!</span>session<span class="ash">[</span><span class="violet">:user_id</span><span class="ash">].</span>nil?</span>
<span class="mark">  <strong><span class="green">end</span></strong></span>
<strong><span class="green">end</span></strong></pre>
</div>
<p class="noindent">With the code in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex033">Listing 8.33</a>, we can assert that the user is logged in after signup using the line shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex034">Listing 8.34</a>.</p>
<p class="ex-title" id="ch08ex034"><strong>Listing 8.34:</strong> A test of login after signup. <span class="green5"><small>GREEN</small></span></p>
<p><code>test/integration/users_signup_test.rb</code></p>
<p class="codelink"><a id="pf0424-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0424-02a">Click here to view code image</a></p>
<div class="example">
<pre><span class="green1">require</span> <span class="maroon">'test_helper'</span>

<strong><span class="green">class</span></strong> <strong><span class="blue3">UsersSignupTest</span></strong> <span class="ash">&lt;</span> <span class="red">ActionDispatch</span><span class="ash">::</span><span class="red">IntegrationTest</span>
  <span class="ash">.</span>
  <span class="ash">.</span>
  <span class="ash">.</span>
  <span class="green1">test</span> <span class="maroon">"valid signup information"</span> <strong><span class="green">do</span></strong>
    get signup_path
    assert_difference <span class="maroon">'User.count'</span>, <span class="ash">1</span> <strong><span class="green">do</span></strong>
      post users_path, <span class="violet">params</span>: { <span class="violet">user</span>: { <span class="green1">name</span>: <span class="maroon">"Example User"</span>,
                                         <span class="violet">email</span>: <span class="maroon">"user@example.com"</span>,
                                         <span class="violet">password</span>:              <span class="maroon">"password"</span>,
                                         <span class="violet">password_confirmation</span>: <span class="maroon">"password"</span> } }
    <strong><span class="green">end</span></strong>
    follow_redirect!
    assert_template <span class="maroon">'users/show'</span>
<span class="mark">    assert is_logged_in?</span>
  <strong><span class="green">end</span></strong>
<strong><span class="green">end</span></strong></pre>
</div>
<p class="indent"><span epub:type="pagebreak" id="page_425"></span>At this point, the test suite should still be <span class="green5"><small>GREEN</small></span>:</p>
<p class="ex-title" id="ch08ex035"><strong>Listing 8.35:</strong> <span class="green5"><small>GREEN</small></span></p>
<div class="example">
<pre>$ rails test</pre>
</div>
<section>
<h5 class="h5" id="lev94">Exercises</h5>
<p class="noindent">Solutions to the exercises are available to all Rails Tutorial purchasers at <a href="https://www.railstutorial.org/aw-solutions">https://www.railstutorial.org/aw-solutions</a>.</p>
<p class="indent">To see other peoples answers and to record your own, subscribe to the Rails Tutorial course or to the Learn Enough All Access Bundle.</p>
<ol class="num">
<li><p class="num">Is the test suite <span class="red5"><small>RED</small></span> or <span class="green5"><small>GREEN</small></span> if you comment out the <strong><span class="dark-green"><code>log_in</code></span></strong> line in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex032">Listing 8.32</a>?</p></li>
<li><p class="num">By using your text editors ability to comment out code, toggle back and forth between commenting out code in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex032">Listing 8.32</a> and confirm that the test suite toggles between <span class="red5"><small>RED</small></span> and <span class="green5"><small>GREEN</small></span>. (You will need to save the file between toggles.)</p></li>
</ol>
</section>
</section>
</section>
<section>
<h3 class="h3" id="sec8_3">8.3 Logging Out</h3>
<p class="noindent">As discussed in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#sec8_1">Section 8.1</a>, our authentication model is to keep users logged in until they log out explicitly. In this section, well add this necessary logout capability. Because the Log out link has already been defined (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex019">Listing 8.19</a>), all we need is to write a valid controller action to destroy user sessions.</p>
<p class="indent">So far, the Sessions controller actions have followed the RESTful convention of using <strong><span class="dark-green"><code>new</code></span></strong> for a login page and <strong><span class="dark-green"><code>create</code></span></strong> to complete the login. Well continue this theme by using a <strong><span class="dark-green"><code>destroy</code></span></strong> action to delete sessions, in other words, to log out. Unlike with the login functionality, which we use in both <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex015">Listing 8.15</a> and <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex032">Listing 8.32</a>, well be logging out only in one place, so well put the relevant code directly in the <strong><span class="dark-green"><code>destroy</code></span></strong> action. As well see in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch09.xhtml#sec9_3">Section 9.3</a>, this design (with a little refactoring) will also make the authentication machinery easier to test.<span epub:type="pagebreak" id="page_426"></span></p>
<p class="indent">Logging out involves undoing the effects of the <strong><span class="dark-green"><code>log_in</code></span></strong> method from <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex014">Listing 8.14</a>, which involves deleting the user id from the session.<sup><a id="ch08fn21a" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fn21">21</a></sup> To do this, we use the <strong><span class="dark-green"><code>delete</code></span></strong> method as follows:</p>
<p class="footnote"><a id="ch08fn21" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fn21a">21</a>. Some browsers offer a remember where I left off feature, which restores the session automatically, so be sure to disable any such feature before trying to log out.</p>
<pre class="pre1">session<span class="ash">.</span>delete(<span class="violet">:user_id</span>)</pre>
<p class="noindent">Well also set the current user to <strong><span class="dark-green"><code>nil</code></span></strong>, although in the present case this wont matter because of an immediate redirect to the root URL.<sup><a id="ch08fn22a" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fn22">22</a></sup> As with <strong><span class="dark-green"><code>log_in</code></span></strong> and associated methods, well put the resulting <strong><span class="dark-green"><code>log_out</code></span></strong> method in the Sessions helper module, as shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex036">Listing 8.36</a>.</p>
<p class="footnote"><a id="ch08fn22" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08fn22a">22</a>. Setting <strong><span class="dark-green"><code>@current_user</code></span></strong> to <strong><span class="dark-green"><code>nil</code></span></strong> would matter only if <strong><span class="dark-green"><code>@current_user</code></span></strong> were created before the <strong><span class="dark-green"><code>destroy</code></span></strong> action (which it isnt) <em>and</em> if we didnt issue an immediate redirect (which we do). This is an unlikely combination of events, and with the application as presently constructed it isnt necessary, but because its security-related I include it for completeness.</p>
<p class="ex-title" id="ch08ex036"><strong>Listing 8.36:</strong> The <strong><span class="dark-green"><code>log_out</code></span></strong> method.</p>
<p><code>app/helpers/sessions_helper.rb</code></p>
<p class="codelink"><a id="pf0426-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0426-01a">Click here to view code image</a></p>
<div class="example">
<pre><strong><span class="green">module</span></strong> <strong><span class="blue3">SessionsHelper</span></strong>

  <span class="blue"># Logs in the given user.</span>
  <strong><span class="green">def</span></strong> <span class="blue3">log_in</span>(user)
    session<span class="ash">[</span><span class="violet">:user_id</span><span class="ash">] =</span> user<span class="ash">.</span>id
  <strong><span class="green">end</span></strong>
  <span class="ash">.</span>
  <span class="ash">.</span>
  <span class="ash">.</span>
  <span class="blue">#</span> <span class="blue">Logs out the current user.</span>
  <strong><span class="green">def</span></strong> <span class="blue3">log_out</span>
<span class="mark">    session<span class="ash">.</span>delete(<span class="violet">:user_id</span>)</span>
<span class="mark">    <span class="violet">@current_user</span> <span class="ash">=</span> <strong><span class="green">nil</span></strong></span>
  <strong><span class="green">end</span></strong>
<strong><span class="green">end</span></strong></pre>
</div>
<p class="indent">We can put the <strong><span class="dark-green"><code>log_out</code></span></strong> method to use in the Sessions controllers <strong><span class="dark-green"><code>destroy</code></span></strong> action, as shown in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex037">Listing 8.37</a>.<span epub:type="pagebreak" id="page_427"></span></p>
<p class="ex-title" id="ch08ex037"><strong>Listing 8.37:</strong> Destroying a session (user logout).</p>
<p><code>app/controllers/sessions_controller.rb</code></p>
<p class="codelink"><a id="pf0427-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0427-01a">Click here to view code image</a></p>
<div class="example">
<pre><strong><span class="green">class</span></strong> <strong><span class="blue3">SessionsController</span></strong> <span class="ash">&lt;</span> <span class="red">ApplicationController</span>

  <strong><span class="green">def</span></strong> <span class="blue3">new</span>
  <strong><span class="green">end</span></strong>

  <strong><span class="green">def</span></strong> <span class="blue3">create</span>
    user <span class="ash">=</span> <span class="red">User</span><span class="ash">.</span>find_by(<span class="violet">email</span>: params<span class="ash">[</span><span class="violet">:session</span><span class="ash">][</span><span class="violet">:email</span><span class="ash">].</span>downcase)
    <strong><span class="green">if</span></strong> user <span class="ash">&amp;&amp;</span> user<span class="ash">.</span>authenticate(params<span class="ash">[</span><span class="violet">:session</span><span class="ash">][</span><span class="violet">:password</span><span class="ash">]</span>)
      log_in user
      redirect_to user
    <strong><span class="green">else</span></strong>
      flash<span class="ash">.</span>now<span class="ash">[</span><span class="violet">:danger</span><span class="ash">] =</span> <span class="maroon">'Invalid email/password combination'</span>
      render <span class="maroon">'new'</span>
    <strong><span class="green">end</span></strong>
  <strong><span class="green">end</span></strong>

  <strong><span class="green">def</span></strong> <span class="blue3">destroy</span>
<span class="mark">    log_out</span>
<span class="mark">    redirect_to root_url</span>
  <strong><span class="green">end</span></strong>
<strong><span class="green">end</span></strong></pre>
</div>
<p class="indent">To test the logout machinery, we can add some steps to the user login test from <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex027">Listing 8.27</a>. After logging in, we use <strong><span class="dark-green"><code>delete</code></span></strong> to issue a <code>DELETE</code> request to the logout path (<a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08tab01">Table 8.1</a>) and verify that the user is logged out and redirected to the root URL. We also check that the login link reappears and that the logout and profile links disappear. The new steps appear in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex038">Listing 8.38</a>.</p>
<p class="ex-title" id="ch08ex038"><strong>Listing 8.38:</strong> A test for user logout (and an improved test for invalid login). <span class="green5"><small>GREEN</small></span></p>
<p><code>test/integration/users_login_test.rb</code></p>
<p class="codelink"><a id="pf0427-02" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0427-02a">Click here to view code image</a></p>
<div class="example">
<pre><span class="green1">require</span> <span class="maroon">'test_helper'</span>

<strong><span class="green">class</span></strong> <strong><span class="blue3">UsersLoginTest</span></strong> <span class="ash">&lt;</span> <span class="red">ActionDispatch</span><span class="ash">::</span><span class="red">IntegrationTest</span>

  <strong><span class="green">def</span></strong> <span class="blue3">setup</span>
    <span class="violet">@user</span> <span class="ash">=</span> users(<span class="violet">:michael</span>)
  <strong><span class="green">end</span></strong>

<span class="mark">  <span class="green3">test</span> <span class="red2">"login with valid email/invalid password"</span> <strong><span class="green3">do</span></strong></span>
<span epub:type="pagebreak" id="page_428"></span>    get login_path
    assert_template <span class="maroon">'sessions/new'</span>
<span class="mark">    post login_path, <span class="blue1">params</span>: { <span class="blue1">session</span>: { <span class="blue1">email</span>:    <span class="blue1">@user</span><span class="ash1">.</span>email,</span>
<span class="mark">                                          <span class="blue1">password</span>: <span class="red2">"invalid"</span> } }</span>
<span class="mark">    assert_not is_logged_in?</span>
    assert_template <span class="maroon">'sessions/new'</span>
    assert_not flash<span class="ash">.</span>empty?
    get root_path
    assert flash<span class="ash">.</span>empty?
  <strong><span class="green">end</span></strong>

<span class="mark">  <span class="green3">test</span> <span class="red2">"login with valid information followed by logout"</span> <strong><span class="green3">do</span></strong></span>
    get login_path
    post login_path, <span class="violet">params</span>: { <span class="violet">session</span>: { <span class="violet">email</span>:    <span class="violet">@user</span><span class="ash">.</span>email,
                                          <span class="violet">password</span>: <span class="maroon">'password'</span> } }
<span class="mark">    assert is_logged_in?</span>
    assert_redirected_to <span class="violet">@user</span>
    follow_redirect!
    assert_template <span class="maroon">'users/show'</span>
    assert_select <span class="maroon">"a[href=?]"</span>, login_path, <span class="violet">count</span>: <span class="ash">0</span>
    assert_select <span class="maroon">"a[href=?]"</span>, logout_path
    assert_select <span class="maroon">"a[href=?]"</span>, user_path(<span class="violet">@user</span>)
    delete logout_path
<span class="mark">    assert_not is_logged_in?</span>
<span class="mark">    assert_redirected_to root_url</span>
<span class="mark">    follow_redirect!</span>
<span class="mark">    assert_select <span class="red2">"a[href=?]"</span>, login_path</span>
<span class="mark">    assert_select <span class="red2">"a[href=?]"</span>, logout_path,      <span class="blue1">count</span>: 0</span>
<span class="mark">    assert_select <span class="red2">"a[href=?]"</span>, user_path(<span class="blue1">@user</span>), <span class="blue1">count</span>: 0</span>
  <strong><span class="green">end</span></strong>
<strong><span class="green">end</span></strong></pre>
</div>
<p class="noindent">(Now that we have <strong><span class="dark-green"><code>is_logged_in?</code></span></strong> available in tests, weve also thrown in a bonus <strong><span class="dark-green"><code>assert is_logged_in?</code></span></strong> immediately after posting valid information to the sessions path. Weve also added a similar assertion and the solution to the exercise from <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#sec8_2_4">Section 8.2.4</a> by adding the results of <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex030">Listing 8.30</a>.)</p>
<p class="indent">With the session <strong><span class="dark-green"><code>destroy</code></span></strong> action thus defined and tested, the initial signup/-login/logout triumvirate is complete, and the test suite should be <span class="green5"><small>GREEN</small></span>:</p>
<p class="ex-title" id="ch08ex039"><strong>Listing 8.39:</strong> <span class="green5"><small>GREEN</small></span></p>
<div class="example">
<pre>$ rails test</pre>
</div>
<section>
<h5 class="h5" id="lev95"><span epub:type="pagebreak" id="page_429"></span>Exercises</h5>
<p class="noindent">Solutions to the exercises are available to all Rails Tutorial purchasers at <a href="https://www.railstutorial.org/aw-solutions">https://www.railstutorial.org/aw-solutions</a>.</p>
<p class="indent">To see other peoples answers and to record your own, subscribe to the Rails Tutorial course or to the Learn Enough All Access Bundle.</p>
<ol class="num">
<li><p class="num">Confirm in a browser that the Log out link causes the correct changes in the site layout. What is the correspondence between these changes and the final three steps in <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#ch08ex038">Listing 8.38</a>?</p></li>
<li><p class="num">By checking the site cookies, confirm that the session is correctly removed after logging out.</p></li>
</ol>
</section>
</section>
<section>
<h3 class="h3" id="sec8_4">8.4 Conclusion</h3>
<p class="noindent">With the material in this chapter, our sample application has a fully functional login and authentication system. In the next chapter, well take our app to the next level by adding the ability to remember users for longer than a single browser session.</p>
<p class="indent">Before moving on, merge your changes back into the master branch:</p>
<p class="codelink"><a id="pf0429-01" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08_images.xhtml#pf0429-01a">Click here to view code image</a></p>
<pre class="pre1">$ rails test
$ git add -A
$ git commit -m "Implement basic login"
$ git checkout master
$ git merge basic-login</pre>
<p class="noindent">Then push up to the remote repository:</p>
<pre class="pre1">$ rails test
$ git push</pre>
<p class="noindent">Finally, deploy to Heroku as usual:</p>
<pre class="pre1">$ git push heroku</pre>
<section>
<h4 class="h4" id="sec8_4_1">8.4.1 What We Learned in this Chapter</h4>
<p class="bullet"> Rails can maintain state from one page to the next using temporary cookies via the <strong><span class="dark-green"><code>session</code></span></strong> method.<span epub:type="pagebreak" id="page_430"></span></p>
<p class="bullet"> The login form is designed to create a new session to log a user in.</p>
<p class="bullet"> The <strong><span class="dark-green"><code>flash.now</code></span></strong> method is used for flash messages on rendered pages.</p>
<p class="bullet"> Test-driven development is useful when debugging by reproducing the bug in a test.</p>
<p class="bullet"> Using the <strong><span class="dark-green"><code>session</code></span></strong> method, we can securely place a user id on the browser to create a temporary session.</p>
<p class="bullet"> We can change features such as links on the layouts based on login status.</p>
<p class="bullet"> Integration tests can verify correct routes, database updates, and proper changes to the layout.</p>
</section>
</section>
</section>
<div class="annotator-outer annotator-viewer viewer annotator-hide">
  <ul class="annotator-widget annotator-listing"></ul>
</div><div class="annotator-modal-wrapper annotator-editor-modal annotator-editor annotator-hide">
	<div class="annotator-outer editor">
		<h2 class="title">Highlight</h2>
		<form class="annotator-widget">
			<ul class="annotator-listing">
			<li class="annotator-item"><textarea id="annotator-field-10" placeholder="Add a note using markdown (optional)" class="js-editor" maxlength="750"></textarea></li></ul>
			<div class="annotator-controls">
				<a class="link-to-markdown" href="https://daringfireball.net/projects/markdown/basics" target="_blank">?</a>
				<ul>
					<li class="delete annotator-hide"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#delete" class="annotator-delete-note button positive">Delete Note</a></li>
					<li class="save"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#save" class="annotator-save annotator-focus button positive">Save Note</a></li>
					<li class="cancel"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#cancel" class="annotator-cancel button">Cancel</a></li>
				</ul>
			</div>
		</form>
	</div>
</div><div class="annotator-modal-wrapper annotator-delete-confirm-modal" style="display: none;">
  <div class="annotator-outer">
    <h2 class="title">Highlight</h2>
      <a class="js-close-delete-confirm annotator-cancel close" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#close">Close</a>
      <div class="annotator-widget">
         <div class="delete-confirm">
            Are you sure you want to permanently delete this note?
         </div>
         <div class="annotator-controls">
            <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#cancel" class="annotator-cancel button js-cancel-delete-confirm">No, I changed my mind</a>
            <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#delete" class="annotator-delete button positive js-delete-confirm">Yes, delete it</a>
         </div>
       </div>
   </div>
</div><div class="annotator-adder" style="display: none; top: 4008.68px; left: 300.5px; width: 259px;">
	<ul class="adders expandUp">
		
		<li class="copy"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#">Copy</a></li>
		
		<li class="add-highlight"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#">Add Highlight</a></li>
		<li class="add-note"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#">
			Add Note
		</a></li>
		
	</ul>
</div></div></div>



  <div class="t-sbo-prev sbo-prev sbo-nav-bottom">
  
    
      
        <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch07.xhtml" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">Chapter 7. Sign Up</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-bottom">
  
    
      
        <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch09.xhtml" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">Chapter 9. Advanced Login</div>
        </a>
    
  
  </div>

</section>
  </div>
<section class="sbo-saved-archives"></section>



          
          
  




    
    
      <div id="js-subscribe-nag" class="subscribe-nag clearfix trial-panel t-subscribe-nag collapsed slideUp">
        
        
          <p class="usage-data">Find answers on the fly, or master something new. Subscribe today. <a href="https://learning.oreilly.com/subscribe/" class="ga-active-trial-subscribe-nag">See pricing options.</a></p>
        

        
        

      </div>

    
    



        
      </div>
      
        

<footer class="pagefoot t-pagefoot" style="padding-bottom: 69px;">
  <a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#" class="icon-up" onclick="window.Appcues.track(&#39;JumpTop_HeronBook&#39;)" style="display: block;"><div class="visuallyhidden">Back to top</div></a>
  <ul class="js-footer-nav">
  
    
    <li><a href="https://learning.oreilly.com/public/support/">Support</a></li>
    
    <li><a href="https://learning.oreilly.com/accounts/logout/">Sign Out</a></li>
    
  
  
  </ul>
  <span class="copyright"> 2020 <a href="https://learning.oreilly.com/" target="_blank">O'Reilly Media, Inc</a>.</span>
  
    
    <a href="https://www.oreilly.com/terms/">Terms of Service</a> 
     / 
    
    <a href="https://learning.oreilly.com/privacy">Privacy Policy</a> 
    
    
  
</footer>

      
    
    <script src="./Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition_files/saved_resource(1)" charset="utf-8"></script><script type="text/javascript" id="">(function(){window.medalliaUserIdentifier=document.documentElement.dataset.userUuid;window.medalliaUserName=document.documentElement.dataset.username})();</script>
<script type="text/javascript" id="" src="./Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition_files/embed.js.download"></script>
    <script src="./Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition_files/saved_resource(2)" charset="utf-8"></script>
  

<div></div><div></div><div class="selection_bubble_root" style="display: none;"></div><div class="annotator-notice"></div><div class="font-flyout" style="top: 201.006px; left: 1194.34px;"><div class="font-controls-panel">
	<div class="nightmodes">
		<ul>
			<li class="day"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#" id="day-mode" title="Day Mode">
				<i class="fa fa-sun-o"></i>
				<span>Day Mode</span></a></li>
			<li class="cloudy"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#" id="cloudy-mode" title="Cloudy Mode">
				<i class="fa fa-cloud"></i>
				<span>Cloud Mode</span>
			</a></li>
			<li class="night"><a href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#" id="night-mode" title="Night Mode">
				<i class="fa fa-moon-o"></i>
				<span>Night Mode</span>
			</a></li>
		</ul>
	</div>

	<div class="font-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-font left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-font-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-font right"></i>
		</div>
	</div>

	<div class="column-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-compress left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-column-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-expand right"></i>
		</div>
	</div>

	<a id="reset" class="button" href="https://learning.oreilly.com/library/view/ruby-on-rails/9780136702726/ch08.xhtml#">Reset</a>
</div>
</div><script type="text/javascript" async="" src="./Chapter 8. Basic Login - Ruby on Rails Tutorial, 6th Edition_files/generic1604331345324.js.download" charset="UTF-8"></script><script type="text/javascript" id="">function forceInputUppercase(a){var b=a.target.selectionStart,c=a.target.selectionEnd;a.target.value=a.target.value.toUpperCase();a.target.setSelectionRange(b,c)}void 0!=document.getElementById("id_promotion")&&null!=document.getElementById("id_promotion")&&document.getElementById("id_promotion").addEventListener("keyup",forceInputUppercase,!1);
void 0!=document.getElementsByName("promotionCode")[0]&&null!=document.getElementsByName("promotionCode")[0]&&document.getElementsByName("promotionCode")[0].addEventListener("keyup",forceInputUppercase,!1);</script><script type="text/javascript" id="">var nonwExpandable=document.querySelectorAll(".orm-ff-NavigationSubnav-headerListItem a, .orm-ff-NavigationView-headerListItem a");nonwExpandable.forEach(function(a,b){b+1!=nonwExpandable.length?a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"global nav",eventAct:"navigation",eventLbl:a.childNodes[1].textContent})}):b+1==nonwExpandable.length&&a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"user login",eventAct:"logout",eventLbl:"global nav | unified"})})});
var nonwExpandableFo=document.querySelectorAll(".drop-content li:not(.flyout-parent) a");
nonwExpandableFo.forEach(function(a,b){"drop-content"==a.parentNode.parentNode.parentNode.className&&b+1!=nonwExpandableFo.length?a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"global nav",eventAct:"navigation",eventLbl:a.childNodes[1].textContent})}):"drop-content"==a.parentNode.parentNode.parentNode.className&&b+1==nonwExpandableFo.length&&a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"user login",eventAct:"logout",eventLbl:"global nav | unified"})})});
var expandable=document.querySelectorAll(".orm-ff-NavigationSubnav-toggleControls a, .orm-ff-NavigationView-toggleControls a");expandable.forEach(function(a){a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"global nav",eventAct:"navigation",eventLbl:a.parentNode.parentNode.parentNode.querySelectorAll(".orm-Button-btnContentWrap span")[0].childNodes[1].textContent+" | "+a.textContent})})});var flyoutLinks=document.querySelectorAll(".flyout a");
flyoutLinks.forEach(function(a){a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"global nav",eventAct:"navigation",eventLbl:a.closest("li.flyout-parent").getElementsByTagName("a")[0].textContent+" | "+a.textContent})})});</script><span></span><script type="text/javascript" id="">dataLayer.push({"ld.experiment":void 0,"ld.variation":void 0});</script></body></html>